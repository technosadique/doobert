<?php
$base_url = $this->config->item('base_url');
$owner_id = $this->common_function->get_org_owner_id($this->session->userdata('userid'),$this->session->userdata('org_id'));

$make_array_user = array();
$check_per_flag = '';
$user_permission = $this->common_function->get_permission($this->session->userdata('userid'),$this->session->userdata('org_id'));
					
if(!empty($user_permission)) {
	$make_array_user = unserialize($user_permission);
}
if(empty($profile_setting))
				{
					$first ='yes';
				}
				else
				{
					$first ='no';
				}

if(isset($profile_setting['st_contact'])!='') { 			  
			  		$contact = unserialize($profile_setting['st_contact']); 							   
				} 
				else {
					$contact = '';
				}
$P_location='';					
					
?>
<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en" class="no-js">
<!--<![endif]-->
<!-- BEGIN HEAD --><head>

<meta charset="utf-8"/>
<title>Create Legs - Transportation Details - <?php echo $transport_details['st_org_name']; ?>'s Transportations - Transportation - Doobert</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="" name="description"/>
<meta content="" name="author"/>
<?PHP include APPPATH."views/includes/head-links-inside.php" ?>
<?PHP //include APPPATH."views/includes/head-links.php";?>
<!-- BEGIN PAGE LEVEL STYLES -->
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/plugins/clockface/css/clockface.css"/>
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/plugins/bootstrap-timepicker/css/bootstrap-timepicker.min.css"/>
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/plugins/bootstrap-datetimepicker/css/datetimepicker.css"/>
<link rel="stylesheet" type="text/css" href="<?php echo base_url();  ?>assets/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.css"/>
<?PHP include APPPATH."views/includes/fb_share_meta.php"; ?>
<!-- END PAGE LEVEL STYLES -->
<script type="text/javascript">
var page_id = "<?php echo isset($legs_page)?$legs_page:"1"; ?>";
</script>
<style type="text/css">
.add_legs_btns_wrp a:last-child{margin:0 5px 8px 0}
.btn { padding: 7px 7px !important; }
.ui-sortable tr {
	cursor:pointer;
}
		
.ui-sortable tr:hover {
	background:rgba(244,251,17,0.45);
}
</style>
<!-- BEGIN PAGE LEVEL STYLES -->
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/plugins/bootstrap-fileinput/bootstrap-fileinput.css"/>
<!-- Multiple file upload start -->
<!-- Generic page styles -->
<link rel="stylesheet" href="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/css/style.css">
<!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
<link rel="stylesheet" href="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/css/jquery.fileupload.css">
<link rel="stylesheet" href="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/css/jquery.fileupload-ui.css">
<!-- CSS adjustments for browsers with JavaScript disabled -->

<noscript>
<link rel="stylesheet" href="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/css/jquery.fileupload-noscript.css">
</noscript>
<noscript>
<link rel="stylesheet" href="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/css/jquery.fileupload-ui-noscript.css">
</noscript>
<!-- Multiple file upload end -->
</head>
<!-- BEGIN BODY -->
<body class="page-header-fixed test-match-height test-rows test-responsive test-border-box test-margin test-padding test-border">

<div id="loader" style="display: none;"><img src="<?php echo base_url(); ?>assets/img/ajax-modal-loading.gif" width="32" height="32" align="absmiddle">&nbsp;<span id="loadertext">Loading...</span></div>

<!--Menu Active Link-->
<?php $tab = 3; $subtab = 3.1; $display_menu = 2; ?>

<!-- BEGIN HEADER -->
<?PHP include APPPATH."views/includes/head-content-inside.php" ?>
<?PHP //include APPPATH."views/includes/head-content-login.php"; ?>
<!-- END HEADER -->
<div class="clearfix"> </div>
<!-- BEGIN CONTAINER -->
<div class="page-container">
  <div class="row no-margin">
    <div class="top-searchbar">
      <?PHP include APPPATH."views/includes/quick-links.php"; ?>
      <?PHP include APPPATH."views/includes/app-search.php"; ?>
    </div>
  </div>
  <div class="clearfix"></div>
  <div class="row page-title-bg no-margin">
    <div class="pull-left inner-bg"> 
      <!-- BEGIN PAGE TITLE & BREADCRUMB-->
      <div class="col-lg-5 col-md-5 myaccount no-space">
        <h3 class="page-title">Create Legs</h3>
      </div>
      <div class="app-breadcrumb col-lg-7 col-md-7 no-space">
        <ul class="breadcrumb">
          <li> <a href="<?php echo base_url(); ?>dashboard/">My Account</a> <i class="fa fa-angle-right"></i> </li>
          <li> <a href="<?php echo base_url(); ?>org-dashboard/<?php echo $this->session->userdata('org_id');?>/">Organization</a> <i class="fa fa-angle-right"></i> </li>
          <li> <a href="<?php echo base_url(); ?>organization-transportation/">Transportation</a> <i class="fa fa-angle-right"></i> </li>
          <li> <a href="<?php echo base_url(); ?>org-add-transport/">Transportation Details</a> <i class="fa fa-angle-right"></i> </li>
          <li> <a href="<?php echo base_url(); ?>add-animal-transport/<?php echo $this->session->userdata('transport_id'); ?>">Add Animal to Transportation</a> <i class="fa fa-angle-right"></i> </li>
          <li>Create Legs</li>
        </ul>
      </div>
      <!-- END PAGE TITLE & BREADCRUMB--> 
    </div>
    <?php /*?><div id="simplified-new-transport">
  	<div class="row content-wrapper margin-bottom-10">
				<div id="options" class="row dobt-form no-margin">
              		<div class="gr-wrap col-lg-4 col-md-4 col-sm-4 steps no-right-space finished">
                        <div class="caption">Input Zip Codes</div>
                        <div class="arrow"></div>
                        <div class="bar"></div>
              		</div>
              		<div class="gr-wrap col-lg-4 col-md-4 col-sm-4 steps no-right-space finished" id="add_your_animals">
                        <div class="caption">Select your animals</div>
                        <div class="arrow"></div>
                        <div class="bar completed"></div>
              		</div>
              		<div class="gr-wrap col-lg-4 col-md-4 col-sm-4 steps no-right-space active" id="specify_the_legs">
                        <div class="caption">Specify the legs</div>
                        <div class="arrow"></div>
                        <div class="bar completed"></div>
              		</div>
					<div class="clearfix"></div>
				</div>
                <div class="simplified-info">Add the legs for each stop of the transport.</div>
      </div>
	
  	</div><?php */?>
  </div>
  
  <div class="clearfix"> </div>
  <!-- BEGIN HORIZONTAL MENU PAGE SIDEBAR -->
  <div class="page-sidebar-wrapper">
  <?PHP include APPPATH."views/includes/sidebar_menu-organization.php"; ?>
  </div>
  <!-- END BEGIN HORIZONTAL MENU PAGE SIDEBAR --> 
  <!-- BEGIN CONTENT -->
  <div class="page-content-wrapper">
    <div class="page-content marl0" id="create-legs">
     <?php echo ($Err_Msg!='')?"<div id=\"error_add_transport\" class=\"error\">".$Err_Msg."</div>":""; ?>
     
       <!--Being error section-->
            <div class="row no-margin">
                <!-- File upload error MODAL POPUP-->
<?php /*?><div class="modal fade" id="error_popup" tabindex="-1" role="basic" aria-hidden="true">
								<div class="modal-dialog">
									<div class="modal-content" style="max-height:450px;overflow:auto;">
										<div class="modal-header">
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true"  title="Close"></button>
                                            <h4>Errors!</h4>
										</div>
										<div class="modal-body">
                                        
											<h4><?php echo $this->session->flashdata('leg_upload_error'); ?></h4>
										</div>
									</div>
									<!-- /.modal-content -->
								</div>
								<!-- /.modal-dialog -->
							</div><?php */?>
                            
		<div class="modal fade" id="error_popup" tabindex="-1" role="dialog" aria-hidden="true">
								<div class="modal-dialog">
									<div class="modal-content">
										<div class="modal-header">
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true"  title="Close"></button>                               
										</div>
										<div class="modal-body">
                                        
											<?php echo $this->session->flashdata('leg_upload_error'); ?>
										</div>                                         									 
									</div>
									<!-- /.modal-content -->
								</div>
								<!-- /.modal-dialog -->
							</div>                            
<!-- File upload error MODAL POPUP-->
				<!-- File upload success MODAL POPUP-->
<?php /*?><div class="modal fade" id="leg_upload_success_popup" tabindex="-1" role="basic" aria-hidden="true">
								<div class="modal-dialog">
									<div class="modal-content">
										<div class="modal-header no-border">
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true" title="Close"></button>
										</div>
										<div class="modal-body">
                                        
											<h4 style="margin-top:-10px;"><?php echo $this->session->flashdata('leg_upload_success'); ?></h4>
										</div>
									</div>
									<!-- /.modal-content -->
								</div>
								<!-- /.modal-dialog -->
							</div><?php */?>
                            
<div class="modal fade" id="leg_upload_success_popup" tabindex="-1" role="basic" aria-hidden="true">
								<div class="modal-dialog">
									<div class="modal-content">
										<div class="modal-header no-border">
											<button type="button" class="close" onClick="javascript:window.location='<?php echo base_url(); ?>transport-create-legs/'" title="Close"></button>                                           
										</div>
										<div class="modal-body">                                        
											<?php echo $this->session->flashdata('leg_upload_success'); ?>
										</div>
									</div>
									<!-- /.modal-content -->
								</div>
								<!-- /.modal-dialog -->
							</div>                            
<!-- File upload success MODAL POPUP-->
            <!--End error section--> 

            <?php // added by amit ...7-2-2017 ?>
                  <div class="modal fade" id="portlet-config" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
                  <div class="modal-dialog" id="edit-tranp-date">
                    <form class="horizontal-form" role="form" id="edit_date" name="edit_date" enctype="multipart/form-data" action="" method="post">
                      <div class="modal-content">
                        <div class="modal-header">
                          <button aria-hidden="true" data-dismiss="modal" class="close empty_dates" type="button" title="Close" onClick="resetdropdown();"></button>
                          <h4 class="modal-title">Information</h4>
                        </div>
                        <div class="modal-body">
                          <div class="form-group">
                            <label class="control-label col-md-12" style="text-align:center;">We have saved your transport to your draft list.</label>
                          </div>
                          <div class="clearfix"></div>
                        </div>
                        <div class="modal-footer no-margin">
                          <button class="btn pink dobt-btn" title="OK" type="button" name="c_date1" id="c_date1">OK</button>
                          <button class="btn grey dobt-btn" title="Cancel" type="button"  name="c_date" id="c_date">Cancel</button>
                        </div>
                      </div>
                    </form>
                    <!-- /.modal-content --> 
                  </div>
                  <!-- /.modal-dialog --> 
                </div>



            
      <!-- BEING PAGE CONTENT-->
      <div id="simplified-new-transport" class="legstransport-info">
	  <div class="row content-wrapper marlr0">
          <div id="options" class="row dobt-form no-margin">
            <div class="gr-wrap col-lg-4 col-md-4 col-sm-4 steps no-right-space finished">
              <div class="caption">Input locations</div>
              <div class="arrow"></div>
              <div class="bar completed"></div>
            </div>
            <div class="gr-wrap col-lg-4 col-md-4 col-sm-4 steps no-right-space active">
              <div class="caption">Select your animals</div>
              <div class="arrow"></div>
              <div class="bar completed"></div>
            </div>
            <div class="gr-wrap col-lg-4 col-md-4 col-sm-4 steps no-right-space active">
              <div class="caption">Specify the legs</div>
              <div class="arrow"></div>
              <div class="bar completed"></div>
            </div>
            <div class="clearfix"></div>
          </div>
        </div>
		<div class="simplified-info">Add the legs for each stop of the transport.</div>
	  </div>
	  <div class="clear"></div>
      <input type="hidden" name="leg_deleted" id="leg_deleted" value="">
      <form class="horizontal-form" role="form" id="addlegs" name="addlegs" enctype="multipart/form-data" action="" method="post">
        <div class="row content-wrapper marlr0">
          <div class="row dobt-form no-margin">
            <div class="gr-wrap col-lg-3 col-md-4 col-sm-5">
            <div class="transport-top-left-heading">
              <div class="id">#DBT<?php echo $transport_details['in_transportation_id'];?></div>
              <div class="calendar"><i class="fa fa-calendar"></i><?php echo date("l, M d",strtotime($transport_details['dt_target']));?></div>
              <div class="clearfix"></div>
              </div>
              <div class="fromtolocation">
                <div class="row no-margin">
                  <div class="gr-wrap col-lg-12 col-md-12 col-sm-12">
                  
                  	<p class="trans-from-info"><span>From:</span> <?php echo ($transport_details['st_from_city']?$transport_details['st_from_city'].", ":"").($transport_details['st_from_state']?$transport_details['st_from_state'].", ":""); ?> on <span class="date"><?php echo date("M d",strtotime($transport_details['dt_pickup_date']));?></span></p>
                    <p class="trans-to-info"><span>To:</span> <?php echo ($transport_details['st_to_city']?$transport_details['st_to_city'].", ":"").($transport_details['st_to_state']?$transport_details['st_to_state'].", ":""); ?> on <span class="date"><?php echo date("M d",strtotime($transport_details['dt_target']));?></span></p>
                    
                  </div>
                  
                </div>
              </div>
              <div class="milescovered"><i class="fa fa-thumbs-up"></i>  <?php /*?><a href="http://www.facebook.com" target="_blank" title="Share"></a><?php */?>
              <?php /*?><a href="javascript:void(0);" title="Facebook" onClick="window.open('https://www.facebook.com/sharer/sharer.php?s=100&p[url]=<?php echo $UrlTopass; ?>&p[images][0]=<?php echo $fb_image;?>&p[title]=Doobert&p[summary]=<?php echo addslashes(substr($transport_details['st_additional_info'],0,60)); ?>','popup','height=300,width=450,left=400,top=300,resizable=no,scrollbars=no,toolbar=no,menubar=no,location=no,directories=no,status=no');"></a><?php */?>
              <span><?php echo ($transport_details['cover_dis_per']>100) ? "100" : $transport_details['cover_dis_per'];?>%</span> of <?php echo number_format($transport_details['in_tot_distance'],"2",".","");?> miles covered</div>
              <div class="clearfix"></div>
			  
			  <div class="transport-coordinator-info">
              <h3>Transport Coordinator</h3>
              <div class="transport-detail coord">
                <?php 
                      if($transport_details['st_profile_image']!='' && file_exists($this->config->item('upload')."profile/140x140/".$transport_details['st_profile_image']))
                      {
                          $image_url  = $this->config->item('upload_url')."profile/63x63/".$transport_details['st_profile_image'];
                      }
                      else
                      {
                          $image_url  = $this->config->item('upload_url')."profile/63x63/no_photo_icon.png";
                      }
				?>
                <div class="logo"><img src="<?php echo $image_url; ?>" alt="<?php echo $image_url; ?>" title="<?php echo $image_url; ?>"></div>
                <div class="cocordinator-info create-cocordinator-info" style="position:relative;">
                <?php
				$link_name 	= $this->common_function->get_filtered_name($transport_details['st_display_name']);
				$url_link 	= base_url()."user-".$transport_details['in_user_id']."-".$link_name."/";
				?>
				<?php
					$check_user = $this->common_model->get_user_verified($transport_details['in_user_id']);
 					if(!empty($check_user)) { 
					   $class = 'bg-green-logo'; 
					   $title = date('F j, Y',strtotime($check_user['dt_doobert_verified']));
					   $verify_tag = '<img src="'.base_url().'assets/img/green_logo.png" title="'.$title.'" />';
				   }else { $class = 'bg-gray-logo'; 
						   $title = '';
						   $verify_tag = '<img src="'.base_url().'assets/img/gray_logo.png" title="'.$title.'" />';
				   } 
				   
				   $check_user_arpa = $this->common_model->check_arpa_certifcate_status($transport_details['in_user_id']);
						if(!empty($check_user_arpa) && $check_user_arpa['st_arpa_cert'] =='Y') { 
							$arpa_title = date('F j, Y',strtotime($check_user_arpa['dt_arpa_cert']));
							$image_cert_url = base_url().'assets/img/arpa-certified.png'; 
						} else {
							$arpa_title = '';
							$image_cert_url = base_url().'assets/img/arpa-certified-grey.png'; 
						} 
				   
				   ?>
				   <div class="" title="">
                 
					<span class="name"> <a href="<?php echo $url_link;?>"><?php echo $transport_details['st_display_name'];?></a> </span>                  
					
					<div class="right-verified-logo">	
						<?php echo $verify_tag; ?>
						<img src='<?php echo $image_cert_url;  ?>' title='<?php echo $arpa_title; ?>' />
					</div>
				  
                   <?php if($transport_details['in_public']=='1'){?>
                    <?php if($first=='no'){ if(is_array($contact) && in_array('st_address1',$contact)){?>
                   <p class="map"><i class="fa fa-map-marker"></i> <?php 
				   	  			    $trans_add = '';
									if(isset($transport_details['st_city']) && $transport_details['st_city'] != ''){
									$trans_add .= $transport_details['st_city'].", ";
									}
									if(isset($transport_details['st_state']) && $transport_details['st_state'] != ''){
									$trans_add .= $transport_details['st_state'].", ";
									}
									if(isset($transport_details['st_zip']) && $transport_details['st_zip'] != ''){
									$trans_add .= $transport_details['st_zip'];
									}				
									echo $trans_add;?> </p>
                   <?php } elseif($first=='yes'){  } } else {  ?> 
                    <p class="map"><i class="fa fa-map-marker"></i> <?php 
					 				$trans_add = '';
									if(isset($transport_details['st_city']) && $transport_details['st_city'] != ''){
									$trans_add .= $transport_details['st_city'].", ";
									}
									if(isset($transport_details['st_state']) && $transport_details['st_state'] != ''){
									$trans_add .= $transport_details['st_state'].", ";
									}
									if(isset($transport_details['st_zip']) && $transport_details['st_zip'] != ''){
									$trans_add .= $transport_details['st_zip'];
									}				
									echo $trans_add;?> </p>              
                   <?php } ?>
                  <?php } ?>
				  </div>
                </div>
                <div class="clearfix"></div>
              </div>
			  </div>
            </div>
            <div class="gr-wrap col-lg-9 col-md-8 col-sm-7 tabs overflowvi">
            
              <div class="bg">
                <ul class="nav nav-pills fl marb0">
                 <?php if(empty($leg_page_link)){ ?><li class="active"><a href="#tab_2_1" data-toggle="tab">Legs</a></li><?php } ?>
                  <?php for($m=1;$m<=count($leg_page_link);$m++)
						{ ?>
                <li id="r_map<?php echo $m;?>"   <?php if($leg_page_link[$m]['selected']==$m){ echo "class=\"active\""; }  ?>><a href="<?php echo $this->config->item('base_url')."transport-create-legs/".$m; ?>" id="route_tab_<?php echo $m;?>"><?php echo ($m=='1')?"Legs":"";?> <?php echo $leg_page_link[$m]['text'];?></a> </li>
                <?php } ?>
                </ul>
				<div class="clearfix"></div>
              </div>
			  <div class="clearfix"></div>
              <div class="tab-content">
                <div class="tab-pane fade active in" id="tab_2_1">
                <script type="text/javascript">
							var q 		= 0;
							var flag 	= '';
							var edit_q	= '';
							var tr_cnt	= '';
							var myArray = new Array();
							var way = new Array();
				</script>
                  
                  
                  <p class="list" id="leg_details_p">List of Created Legs</p>
                  <div class="table-responsive marb20" id="leg_details_div">
                    <table class="table table-striped table-hover" id="leg_table">
                      <thead>
                        <tr>
                          <th nowrap>Leg #</th>
                          <th>Pick Up Address</th>
                          <th>Drop Off Address</th>
                          <th>Start Time</th>
                          <th>End Time</th>
                          <th>Meeting Location</th>
                           <?php
				  			if($transport_details['st_trans_type']=='P'){
					  		?>
                          <th nowrap class="w130">Action</th>
                          <?php } ?>
                        </tr>
                      </thead>
                      <tbody id="leg_table_body">
                      <?php
					  $i = 0;
					?>
                     <?php					  
					 if(isset($leg_details) && !empty($leg_details))
					 {
						 $id = 0;;
						 $base_date = '';
						  foreach($leg_details as $key=>$value)
						  {
							  $id++;
							  if(isset($value['meeting_location']) && $value['meeting_location'] != '')
							  {
							  	  $meeting_location1 = '';
								  $meeting_location = $value['meeting_location'];
								  $meeting_location_length = strlen($meeting_location);
								  
								  $meeting_location1 = substr($meeting_location,0,9);
								 
								  if($meeting_location_length > 10)							  
								  {
									$meeting_location1 .= '...'; 
								  }
							  }
							  
							  if($value['route_type_id']=='1' || $value['route_type_id']=='0') {
							   if(isset($value['pick_start_time']) && $value['pick_start_time'] != '')
							   {
							  $pick_date = date("d M y - h:i A",strtotime($value['pick_start_time']));
							   }
							   if(isset($value['drop_start_time']) && $value['drop_start_time'] != '')
							   {
							  $drop_date = date('d M y - h:i A', strtotime($value['drop_start_time']));
							   }
							  
							  if(isset($value['pick_start_time']) && $value['pick_start_time'] != '' && isset($value['drop_start_time']) && $value['drop_start_time'] != '')
							  if(strtotime($value['drop_start_time'])>strtotime($value['pick_start_time']) && strtotime($value['drop_start_time'])>strtotime($base_date)){$base_date =  date('d M y h:i A',strtotime($value['drop_start_time'])); }
							  ?>
							  
								<tr id="tr_<?php echo $id; ?>" data-leg-id="<?php echo $value['leg_id']; ?>" data-sort-order="<?php echo (isset($value['in_sort_order']) && $value['in_sort_order'] > 0 ) ? $value['in_sort_order'] : $id; ?>">
								<td class="priority">
								<span class="glyphicon glyphicon-move"></span>
								<?php echo (isset($value['in_sort_order']) && $value['in_sort_order'] > 0) ? $value['in_sort_order']."." : $id."."; ?> 
                                <?php if($value['no_of_drivers_pilots'] >= 2){ ?>
                                <span class="leg-fa-users"><i class="fa fa-users"></i></span>
                                <?php } ?>
                                </td>
								<td><?php echo (($value['route_type_id']==1)?"Zip Code/Airport Id: ":"").(isset($value['pick_street']) && $value['pick_street'] != '' ? stripslashes($value['pick_street']).", ":"").(isset($value['pick_city']) && $value['pick_city'] != '' ? stripslashes($value['pick_city']).", ":"").(isset($value['pick_state']) && $value['pick_state'] != '' ? stripslashes($value['pick_state']):"").(isset($value['pick_zip']) && $value['pick_zip'] != '' ? ", ".stripslashes($value['pick_zip']):""); ?></td>
								<td><?php echo (($value['route_type_id']==1)?"Zip Code/Airport Id: ":"").(isset($value['drop_street']) && $value['drop_street'] != '' ? stripslashes($value['drop_street']).", ":"").(isset($value['drop_city']) && $value['drop_city'] != '' ? stripslashes($value['drop_city']).", ":"").(isset($value['drop_state']) && $value['drop_state'] != '' ? stripslashes($value['drop_state']):"").(isset($value['drop_zip']) && $value['drop_zip'] != '' ? ", ".stripslashes($value['drop_zip']):""); ?></td>
								<td><?php
								$pick_timezone = isset($value['pick_timezone']) && $value['pick_timezone'] != '' ? $value['pick_timezone'] : '';
								 echo $pick_date." - ".$pick_timezone; ?></td>
								<td><?php
								$drop_timezone  = isset($value['drop_timezone']) && $value['drop_timezone'] != '' ? $value['drop_timezone'] : '';
								 echo $drop_date." - ".$drop_timezone ; ?>	</td>
                                <td class="meet-location"><?php echo (isset($value['meeting_location']) && $value['meeting_location'] != '') ? stripslashes($meeting_location1) : ''; ?>
                                <?php if(isset($value['meeting_location']) && $value['meeting_location'] != '') { ?>
                                <a href="javascript:void(0);" data-toggle="tooltip" data-original-title="<?php echo stripslashes($value['meeting_location']); ?>"  class="eyeicon"><i class="fa fa-eye"></i></a>	<?php } ?>
                                </td>
							    <?php if($transport_details['st_trans_type']=='P'){ ?> 
                                <td>                                
					  			<?php if($value['mark_completed']=='0'){ ?>
                                <a class="edit_legs" href="javascript:void(0);" title="Edit" onClick="edit_leges('<?php echo $id; ?>',$(this));"><i class="fa fa-edit"></i> Edit</a>
                      			<a class="delete-leg" href="javascript:void(0);" title="Delete" onClick="delete_leges('<?php echo $id; ?>',$(this));"><i class="fa fa-trash-o delete-icon"></i></a> 			
								<?php }else { echo "Leg Completed";} ?>
                                <div class="clearfix"></div>
                                </td> 
					  
					  			<?php } ?>
                      		  
							    <script type="text/javascript">
							    var q = '<?php echo $id; ?>';
							  
myArray.push({"pickup_street":'<?php echo addslashes($value['pick_street']);?>',"pickup_city":'<?php echo addslashes($value['pick_city']);?>',"pickup_state":'<?php echo addslashes($value['pick_state']);?>',"pickup_zip":'<?php echo addslashes($value['pick_zip']);?>',"pickup_country":'<?php echo addslashes($value['pick_country']);?>',"clockface_2_modal":'<?php echo $pick_date;?>',"pickup_zone":'<?php echo $value['pick_timezone'];?>',"dropoff_street":'<?php echo addslashes($value['drop_street']); ?>',"dropoff_city":'<?php echo addslashes($value['drop_city']); ?>',"dropoff_state":'<?php echo addslashes($value['drop_state']); ?>',"dropoff_zip":'<?php echo addslashes($value['drop_zip']); ?>',"dropoff_country":'<?php echo addslashes($value['drop_country']);?>',"clockface_3_modal":'<?php echo $drop_date; ?>',"dropoff_zone":'<?php echo $value['drop_timezone']; ?>',"leg_id":'<?php echo $value['leg_id']; ?>',"route_type":'<?php echo $value['route_type']; ?>',"route_type_id":'<?php echo $value['route_type_id']; ?>' ,"pickup_airport":'<?php echo (($value['route_type_id']=='1')?addslashes($value['pick_street']):"");?>',"pickup_airport_clock":'<?php echo (($value['route_type_id']=='1')?$pick_date:"");?>',"pickup_airport_zone":'<?php echo (($value['route_type_id']=='1')?$value['pick_timezone']:"");?>',"dropoff_airport":'<?php echo (($value['route_type_id']=='1')?addslashes($value['drop_street']):"");?>',"dropoff_airport_clock":'<?php echo (($value['route_type_id']=='1')?$drop_date:"");?>',"dropoff_airport_zone":'<?php echo (($value['route_type_id']=='1')?$value['drop_timezone']:"");?>',"dropoff_airport_state":'<?php echo (($value['route_type_id']=='1')?$value['drop_state']:"");?>',"dropoff_airport_city":'<?php echo (($value['route_type_id']=='1')?addslashes($value['drop_city']):"");?>',"pickup_airport_state":'<?php echo (($value['route_type_id']=='1')?addslashes($value['pick_state']):"");?>',"pickup_airport_city":'<?php echo (($value['route_type_id']=='1')?addslashes($value['pick_city']):"");?>',"update_leg":'added',"meeting_location":'<?php echo addslashes($value['meeting_location']);?>',"no_of_drivers":'<?php echo addslashes($value['no_of_drivers_pilots']);?>',"multiple_drivers_pilots":'<?php echo addslashes($value['multiple_drivers_pilots']);?>',"no_of_pilots":'<?php echo addslashes($value['no_of_drivers_pilots']);?>',"pilot_meeting_location":'<?php echo addslashes($value['meeting_location']);?>',"in_sort_order":'<?php echo isset($value['in_sort_order']) ? addslashes($value['in_sort_order']) : $id; ?>'});
							  
							    way.push({"location":"<?php echo $value['pick_street'];?>,<?php echo trim($value['pick_city']);?>,<?php echo $value['pick_state'];?><?php echo $value['pick_zip'];?> <?php echo $value['pick_country'];?>"});
							   </script>
							   </tr>    
                               <?php } ?>
                               
                               <?php if($value['route_type_id']=='2'){ ?>
                               
                               <tr id="tr_<?php echo $id; ?>" data-leg-id="<?php echo $value['leg_id']; ?>" data-sort-order="<?php echo (isset($value['in_sort_order']) && $value['in_sort_order'] > 0 ) ? $value['in_sort_order'] : $id; ?>">
								<td class="priority">
								<span class="glyphicon glyphicon-move"></span>
								<?php echo (isset($value['in_sort_order']) && $value['in_sort_order'] > 0 ) ? $value['in_sort_order']."." : $id."."; ?> 
                                </td>
								<td colspan="5"><strong>Overnight Leg: </strong><?php echo ((isset($value['o_pick_street']) && $value['o_pick_street'] != '' ?stripslashes($value['o_pick_street']).", ":"").($value['o_pick_city']?stripslashes($value['o_pick_city']).", ":"").($value['o_pick_state']?stripslashes($value['o_pick_state']).", ":"").($value['o_pick_zip']? stripslashes($value['o_pick_zip']):"")); ?>
								<p><?php echo (isset($value['overnight_comments']) && $value['overnight_comments'] != '') ? stripslashes($value['overnight_comments']) : '-'; ?>	</p>
                                </td>
							    <?php if($transport_details['st_trans_type']=='P'){ ?> 
                                <td>                                
					  			<?php if($value['mark_completed']=='0'){ ?>
                                <a class="edit_legs" href="javascript:void(0);" title="Edit" onClick="edit_leges('<?php echo $id; ?>',$(this));"><i class="fa fa-edit"></i> Edit</a>
                      			<a class="delete-leg" href="javascript:void(0);" title="Delete" onClick="delete_leges('<?php echo $id; ?>',$(this));"><i class="fa fa-trash-o delete-icon"></i></a> 			
								<?php }else { echo "Leg Completed";} ?>
                                </td> 
					  
					  			<?php } ?>
                      		  
							    <script type="text/javascript">
							    var q = '<?php echo $id; ?>';
							  
							    myArray.push({"o_pickup_street":'<?php echo addslashes($value['o_pick_street']);?>',"o_pickup_city":'<?php echo addslashes($value['o_pick_city']);?>',"o_pickup_state":'<?php echo addslashes($value['o_pick_state']);?>',"o_pickup_country":'<?php echo addslashes($value['o_pick_country']);?>',"o_pickup_zip":'<?php echo addslashes($value['o_pick_zip']);?>',"leg_id":'<?php echo addslashes($value['leg_id']); ?>',"route_type":'<?php echo addslashes($value['route_type']); ?>',"route_type_id":'<?php echo addslashes($value['route_type_id']); ?>',"overnight_comments":'<?php echo addslashes($value['overnight_comments']);?>',"update_leg":'added',"in_sort_order":'<?php echo isset($value['in_sort_order']) ? addslashes($value['in_sort_order']) : $id; ?>'});
						
							   </script>
							   </tr> 
                               <?php }  ?>
                                                          
							   <?php  
						  }
					 }
					  ?>
                      </tbody>
                    </table>
                  </div>
                  
                  <div class="add_legs_btns_wrp" id="add_legs_btns_wrp_hide">
                  <span class="fl">
				  
				  <?php if($transport_details['st_trans_type']=='P'){ ?>
                  <a title="Upload Legs" href="javascript:void(0);" id="upload_leg_excel" class="btn light-green fr upload-leg-btn" onClick="$('#upload_leg_div').modal('show');">Upload Legs</a>
                  <?php } ?>
                  <?php //change the position of save draft button ...Added by Amit 8-2-2017 ?>
				                  <?php if($transport_details['in_status']!='1') { ?>
                  <a title="Save to Draft" href="javascript:void(0);" id="save_draft" class="btn pink-btn">Save to Draft</a>
                  <?php } ?>  
				  
                  </span>
                  
                
                  <span class="fr ipad-flnone">
                  
                  <?php if($transport_details['st_trans_type']=='P'){ ?>
                  <div class="fl">
				  	<div class="btn-group">
									<button class="btn btn-default orange btn-md dropdown-toggle add-legbtn-bg" type="button" data-toggle="dropdown">
									Add Leg <i class="fa fa-angle-down"></i>
									</button>
									<ul class="dropdown-menu" role="menu">
										<li><a href="javascript:void(0);" id="add_aviation_leg_g" class="legs_btn">Ground Leg</a></li>
										<li><a href="javascript:void(0);" id="add_aviation_leg_a" class="legs_btn">Aviation Leg</a></li>
										<li><a href="javascript:void(0);" id="add_aviation_leg_o" class="legs_btn">Overnight Leg</a></li>
									</ul>
								</div>					
                  </div>
				  <?php } ?>
                   <?php if((isset($transport_files) && !empty($transport_files)) || (isset($transport_details['st_add_comments']) && $transport_details['st_add_comments'] != '')){ ?>
				  <a title="Edit Additional Info" href="#edit-additional-info" data-toggle="modal" class="btn dark-blue"><i class="fa fa-edit edit-additional-info"></i> Edit Additional Info</a>
                  <?php }else{ ?>
				  <a title="Add Additional Info" href="#add-additional-info" data-toggle="modal" class="btn dark-blue add-additional-info">Add Additional Info</a>
				  <?php } ?>
				  
<!--                   <?php if($transport_details['in_status']!='1') { ?>
                  <a title="Save to Draft" href="javascript:void(0);" id="save_draft" class="btn pink-btn">Save to Draft</a>
                  <?php } ?> -->
                  <a href="javascript:void(0);" id="save_legs" class="btn pink-btn"  title="Save & Publish" >Save & Publish</a>
				   <?php if($transport_details['in_status']=='1') { ?>
				   <a href="javascript:void(0);" id="save_only" class="btn pink-btn"  title="Save Only" >Save Only</a>
					<?php } ?>
				  </span>
                  </div>
                  
                   <div class="clearfix"></div>
                   
				  <div  class="fr" id="loadimg"></div>	              
                  <div class="clearfix"></div>
                  <input type="hidden" id="distance_covered" value="<?php echo (number_format($transport_details['in_distance_covered'],"2",".","")<=0)?"0":number_format($transport_details['in_distance_covered'],"2",".","");?>">
                  <input type="hidden" id="distance_total" value="<?php echo (number_format($transport_details['in_tot_distance'],"2",".","")<=0)?"0":number_format($transport_details['in_tot_distance'],"2",".","");?>">
                  <input type="hidden" id="distance_remaining" 
                  value="<?php echo ((number_format($transport_details['in_tot_distance'],"2",".","")- number_format($transport_details['in_distance_covered'],"2",".",""))<=0)?"0": (number_format($transport_details['in_tot_distance'],"2",".","")-number_format($transport_details['in_distance_covered'],"2",".",""));?>">
                  
                  <p class="distance" id="distance_remain" style="float:left;">Distance Remaining: <?php echo (number_format($transport_details['remin_distance'],"2",".","")<=0)?"0":number_format($transport_details['remin_distance'],"2",".","");?> miles</p>
                  <div id="map-seach-wrap" style="position:inherit !important;float:right;top:0;width:365px">
               	<?php /*?><form name="map_search" id="map_search" action="" method="post" class="form-horizontal form-row-seperated"><?php */?>
          		<div class="col-md-3 no-space select-box-wrp">
              <div class="form-group">
                <label class="show">Show:</label>
                <div class="user-type">
                  <select class="bs-select form-control white-btn" id="recent_activity" name="recent_activity">
                    <option <?php if($this->session->userdata('recent_activity')=='1'){?> selected="selected" <?php } ?> value="1">All User Types</option>
                    <option <?php if($this->session->userdata('recent_activity')=='D'){?> selected="selected" <?php } ?> value="D">Driver</option>
                    <option <?php if($this->session->userdata('recent_activity')=='P'){?> selected="selected" <?php } ?> value="P">Pilot</option>	                  </select>
                </div>
              </div>
            </div>
            	<input type="submit" title="Go" value="Go" name="go" id="go" class="go-button">
				<span class="btn light-green transport-view-map map" style="margin-top:0px;" title="View Map"><i class="fa fa-eye"></i> View Map</span>
          		<div class="clearfix"></div>
        		
                  </div>
                  
                  <div class="clearfix"></div>
                  <?php if($transport_details['st_trans_type']=='P'){ ?>
                  <div id="address_display" style="display:none">
                  <p class="selectpick"><span><span class="require">*</span> Required Fields</span>Type address into below inputs.</p>
                  <div class="clearfix"></div>
                  <div id="form">
                  	<div class="col-lg-12 multi-driver-wraper">
                  	<div class="creatleg-multiple-drivers">
                    <div class="multi-driver">
                    <input type="hidden" name="multiple_drivers_txt" id="multiple_drivers_txt" value="">
                  	<div class="checkbox-list">
                       <label>
                       <input type="checkbox" id="multiple_drivers" name="multiple_drivers"> Multiple Drivers
                       </label>                       
                    </div>
                    

                  </div>
                  	<div class="no-of-drivers-div">
                    <div class="form-group" id="no_of_drivers_div" style="display:none;">
                              <label for="no_of_drivers" class="control-label"> | Number of Drivers needed: </label>
                              <select class="form-control" name="no_of_drivers" id="no_of_drivers">
                                <option value="" selected="selected">Select</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                              </select>
                    </div>
                    </div>                   
                    <div class="clearfix"></div>    
 					</div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="row dobt-form no-margin">
                      <div class="gr-wrap col-lg-6 col-md-6 col-sm-12 padr20">
                        <p class="head">Pick Up Address</p>
                        <div class="box">
                          <div class="col-md-12 no-left-space no-right-space smaller">
                            <div class="form-group">
                              <label class="control-label" for="pickup_street">Street:</label>
                              <input type="text" class="form-control" id="pickup_street" name="pickup_street" maxlength="50" placeholder="Enter Street Address">
                              <input type="hidden" id="leg_id" name="leg_id" maxlength="50" value="" >
                              <input type="hidden" id="update_leg" name="update_leg" maxlength="50" value="">
                            </div>
                          </div>
						  
						  <div class="col-md-12 no-left-space no-right-space smaller">
                            <div class="form-group">
                              <label class="control-label" for="pickup_Location">Pick Up Location: <span class="required">*</span></label>
                              <input type="text" class="form-control" id="pickup_location" name="pickup_location" maxlength="250" placeholder="Enter From City, State or Zip" value="<?php echo $P_location; ?>">
                            </div>
                          </div>
						  <input type="hidden" id="pickup_city" name="pickup_city" maxlength="50" onBlur="get_zip('pickup_city','pickup_state','pickup_zip');"> 
						  <!-- value="<?php echo $transport_details['st_from_city'];?>"  value="<?php echo $transport_details['st_from_state']?>"   value="<?php echo $transport_details['st_from_country'];?>" value="<?php echo $transport_details['st_from_zip'];?>" -->
						   <input type="hidden"   id="pickup_state" name="pickup_state" maxlength="50" onBlur="get_zip('pickup_city','pickup_state','pickup_zip');">
						   <input type="hidden" id="pickup_country"   name="pickup_country" onBlur="get_zip('pickup_city','pickup_state','pickup_zip');">
						    <input type="hidden" id="pickup_zip"   name="pickup_zip" onBlur="get_zip('pickup_city','pickup_state','pickup_zip');">
						
                          <div class="clearfix"></div>
                       <!--  <div class="col-lg-6 col-md-6 col-sm-6 no-left-space  smaller column  marr18">
                            <div class="form-group">transport_details['st_from_zip']
                              <label class="control-label" for="pickup_city">City: <span class="required">*</span></label>
                              <input type="text" class="form-control" onBlur="get_zip('pickup_city','pickup_state','pickup_zip');" id="pickup_city" name="pickup_city" maxlength="50">

                            </div>
                          </div>
                          <div class="col-lg-6 col-md-6 col-sm-6 no-left-space no-right-space smaller column">
                            <div class="form-group">
                              <label class="control-label" for="pickup_state">State: <span class="required">*</span></label>
                              <select id="pickup_state" class="form-control" name="pickup_state" onChange="get_zip('pickup_city','pickup_state','pickup_zip');">
                                <option value="">Select</option>
                                <?php 
							   foreach($state_list as $key=>$value)
							   {
								?>
													<option value="<?php echo $key;?>"><?php echo $value;?></option>
													<?php   
							   }
							  ?>
                              </select>

                            </div>
                          </div>
                          
                          <div class="clearfix"></div>
                          <div class="col-lg-6 col-md-6 col-sm-6 no-left-space  smaller column  marr18">
                            <div class="form-group">
                              <label class="control-label" for="pickup_country">Country: <span class="required">*</span></label>
                              <select id="pickup_country" data-address="pickup" class="form-control" name="pickup_country">
							 <?php foreach($country_list as $key=>$value)
                              {
                              ?>
                              <option value="<?php echo $key;?>" ><?php echo $value;?></option>
                              <?php    
                              }
                              ?>
								</select>
                            </div>
                          </div>
                          <div class="col-lg-6 col-md-6 col-sm-6 no-left-space no-right-space smaller column">
                            <div class="form-group">
                              <label class="control-label" for="pickup_zip">Zip: <span class="required">*</span></label>
                              <input type="text" class="form-control" id="pickup_zip" name="pickup_zip" maxlength="50">
                            </div>
                          </div> -->
                          
                          <div class="clearfix"></div>
                          <div class="col-lg-6 col-md-6 col-sm-6 no-left-space  smaller column  marr18">
                            <div class="form-group">
                              <label class="control-label" for="clockface_2_modal">Start Time: <span class="required">*</span></label>
                              <div class="input-group date from_date <?php /*?>form_meridian_datetime<?php */?>" data-date="">
                                <input type="text" <?php if(count($leg_details)<=0){ ?> value="<?php echo ($transport_details['dt_pickup_date'])?date("d M y",strtotime($transport_details['dt_pickup_date']))." - 06:00 AM":"";?>" <?php } ?> size="16" name="clockface_2_modal" id="clockface_2_modal" readonly class="form-control ">
                                <span class="input-group-btn">
                                <button class="btn default date-reset" type="button"><i class="fa fa-times"></i></button>
                                </span> <span class="input-group-btn">
                                <button class="btn default date-set" type="button"><i class="fa fa-calendar"></i></button>
                                </span> </div>
                            </div>
                          </div>
						  <div class="col-lg-6 col-md-6 col-sm-6 no-left-space no-right-space smaller column">
                            <div class="form-group">
                              <label class="control-label" for="pickup_zone">Time Zone: <span class="required">*</span></label>
                              <select id="pickup_zone" name="pickup_zone" class="form-control">
                                <option value="">Select</option>
                                <?php 
							   foreach($time_zone as $key=>$value)
							   {
								?>
                                <option <?php if($user_time_zone==$key){ ?>selected <?php } ?> value="<?php echo $key;?>"><?php echo $value;?></option>
                                <?php   
							   }
								?>
                              </select>
                            </div>
                          </div>

                          <div class="clearfix"></div>
                        </div>
                      </div>
                      <div class="gr-wrap col-lg-6 col-md-6 col-sm-12">
                        <p class="head">Drop Off Address</p>
                        <div class="box">
                          <div class="col-md-12 no-left-space no-right-space smaller">
                            <div class="form-group">
                              <label class="control-label" for="dropoff_street">Street:</label>
                              <input type="text" class="form-control" id="dropoff_street" name="dropoff_street" maxlength="50" placeholder="Enter Street Address">
                            </div>
                          </div>
						  
						  <div class="col-md-12 no-left-space no-right-space smaller">
                            <div class="form-group">
                              <label class="control-label" for="dropoff_location">Drop Off Location: <span class="required">*</span></label>
                              <input type="text" class="form-control" id="dropoff_location" name="dropoff_location" maxlength="50" placeholder="Enter To City, State or Zip">
                            </div>
                          </div>
                            <input type="hidden" value="<?php echo $transport_details['st_from_city'];?>" id="dropoff_city" name="dropoff_city" maxlength="50">
						   <input type="hidden"  value="<?php echo $transport_details['st_from_state']?>" id="dropoff_state" name="dropoff_state" maxlength="50">
						   <input type="hidden" id="dropoff_country"  value="<?php echo $transport_details['st_from_country'];?>" name="dropoff_country">
						    <input type="hidden" id="dropoff_zip"  value="<?php echo $transport_details['st_from_zip'];?>" name="dropoff_zip">
                          <div class="clearfix"></div>
                        <!--  <div class="col-lg-6 col-md-6 col-sm-6 no-left-space smaller column marr18">
                            <div class="form-group">
                              <label class="control-label" for="dropoff_city">City: <span class="required">*</span></label>
                              <input type="text" class="form-control" id="dropoff_city" onBlur="get_zip('dropoff_city','dropoff_state','dropoff_zip');" name="dropoff_city" maxlength="50">


                            </div>
                          </div>
                          <div class="col-lg-6 col-md-6 col-sm-6 no-left-space no-right-space smaller column">
                            <div class="form-group">
                              <label class="control-label" for="dropoff_state">State: <span class="required">*</span></label>
                              <select id="dropoff_state" name="dropoff_state" class="form-control" onChange="get_zip('dropoff_city','dropoff_state','dropoff_zip');">
                                <option value="">Select</option>
                                <?php foreach($state_list as $key=>$value) { ?>
                                <option value="<?php echo $key;?>"><?php echo $value;?></option>
                                <?php   } ?>
                              </select>

                            </div>
                          </div>
                          
                          <div class="clearfix"></div>
                          <div class="col-lg-6 col-md-6 col-sm-6 no-left-space smaller column marr18">
                            <div class="form-group">
                              <label class="control-label" for="dropoff_country">Country: <span class="required">*</span></label>
                              <select id="dropoff_country"  data-address="dropoff"  class="form-control" name="dropoff_country">
                                <?php foreach($country_list as $key=>$value)
								  {
								  ?>
								  <option value="<?php echo $key;?>" ><?php echo $value;?></option>
								  <?php    
								  }
								  ?>
								</select>
                            </div>
                          </div>
                          <div class="col-lg-6 col-md-6 col-sm-6 no-left-space no-right-space smaller column">
                            <div class="form-group">
                              <label class="control-label" for="dropoff_zip">Zip: <span class="required">*</span></label>
                              <input type="text" class="form-control" id="dropoff_zip" name="dropoff_zip" maxlength="50">
                            </div>
                          </div> -->
                          <div class="clearfix"></div>
                          <div class="col-lg-6 col-md-6 col-sm-6 no-left-space smaller column marr18">
                            <div class="form-group">
                              <label class="control-label" for="clockface_3_modal">End Time: <span class="required">*</span></label>
                              <div class="input-group date to_date <?php /*?>form_meridian_datetime<?php */?>" data-date="">
                                <input type="text" name="clockface_3_modal" id="clockface_3_modal" size="16" readonly class="form-control">
                                <span class="input-group-btn">
                                <button class="btn default date-reset" type="button"><i class="fa fa-times"></i></button>
                                </span> <span class="input-group-btn">
                                <button class="btn default date-set" type="button"><i class="fa fa-calendar"></i></button>
                                </span> </div>


                            </div>
                          </div>
						   <div class="col-lg-6 col-md-6 col-sm-6 no-left-space no-right-space smaller column">
                            <div class="form-group">
                              <label class="control-label" for="dropoff_zone">Time Zone: <span class="required">*</span></label>
                              <select id="dropoff_zone" name="dropoff_zone" class="form-control">
                                <option value="">Select</option>
                                <?php 
							   foreach($time_zone as $key=>$value)
							   {
								?>
                                <option <?php if($user_time_zone==$key){ ?>selected <?php } ?> value="<?php echo $key;?>"><?php echo $value;?></option>
                                <?php   
							   }
								?>
                              </select>                            </div>
                          </div>
                          <div class="clearfix"></div>
                        </div>
                      </div>
                      <div class="clearfix"></div>
                    </div>
                    
                    <?php /*?><div id="meeting_location_div" style="display:none;"><?php */?>
                    <div id="meeting_location_div" style="display:block;">
                        <div class="row dobt-form no-margin">
                          <div class="gr-wrap col-md-8 review-appication">
                            <div class="form-group">
                             <label class="control-label" for="meeting_location">Meeting Location:</label>
                              <input type="text" id="meeting_location" name="meeting_location" class="form-control" placeholder="Enter your meeting location here..." maxlength="500">
                            </div>
                          </div>
                        </div>                    
                    </div>
                    
                    <div align="center">
                      <button aria-hidden="true" name="submit" id="submit" class="btn orange dobt-btn" type="button" title="+ Add Leg"><i class="fa fa-plus"></i> Add Leg</button>
                      <button aria-hidden="true" name="cancel_g" id="cancel_g" class="btn orange dobt-btn" type="button" title="Cancel">Cancel</button>
                      <input type="hidden" name="route_type" id="route_type" value="" />
                      <input type="hidden" name="route_type_id" id="route_type_id" value="" />
                      <?php /*?><a  id="add_legs" class="btn orange dobt-btn button" title="+ Add a Leg"><i class="fa fa-plus"></i> Add a Leg</a><?php */?>
                    </div>
                  </div>
                  
                  </div>
                  
                  
                  <div id="overnight_display" style="display:none">
                  <p class="selectpick"><span><span class="require">*</span> Required Fields</span>Please check overnight location address into below inputs.</p>
                  <div class="clearfix"></div>
                  <div id="form">
                  	<div class="col-md-6 no-space">
                    </div>
                    <div class="clearfix"></div>
                    <div class="row dobt-form no-margin">
                      <div class="col-lg-12">
                        <p class="head">Overnight Location Address</p>
                        <div class="box">
                          <div class="col-lg-4 col-md-6 col-sm-6 no-space">
                            <div class="form-group">
                              <label class="control-label" for="o_pickup_street">Street:</label>
                              <input type="text" class="form-control" id="o_pickup_street" name="o_pickup_street" maxlength="50" placeholder="Enter Street Address">
                              <input type="hidden" id="leg_id" name="leg_id" maxlength="50" value="">
                              <input type="hidden" id="update_leg" name="update_leg" maxlength="50" value="">
                            </div>
                          </div>
						  
						  <div class="col-lg-4 col-md-6 col-sm-6">
                            <div class="form-group">
                              <label class="control-label" for="o_pickup_location">Overnight Location: <span class="required">*</span></label>
                              <input type="text" class="form-control" id="o_pickup_location" name="o_pickup_location" maxlength="50" placeholder="Enter From City, State or Zip">
                            </div>
                          </div>
						   <input type="hidden" class="form-control" id="o_pickup_city" name="o_pickup_city" value='' maxlength="50">
						   <input type="hidden" class="form-control" id="o_pickup_state" name="o_pickup_state" value='' maxlength="50">
						   <input type="hidden" class="form-control" id="o_pickup_country" name="o_pickup_country" value='' maxlength="50">
						    <input type="hidden" class="form-control" id="o_pickup_zip" name="o_pickup_zip" value='' maxlength="50">
						  
                        <!--  <div class="col-lg-4 col-md-6 col-sm-6">
                            <div class="form-group">
                              <label class="control-label" for="o_pickup_city">City: <span class="required">*</span></label>
                              <input type="text" class="form-control" onBlur="get_zip('o_pickup_city','o_pickup_state','o_pickup_zip');" id="o_pickup_city" name="o_pickup_city" maxlength="50">

                            </div>
                          </div>
                          <div class="col-lg-4 col-md-6 col-sm-6 no-space">
                            <div class="form-group">
                              <label class="control-label" for="o_pickup_state">State: <span class="required">*</span></label>
                              <select id="o_pickup_state" class="form-control" name="o_pickup_state" onChange="get_zip('o_pickup_city','o_pickup_state','o_pickup_zip');">
                                <option value="">Select</option>
                                <?php 
							   foreach($state_list as $key=>$value)
							   {
								?>
								<option value="<?php echo $key;?>"><?php echo $value;?></option>
							<?php   
							   }
							  ?>
                              </select>

                            </div>
                          </div>
                          
                          <div class="col-lg-4 col-md-6 col-sm-6 no-space ipad-paddleftright20">
                            <div class="form-group">
                              <label class="control-label" for="o_pickup_country">Country: <span class="required">*</span></label>
                              <select id="o_pickup_country" data-address="o_pickup" class="form-control" name="o_pickup_country">
							 <?php foreach($country_list as $key=>$value)
                              {
                              ?>
                              <option value="<?php echo $key;?>" ><?php echo $value;?></option>
                              <?php    
                              }
                              ?>
								</select>
                            </div>
                          </div>
                          <div class="col-lg-4 col-md-6 col-sm-6 ipad-paddleftright0">
                         	 <div class="form-group">
                              <label class="control-label" for="o_pickup_zip">Zip: <span class="required">*</span></label>
                              <input type="text" class="form-control" id="o_pickup_zip" name="o_pickup_zip" maxlength="50">
                            </div>
                          </div>-->
                          <div class="clearfix"></div>
                          <div class="col-lg-12 no-space">
                          	<div class="form-group">
                                    <label for="overnight_comments">Comments:</label>
                                    <textarea class="form-control" rows="3" name="overnight_comments" id="overnight_comments"></textarea>
                                  </div>
                          </div>
						  <div class="clearfix"></div>
                        </div>
                      </div>
                      
                      <div class="clearfix"></div>
                    </div>
                    
                    
                    
                    <div align="center">
                      <button aria-hidden="true" name="overnight_submit" id="overnight_submit" class="btn orange dobt-btn" type="button" title="+ Add Location"><i class="fa fa-plus"></i> Add Location</button>
                      <button aria-hidden="true" name="overnight_more_submit" id="overnight_more_submit" class="btn orange dobt-btn" type="button" title="+ Add Location"><i class="fa fa-plus"></i> Add More</button>
                      <button aria-hidden="true" name="cancel_o" id="cancel_o" class="btn orange dobt-btn" type="button" title="Cancel">Cancel</button>
                      <input type="hidden" name="route_type" id="route_type" value="" />
                      <input type="hidden" name="route_type_id" id="route_type_id" value="" />
                    </div>
                  </div>
                  
                  </div>
                  
                  <div id="aviation_display" style="display:none">
                  <p class="selectpick"><span><span class="require">*</span> Required Fields</span>Type address into below inputs.</p>
                  <div class="clearfix"></div>
                  <div id="form_aviation">
                  
                    <div class="col-lg-12 multi-pilot-wraper">
                  	<div class="creatleg-multiple-pilot">
                    <div class="multi-pilot">
                    <input type="hidden" name="multiple_pilots_txt" id="multiple_pilots_txt" value="">
                  	<div class="checkbox-list">
                       <label style="display:inline-block;">
                       <input type="checkbox" id="multiple_pilots" name="multiple_pilots"> Multiple Pilots	
                       </label>                       
                    </div>    
                    </div>
                   <div class="no-of-pilot-div">
                    <div class="form-group" id="no_of_pilots_div" style="display:none;">
                              <label for="no_of_pilots" class="control-label" style="padding-left:10px;">| Number of Pilots needed: </label>
                              <select class="form-control" name="no_of_pilots" id="no_of_pilots">
                                <option value="" selected="selected">Select</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                              </select>
                    </div>
                    </div>
                    <div class="clearfix"></div> 
                    </div>
                    </div>
                    
                    <div class="clearfix"></div>
                    <div class="row dobt-form no-margin">
                      <div class="gr-wrap col-lg-6 col-md-6 col-sm-12 padr20">
                        <p class="head">From Airport</p>
                        <div class="box">
                          <div class="col-md-12 no-left-space smaller column marr18 airport-id">
                            <div class="form-group">
                              <label class="control-label" for="pickup_airport">From Location/Airport ID: <span class="required">*</span></label>
                              <input type="text" class="form-control"  placeholder="Enter From City, State or Zip/Airport ID" id="pickup_airport" name="pickup_airport" maxlength="50">	<!-- autocomplete="off" -->
                               <input type="hidden" id="pickup_airport_city" name="pickup_airport_city" maxlength="50">
                              <input type="hidden" id="pickup_airport_state" name="pickup_airport_state" maxlength="50">
                            </div>
                          </div>
                          <div class="clearfix"></div>
                          <div class="col-lg-6 col-md-6 col-sm-6 no-left-space smaller column  marr18">
                            <div class="form-group">
                              <label class="control-label" for="pickup_airport_clock">Start Time: <span class="required">*</span></label>
                              <div class="input-group date from_date <?php /*?>form_meridian_datetime<?php */?>" data-date="">
                                <input type="text"  <?php if(count($leg_details)<=0){ ?> value="<?php echo ($transport_details['dt_pickup_date'])?date("d M y",strtotime($transport_details['dt_pickup_date']))." - 06:00 AM":"";?>" <?php } ?> size="16" name="pickup_airport_clock" id="pickup_airport_clock" readonly class="form-control ">
                                <span class="input-group-btn">
                                <button class="btn default date-reset" type="button"><i class="fa fa-times"></i></button>
                                </span> <span class="input-group-btn">
                                <button class="btn default date-set" type="button"><i class="fa fa-calendar"></i></button>
                                </span> </div>

                            </div>
                          </div>
                          <div class="col-lg-6 col-md-6 col-sm-6 no-left-space no-right-space smaller column">
                            <div class="form-group">
                              <input type="hidden" id="user_time_zone" name="user_time_zone" value="<?php echo $user_time_zone; ?>">
                              <label class="control-label" for="pickup_airport_zone">Time Zone: <span class="required">*</span></label>
                              <select id="pickup_airport_zone" name="pickup_airport_zone" class="form-control">
                                <option value="">Select</option>
                                <?php 
							   foreach($time_zone as $key=>$value)
							   {
								?>
                                <option <?php if($user_time_zone==$key){ ?>selected <?php } ?> value="<?php echo $key;?>"><?php echo $value;?></option>
                                <?php   
							   }
								?>
                              </select>
                            </div>
                          </div>
                          <div class="clearfix"></div>
                        </div>
                      </div>
                      <div class="gr-wrap col-lg-6 col-md-6 col-sm-12">
                        <p class="head">To Airport</p>
                        <div class="box">
                          <div class="col-md-12 no-left-space smaller column  marr18 airport-id">
                            <div class="form-group">
                              <label class="control-label" for="dropoff_airport">To Location/Airport ID: <span class="required">*</span></label>
                              <input type="text" class="form-control" placeholder="Enter To City, State or Zip/Airport ID" id="dropoff_airport" name="dropoff_airport" maxlength="50">
                              <input type="hidden" id="dropoff_airport_city" name="dropoff_airport_city" maxlength="50">
                              <input type="hidden" id="dropoff_airport_state" name="dropoff_airport_state" maxlength="50">
                            </div>
                          </div>
                          
                          <div class="clearfix"></div>
                          <div class="col-lg-6 col-md-6 col-sm-6 no-left-space smaller column marr18">
                            <div class="form-group">
                              <label class="control-label" for="dropoff_airport_clock">End Time: <span class="required">*</span></label>
                              <div class="input-group date to_date <?php /*?>form_meridian_datetime<?php */?>" data-date="">
                                <input type="text" name="dropoff_airport_clock" id="dropoff_airport_clock" size="16" readonly class="form-control">
                                <span class="input-group-btn">
                                <button class="btn default date-reset" type="button"><i class="fa fa-times"></i></button>
                                </span> <span class="input-group-btn">
                                <button class="btn default date-set" type="button"><i class="fa fa-calendar"></i></button>
                                </span> </div>


                            </div>
                          </div>
                          <div class="col-lg-6 col-md-6 col-sm-6 no-left-space no-right-space smaller column">
                            <div class="form-group">
                              <label class="control-label" for="dropoff_airport_zone">Time Zone: <span class="required">*</span></label>
                              <select id="dropoff_airport_zone" name="dropoff_airport_zone" class="form-control">
                                <option value="">Select</option>
                                <?php 
							   foreach($time_zone as $key=>$value)
							   {
								?>
                                <option <?php if($user_time_zone==$key){ ?>selected <?php } ?> value="<?php echo $key;?>"><?php echo $value;?></option>
                                <?php   
							   }
								?>
                              </select>                            </div>
                          </div>
                          <div class="clearfix"></div>
                        </div>
                      </div>
                      <div class="clearfix"></div>
                    </div>
                    
                    <?php /*?><div id="pilot_meeting_location_div" style="display:none;"><?php */?>
                    <div id="pilot_meeting_location_div" style="display:block;">
                        <div class="row dobt-form no-margin">
                          <div class="gr-wrap col-md-8 review-appication">
                            <div class="form-group">
                             <label class="control-label" for="pilot_meeting_location">Meeting Location:</label>
                              <input type="text" id="pilot_meeting_location" name="pilot_meeting_location" class="form-control" placeholder="Enter your meeting location here..." maxlength="500">
                            </div>
                          </div>
                        </div>                    
                    </div>
                    
                    <div align="center">
                      <button aria-hidden="true" name="airport_submit" style=" margin-right: 5px;" id="airport_submit" class="btn orange dobt-btn" type="button" title="+ Add Leg"><i class="fa fa-plus"></i> Add Leg</button><button aria-hidden="true" name="cancel_a" id="cancel_a" class="btn orange dobt-btn" type="button" title="Cancel">Cancel</button>
                    </div>
                  </div>
                  
                  </div>
                  <?php } ?>
                </div>
              </div>
              
              <div id="main-transportation-route">                          
                  <div id="my-leg" style="display:none">
                    <div id="origin-address"  >
                      <input id="origin-address1" placeholder="Pick Up Address"  />
                    </div>
                    <div id="destination-address">
                      <input id="destination-address1" placeholder="Drop Off Address" />
                    </div>       
                    <div id="distance">Distance:&nbsp;<b><span id="miles">0</span>&nbsp;miles</b></div>
                  </div>
                  <div data-current-user-can-join="false" data-destination-address="<?php echo $transport_details['st_to_street'].",".$transport_details['st_to_city'].",".$transport_details['st_to_state'].",".$transport_details['st_to_zip'].",".$transport_details['st_to_country']; ?>" data-origin-address="<?php echo $transport_details['st_from_city'].",".$transport_details['st_from_state'].",".$transport_details['st_from_zip'].",".$transport_details['st_from_country']; ?>" id="route-map"  style="height:620px"></div>
                          <div class="transport_legend"> 
                          <div id="leg-legend">
                            <div id="legend-data"> <span class="legend-text">Legend:</span>
                              <ul>
                                <li><span>Driver</span></li>
                                <li class="pilot active"><span>Pilot</span></li>
                                <li class="multi-role-user"><span>Multi Role User</span></li>
                                <li class="yellow-pins"><span>Zoom to View</span></li>
                                <li class="blue-pins"><span>Zoom to View</span></li>
                                <li class="red-pins"><span>Zoom to View</span></li>
                              </ul>
                            </div>
                          </div>
                          </div>
                </div>
                
            </div>
            <div class="clearfix"></div>
          </div>
        </div>
      </form>
      
      <!-- END PAGE CONTENT--> 
    </div>
  </div>
  <!-- END CONTENT --> 
</div>
<!-- END CONTAINER -->
<!-- BEGIN THANK YOU MODAL POPUP-->
<div class="modal fade" id="aviation_popup" tabindex="-1" role="basic" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog"><!--org-search-lg-alert-->
    <div class="modal-content "><!--org-search-alert-->
      <div class="modal-header">
        <button aria-hidden="true" data-dismiss="modal" class="close" type="button" title="Close"></button>
  		<h4 class="title">Add Leg for</h4>
      </div>

      <div class="modal-body">
<?php /*?><form role="form" id="route_radio" name="route_radio"><?php */?>
      <div class="form-group">
			<div class="radio-list">    
			    <label class="radio-inline" for="road_transport">
			    <input type="radio" name="transport_type" id="road_transport" class="chk" value="0" checked> Road Transportation</label>
			    <label class="radio-inline" for="aviation_transport">
			    <input type="radio" name="transport_type" id="aviation_transport" class="chk" value="1"  > Aviation Transportation</label>
			</div>
			</div>
<?php /*?></form><?php */?>
</div>
      <div class="modal-footer no-border"> <button title="Continue" type="submit" class="btn orange dobt-btn" id="transport_submit" name="transport_submit" aria-hidden="true">Continue</button></div>
    </div>
    <!-- /.modal-content --> 
  </div>
  <!-- /.modal-dialog --> 
</div>
<!-- END THANK YOU MODAL POPUP-->

<!-- Transport Created Successfully MODAL POPUP-->
<div class="modal fade transport-created" id="transport_loader" tabindex="-1" role="basic" aria-hidden="true">
								<div class="modal-dialog">
									<div class="modal-content">
										<?php /*?><div class="modal-header no-border">
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
										</div><?php */?>
										<div class="modal-body">
                                        
										<img src="<?php echo base_url(); ?>assets/img/ajax-loading.gif" width="32" height="32" align="absmiddle" style="margin:0 auto">&nbsp;<span id="tran-loadertext">Doobert is e-mailing the drivers and pilots</span>
										</div>
									</div>
									<!-- /.modal-content -->
								</div>
								<!-- /.modal-dialog -->
							</div>
<!-- END Transport Created Successfully MODAL POPUP-->

<div class="modal fade transport-created_save_only" id="transport_loader_save_only" tabindex="-1" role="basic" aria-hidden="true">
								<div class="modal-dialog">
									<div class="modal-content">
										<?php /*?><div class="modal-header no-border">
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
										</div><?php */?>
										<div class="modal-body">
                                        
										<img src="<?php echo base_url(); ?>assets/img/ajax-loading.gif" width="32" height="32" align="absmiddle" style="margin:0 auto">&nbsp;<span id="tran-loadertext">Doobert is updating the information</span>
										</div>
									</div>
									<!-- /.modal-content -->
								</div>
								<!-- /.modal-dialog -->
							</div>

<!-- Transport Created Successfully MODAL POPUP-->
<div class="modal fade transport-created" id="transport-created-successfully" tabindex="-1" role="basic" aria-hidden="true">
								<div class="modal-dialog">
									<div class="modal-content">
										<div class="modal-body">
                                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"  title="Close"></button>
											<h4>"Congratulations.  Your transport has been created and we're notifying the Drivers & Pilots along the route"</h4>
										</div>
									</div>
									<!-- /.modal-content -->
								</div>
								<!-- /.modal-dialog -->
							</div>
<!-- END Transport Created Successfully MODAL POPUP-->

<div class="modal fade upload_leg_div" id="upload_leg_div" tabindex="-1" role="basic" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" id="popup_leg_upload_close" title="Close"></button>
                    <form name="upload_legs_by_file" id="upload_legs_by_file" action="<?php echo base_url(); ?>transport-create-legs" method="post" enctype="multipart/form-data">     
                    <div class="form-group">
                      <div class="col-md-12 no-space">
                      <label for="drop_info" class="control-label">Upload Legs:</label>
                      <div class="clearfix"></div>
                        <span class="upload-des-text">(Upload a .xls, .xlsx, .csv(comma delimited) file, 1MB Maximum) <a href="<?php echo base_url(); ?>upload/legupload/sample.xlsx">Sample file</a></span>
                        <div class="fileinput fileinput-new" data-provides="fileinput">
                          <div class="input-group margin-bottom10">
                            <div class="form-control uneditable-input span3" data-trigger="fileinput"> <i class="fa fa-file fileinput-exists"></i>&nbsp; <span class="fileinput-filename"> </span> </div>
                            <span class="input-group-addon btn default btn-file light-green"> <span class="fileinput-new"> Browse... </span> <span class="fileinput-exists"> Change </span>
                            <input type="file" name="leg_upload" id="leg_upload">
                            </span> <a href="#" class="input-group-addon btn default fileinput-exists hidden-480" data-dismiss="fileinput"> Remove </a> </div>
                             <span><a href="javascript:void(0);" class="btn default light-green"  id="upload_leg_file" name="upload_leg_file"> Upload File </a> </span>
                    
                            <span style="display:inline-block"><a href="javascript:void(0);" class="btn default" onClick="$('#upload_leg_div').modal('hide');" id="popup_leg_upload_cancel"> Cancel</a> </span>
                            
                            <input type="hidden" name="upload_leg_f" id="upload_leg_f" value="">
                            
                           </div>
                           
                      </div>                  
                    </div>
                    </form>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
<!-- END Transport Created Successfully MODAL POPUP-->
</div>


<div id="add-additional-info" class="modal fade" tabindex="-1" aria-hidden="true">
<form class="horizontal-form" role="form" id="transport_add_info" name="transport_add_info" enctype="multipart/form-data" action="<?php echo base_url().'org_transportation/add_transport_info' ?>" method="post">
  <input type="hidden" class="form-control" id="transport_id_add_info" name="transport_id_add_info" value="<?php echo $this->session->userdata('transport_id'); ?>">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" title="Close"></button>
<h4 class="modal-title">Additional Information</h4>
        <div class="form-group">
          <label for="additional-comments">Comments:</label>
          <textarea class="form-control" id="additional-comments" name="additional-comments" rows="4" ></textarea>
        </div>
        <div class="form-group">
          <label for="attach-documents">Attach Documents:</label>
          <div class="attach-doc-box">
          
		  <span class="btn btn-success fileinput-button"> <i class="glyphicon glyphicon-plus"></i> <span>Add files...</span>
		  <input type="file" name="files" multiple title="Add Files">
		  </span>
		  <?php /*?><button type="submit" class="btn btn-primary start" title="Start upload"> <i class="glyphicon glyphicon-upload"></i> <span>Start upload</span> </button><?php */?>
		  <span class="files">(Upload a .jpg, .jpe, .jpeg, .doc, .docx, .xls, .xlsx, .pdf file, 5MB Maximum)</span>
          
		  <input type="hidden"  class="form-control" id="image_file" name="image_file" value="" >
		  
		  <!-- The global progress state -->
            <div class="col-lg-12 fileupload-progress fade">
              <!-- The global progress bar -->
              <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-bar progress-bar-success" style="width:0%;"></div>
              </div>
              <!-- The extended global progress state -->
              <div class="progress-extended">&nbsp;</div>
            </div>
			<table role="presentation" class="table table-striped">
				<tbody class="files">
				</tbody>
			  </table>			
			<!-- The template to display files available for upload -->
        <script id="template-upload" type="text/x-tmpl">
                    {% for (var i=0, file; file=o.files[i]; i++) { %}
                        <tr class="template-upload fade">
                            <td>
                                <span class="preview"></span>
                            </td>
                            <td>
                                <p class="name word-break">{%=file.name%}</p>
                                <strong class="error text-danger"></strong>
                            </td>
                            <td>
                                <p class="size">Processing...</p>
                                <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><div class="progress-bar progress-bar-success" style="width:0%;"></div></div>
                            </td>
                            <td>
                                {% if (!i && !o.options.autoUpload) { %}
                                    <button class="btn btn-primary start" title="Start" disabled>
                                        <i class="glyphicon glyphicon-upload"></i>
                                        <span>Start</span>
                                    </button>
                                {% } %}
                                {% if (!i) { %}
                                    <button class="btn btn-warning black cancel" title="Cancel">
                                        <i class="glyphicon glyphicon-ban-circle"></i>
                                        <span>Cancel</span>
                                    </button>
                                {% } %}
                            </td>
                        </tr>
                    {% } %}
                    </script>
					
					<!-- The template to display files available for download -->
        <script id="template-download" type="text/x-tmpl">
                    {% for (var i=0, file; file=o.files[i]; i++) { %}
                        <tr class="template-download fade">
                            <td>
                                <span class="preview">
                                    {% if (file.thumbnailUrl) { %}
                                        <a href="{%=file.url%}" title="{%=file.name%}" download="{%=file.name%}" data-gallery><img src="{%=file.thumbnailUrl%}"></a>
                                    {% } %}
                                </span>
                            </td>
                            <td>
                                <p class="name word-break">
                                    {% if (file.url) { %}
                                        <a href="{%=file.url%}" title="{%=file.name%}" download="{%=file.name%}" {%=file.thumbnailUrl?'data-gallery':''%}>{%=file.name%}</a>
                                    {% } else { %}
                                        <span>{%=file.name%}</span>
                                    {% } %}
                                </p>
                                {% if (file.error) { %}
                                    <div><span class="label label-danger">Error</span> {%=file.error%}</div>
                                {% } %}
                            </td>
                            <td>
                                <span class="size">{%=o.formatFileSize(file.size)%}</span>
                            </td>
                            <td>
                                {% if (file.deleteUrl) { %}
                                    <button class="btn btn-danger black delete" data-type="{%=file.deleteType%}" data-url="{%=file.deleteUrl%}"{% if (file.deleteWithCredentials) { %} data-xhr-fields='{"withCredentials":true}'{% } %}>
                                        <i class="glyphicon glyphicon-trash"></i>
                                        <span>Cancel</span>
                                    </button>
                                    <input type="checkbox" name="delete" value="1" class="toggle">
                                {% } else { %}
                                    <button class="btn btn-warning black cancel">
                                        <i class="glyphicon glyphicon-ban-circle"></i>
                                        <span>Cancel</span>
                                    </button>
                                {% } %}
                            </td>
                        </tr>
                    {% } %}
                    </script>
			
		  </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn orange fl" title="Add Info" id="add_transport_info">Add Info</button>
      </div>
    </div>
    <div class="clearfix"></div>
    <img id="loadimg_upload" style="display:none" src="<?php echo base_url(); ?>assets/img/ajax-loading.gif" alt="loader" /> </div>
</form>
  </div>
  
  
<div id="edit-additional-info" class="modal fade" tabindex="-1" aria-hidden="true">
<form class="horizontal-form" role="form" id="transport_update_info" name="transport_update_info" enctype="multipart/form-data" action="<?php echo base_url().'org_transportation/update_transport_info' ?>" method="post">
  <input type="hidden" class="form-control" id="transport_id_update_info" name="transport_id_update_info" value="<?php echo $this->session->userdata('transport_id'); ?>">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" title="Close"></button>
<h4 class="modal-title">Additional Information</h4>
        <div class="form-group">
          <label for="additional-comments">Comments:</label>
          <textarea class="form-control" id="additional-comments-update" name="additional-comments-update" rows="4" ><?php echo isset($transport_details['st_add_comments']) && $transport_details['st_add_comments'] != '' ? $transport_details['st_add_comments'] : '';   ?></textarea>
        </div>
        <div class="form-group">
          <label for="attach-documents">Attach Documents:</label>
          <div class="attach-doc-box">
          
		  <span class="btn btn-success fileinput-button"> <i class="glyphicon glyphicon-plus"></i> <span>Add files...</span>
		  <input type="file" name="files" multiple title="Add Files">
		  </span>
		  <?php /*?><button type="submit" class="btn btn-primary start" style="display:none;"> <i class="glyphicon glyphicon-upload"></i> <span>Start upload</span> </button><?php */?>
		  <span class="files">(Upload a .jpg, .jpe, .jpeg, .doc, .docx, .xls, .xlsx, .pdf file, 5MB Maximum)</span>
          
		  <input type="hidden"  class="form-control" id="image_file_update" name="image_file_update" value="" >
		  
		  <!-- The global progress state -->
            <div class="col-lg-12 fileupload-progress fade">
              <!-- The global progress bar -->
              <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                <div class="progress-bar progress-bar-success" style="width:0%;"></div>
              </div>
              <!-- The extended global progress state -->
              <div class="progress-extended">&nbsp;</div>
            </div>
			
			<table role="presentation" class="table table-striped">
				<tbody class="files">
				</tbody>
			  </table>
			
			<!-- The template to display files available for upload -->
        <script id="template-upload" type="text/x-tmpl">
                    {% for (var i=0, file; file=o.files[i]; i++) { %}
                        <tr class="template-upload fade">
                            <td>
                                <span class="preview"></span>
                            </td>
                            <td>
                                <p class="name word-break">{%=file.name%}</p>
                                <strong class="error text-danger"></strong>
                            </td>
                            <td>
                                <p class="size">Processing...</p>
                                <div class="progress progress-striped active" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><div class="progress-bar progress-bar-success" style="width:0%;"></div></div>
                            </td>
                            <td>
                                {% if (!i && !o.options.autoUpload) { %}
                                    <button class="btn btn-primary start" disabled>
                                        <i class="glyphicon glyphicon-upload"></i>
                                        <span>Start</span>
                                    </button>
                                {% } %}
                                {% if (!i) { %}
                                    <button class="btn btn-warning black cancel">
                                        <i class="glyphicon glyphicon-ban-circle"></i>
                                        <span>Cancel</span>
                                    </button>
                                {% } %}
                            </td>
                        </tr>
                    {% } %}
                    </script>
					
					<!-- The template to display files available for download -->
        <script id="template-download" type="text/x-tmpl">
                    {% for (var i=0, file; file=o.files[i]; i++) { %}
                        <tr class="template-download fade">
                            <td>
                                <span class="preview">
                                    {% if (file.thumbnailUrl) { %}
                                        <a href="{%=file.url%}" title="{%=file.name%}" download="{%=file.name%}" data-gallery><img src="{%=file.thumbnailUrl%}"></a>
                                    {% } %}
                                </span>
                            </td>
                            <td>
                                <p class="name word-break">
                                    {% if (file.url) { %}
                                        <a href="{%=file.url%}" title="{%=file.name%}" download="{%=file.name%}" {%=file.thumbnailUrl?'data-gallery':''%}>{%=file.name%}</a>
                                    {% } else { %}
                                        <span>{%=file.name%}</span>
                                    {% } %}
                                </p>
                                {% if (file.error) { %}
                                    <div><span class="label label-danger">Error</span> {%=file.error%}</div>
                                {% } %}
                            </td>
                            <td>
                                <span class="size">{%=o.formatFileSize(file.size)%}</span>
                            </td>
                            <td>
                                {% if (file.deleteUrl) { %}
                                    <button class="btn btn-danger black delete" data-type="{%=file.deleteType%}" data-url="{%=file.deleteUrl%}"{% if (file.deleteWithCredentials) { %} data-xhr-fields='{"withCredentials":true}'{% } %}>
                                        <i class="glyphicon glyphicon-trash"></i>
                                        <span>Cancel</span>
                                    </button>
                                    <input type="checkbox" name="delete" value="1" class="toggle">
                                {% } else { %}
                                    <button class="btn btn-warning black cancel">
                                        <i class="glyphicon glyphicon-ban-circle"></i>
                                        <span>Cancel</span>
                                    </button>
                                {% } %}
                            </td>
                        </tr>
                    {% } %}
                    </script>
			
		  </div>
        </div>
		
		<div class="attachments">
		<input type="hidden" class="form-control" id="transport_info_files_cnt" name="transport_info_files_cnt" value="<?php echo count($transport_files); ?>">
		  <p class="info">Attachments (<?php echo count($transport_files); ?>)</p>
		  <?php
		if(isset($transport_files) && !empty($transport_files))
		{
		?>
		  <div class="attached-file">
			<?php	
		foreach($transport_files as $key=>$value)
			{
		?>
			<span class="del-icon"> <i class="fa fa-file"></i> <a href="<?php echo base_url().'org_transportation/generate_download/'?><?php echo $this->common_function->encode_base64($value['st_file_name']); ?>/" title="<?php echo $value['st_file_name']; ?>"><?php echo $value['st_file_name']; ?></a>
			<?php if($this->session->userdata('userid')==$transport_details['in_trans_coods_id']) { ?>
			<a id="<?php echo $value['in_transport_file_id']; ?>" href="<?php echo base_url().'org_transportation/delete_transport_add_files/'?><?php echo $value['in_transport_file_id']; ?>/<?php echo $transport_details['in_transportation_id'];?>" onClick="javascript:return confirm('Are you sure you want to delete it?');"  title="Delete"> <i class="fa fa-times close-attach-file"></i> </a>
			<?php } ?>
			</span>
			<?php } 
		  ?>
		  </div>
		  <div class="clearfix"></div>
		  <?php 
		}
		?>
		</div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn orange fl" title="Update" id="update_transport_info">Update</button>
      </div>
    </div>
    <div class="clearfix"></div>
    <img id="loadimg_upload" style="display:none" src="<?php echo base_url(); ?>assets/img/ajax-loading.gif" alt="loader" /> </div>
</form>
  </div>  
  
<a href="#" class="crunchify-top" id="crunchify-top" title="Top">↑Top</a>


<!-- BEGIN success_transport_info_popup MODAL POPUP-->
<div class="modal fade" id="success_transport_info_popup" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"> 
        <button aria-hidden="true" data-dismiss="modal" class="close" type="button"></button>
        <h4 class="modal-title">Information!</h4>
      </div>
      <div class="modal-body">Additional Information updated successfully.
	  </div>
	  <div class="modal-footer text-center no-margin"> <a class="btn blue" data-dismiss="modal" href="javascript:void(0);"  title="Close">Close</a> </div>
	 </div>
    </div>
    <!-- /.modal-content --> 
  </div>
  <!-- /.modal-dialog --> 
</div>
<!-- END success_transport_info_popup MODAL POPUP-->

<!-- Contact US Form -->
  <div class="modal fade" id="map-user-contact" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog">
                        <form class="horizontal-form" role="form" id="send-request" name="send_request" action="" method="post">
                            <input type="hidden" id="contact_name" name="contact_name" value="">
                            <input type="hidden" id="contact_email" name="contact_email" value="">
							<input type="hidden" id="org_id" name="org_id" value="">
							<input id="user-name" name="user-name" type="hidden" value="<?php echo $this->session->userdata('user_name')." ".$this->session->userdata('last_name');  ?>" />
							<input id="user-email" name="user-email" type="hidden" value="<?php echo $this->session->userdata('email'); ?>" />
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button aria-hidden="true" data-dismiss="modal" id="close_button"  class="close empty_dates" type="button" title="Close"></button>
                                    <h4 class="modal-title">Contact Request</h4>
                                </div>							
                                <div class="modal-body">
                                    <div class="form-group col-md-12 padl0 padr0">
                                       <textarea id="contactmessage" name="contactmessage" rows="3" class="form-control" maxlength="500" Placeholder="Enter Your Message" ></textarea>
                                    </div>
                                    <div class="form-group col-md-12 padl0 padr0 btm-button marb0">
                                            <a href="javascript:void(0);" class="btn orange fr" id="send_request_btn" title="Send">Send</a>
                                           <!-- <input type="submit" class="btn orange mart20 fr wht"  id="send_request_btn" value="Send">-->
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </form>
                        <!-- /.modal-content --> 
                        </div>
                    </div>

<!-- End Contact Us Form --> 

	<!-- Start Thank You Message -->
						 <div class="modal fade" id="thankyou-config" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header"> 
                            <button aria-hidden="true" data-dismiss="modal" class="close" type="button"></button>
                            <h4 class="modal-title">THANK YOU</h4>
                        </div>
                        <div class="modal-body"><h5>Mail sent successfully.</h5></div>
                        <div class="modal-footer text-center no-margin"><a class="btn blue" data-dismiss="modal" title="Close">Close</a> </div>
                    </div>
                    <!-- /.modal-content --> 
                </div>
                <!-- /.modal-dialog --> 
            </div>
			<!-- End Thank you Message -->
				<div class="modal fade legs_reorder" id="legs_reorder" tabindex="-1" role="basic" aria-hidden="true">
								<div class="modal-dialog">
									<div class="modal-content" style="width:450px;">
										<?php /*?><div class="modal-header no-border">
											<button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
										</div><?php */?>
										<div class="modal-body">
                                        
										<img src="<?php echo base_url(); ?>assets/img/ajax-loading.gif" width="32" height="32"  style="margin-left:40%;">&nbsp;<br><span style="color: #4b7276; font: normal 27px 'Open Sans',Helvetica,Arial,sans-serif;">Doobert is re-ordering the legs</span>
										</div>
									</div>
									<!-- /.modal-content -->
								</div>
								<!-- /.modal-dialog -->
							</div>

<?PHP include APPPATH."views/includes/footer.php" ?>
<!-- BEGIN JAVASCRIPTS --> 
<script type="text/javascript">
var upload_link= '<?php echo base_url(); ?>org_transportation/add_images';
var file_divid = 'transport_add_info';

var file_divid_update = 'transport_update_info';

</script>

<script src="<?php echo base_url(); ?>assets/plugins/jquery-validation/dist/jquery.validate.min.js" type="text/javascript"></script> 
<!--Date Picker--> 
<!-- BEGIN PAGE LEVEL PLUGINS --> 
<script type="text/javascript" src="<?php echo base_url(); ?>assets/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="<?php echo base_url(); ?>assets/plugins/clockface/js/clockface.js"></script> 
<script type="text/javascript" src="<?php echo base_url(); ?>assets/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script> 
<script type="text/javascript" src="<?php echo base_url(); ?>assets/plugins/jquery.ui.touch-punch.js"></script> 

<!-- END PAGE LEVEL PLUGINS --> 
<!-- BEGIN PAGE LEVEL SCRIPTS --> 


<script type="text/javascript" src="<?php echo base_url(); ?>assets/ajaxfileupload.js"></script>


<script src="<?php echo base_url(); ?>assets/scripts/custom/components-pickers.js"></script> 
<script src="<?php echo base_url(); ?>assets/plugins/bootstrap-modal/js/bootstrap-modal.js" type="text/javascript" ></script>
<script src="<?php echo base_url(); ?>assets/plugins/bootstrap-modal/js/bootstrap-modalmanager.js" type="text/javascript" ></script>

<!-- The jQuery UI widget factory, can be omitted if jQuery UI is already included --> 
<script src="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/js/vendor/jquery.ui.widget.js"></script> 
<!-- The Templates plugin is included to render the upload/download listings --> 
<script src="<?php echo base_url(); ?>assets/plugins/multi-files-upload/tmpl.min.js"></script> 
<!-- The Load Image plugin is included for the preview images and image resizing functionality --> 
<script src="<?php echo base_url(); ?>assets/plugins/multi-files-upload/load-image.min.js"></script> 
<!-- The Canvas to Blob plugin is included for image resizing functionality --> 
<script src="<?php echo base_url(); ?>assets/plugins/multi-files-upload/canvas-to-blob.min.js"></script> 
<!-- Bootstrap JS is not required, but included for the responsive demo navigation --> 
<?php /*?><script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script> <?php */?>
<!-- blueimp Gallery script --> 
<script src="<?php echo base_url(); ?>assets/plugins/multi-files-upload/jquery.blueimp-gallery.min.js"></script> 
<!-- The Iframe Transport is required for browsers without support for XHR file uploads --> 
<script src="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/js/jquery.iframe-transport.js"></script> 
<!-- The basic File Upload plugin --> 
<script src="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/js/jquery.fileupload.js"></script> 
<!-- The File Upload processing plugin --> 
<script src="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/js/jquery.fileupload-process.js"></script> 
<!-- The File Upload image preview & resize plugin --> 
<script src="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/js/jquery.fileupload-image.js"></script> 
<?php /*?><!-- The File Upload audio preview plugin --> 
<script src="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/js/jquery.fileupload-audio.js"></script> 
<!-- The File Upload video preview plugin --> 
<script src="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/js/jquery.fileupload-video.js"></script> <?php */?>
<!-- The File Upload validation plugin --> 
<script src="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/js/jquery.fileupload-validate.js"></script> 
<!-- The File Upload user interface plugin --> 
<script src="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/js/jquery.fileupload-ui.js"></script> 
<!-- The main application script --> 
<script src="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/js/file_upload_main.js"></script> 

<!-- END PAGE LEVEL SCRIPTS --> 

<!-- END JAVASCRIPTS -->
<script>      
$(window).load(function() {
	var editedTrid;
     ComponentsPickers.init();
	 //App.init();
});		

$(document).ready(function(){
	
		$('#send_request_btn').live('click',function(){
					var mess='';
					mess = $('#contactmessage').val(); 
					var username = $("#user-name").val();
					var useremail = $("#user-email").val();
					var org_id = $("#org_id").val();
					//var validatemail= 	validateEmail(useremail);
					//alert(validatemail);	
					//alert(mess);		
                    //if(mess == '' || name == '' || email == '')
					if(mess == '')	
                    {
						alert('Please complete your information.');
						//alert('Please complete the form details.');
						//$.modal.close();
                        return false;
                    }
					else
                    {
					var name  = $('#contact_name').val();
                    var email = $('#contact_email').val();
					
						 $.ajax({
								type: "POST",
								url: '<?php echo base_url(); ?>rescue_map/map_send_mail',
								beforeSend: function(){
								$('#map-user-contact').modal('toggle');	
								//$.modal.close();
								//$('#user-contact').hide();
								//$.modal.close();
								//$('#loader').show();
								},
								data: {contact_name:name , contact_email:email ,contactmessage:mess , username:username , useremail:useremail , org_id:org_id},
			 // data : { },
								dataType:'json',
			  					complete: function(){
								//$('#loader').hide();
				    			},
								  success:function(data){
									if(data.success == 1)
										$('.modal-title').html('Thank You')	
										$('#contactmessage').val('');
										$('#contact_name').val('');	
										$('#contact_email').val('');
										//$("#user-name").val('');
										//$("#user-email").val('');
										$("#org_id").val('');
										$('#thankyou-config').modal('show');
								}, 
                        //return true;
						 });
                    }
		}); //send_request_btn2	
	
	
	
	<?php  if($this->session->flashdata('success_transport_info')): ?>
		$('#success_transport_info_popup').modal('show');		
	<?php endif; ?>
	
	$('#'+file_divid).fileupload({
		  url: upload_link,
		  maxNumberOfFiles: 5,
		  maxFileSize : 5242880,
		  acceptFileTypes :/(\.|\/)(jpe?g|doc|docx|xls|xlsx|pdf)$/i,
		  sequentialUploads: true,
		  autoUpload :true
		});
		
	$('#'+file_divid_update).fileupload({
		  url: upload_link,
		  maxNumberOfFiles: 5,
		  maxFileSize : 5242880,
		  acceptFileTypes :/(\.|\/)(jpe?g|doc|docx|xls|xlsx|pdf)$/i,
		  sequentialUploads: true,
		  autoUpload :true
		});	
		
});
		
$('#add_transport_info').live('click',function(){
	
	var file_name = '';
	$('#image_file').val('');
	$('.table-striped tr').each(function() {
	var image_files = $(this).find('td p a').text(); 
	if(image_files!='')
	{  
		if (file_name == '') {
				file_name += image_files;
		}else{
				file_name += ',' + image_files; 
		}
	}
	});
	$('#image_file').val(file_name);
	
	if($('#additional-comments').val() == "" && $('#image_file').val() == "") {
		alert("Please enter comments/upload files.");
		return false;
	} else {
		//$('#add_transport_info').hide();
		if($.browser.msie) {
				$('.display_loader').html('<img id="loadimg" src="<?php echo base_url(); ?>assets/img/ajax-loading.gif" alt="loader" />');
			}
		$('.display_loader').show();
		
		$('#loadimg_mail').show();
		$('#add-additional-info').modal('hide');
		
		if($.browser.msie) {
			$('.display_loader').html('<div id="loader" style="display: none;"><img src="<?php echo base_url(); ?>assets/img/ajax-modal-loading.gif" width="32" height="32" align="absmiddle">&nbsp;<span id="loadertext">Loading...</span></div>');
		}
		
		$('.display_loader').show();
		$('#loader').show();
		
		
		//$('#transport_add_info').submit();
		
		$.ajax({
				  type: "POST",
				  url: '<?php echo base_url(); ?>org_transportation/add_transport_info',
				  data: {
					  additional_comments : $('#additional-comments').val(),
					  image_file: $('#image_file').val(),
				      transport_id_add_info: $('#transport_id_add_info').val()					   
				  },
				  dataType:"json",
				  success:function(data) {
					 //alert(data);
					 $('#loader').hide();
					 $('#success_transport_info_popup').modal('show');					
				  }
			});
	}
	});   

$('#update_transport_info').live('click',function(){
	
	var file_name = '';
	$('#image_file_update').val('');
	$('.table-striped tr').each(function() {
	var image_files = $(this).find('td p a').text(); 
	if(image_files!='')
	{  
		if (file_name == '') {
				file_name += image_files;
		}else{
				file_name += ',' + image_files; 
		}
	}
	});
	$('#image_file_update').val(file_name);
	
	if($('#additional-comments-update').val() == "" && $('#image_file_update').val() == "" && $('#transport_info_files_cnt').val() == 0) {
		alert("Please enter comments/upload files.");
		return false;
	} else {
		//$('#update_transport_info').hide();
		
		if($.browser.msie) {
				$('.display_loader').html('<img id="loadimg" src="<?php echo base_url(); ?>assets/img/ajax-loading.gif" alt="loader" />');
			}
		$('.display_loader').show();
		
		$('#loadimg_mail').show();
		$('#edit-additional-info').modal('hide');
		
		if($.browser.msie) {
			$('.display_loader').html('<div id="loader" style="display: none;"><img src="<?php echo base_url(); ?>assets/img/ajax-modal-loading.gif" width="32" height="32" align="absmiddle">&nbsp;<span id="loadertext">Loading...</span></div>');
		}
		
		$('.display_loader').show();
		$('#loader').show();	

		//$('#transport_update_info').submit();
		$.ajax({
				  type: "POST",
				  url: '<?php echo base_url(); ?>org_transportation/update_transport_info',
				  data: {
					  additional_comments_update : $('#additional-comments-update').val(),
					  image_file_update: $('#image_file_update').val(),
				      transport_id_update_info: $('#transport_id_update_info').val()					   
				  },
				  dataType:"json",
				  success:function(data) {
					 //alert(data);
					 $('#loader').hide();
					 $('#success_transport_info_popup').modal('show');
				  }
			});
	}
	});   
	
//Renumber table rows
function renumber_table(tableID) {
    $(tableID + " tr").each(function() {
		//alert(this.id);
		var mystr = this.id;
		var leg_id = $(this).attr('data-leg-id');
		//alert(leg_id);
		var prev_pos = $(this).attr('data-sort-order');
		
		//var prev_pos = mystr.substr(mystr.indexOf("_") + 1);
        
		count = $(this).parent().children().index($(this)) + 1;
		var curr_pos = count;
		var multi_driver_icon = '';
		if ($(this).find('span.leg-fa-users').length)
		{
			multi_driver_icon = '<span class=\"leg-fa-users\"><i class=\"fa fa-users\"></i></span>';
		}
        $(this).find('.priority').html('<span class="glyphicon glyphicon-move"></span> '+count+'.'+multi_driver_icon);
        //$(this).find('.priority').html('<span class="glyphicon glyphicon-move"></span> '+count+'.');
		//alert('prev position: '+prev_pos);
		//alert('curr position: '+curr_pos);
		this.id = 'tr_'+count;
		//console.log(myArray[count-1]['in_sort_order']);
		//console.log(myArray.length);
		
		/*for(var i=0;i<=35;i++)
		{
			if(prev_pos == (i+1)){	
			
				if(myArray[i]['update_leg'] != 'delete')
				{
					myArray[i]['in_sort_order'] = count;	
				}		
			}
		}*/
		
		for(var i=0;i<myArray.length;i++)
		{
			if(myArray[i]['update_leg']['leg_id']!='')
			{	
				if(leg_id == myArray[i]['leg_id'])
				{	
					if(myArray[i]['update_leg'] != 'delete')
					{
						myArray[i]['in_sort_order'] = count;	
					}		
				}
			}	
		}
		console.log(myArray);
		
			
    });
	
	//console.log(myArray.length);
	//console.log(myArray);
}

$(document).ready(function(){
//$('[data-toggle="tooltip"]').tooltip();   
$("body").tooltip({ selector: '[data-toggle="tooltip"]' });

//Helper function to keep table row from collapsing when being sorted
var fixHelperModified = function(e, tr) {
	var $originals = tr.children();
	var $helper = tr.clone();
	/*$helper.children().each(function(index)
	{
	  $(this).width($originals.eq(index).width())
	});*/
	//$helper.css({'width': $(this).width(), 'height': $(this).height()});
	return $helper;
};

//Make diagnosis table sortable
$("#leg_table tbody").sortable({
	handle: '.priority',
	helper: fixHelperModified,
	stop: function(event,ui) {
		renumber_table('#leg_table_body')
		var jsondata = JSON.stringify(myArray);
			$.ajax({
				url: '<?php echo base_url(); ?>org_transportation/update_sort_order_legs/',
				type: 'POST',
					beforeSend: function() {
					$('#legs_reorder').modal('show');
				  },
				data: { data_val:jsondata},
				success: function(result) {
					console.log(result);
				},
				complete: function() {
					 $('#legs_reorder').modal('hide');
				  },
			});
		}
}).disableSelection();

});



jQuery(document).ready(function() {
    $('#addlegs').validate({
		errorElement: 'span', //default input error message container
		errorClass: 'help-block', // default input error message class
		focusInvalid: true, // do not focus the last invalid input
		rules: {
			/*pickup_city: {
				required: true
			},
			pickup_state: {
				required: true
			},
			pickup_zip: {
				required: true
			},*/
			/*dropoff_city: {
				required: true
			},
			dropoff_state: {
				required: true
			},
			dropoff_zip: {
				required: true
			},*/
			pickup_zone: {
				required: true
			},
			clockface_2_modal: {
				required: true
			},
			dropoff_zone: {
				required: true
			},
			clockface_3_modal: {
				required: true
			},
			pickup_airport: {
				required: true
			},
			pickup_airport_clock: {
				required: true
			},
			pickup_airport_zone: {
				required: true
			},
			dropoff_airport: {
				required: true
			},
			dropoff_airport_clock: {
				required: true
			},
			dropoff_airport_zone: {
				required: true
			},
			dropoff_location: {
				required: true
			},
			pickup_location: {
				required: true
			},
			o_pickup_location: {
				required: true
			},
			
			no_of_drivers: {
				required: {
						depends: function(){
								if($('#multiple_drivers_txt').val() == '1'){ 
									return true;
								} else {
									return false;
								}
							}
						}
			},
			no_of_pilots: {
				required: {
						depends: function(){
								if($('#multiple_pilots_txt').val() == '1'){ 
									return true;
								} else {
									return false;
								}
							}
						}
			},
			o_pickup_city: {
				required: {
						depends: function(){
								if($('#route_type_id').val() == '2'){ 
									return true;
								} else {
									return false;
								}
							}
						}
			},
			o_pickup_state: {
				required: {
						depends: function(){
								if($('#route_type_id').val() == '2'){ 
									return true;
								} else {
									return false;
								}
							}
						}
			},
			o_pickup_country: {
				required: {
						depends: function(){
								if($('#route_type_id').val() == '2'){ 
									return true;
								} else {
									return false;
								}
							}
						}
			},
			o_pickup_zip: {
				required: {
						depends: function(){
								if($('#route_type_id').val() == '2'){ 
									return true;
								} else {
									return false;
								}
							}
						}
			}
			
			
			},

		messages: {
			/*pickup_city: {
				required: 'Please enter pick up city.'
			},
			pickup_state: {
				required: 'Please enter pick up state.'
			},
			pickup_zip: {
				required: 'Please enter pick up zip.'
			},
			dropoff_city: {
				required: 'Please enter drop off city.'
			},
			dropoff_state: {
				required: 'Please enter drop off state.'
			},
			dropoff_zip: {
				required: 'Please enter drop off zip.'
			},*/
			pickup_zone: {
				required: 'Please select pick up time zone.'
			},
			clockface_2_modal: {
				required: "Please select start time."
			},
			dropoff_zone: {
				required: 'Please select pick up time zone.'
			},
			clockface_3_modal: {
				required: "Please select end time."
			},
			pickup_airport: {
				required: "Please enter from location."
			},
			pickup_airport_clock: {
				required: "Please select start time."
			},
			pickup_airport_zone: {
				required: "Please select pick up time zone."
			},
			dropoff_airport: {
				required: "Please enter to location."
			},
			dropoff_airport_clock: {
				required: "Please select end time."
			},
			dropoff_airport_zone: {
				required: "Please select drop off time zone."
			},
			no_of_drivers: {
				required: "Please select number of drivers."
			},
			no_of_pilots: {
				required: "Please select number of pilots."
			},
			o_pickup_city: {
				required: "Please enter city."
			},
			o_pickup_state: {
				required: "Please select state."
			},
			o_pickup_country: {
				required: "Please select country."
			},
			o_pickup_zip: {
				required: "Please enter zipcode."
			},
			pickup_location:{
				required :"Please enter pickup location"
			},
			dropoff_location:{
				required :"Please enter dropoff location"
			},
			o_pickup_location:{
				required :"Please enter overnight location"
			}
		},

		invalidHandler: function (event, validator) { //display error alert on form submit   
			$('#addlegs').show();
			
			var errors = validator.numberOfInvalids();
			if (errors) {
			  var message = errors == 1
				? 'You missed 1 field. It has been highlighted'
				: 'You missed ' + errors + ' fields. They have been highlighted';
			  alert(message);
			}
		},

		highlight: function (element) { // hightlight error inputs
			$(element)
				.closest('.form-group').addClass('has-error'); // set error class to the control group
		},

		success: function (label) { //alert(label);
			label.closest('.form-group').removeClass('has-error');
			label.remove();
		},

		errorPlacement: function (error, element) { 
			//error.addClass('help-small no-left-padding').insertAfter(element.closest('.form-group'));
			//error.addClass('help-block').insertAfter(element.closest('.form-group'));
			if (element.attr("name") == "clockface_2_modal" || element.attr("name") == "clockface_3_modal" || element.attr("name") == "pickup_airport_clock" || element.attr("name") == "dropoff_airport_clock")
			{
				error.addClass('help-block').insertAfter(element.closest('.input-group'));
			}
			else
			{
				error.addClass('help-block').insertAfter(element.closest('.form-control'));
			}
		}

	});
	

var startDate = new Date('01/01/2012');
var FromEndDate = new Date();
var ToEndDate = new Date();
ToEndDate.setDate(ToEndDate.getDate()+365);
$('.from_date').datetimepicker({ 
    //weekStart: 1,
    //startDate: '01/01/2012',
    endDate: '<?php echo $transport_details['dt_target']? date('Y-m-d 23:59:59',strtotime($transport_details['dt_target'])):date("Y-m-d"); ?>',    
	format: "dd M yy - HH:ii P",
	showMeridian: true,
	autoclose: true,
	pickerPosition: "bottom-left",
	//todayBtn: true,
	startDate:'<?php echo $transport_details['dt_pickup_date']? date('Y-m-d 00:00:01',strtotime($transport_details['dt_pickup_date'])):date("Y-m-d"); ?>'	
})
    
$('.to_date').datetimepicker({
        
        //weekStart: 1,
        //startDate: startDate,
        endDate: '<?php echo $transport_details['dt_target']? date('Y-m-d 23:59:59',strtotime($transport_details['dt_target'])):date("Y-m-d"); ?>',
		format: "dd M yy - HH:ii P",
		showMeridian: true,
		autoclose: true,
		todayBtn: false,
		pickerPosition: "bottom-left",
		startDate:'<?php echo $transport_details['dt_pickup_date']? date('Y-m-d 00:00:01',strtotime($transport_details['dt_pickup_date'])):date("Y-m-d"); ?>'
		
    })
    	
		var jsondata_legs = JSON.stringify(myArray); 
		var update_distance = 'save_legs';
		$.ajax({
			url: '<?php echo base_url(); ?>org_transportation/get_distance_remain/<?php echo $transport_details['in_transportation_id'];?>/',
			type: 'POST',
			data: { data_val:jsondata_legs,action:update_distance},
			success: function(data) {
				if(data)
				{
					//alert(data);
					console.log(data);
					var e = eval('(' + data + ')');
					jQuery("#distance_remain").html("Distance Remaining: "+parseFloat(e.distance_remain).toFixed(2)+" miles");
				}
			},
			async: false
		});
	
/*updated in ajax on 09-06-2016
 jQuery.post("<php echo base_url(); ?>org_transportation/get_distance_remain/<php echo $transport_details['in_transportation_id'];?>/",{data_val:myArray,action:"save_legs"}, function(data) {
				if(data)
				{
					var e = eval('(' + data + ')');
					jQuery("#distance_remain").html("Distance Remaining: "+e.distance_remain+" miles");
				}
			});	*/
			
$('#pickup_airport').autocomplete ({
		source: function (request, response)
   		 {
			request.term = $.trim(request.term);
			var str	= request.term;
			var letters = /^[a-zA-Z ]+$/;	
			if(str.match(letters))
			{
				request.term = str; 
			} else {
				str = str.toUpperCase();
				request.term = str.replace(/\s/g, ''); 
			}
			
			$.ajax(
			{
				//url: "<?php echo base_url(); ?>org_transportation/get_airports_by_zipcode/" ,
				url: "<?php echo base_url(); ?>org_transportation/get_airports_by_zipcode_or_airport_id/" ,
				dataType: "json",
				data:
				{
					term: request.term
				},
				success: function (data)
				{
					//alert(data);
					//return false;
					//response(data);
					if(data=="1")
					{
						window.location.href="<?php echo base_url() ?>";
					}
					/*if(data == null || data === '')
					{
						alert('Please enter valid from Zipcode/Airport ID');
						$("#pickup_airport").val('');
					}
					else*/
					if(1)
					{
						response(data);
					}
					
				}
			});
  	  	},
		minLength:1,
		open: function() { $('.ui-menu').width($("#pickup_airport" ).width()) },
		focus: function( event, ui ) {
				var id = ui.item.label;
				//alert(id);
				var name = ui.item.value;
				$( "#pickup_airport" ).val(name);
				$( "#pickup_airport_state" ).val(ui.item.st_state);
				$( "#pickup_airport_city" ).val(ui.item.st_city);
				return false;
		},     
		select: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			$("#pickup_airport" ).val(name);
			$("#pickup_airport_state" ).val(ui.item.st_state);
			$("#pickup_airport_city" ).val(ui.item.st_city);
			return false;
		}
	});	
$('#pickup_airport').live('change',function(){
//var selected_zipcode = $(this).val();
var selected_zipcode = $.trim($(this).val());
var str	= selected_zipcode; 
//selected_zipcode = str.replace(/\s/g, ''); 

var letters = /^[a-zA-Z ]+$/;	
if(str.match(letters))
{
			 selected_zipcode = str; 
} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
}

//alert($("#pick_city" ).val());
var select_pickup_city = $("#pickup_airport_city" ).val();
//alert(select_pickup_city);
var select_pickup_state = $("#pickup_airport_state" ).val();
//alert(select_pickup_state);
//var select_pickup_country = $("#pickup_country" ).val();
//alert(select_pickup_country);
//alert($("#pick_zip").val());
//alert($("#pick_zip").val().indexOf(','));

if ($("#pickup_airport").val().indexOf(',') != -1 && $("#pickup_airport").val().indexOf('USA') != -1 && $("#pickup_airport").val().indexOf('Canada') != -1) {
	if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
	{
		//$("#pickup_location").val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
	}
}
else
{
	if(selected_zipcode!=''){	
	  $.ajax({
            url: "<?php echo base_url(); ?>org_transportation/get_airports_by_zipcode_or_airport_id/" ,
            dataType: "json",
            data:
            {
                term: selected_zipcode,
				city: $("#pickup_airport_city" ).val(),
				state: $("#pickup_airport_state" ).val()
            },
            success: function (data)
            {
				//alert(data);
				//alert(data.length);
				//console.log(data);
				//console.log(data[0].label);
				if(data)
				{
				var name = data[0].label;
				//alert(name);
				$( "#pickup_airport" ).val(data[0].label);
				$( "#pickup_airport_state" ).val(data[0].st_state);
				$( "#pickup_airport_city" ).val(data[0].st_city);
				}
				else
				{
					if(data == null || data === '')
					{
						alert('Please enter valid from location');
						$("#pickup_airport").val('');
					}
				}
				
            }
        });	
	}//!=''			
}
});	

$('#dropoff_airport').autocomplete({
		source: function (request, response)
   		 {
			request.term = $.trim(request.term);
			var str	= request.term;
			var letters = /^[a-zA-Z ]+$/;	
			if(str.match(letters))
			{
				request.term = str; 
			} else {
				str = str.toUpperCase();
				request.term = str.replace(/\s/g, ''); 
			}	 
			$.ajax(
			{
				url: "<?php echo base_url(); ?>org_transportation/get_airports_by_zipcode_or_airport_id/" ,
				dataType: "json",
				data:
				{
					term: request.term
				},
				success: function (data)
				{
					//alert(data);	
					if(data=="1")
					{
						window.location.href="<?php echo base_url() ?>";
					}
					/*if(data == null || data === '')
					{
						alert('Please enter valid to Zipcode/Airport ID');
						$("#dropoff_airport").val('');
					}
					else*/
					if(1)
					{
						response(data);
					}
				}
			});
  	  	}, 
		minLength:1,
		open: function() { $('.ui-menu').width($("#dropoff_airport" ).width()) },
		focus: function( event, ui ) {
				var id = ui.item.label;
				var name = ui.item.value;
				$("#dropoff_airport" ).val(name);
				$("#dropoff_airport_state" ).val(ui.item.st_state);
				$("#dropoff_airport_city" ).val(ui.item.st_city);
				return false;
		},     
		select: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			$("#dropoff_airport" ).val(name);
			$("#dropoff_airport_state" ).val(ui.item.st_state);
			$("#dropoff_airport_city" ).val(ui.item.st_city);
			return false;
		}
	});	
$('#dropoff_airport').live('change',function(){
//var selected_zipcode = $(this).val();
var selected_zipcode = $.trim($(this).val());
var str	= selected_zipcode; 
//selected_zipcode = str.replace(/\s/g, ''); 

var letters = /^[a-zA-Z ]+$/;	
if(str.match(letters))
{
			 selected_zipcode = str; 
} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
}

//alert($("#pick_city" ).val());
var select_pickup_city = $("#dropoff_airport_city" ).val();
//alert(select_pickup_city);
var select_pickup_state = $("#dropoff_airport_state" ).val();
//alert(select_pickup_state);
//var select_pickup_country = $("#pickup_country" ).val();
//alert(select_pickup_country);
//alert($("#pick_zip").val());
//alert($("#pick_zip").val().indexOf(','));

if ($("#dropoff_airport").val().indexOf(',') != -1 && $("#dropoff_airport").val().indexOf('USA') != -1 && $("#dropoff_airport").val().indexOf('Canada') != -1) {
	if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
	{
		//$("#pickup_location").val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
	}
}
else
{
	if(selected_zipcode!=''){
	  $.ajax({
            url: "<?php echo base_url(); ?>org_transportation/get_airports_by_zipcode_or_airport_id/" ,
            dataType: "json",
            data:
            {
                term: selected_zipcode,
				city: $("#dropoff_airport_city" ).val(),
				state: $("#dropoff_airport_state" ).val()
            },
            success: function (data)
            {
				//alert(data);
				//alert(data.length);
				//console.log(data);
				//console.log(data[0].label);
				if(data)
				{
				var name = data[0].label;
				//alert(name);
				$( "#dropoff_airport" ).val(data[0].label);
				$( "#dropoff_airport_state" ).val(data[0].st_state);
				$( "#dropoff_airport_city" ).val(data[0].st_city);
				}
				else
				{
					if(data == null || data === '')
					{
						alert('Please enter valid to location');
						$("#dropoff_airport").val('');
					}
				}
				
            }
        });		
	} //!=''
}
});	
	
	
	

$('#dropoff_zip').autocomplete ({
	source: function (request, response)
    {
		request.term = $.trim(request.term);
		var str	= request.term;
		var letters = /^[a-zA-Z ]+$/;	
		if(str.match(letters))
		{
			request.term = str; 					
		} else {
			str = str.toUpperCase();
			request.term = str.replace(/\s/g, ''); 
		}	
        $.ajax(
        {
            url: "<?php echo base_url(); ?>org_transportation/get_zip_code/" ,
            dataType: "json",
            data:
            {
                term: request.term,
				city: $("#dropoff_city" ).val(),
				state: $("#dropoff_state" ).val()
            },
            success: function (data)
            {
				if(data=="1")
				{
					window.location.href="<?php echo base_url() ?>";
				}
				else
				{
                	response(data);
				}
            }
        });
    },
	minLength:1,
	focus: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			$("#dropoff_zip" ).val(name);
			$("#dropoff_country" ).val(ui.item.st_country);
			country_state(ui.item.st_country,"dropoff");
			$("#dropoff_city" ).val(ui.item.city);
			$("#dropoff_state" ).val(ui.item.state_prefix);
			return false;
	},
	open: function() { $('.ui-menu').width($("#dropoff_zip" ).width()) },
	select: function( event, ui ) {
		var id = ui.item.label;
		var name = ui.item.value;
		$("#dropoff_zip" ).val(name);
		$("#dropoff_country" ).val(ui.item.st_country);
		country_state(ui.item.st_country,"dropoff");
		$("#dropoff_city" ).val(ui.item.city);
		$("#dropoff_state" ).val(ui.item.state_prefix);
		return false;
		}
	});

$('#pickup_zip').autocomplete ({
	source: function (request, response)
    {
		request.term = $.trim(request.term);
		var str	= request.term;
		var letters = /^[a-zA-Z ]+$/;	
		if(str.match(letters))
		{
			request.term = str; 					
		} else {
			str = str.toUpperCase();
			request.term = str.replace(/\s/g, ''); 
		}	
        $.ajax(
        {
            url: "<?php echo base_url(); ?>org_transportation/get_zip_code/" ,
            dataType: "json",
            data:
            {
                term: request.term,
				city: $("#pickup_city" ).val(),
				state: $("#pickup_state" ).val()
            },
            success: function (data)
            {
				if(data=="1")
				{
					window.location.href="<?php echo base_url() ?>";
				}
				else
				{
                	response(data);
				}
            }
        });
    },
	minLength:1,
	open: function() { $('.ui-menu').width($("#pickup_zip" ).width()) },
	focus: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			$("#pickup_zip" ).val(name);
			$("#pickup_country" ).val(ui.item.st_country);
			country_state(ui.item.st_country,"pickup");
			$("#pickup_city" ).val(ui.item.city);
			$("#pickup_state" ).val(ui.item.state_prefix);
			return false;
	},  
	select: function( event, ui ) {
		var id = ui.item.label;
		var name = ui.item.value;
		$("#pickup_zip" ).val(name);
		$("#pickup_country" ).val(ui.item.st_country);
		country_state(ui.item.st_country,"pickup");
		$("#pickup_city" ).val(ui.item.city);
		$("#pickup_state" ).val(ui.item.state_prefix);
		
		return false;
	}
	});
	
	
	$('#o_pickup_zip').autocomplete ({
	source: function (request, response)
    {
		request.term = $.trim(request.term);
		var str	= request.term;
		var letters = /^[a-zA-Z ]+$/;	
		if(str.match(letters))
		{
			request.term = str; 					
		} else {
			str = str.toUpperCase();
			request.term = str.replace(/\s/g, ''); 
		}	
        $.ajax(
        {
            url: "<?php echo base_url(); ?>org_transportation/get_zip_code/" ,
            dataType: "json",
            data:
            {
                term: request.term,
				city: $("#o_pickup_city" ).val(),
				state: $("#o_pickup_state" ).val()
            },
            success: function (data)
            {
				if(data=="1")
				{
					window.location.href="<?php echo base_url() ?>";
				}
				else
				{
                	response(data);
				}
            }
        });
    },
	minLength:1,
	open: function() { $('.ui-menu').width($("#o_pickup_zip" ).width()) },
	focus: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			$("#o_pickup_zip" ).val(name);
			$("#o_pickup_country" ).val(ui.item.st_country);
			country_state(ui.item.st_country,"o_pickup");
			$("#o_pickup_city" ).val(ui.item.city);
			$("#o_pickup_state" ).val(ui.item.state_prefix);
			return false;
	},  
	select: function( event, ui ) {
		var id = ui.item.label;
		var name = ui.item.value;
		$("#o_pickup_zip" ).val(name);
		$("#o_pickup_country" ).val(ui.item.st_country);
		country_state(ui.item.st_country,"o_pickup");
		$("#o_pickup_city" ).val(ui.item.city);
		$("#o_pickup_state" ).val(ui.item.state_prefix);
		
		return false;
	}
	});

  <?php 
				if($this->session->flashdata('leg_upload_error')) {
			?>
			$('#loader').hide();
			$('#error_popup').modal('show');
				<?php } ?>
				
				  <?php 
				if($this->session->flashdata('leg_upload_success')) {
			?>
			$('#leg_upload_success_popup').modal('show');
			
				<?php } ?>
        
					
});	


$('#upload_leg_file').live('click',function(event) {
	event.preventDefault();
	var action = $(this).attr("id");
	$('#upload_leg_f').val('');
	var error_msg = '';
	
	if($('#leg_upload').val() == '')
	{
	alert('Please select file to upload.');
	return false;
	}
	
	if($('#leg_upload').val()!='') {
			$("#popup_leg_upload_cancel").attr("disabled",true);
			$("#popup_leg_upload_cancel").hide();
			$("#popup_leg_upload_close").hide();
			var fsize1 = $('#leg_upload')[0].files[0].size;
			var fname1 = $('#leg_upload')[0].files[0].name;
			var ftype1 = $('#leg_upload')[0].files[0].type;
			
			if ( $.browser.msie ) {
				//alert( $.browser.version );
				// Use a regular expression to trim everything before final dot
				 var extension = $('#leg_upload').val().replace(/^.*\./, '');
				 //alert(extension);
				   
				 if(extension != "" && extension != "xls" && extension != "xlsx" && extension != "csv")
				 {
					error_msg+='Upload file format is invalid\n';
				 }
				 else{
					//error_msg+='correct file format\n';
				 }
			}
			else
			{
				if(fsize1 > 1048576) {
					error_msg+='Upload file must be less than 1MB\n';
				}
				
				if(ftype1 != 'text/comma-separated-values' && ftype1 != 'application/vnd.ms-excel' && ftype1 != 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' && ftype1 != '.csv') {
					error_msg+='Upload file format is invalid\n';
				}
			}			
			
			if(error_msg != '') {
				alert(error_msg);
				return false;
			}
			$('#upload_leg_f').val('1');
			$('#upload_leg_div').modal('hide');
			$('#loader').show();
			$('#upload_legs_by_file').submit();
	}

});
	   
jQuery('#save_legs,#save_draft,#save_only').live('click',function(e){
var action = $(this).attr("id");
	$('#upload_leg_f').val('');
		<?php if($transport_details['st_trans_type']=='P')
		{
			?>
			
		if(action=='save_legs')
		{
			var new_date = new Date();
			<?php 
			
			$dt_target =  date("Y",strtotime($transport_details['dt_target'])).",".(date("m",strtotime($transport_details['dt_target']))-1).",".date("d",strtotime($transport_details['dt_target'])).",23,59,59,0";
			$dt_pickup_date =  date("Y",strtotime($transport_details['dt_pickup_date'])).",".(date("m",strtotime($transport_details['dt_pickup_date']))-1).",".date("d",strtotime($transport_details['dt_pickup_date'])).",0,0,0,0";
			
			if($transport_details['in_status']=='1')
			{
				?>
				
				if(new Date(<?php echo $dt_target;?>)<new Date())
				{
					alert("Transportation target date must be greater than current date.");
					return false;
				}
				<?php	
			}
			else
			{
				?>
				if(new Date(<?php echo $dt_pickup_date;?>)<new Date(new_date.getFullYear(),new_date.getMonth(),new_date.getDate(),0,0,0,0) || new Date(<?php echo $dt_target ?>)<new Date())
				{
					alert("Transportation target date and pick up date must be greater than or equal to the current date.");
					return false;
				}
				<?php	
			}
			?>	
		}
		 //alert(Date.now());
		 //exit;
		var g_leg = $('#address_display').css('display');
		var a_leg = $('#aviation_display').css('display');
		var o_leg = $('#overnight_display').css('display');
		 
		//if(flag!='')
		if(flag!='' || g_leg == 'block' || a_leg == 'block' || o_leg == 'block')
		{
			//alert("Update your current leg.");
			alert("Please scroll down to complete editing the currently selected leg.");
			return false;
		}
		var start_zip = '<?php echo $transport_details['st_from_zip']; ?>';
		var end_zip  = '<?php echo $transport_details['st_to_zip']; ?>'; 
		var error_message = "";
		var last_error_message = "";
		
		//alert('myArray.length:'+myArray.length);
		
		//console.log('myArray.length:'+myArray.length);
		//console.log('myArray');
		//for(var i = 0; i < myArray.length; i++){
			//console.log(i + " = " + myArray[i]);
		//}
		var status = '0';
		if(myArray.length>0)
		{
			for(var j=0;j<myArray.length;j++)
			{
				if(myArray[j]['update_leg'] == 'delete')
				{
					status = '1';
				} else {
					status = '0';
				}		
			}
			if(status == '1')
			{
				alert("Please create legs.");
				return false;
			}	
		}
		else {
			alert("Please create legs.");
			return false;
		}
		
	   /*	if(myArray.length == 1)
		{
			//console.log('myArray.length:'+myArray.length);
			//console.log(myArray);
			//alert(myArray[0]['update_leg']);
			if(myArray[0]['update_leg'] == 'delete')
			{
			alert("Please create legs.");
			return false;			
			}
		}
		
		if(myArray.length == 2)
		{
			//console.log('myArray.length:'+myArray.length);
			//console.log(myArray);
			//alert(myArray[0]['update_leg']);
			if(myArray[0]['update_leg'] == 'delete' && myArray[1]['update_leg'] == 'delete')
			{
			alert("Please create legs.");
			return false;			
			}
		}
		
		if(myArray.length == 3)
		{
			//console.log('myArray.length:'+myArray.length);
			//console.log(myArray);
			//alert(myArray[0]['update_leg']);
			if(myArray[0]['update_leg'] == 'delete' && myArray[1]['update_leg'] == 'delete' && myArray[2]['update_leg'] == 'delete')
			{
			alert("Please create legs.");
			return false;			
			}
		}
		
		if(myArray.length == 4)
		{
			//console.log('myArray.length:'+myArray.length);
			//console.log(myArray);
			//alert(myArray[0]['update_leg']);
			if(myArray[0]['update_leg'] == 'delete' && myArray[1]['update_leg'] == 'delete' && myArray[2]['update_leg'] == 'delete' && myArray[3]['update_leg'] == 'delete')
			{
			alert("Please create legs.");
			return false;			
			}
		}
		
		if(myArray.length == 5)
		{
			//console.log('myArray.length:'+myArray.length);
			//console.log(myArray);
			//alert(myArray[0]['update_leg']);
			if(myArray[0]['update_leg'] == 'delete' && myArray[1]['update_leg'] == 'delete' && myArray[2]['update_leg'] == 'delete' && myArray[3]['update_leg'] == 'delete' && myArray[4]['update_leg'] == 'delete')
			{
			alert("Please create legs.");
			return false;			
			}
		}
		
		if(myArray.length == 6)
		{
			//console.log('myArray.length:'+myArray.length);
			//console.log(myArray);
			//alert(myArray[0]['update_leg']);
			if(myArray[0]['update_leg'] == 'delete' && myArray[1]['update_leg'] == 'delete' && myArray[2]['update_leg'] == 'delete' && myArray[3]['update_leg'] == 'delete' && myArray[4]['update_leg'] == 'delete' && myArray[5]['update_leg'] == 'delete')
			{
			alert("Please create legs.");
			return false;			
			}
		}
		
		if(myArray.length == 7)
		{
			//console.log('myArray.length:'+myArray.length);
			//console.log(myArray);
			//alert(myArray[0]['update_leg']);
			if(myArray[0]['update_leg'] == 'delete' && myArray[1]['update_leg'] == 'delete' && myArray[2]['update_leg'] == 'delete' && myArray[3]['update_leg'] == 'delete' && myArray[4]['update_leg'] == 'delete' && myArray[5]['update_leg'] == 'delete' && myArray[6]['update_leg'] == 'delete')
			{
			alert("Please create legs.");
			return false;			
			}
		}
		
		if(myArray.length == 8)
		{
			//console.log('myArray.length:'+myArray.length);
			//console.log(myArray);
			//alert(myArray[0]['update_leg']);
			if(myArray[0]['update_leg'] == 'delete' && myArray[1]['update_leg'] == 'delete' && myArray[2]['update_leg'] == 'delete' && myArray[3]['update_leg'] == 'delete' && myArray[4]['update_leg'] == 'delete' && myArray[5]['update_leg'] == 'delete' && myArray[6]['update_leg'] == 'delete' && myArray[7]['update_leg'] == 'delete')
			{
			alert("Please create legs.");
			return false;			
			}
		} */
		renumber_table('#leg_table_body');
		if(myArray.length>0)
		{
			//console.log(myArray);exit;
			for(var i=0;i<myArray.length;i++)
			{
				if(myArray[i]['update_leg']!='delete')
				{
					if(myArray[i]['route_type_id']=='1') // Aviation
					{
						var pickup = myArray[i]['pickup_airport_clock'];
						var target = myArray[i]['dropoff_airport_clock'];
						var target1 = target.replace(" - ", " ");
						var pickup1 = pickup.replace(" - ", " ");
						if((new Date('<?php echo $dt_target;?>')<new Date(pickup1) || new Date('<?php echo $dt_target;?>')<new Date(target1)) || (new Date('<?php echo $dt_pickup_date;?>')>new Date(pickup1) || new Date('<?php echo $dt_pickup_date;?>')>new Date(target1)))
						{
							error_message +="Please update leg "+(i+1)+" as per new transportation date. \n";
						}
					}
					else if(myArray[i]['route_type_id']=='0') // Aviation  // road
					{
						var pickup = myArray[i]['clockface_2_modal'];
						var target = myArray[i]['clockface_3_modal'];
						var target1 = target.replace(" - ", " ");
						var pickup1 = pickup.replace(" - ", " ");
						if((new Date('<?php echo $dt_target;?>')<new Date(pickup1) || new Date('<?php echo $dt_target;?>')<new Date(target1)) || (new Date('<?php echo $dt_pickup_date;?>')>new Date(pickup1) || new Date('<?php echo $dt_pickup_date;?>')>new Date(target1)))
						{
							error_message +="Please update leg "+(i+1)+" as per new transportation date. \n";
						}
					}
					
				}
			}
			
			//alert(error_message);
			//exit;
			if(error_message!='')
			{
				alert(error_message);
				return false;
			}
			//return false;
			$('#save_legs,#save_draft,#add_aviation_leg_g,#add_aviation_leg_a,#save_only').hide();
			$('.add-additional-info').hide();
			
			if(action == 'save_legs')
			{
				$('#transport_loader').modal('show');
				//$('#transport_loader').modal('show',10000);
				setTimeout(function(){
				  $('#transport_loader').modal('hide')
				}, 10000);
			}
			
			if(action == 'save_only')
			{
				$('#transport_loader_save_only').modal('show');
				setTimeout(function(){
				  $('#transport_loader_save_only').modal('hide')
				}, 10000);
			}
			//jQuery.post("<?php echo base_url(); ?>transport-create-legs/",{data_val:myArray,action:action}, function( data ) {
			//alert(data);
			//return false;
			//$('#transport_loader').modal('hide');
			//window.location.href="<?php echo base_url()."org-transportation-scheduled/".$this->session->userdata('transport_id'); ?>";
			//});
			var jsondata = JSON.stringify(myArray); 
			var transport_id = '<?php echo $transport_id ?>';
			var org_id = '<?php echo $org_id ?>';
			$.ajax({
				url: '<?php echo base_url(); ?>transport-create-legs/',
				type: 'POST',
				data: { data_val:jsondata,action:action,transport_id:transport_id,org_id:org_id},
				success: function(result) {
					//console.log(result);
					$('#transport_loader').modal('hide');
					
					 <?php // added by amit ...7-2-2017  if-else?>
					if(action == 'save_draft')
					  {
							$('#portlet-config').modal('show');         
							$('#save_legs,#save_draft,#add_aviation_leg_g,#add_aviation_leg_a,#save_only').show();
							$('.add-additional-info').show();       
					  }
					  else
					{
						window.location.href="<?php echo base_url()."org-transportation-scheduled/".$this->session->userdata('transport_id'); ?>";
				    }
							   
					//window.location.href="<php echo base_url()."org-transportation-scheduled/"?>";
				}
			});
		}
		else
		{
			alert("Please create legs.");
			return false;
		}
		<?php }else{ ?>
			$('#save_legs,#save_draft,#add_aviation_leg_g,#add_aviation_leg_a,#save_only').hide();
			$('.add-additional-info').hide();
			if(action == 'save_legs')
			{
				$('#transport_loader').modal('show');
				//$('#transport_loader').modal('show',10000);
				setTimeout(function(){
				  $('#transport_loader').modal('hide')
				}, 10000);
			}

			if(action == 'save_only')
			{
				$('#transport_loader_save_only').modal('show');
				setTimeout(function(){
				  $('#transport_loader_save_only').modal('hide')
				}, 10000);
			}
			
			
			var transport_id = '<?php echo $transport_id ?>';
			var org_id = '<?php echo $org_id ?>';
			jQuery.post("<?php echo base_url(); ?>transport-create-legs/",{data_val:myArray,transport_type:"D",action:action,transport_id:transport_id,org_id:org_id}, function( data ) {
			//alert(data);
			//return false;
			$('#transport_loader').modal('hide');
			//added by amit

            if(action == 'save_draft')
            {
                  $('#portlet-config').modal('show');         
                  $('#save_legs,#save_draft,#add_aviation_leg_g,#add_aviation_leg_a,#save_only').show();
                  $('.add-additional-info').show();       
            }
            else
            {
                  window.location.href="<?php echo base_url()."org-transportation-scheduled/".$this->session->userdata('transport_id'); ?>";      
            }
			
			});
		<?php } ?>
});

	var add_flg='';
	$(".legs_btn,#transport_submit").live('click',function(){
	var a = (myArray.length) - 1;
	//alert('last_tr_id'+$('#leg_table tr:last').attr("id"));
	//var a =  $('#leg_table tr:last').attr("id");
	var deleted_leg =  $('#leg_deleted').val();
	if(deleted_leg == 1)
	{
		var r =  $('#leg_table tr:last').attr("id");
		if(typeof r == 'undefined')
		{			
			r = 'tr_1';
		}
		var last_tr_id = r.split('_');
		var a = parseInt(last_tr_id[1]-1);
	}
	else 
	{
		var a = (myArray.length) - 1;	
	}
	if(flag!='')
	{
		//alert("Update your current leg.");
		alert("Please scroll down to complete editing the currently selected leg.");
		return false;
	}
	document.getElementById("addlegs").reset();
	$("#address_display,#aviation_display").hide();
	$("#clockface_2_modal,#pickup_airport_clock,#leg_id,#route_type,#route_type_id").val('');	
	
	add_flg='1';
	
	if($(this).attr('id')=='add_aviation_leg_g')
	{
		//alert('myArray.length'+myArray.length);
		
		$('#aviation_display').hide();
		$('#overnight_display').hide();
		$('#address_display').show();
		$("#route_type").val("Road");
		$("#route_type_id").val("0");
		$('#form_aviation').find("*").removeClass('has-error');
		$('#form_aviation').find(".help-block").hide();
		$('#form').find(".help-block").hide();
		
		var drop_state_list = '';
		
		var pick_s ='<?php echo $transport_details['st_from_state']; ?>';
		var pick_c ='<?php echo strtoupper($transport_details['st_from_country']); ?>';
		
		if(myArray.length == 0 && pick_c == 'USA') {
				drop_state_list += '<option value="">Select</option>';
				drop_state_list += '<?php foreach($this->common_function->state_list as $key=>$val) { ?>';
				drop_state_list += ' <option <?php if($transport_details['st_from_state']==$key){?> selected="selected" <?php } ?> value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
				drop_state_list += '<?php } ?>';
			
		}
		else if(myArray.length == 0 && pick_c == 'CANADA') {
				drop_state_list += '<option value="">Select</option>';
				drop_state_list += '<?php foreach($this->common_function->canadian_state_list as $key=>$val) { ?>';
				drop_state_list += ' <option <?php if($transport_details['st_from_state']==$key){?> selected="selected" <?php } ?> value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
				drop_state_list += '<?php } ?>';
			
		}		
		else if(myArray.length > 0  && myArray[a].dropoff_country == 'USA') {
				drop_state_list += '<option value="">Select</option>';
				drop_state_list += '<?php foreach($this->common_function->state_list as $key=>$val) { ?>';
				drop_state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
				drop_state_list += '<?php } ?>';
			
		} else if(myArray.length > 0  && myArray[a].dropoff_country == 'CANADA') {
				drop_state_list += '<option value="">Select</option>';
				drop_state_list += '<?php foreach($this->common_function->canadian_state_list as $key=>$val) { ?>';
				drop_state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
				drop_state_list += '<?php } ?>';
				
		} else if(myArray.length > 0  && myArray[a].route_type_id == '2') {
			    if(myArray[a].o_pickup_country == 'USA')
				{
				drop_state_list += '<option value="">Select</option>';
				drop_state_list += '<?php foreach($this->common_function->state_list as $key=>$val) { ?>';
				drop_state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
				drop_state_list += '<?php } ?>';
				}
				else if(myArray[a].o_pickup_country == 'CANADA')
				{
				drop_state_list += '<option value="">Select</option>';
				drop_state_list += '<?php foreach($this->common_function->canadian_state_list as $key=>$val) { ?>';
				drop_state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
				drop_state_list += '<?php } ?>';
				}				
				
		}else{}
		
		$('#pickup_state').html(drop_state_list); 
		
		
		if(a == 0 && myArray[a]['update_leg'] == 'delete')
		{
				if(pick_c == 'USA') {
					drop_state_list += '<option value="">Select</option>';
					drop_state_list += '<?php foreach($this->common_function->state_list as $key=>$val) { ?>';
					drop_state_list += ' <option <?php if($transport_details['st_from_state']==$key){?> selected="selected" <?php } ?> value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
					drop_state_list += '<?php } ?>';
				
			}
			else if(pick_c == 'CANADA') {
					drop_state_list += '<option value="">Select</option>';
					drop_state_list += '<?php foreach($this->common_function->canadian_state_list as $key=>$val) { ?>';
					drop_state_list += ' <option <?php if($transport_details['st_from_state']==$key){?> selected="selected" <?php } ?> value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
					drop_state_list += '<?php } ?>';
				
			}
			$('#pickup_state').html(drop_state_list); 
			
			$("#pickup_street").val('<?php echo isset($transport_details['st_from_street']) ? $transport_details['st_from_street'] : ''; ?>');
			$("#pickup_city").val('<?php echo isset($transport_details['st_from_city']) ? $transport_details['st_from_city'] : ''; ?>');
			$("#pickup_state").val('<?php echo isset($transport_details['st_from_state']) ? $transport_details['st_from_state'] : ''; ?>');
			$("#pickup_zip").val('<?php echo isset($transport_details['st_from_zip']) ? $transport_details['st_from_zip'] : ''; ?>');
			$("#pickup_country").val('<?php echo isset($transport_details['st_from_country']) ? strtoupper($transport_details['st_from_country']) : ''; ?>');
			$("#clockface_2_modal").val('<?php echo isset($transport_details['dt_pickup_date']) ? date('d M y',strtotime($transport_details['dt_pickup_date'])).' - 06:00 AM':'' ?>');
			var c = $("#pickup_city").val();
			var co = $("#pickup_country").val();
			var s = $("#pickup_state").val();	
			var z =$("#pickup_zip").val();
			var pickval = z+', '+c+', '+s+', '+co;
			$('#pickup_location').val(pickval);
			
			return false;
		}
		
		if(myArray.length == 0)
		{
			//alert('length:'+myArray.length);
			$("#pickup_street").val('<?php echo isset($transport_details['st_from_street']) ? $transport_details['st_from_street'] : ''; ?>');
			$("#pickup_city").val('<?php echo isset($transport_details['st_from_city']) ? $transport_details['st_from_city'] : ''; ?>');
			$("#pickup_state").val('<?php echo isset($transport_details['st_from_state']) ? $transport_details['st_from_state'] : ''; ?>');
			$("#pickup_zip").val('<?php echo isset($transport_details['st_from_zip']) ? $transport_details['st_from_zip'] : ''; ?>');
			$("#pickup_country").val('<?php echo isset($transport_details['st_from_country']) ? strtoupper($transport_details['st_from_country']) : ''; ?>');
			$("#clockface_2_modal").val('<?php echo isset($transport_details['dt_pickup_date']) ? date('d M y',strtotime($transport_details['dt_pickup_date'])).' - 06:00 AM':'' ?>');
			
			var c = $("#pickup_city").val();
			var co = $("#pickup_country").val();
			var s = $("#pickup_state").val();	
			var z =$("#pickup_zip").val();
			var pickval = z+', '+c+', '+s+', '+co;
			$('#pickup_location').val(pickval);		
		}
		else{
			//alert('length:'+myArray.length);
			if(myArray[a].route_type_id == 2)
			{
				$("#pickup_street").val(stripslashes(myArray[a].o_pickup_street ? myArray[a].o_pickup_street : ''));
				$("#pickup_city").val(stripslashes(myArray[a].o_pickup_city));
				$("#pickup_state").val(stripslashes(myArray[a].o_pickup_state));
				$("#pickup_zip").val(stripslashes(myArray[a].o_pickup_zip));
				$("#pickup_country").val(stripslashes(myArray[a].o_pickup_country));	
				
				var c = $("#pickup_city").val();
				var co = $("#pickup_country").val();
				var s = $("#pickup_state").val();	
				var z =$("#pickup_zip").val();
				var pickval = z+', '+c+', '+s+', '+co;
				$('#pickup_location').val(pickval);		
			}
			else if(myArray[a].route_type_id == 1)
			{
				var airport_id = myArray[a].dropoff_airport;
				
				$.ajax({
					  type: "POST",
					  url: '<?php echo base_url(); ?>org_transportation/get_airport_details',
					  data: {
						  airport_id : airport_id
					  },
					  dataType:"json",
					  success:function(data) {
						  
						 var airport_data = data.start; 
						 var zipcode = airport_data.postal_code;
						 var city_name = airport_data.city;
						 var state_name = airport_data.state;
						 var country_name = airport_data.country;
						 
						 if(country_name != '')
						 {
							if(country_name == 'US')
							{
								country_name = 'USA';
							}
							else
							{
								country_name = 'CANADA';
							}	 
						 }
						 var start_time =  myArray[a].dropoff_airport_clock;
						 var start_time_zone = myArray[a].dropoff_airport_zone;
						 
						 $("#pickup_street").val(stripslashes(myArray[a].dropoff_street ? myArray[a].dropoff_street : ''));
						 $("#pickup_city").val((city_name != '') ? city_name : stripslashes(myArray[a].dropoff_city));
						 $("#pickup_state").val((state_name != '') ? state_name : stripslashes(myArray[a].dropoff_state));
						 $("#pickup_zip").val((zipcode != '') ? zipcode : stripslashes(myArray[a].dropoff_zip));
						 $("#pickup_country").val((country_name != '') ? country_name : stripslashes(myArray[a].dropoff_country));
						
						 $("#clockface_2_modal").val((start_time != '') ? start_time : myArray[a].clockface_3_modal);	
						 $("#pickup_zone").val((start_time_zone != '') ? start_time_zone : myArray[a].dropoff_zone);
						 
						 var c = $("#pickup_city").val();
						 var co = $("#pickup_country").val();
						 var s = $("#pickup_state").val();	
						 var z =$("#pickup_zip").val();
						 var pickval = z+', '+c+', '+s+', '+co;
						 $('#pickup_location').val(pickval);
					  }
				});
				
			}
			else
			{
				$("#pickup_street").val(stripslashes(myArray[a].dropoff_street ? myArray[a].dropoff_street : ''));
				$("#pickup_city").val(stripslashes(myArray[a].dropoff_city));
				$("#pickup_state").val(stripslashes(myArray[a].dropoff_state));
				$("#pickup_zip").val(stripslashes(myArray[a].dropoff_zip));
				$("#pickup_country").val(stripslashes(myArray[a].dropoff_country));
				
				$("#clockface_2_modal").val(myArray[a].clockface_3_modal);	
				$("#pickup_zone").val(myArray[a].dropoff_zone);
				
				var c = $("#pickup_city").val();
				var co = $("#pickup_country").val();
				var s = $("#pickup_state").val();	
				var z =$("#pickup_zip").val();
				var pickval = z+', '+c+', '+s+', '+co;
				$('#pickup_location').val(pickval);
			}			
		}
	}	
	
	if($(this).attr('id')=='add_aviation_leg_a')
	{
		 //alert(myArray.length);
		 
		 $('#address_display').hide();
		 $('#overnight_display').hide();
		 $("#route_type").val("Aviation");
		 $('#aviation_display').show();
		 $("#route_type_id").val("1");
		 $('#form').find("*").removeClass('has-error');
		 $('#form').find(".help-block").hide();
		 $('#form_aviation').find(".help-block").hide();	
		 var user_time_zone	  =  $('#user_time_zone').val();
		 var dropoff_airport_zone = '';
		 
		 
		if(a == 0 && myArray[a]['update_leg'] == 'delete')
		{
			$("#pickup_airport").val('<?php echo isset($transport_details['st_from_zip']) ? $transport_details['st_from_zip'] : ''; ?>');
			$("#pickup_airport_clock").val('<?php echo isset($transport_details['dt_pickup_date']) ? date('d M y',strtotime($transport_details['dt_pickup_date'])).' - 06:00 AM':'' ?>');
			$("#pickup_airport_zone").val(user_time_zone);
			return false;
		}
		
		
		 if(myArray.length > 0)
		 {
		 
		 	if(myArray[a].dropoff_airport_zone != '')
			 {
				dropoff_airport_zone = myArray[a].dropoff_airport_zone;			
			 }
			 if(dropoff_airport_zone == '')
			 {
				dropoff_airport_zone = myArray[a].dropoff_zone;
			 }
			 if(dropoff_airport_zone == '')
			 {
				dropoff_airport_zone = $('#user_time_zone').val();
			 }
			 
			 if(myArray[a].route_type_id == 2)
			 {
				$("#pickup_airport").val(stripslashes(myArray[a].o_pickup_zip));			
			 }
			 else
			 {
				$("#pickup_airport").val(stripslashes(myArray[a].dropoff_airport ? myArray[a].dropoff_airport : myArray[a].dropoff_zip));
				$("#pickup_airport_clock").val(myArray[a].dropoff_airport_clock ? myArray[a].dropoff_airport_clock :  myArray[a].clockface_3_modal);
				$("#pickup_airport_zone").val(dropoff_airport_zone);
			 }	
		}
		
		if(myArray.length == 0)
		{
			//alert('myArray.length :'+myArray.length);
			$("#pickup_airport").val('<?php echo isset($transport_details['st_from_zip']) ? $transport_details['st_from_zip'] : ''; ?>');
			$("#pickup_airport_clock").val('<?php echo isset($transport_details['dt_pickup_date']) ? date('d M y',strtotime($transport_details['dt_pickup_date'])).' - 06:00 AM':'' ?>');
			$("#pickup_airport_zone").val(user_time_zone);
			 	
		}	
		
	}
		 
	if($(this).attr('id')=='add_aviation_leg_o')
	{
		//alert(myArray.length);	
			
		$('#overnight_display').show();
		$('#aviation_display').hide();
		$('#address_display').hide();
		$("#route_type").val("Overnight");
		$("#route_type_id").val("2");
		
		
		var drop_state_list = '';
		
		var pick_s ='<?php echo $transport_details['st_from_state']; ?>';
		var pick_c ='<?php echo strtoupper($transport_details['st_from_country']); ?>';
		
		//alert(pick_s);
		//alert(pick_c);
		
		if(myArray.length == 0 && pick_c == 'USA') {
				drop_state_list += '<option value="">Select</option>';
				drop_state_list += '<?php foreach($this->common_function->state_list as $key=>$val) { ?>';
				drop_state_list += ' <option <?php if($transport_details['st_from_state']==$key){?> selected="selected" <?php } ?> value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
				drop_state_list += '<?php } ?>';
			
		}
		else if(myArray.length == 0 && pick_c == 'CANADA') {
				drop_state_list += '<option value="">Select</option>';
				drop_state_list += '<?php foreach($this->common_function->canadian_state_list as $key=>$val) { ?>';
				drop_state_list += ' <option <?php if($transport_details['st_from_state']==$key){?> selected="selected" <?php } ?> value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
				drop_state_list += '<?php } ?>';
			
		}		
		else if(myArray.length > 0 && myArray[a].route_type_id == 2 && myArray[a].o_pickup_country == 'USA') {
				drop_state_list += '<option value="">Select</option>';
				drop_state_list += '<?php foreach($this->common_function->state_list as $key=>$val) { ?>';
				drop_state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
				drop_state_list += '<?php } ?>';
			
		} else if(myArray.length > 0 && myArray[a].route_type_id == 2 && myArray[a].o_pickup_country == 'CANADA') {
				drop_state_list += '<option value="">Select</option>';
				drop_state_list += '<?php foreach($this->common_function->canadian_state_list as $key=>$val) { ?>';
				drop_state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
				drop_state_list += '<?php } ?>';
				
		}else if(myArray.length > 0  && (myArray[a].route_type_id == 0 || myArray[a].route_type_id == 1) && myArray[a].dropoff_country == 'USA') {
				drop_state_list += '<option value="">Select</option>';
				drop_state_list += '<?php foreach($this->common_function->state_list as $key=>$val) { ?>';
				drop_state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
				drop_state_list += '<?php } ?>';
			
		} else if(myArray.length > 0  && (myArray[a].route_type_id == 0 || myArray[a].route_type_id == 1) && myArray[a].dropoff_country == 'CANADA') {
				drop_state_list += '<option value="">Select</option>';
				drop_state_list += '<?php foreach($this->common_function->canadian_state_list as $key=>$val) { ?>';
				drop_state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
				drop_state_list += '<?php } ?>';
				
		} else {}
		
		$('#o_pickup_state').html(drop_state_list); 
		
		
		if(a == 0 && myArray[a]['update_leg'] == 'delete')
		{
			if(pick_c == 'USA') {
					drop_state_list += '<option value="">Select</option>';
					drop_state_list += '<?php foreach($this->common_function->state_list as $key=>$val) { ?>';
					drop_state_list += ' <option <?php if($transport_details['st_from_state']==$key){?> selected="selected" <?php } ?> value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
					drop_state_list += '<?php } ?>';
				
			}
			else if(pick_c == 'CANADA') {
					drop_state_list += '<option value="">Select</option>';
					drop_state_list += '<?php foreach($this->common_function->canadian_state_list as $key=>$val) { ?>';
					drop_state_list += ' <option <?php if($transport_details['st_from_state']==$key){?> selected="selected" <?php } ?> value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
					drop_state_list += '<?php } ?>';
				
			}
			$('#o_pickup_state').html(drop_state_list); 
			$("#o_pickup_street").val('<?php echo isset($transport_details['st_from_street']) ? $transport_details['st_from_street'] : ''; ?>');
			$("#o_pickup_city").val('<?php echo isset($transport_details['st_from_city']) ? $transport_details['st_from_city'] : ''; ?>');
			$("#o_pickup_zip").val('<?php echo isset($transport_details['st_from_zip']) ? $transport_details['st_from_zip'] : ''; ?>');
			$("#o_pickup_country").val('<?php echo isset($transport_details['st_from_country']) ? strtoupper($transport_details['st_from_country']) : ''; ?>');
			var c = $("#o_pickup_city").val();
			var co = $("#o_pickup_country").val();
			var s = $("#o_pickup_state").val();	
			var z =$("#o_pickup_zip").val();
			var pickval = z+', '+c+', '+s+', '+co;
			$('#o_pickup_location').val(pickval);
			
			
			return false;
		}
		
		if(myArray.length > 0)
		{
			if(myArray[a].route_type_id == 2)
			{
			$("#o_pickup_street").val(stripslashes(myArray[a].o_pickup_street ? myArray[a].o_pickup_street : ''));
			$("#o_pickup_city").val(stripslashes(myArray[a].o_pickup_city));
			$("#o_pickup_state").val(stripslashes(myArray[a].o_pickup_state));
			$("#o_pickup_zip").val(stripslashes(myArray[a].o_pickup_zip));
			$("#o_pickup_country").val(stripslashes(myArray[a].o_pickup_country));
			
			var c = $("#o_pickup_city").val();
			var co = $("#o_pickup_country").val();
			var s = $("#o_pickup_state").val();	
			var z =$("#o_pickup_zip").val();
			var pickval = z+', '+c+', '+s+', '+co;
			$('#o_pickup_location').val(pickval);
			}
			if(myArray[a].route_type_id == 0)
			{
			$("#o_pickup_street").val(stripslashes(myArray[a].dropoff_street ? myArray[a].dropoff_street : ''));
			$("#o_pickup_city").val(stripslashes(myArray[a].dropoff_city));
			$("#o_pickup_state").val(stripslashes(myArray[a].dropoff_state));
			$("#o_pickup_zip").val(stripslashes(myArray[a].dropoff_zip));
			$("#o_pickup_country").val(stripslashes(myArray[a].dropoff_country));
			
			var c = $("#o_pickup_city").val();
			var co = $("#o_pickup_country").val();
			var s = $("#o_pickup_state").val();	
			var z =$("#o_pickup_zip").val();
			var pickval = z+', '+c+', '+s+', '+co;
			$('#o_pickup_location').val(pickval);
			}
			if(myArray[a].route_type_id == 1)
			{
			//console.log(myArray[a]);	
			
			var airport_id = myArray[a].dropoff_airport;
				
				$.ajax({
					  type: "POST",
					  url: '<?php echo base_url(); ?>org_transportation/get_airport_details',
					  data: {
						  airport_id : airport_id
					  },
					  dataType:"json",
					  success:function(data) {
						  
						 var airport_data = data.start; 
						 var zipcode = airport_data.postal_code;
						 var city_name = airport_data.city;
						 var state_name = airport_data.state;
						 var country_name = airport_data.country;
						 
						 if(country_name != '')
						 {
							if(country_name == 'US')
							{
								country_name = 'USA';
							}
							else
							{
								country_name = 'CANADA';
							}	 
						 }
						 
						 $("#o_pickup_street").val(stripslashes(myArray[a].dropoff_street ? myArray[a].dropoff_street : ''));
						 $("#o_pickup_city").val((city_name != '') ? city_name : stripslashes(myArray[a].dropoff_city));
						 $("#o_pickup_state").val((state_name != '') ? state_name : stripslashes(myArray[a].dropoff_state));
						 $("#o_pickup_zip").val((zipcode != '') ? zipcode : stripslashes(myArray[a].dropoff_zip));
						 $("#o_pickup_country").val((country_name != '') ? country_name : stripslashes(myArray[a].dropoff_country));
						var c = $("#o_pickup_city").val();
						var co = $("#o_pickup_country").val();
						var s = $("#o_pickup_state").val();	
						var z =$("#o_pickup_zip").val();
						var pickval = z+', '+c+', '+s+', '+co;
						$('#o_pickup_location').val(pickval);
					  }
				});
				
			}
		}
		
		if(myArray.length == 0)
		{
			$("#o_pickup_street").val('<?php echo isset($transport_details['st_from_street']) ? $transport_details['st_from_street'] : ''; ?>');
			$("#o_pickup_city").val('<?php echo isset($transport_details['st_from_city']) ? $transport_details['st_from_city'] : ''; ?>');
			$("#o_pickup_zip").val('<?php echo isset($transport_details['st_from_zip']) ? $transport_details['st_from_zip'] : ''; ?>');
			$("#o_pickup_country").val('<?php echo isset($transport_details['st_from_country']) ? strtoupper($transport_details['st_from_country']) : ''; ?>');
			
			var c = $("#o_pickup_city").val();
			var co = $("#o_pickup_country").val();
			var s = $("#o_pickup_state").val();	
			var z =$("#o_pickup_zip").val();
			var pickval = z+', '+c+', '+s+', '+co;
			$('#o_pickup_location').val(pickval);
		}
		
	}	
});	

$('#submit').live('click',function(){	
		
		//alert(myArray.length);
		if(edit_q!='')
		{
			edit_sort_order = myArray[edit_q-1].in_sort_order;	
			delete myArray[edit_q-1];	
		}
	  //$("#addlegs").valid();
	  
	  var to_date = $('#clockface_3_modal').val();
	  var from_date = $('#clockface_2_modal').val();
	  var to_date_split = to_date.split('-');
	  var from_date_split = from_date.split('-');
	  
	  var start_time_date = new Date(from_date_split[0]);
	  var end_time_date = new Date(to_date_split[0]);
	  
	  var end_date = new Date(end_time_date.getFullYear(), end_time_date.getMonth(), end_time_date.getDate()); 
	  var start_date = new Date(start_time_date.getFullYear(), start_time_date.getMonth(), start_time_date.getDate()); 
	  
	  if (start_date > end_date) {
			alert("Start Date is greather than End Date.");
			return false;
	  } 
	  if (end_date < start_date) {
			alert("End Date is less than Start Date.");
			return false;
	  }
	  
	  if($('#addlegs').valid() == false) {
		return false;
	} else {
		
		var pickup_address  = ($("#pickup_street").val()?$("#pickup_street").val()+", ":"");
			pickup_address += ($("#pickup_city").val()?$("#pickup_city").val()+", ":"");
			pickup_address += ($("#pickup_state").val()?$("#pickup_state").val():"");
			pickup_address += ($("#pickup_zip").val()?", "+$("#pickup_zip").val():"");
			
		var dropoff_address  = ($("#dropoff_street").val()?$("#dropoff_street").val()+", ":"");
			dropoff_address += ($("#dropoff_city").val()?$("#dropoff_city").val()+", ":"");
			dropoff_address += ($("#dropoff_state").val()?$("#dropoff_state").val():"");
			dropoff_address += ($("#dropoff_zip").val()?", "+$("#dropoff_zip").val():"");
		var start_time 		 = $("#clockface_2_modal").val();	
			start_time 		+= " - "+$("#pickup_zone").val();	
		var end_time 		 = $("#clockface_3_modal").val();	
			end_time 		+= " - "+$("#dropoff_zone").val();
	
		var leg_id 			= $("#leg_id").val();	
		var update_leg 		= "update";		
	    var b;	
		
		var meeting_location = $("#meeting_location").val();
		
		var no_of_drivers = $("#no_of_drivers").val();
		
		legsArray = [];
		if(edit_q!='')
		{
			var i 		= edit_q-1;
			
			/*
			if(tr_cnt != '')
			{
				edit_q 	= tr_cnt;
			}*/
			var index 	= edit_q;	
			
			var sort_order = index;
			//console.log(myArray);
			if(myArray[i-1])
			{
				if(typeof myArray[i-1].in_sort_order === 'undefined')
				{
					//alert('sort_order ' + myArray[q-2].in_sort_order);
					sort_order = 1;				
				}else{
					sort_order = parseInt(myArray[i-1].in_sort_order) + parseInt(1);
					}

			}

			var sort_order_max = parseInt(edit_sort_order) + parseInt(1);
			var order_id = edit_sort_order;
			var c=[];
		    if(sort_order_max > 0)
			{	
				var counter= 0;	
				var count_loop=1;
				do {
					var inc_counter='0';	
					for(var k=0; k<myArray.length;++k)
					{
						inc_counter++;
						if(i != k)
						{	
							var value = myArray[k];
							if(myArray[k].update_leg !='delete')
							{
								if(sort_order_max == value.in_sort_order && value.route_type_id == '2' )
								{		
									sort_order_max = parseInt(sort_order_max) + parseInt(1);
									c[counter] = k;
									counter++;
									count_loop=1;
									break;
								//return indexvalue;
								} else if(sort_order_max == value.in_sort_order && value.route_type_id != '2' )
								{	
									c[counter] = k;
									counter++;
									count_loop=0;
									break;
								} else {
									next_counter_value = $.map(myArray, function( value, index ) {
														    if(index != i)
															{	
															   if(sort_order_max == value.in_sort_order && value.update_leg !='delete')
														    	return index;
															}	
														});
									 if(next_counter_value.length >0)
									 {
										 count_loop=1;
									 } else {
										 count_loop=0;
										 break;
									 }
								}
							}
						} else if(inc_counter == myArray.length ){
							count_loop=0;
						}		
					}
				} while(count_loop!=0)		
				if(c.length >0)
				{		
					//b =	b[0];
				}	
				else 
				c = -1;
			} else {
				c = -1;
			}
		 
         	myArray[i]=({"pickup_street":addslashes($("#pickup_street").val()),"pickup_city":addslashes($("#pickup_city").val()),"pickup_state":addslashes($("#pickup_state").val()),"pickup_zip":addslashes($("#pickup_zip").val()),"pickup_country":addslashes($("#pickup_country").val()),"clockface_2_modal":$("#clockface_2_modal").val(),"pickup_zone":$("#pickup_zone").val(),"dropoff_street":addslashes($("#dropoff_street").val()),"dropoff_city":addslashes($("#dropoff_city").val()),"dropoff_state":addslashes($("#dropoff_state").val()),"dropoff_zip":addslashes($("#dropoff_zip").val()),"dropoff_country":addslashes($("#dropoff_country").val()),"clockface_3_modal":$("#clockface_3_modal").val(),"dropoff_zone":$("#dropoff_zone").val(),"leg_id":$("#leg_id").val(),"route_type":$("#route_type").val(),"route_type_id":$("#route_type_id").val(),"pickup_airport":addslashes($("#pickup_airport").val()),"pickup_airport_clock":$("#pickup_airport_clock").val(),"pickup_airport_zone":$("#pickup_airport_zone").val(),"dropoff_airport":addslashes($("#dropoff_airport").val()),"dropoff_airport_clock":$("#dropoff_airport_clock").val(),"dropoff_airport_zone":$("#dropoff_airport_zone").val(),"dropoff_airport_state":addslashes($("#dropoff_airport_state").val()),"dropoff_airport_city":addslashes($("#dropoff_airport_city").val()),"pickup_airport_state":addslashes($("#pickup_airport_state").val()),"pickup_airport_city":addslashes($("#pickup_airport_city").val()),"update_leg":"update","meeting_location":addslashes($("#meeting_location").val()),"no_of_drivers":addslashes($("#no_of_drivers").val()),"multiple_drivers":addslashes($("#multiple_drivers_txt").val()),"in_sort_order":edit_sort_order});
			legsArray[0] =({"pickup_street":addslashes($("#pickup_street").val()),"pickup_city":addslashes($("#pickup_city").val()),"pickup_state":addslashes($("#pickup_state").val()),"pickup_zip":addslashes($("#pickup_zip").val()),"pickup_country":addslashes($("#pickup_country").val()),"clockface_2_modal":$("#clockface_2_modal").val(),"pickup_zone":$("#pickup_zone").val(),"dropoff_street":addslashes($("#dropoff_street").val()),"dropoff_city":addslashes($("#dropoff_city").val()),"dropoff_state":addslashes($("#dropoff_state").val()),"dropoff_zip":addslashes($("#dropoff_zip").val()),"dropoff_country":addslashes($("#dropoff_country").val()),"clockface_3_modal":$("#clockface_3_modal").val(),"dropoff_zone":$("#dropoff_zone").val(),"leg_id":$("#leg_id").val(),"route_type":$("#route_type").val(),"route_type_id":$("#route_type_id").val(),"pickup_airport":addslashes($("#pickup_airport").val()),"pickup_airport_clock":$("#pickup_airport_clock").val(),"pickup_airport_zone":$("#pickup_airport_zone").val(),"dropoff_airport":addslashes($("#dropoff_airport").val()),"dropoff_airport_clock":$("#dropoff_airport_clock").val(),"dropoff_airport_zone":$("#dropoff_airport_zone").val(),"dropoff_airport_state":addslashes($("#dropoff_airport_state").val()),"dropoff_airport_city":addslashes($("#dropoff_airport_city").val()),"pickup_airport_state":addslashes($("#pickup_airport_state").val()),"pickup_airport_city":addslashes($("#pickup_airport_city").val()),"update_leg":"update","meeting_location":addslashes($("#meeting_location").val()),"no_of_drivers":addslashes($("#no_of_drivers").val()),"multiple_drivers":addslashes($("#multiple_drivers_txt").val()),"in_sort_order":edit_sort_order});
	
			if(c.length >0)
			{
				var k=0;
				for(var j=0;j<c.length;j++ )
				{
					b=c[j];
					if(myArray[b].route_type_id == '0')
					{
						myArray[b].pickup_street = addslashes($("#dropoff_street").val());
						myArray[b].pickup_city = addslashes($("#dropoff_city").val());
						myArray[b].pickup_state = addslashes($("#dropoff_state").val());
						myArray[b].pickup_zip = addslashes($("#dropoff_zip").val());
						myArray[b].pickup_country = addslashes($("#dropoff_country").val());
					} else if(myArray[b].route_type_id == '1')
					{
						var term = $("#dropoff_zip").val();
						$.ajax({
						url: "<?php echo base_url(); ?>org_transportation/get_airports_by_zipcode_or_airport_id/" ,
						dataType: "json",
						async:false,
						data:{
						term:term 
						},
						success: function (data)
						{
							myArray[b].pickup_street = data[0].value;
							myArray[b].pickup_airport = data[0].value;
							myArray[b].pickup_airport_state = data[0].st_state;
							myArray[b].pickup_airport_city = data[0].st_city;
							myArray[b].pickup_city    = data[0].st_city;
							myArray[b].pickup_state   = data[0].st_state;
							/*$("#pickup_airport").val(data[0].value);
							$("#pickup_airport_city").val(stripslashes(data[0].st_city));
							$("#pickup_airport_state").val(stripslashes(data[0].st_state));*/	
						},
					});
					
					myArray[b].pickup_zip         = '';
					myArray[b].pickup_country     = '';
					
					/*if(myArray[b].pickup_city == '')
					{	
						myArray[b].pickup_city = addslashes($("#dropoff_city").val());
						myArray[b].pickup_airport_city = addslashes($("#dropoff_city").val());
					}

					if(myArray[b].pickup_state == '')
					{	
						myArray[b].pickup_state = addslashes($("#dropoff_state").val());
						myArray[b].pickup_airport_state = addslashes($("#dropoff_state").val());
					}	
					
					myArray[b].pickup_zip     = $("#dropoff_zip").val();*/
					//myArray[b].pickup_country = addslashes($("#dropoff_country").val());
					
					} else if(myArray[b].route_type_id == '2') {
					
					myArray[b].o_pickup_street = addslashes($("#dropoff_street").val());
					myArray[b].o_pickup_city = addslashes($("#dropoff_city").val());
					myArray[b].o_pickup_state = addslashes($("#dropoff_state").val());
					myArray[b].o_pickup_zip = addslashes($("#dropoff_zip").val());
					myArray[b].o_pickup_country = addslashes($("#dropoff_country").val());
					
				}
				k = parseInt(k) + parseInt(1);
				legsArray[k] = myArray[b];
			  }		
			}
			
		}
		else
		{
			/*if(q>8)	
			 {
				 alert("Maximum 9 Legs are allowed.");
				 return false;
			 }
			*/
			q++;
			/*if(tr_cnt != '')
			{
				q 	= tr_cnt;
			}*/
			var index = q;
			c = -1;
			var sort_order = index;
			
			var sort_order = index;
			//console.log(myArray);
			//alert(q-2);
			
			//if(myArray[q-2])
			//{
			//	if(typeof myArray[q-2].in_sort_order === 'undefined')
				if(myArray.length == 0)	
				{
					//alert('sort_order ' + myArray[q-2].in_sort_order);
					sort_order = 1;				
				}else{
					  var get_sort_order = $.map( myArray, function( value, index ) {
											return value.in_sort_order;
								});
					  
					  	if(get_sort_order.length > 0)
								{	
									var max_order_value	 = 	Math.max.apply(Math,get_sort_order);
								} else {
									var max_order_value	 = 	0;		
								}
					 sort_order = parseInt(max_order_value) + parseInt(1);			
					//sort_order = parseInt(myArray[q-2].in_sort_order) + parseInt(1);
				}					
		//	}
			var order_id = sort_order;
			//alert(sort_order);
			
			   myArray.push({"pickup_street":addslashes($("#pickup_street").val()),"pickup_city":addslashes($("#pickup_city").val()),"pickup_state":addslashes($("#pickup_state").val()),"pickup_zip":addslashes($("#pickup_zip").val()),"pickup_country":addslashes($("#pickup_country").val()),"clockface_2_modal":$("#clockface_2_modal").val(),"pickup_zone":$("#pickup_zone").val(),"dropoff_street":addslashes($("#dropoff_street").val()),"dropoff_city":addslashes($("#dropoff_city").val()),"dropoff_state":addslashes($("#dropoff_state").val()),"dropoff_zip":addslashes($("#dropoff_zip").val()),"dropoff_country":addslashes($("#dropoff_country").val()),"clockface_3_modal":$("#clockface_3_modal").val(),"dropoff_zone":$("#dropoff_zone").val(),"leg_id":$("#leg_id").val(),"route_type":$("#route_type").val(),"route_type_id":$("#route_type_id").val(),"pickup_airport":addslashes($("#pickup_airport").val()),"pickup_airport_clock":$("#pickup_airport_clock").val(),"pickup_airport_zone":$("#pickup_airport_zone").val(),"dropoff_airport":addslashes($("#dropoff_airport").val()),"dropoff_airport_clock":$("#dropoff_airport_clock").val(),"dropoff_airport_zone":$("#dropoff_airport_zone").val(),"dropoff_airport_state":addslashes($("#dropoff_airport_state").val()),"dropoff_airport_city":addslashes($("#dropoff_airport_city").val()),"pickup_airport_state":addslashes($("#pickup_airport_state").val()),"pickup_airport_city":addslashes($("#pickup_airport_city").val()),"update_leg":"update","meeting_location":addslashes($("#meeting_location").val()),"no_of_drivers":$("#no_of_drivers").val(),"multiple_drivers":addslashes($("#multiple_drivers_txt").val()),"in_sort_order":sort_order});
			   legsArray[0] = ({"pickup_street":addslashes($("#pickup_street").val()),"pickup_city":addslashes($("#pickup_city").val()),"pickup_state":addslashes($("#pickup_state").val()),"pickup_zip":addslashes($("#pickup_zip").val()),"pickup_country":addslashes($("#pickup_country").val()),"clockface_2_modal":$("#clockface_2_modal").val(),"pickup_zone":$("#pickup_zone").val(),"dropoff_street":addslashes($("#dropoff_street").val()),"dropoff_city":addslashes($("#dropoff_city").val()),"dropoff_state":addslashes($("#dropoff_state").val()),"dropoff_zip":addslashes($("#dropoff_zip").val()),"dropoff_country":addslashes($("#dropoff_country").val()),"clockface_3_modal":$("#clockface_3_modal").val(),"dropoff_zone":$("#dropoff_zone").val(),"leg_id":$("#leg_id").val(),"route_type":$("#route_type").val(),"route_type_id":$("#route_type_id").val(),"pickup_airport":addslashes($("#pickup_airport").val()),"pickup_airport_clock":$("#pickup_airport_clock").val(),"pickup_airport_zone":$("#pickup_airport_zone").val(),"dropoff_airport":addslashes($("#dropoff_airport").val()),"dropoff_airport_clock":$("#dropoff_airport_clock").val(),"dropoff_airport_zone":$("#dropoff_airport_zone").val(),"dropoff_airport_state":addslashes($("#dropoff_airport_state").val()),"dropoff_airport_city":addslashes($("#dropoff_airport_city").val()),"pickup_airport_state":addslashes($("#pickup_airport_state").val()),"pickup_airport_city":addslashes($("#pickup_airport_city").val()),"update_leg":"update","meeting_location":addslashes($("#meeting_location").val()),"no_of_drivers":$("#no_of_drivers").val(),"multiple_drivers":addslashes($("#multiple_drivers_txt").val()),"in_sort_order":sort_order});
		}
		//console.log(myArray);
		var meeting_location1 = '';
		if(meeting_location.length > 10)
		{
		  meeting_location1 = meeting_location.substring(0,9);
		  meeting_location1 = meeting_location1+'...';
		}
		//alert(meeting_location1);
		if(meeting_location1 == '' || meeting_location1.length == 0)
		{
			meeting_location1 = meeting_location;
		}
		
		if(no_of_drivers >= 2)
		{
		var multi_driver_icon = '<span class=\"leg-fa-users\"><i class=\"fa fa-users\"></i></span>';
		}else{
		var multi_driver_icon = '';
		}
		
		//var row  = "<tr id=\"tr_"+index+"\">";
			//row += "<td>"+index+"."+multi_driver_icon+"</td>";
		var row  = "<tr id=\"tr_"+order_id+"\" data-sort-order="+index+">";
			row += "<td class=\"priority\"><span class=\"glyphicon glyphicon-move\"></span> "+order_id+"."+multi_driver_icon+"</td>";
			row += "<td>"+pickup_address+"</td>";
			row += "<td>"+dropoff_address+"</td>";
			row += "<td>"+start_time+"</td>";
			row += "<td>"+end_time+"</td>";
			//row += "<td>"+meeting_location+"</td>";
			//row += "<td>"+meeting_location1+"<a class=\"eyeicon\" data-original-title=\""+meeting_location+"\" data-toggle=\"tooltip\" href=\"javascript:void(0);\"><i class=\"fa fa-eye\"></i></a></td>";
			if(meeting_location !=  '')
			{
			row += "<td class=\"meet-location\">"+meeting_location1+"<a class=\"eyeicon\" data-original-title=\""+meeting_location+"\" data-toggle=\"tooltip\" href=\"javascript:void(0);\"><i class=\"fa fa-eye\"></i></a></td>";
			}else
			{
			row += "<td></td>";	
			}
			row += "<td><a class=\"edit_legs\" href=\"javascript:void(0);\" title=\"Edit\" onClick=\"edit_leges('"+index+"',$(this));\"><i class=\"fa fa-edit\"></i> Edit</a><a  class=\"delete-leg\" href=\"javascript:void(0);\" title=\"Delete\" onClick=\"delete_leges('"+index+"',$(this));\" style='color:#000'><i class=\"fa fa-trash-o delete-icon\"></i></a></td>";
			row += "</tr>";
			if(c.length >0)
			{
				for(var j=0;j<c.length;j++ )
				{
					b=c[j];	
					var new_pickup_address  = (myArray[b].pickup_street?myArray[b].pickup_street+", ":"");
					var trid = $('tr[data-leg-id="'+myArray[b].leg_id+'"]').attr('id');
					new_pickup_address += (myArray[b].pickup_city?myArray[b].pickup_city+", ":"");
					new_pickup_address += (myArray[b].pickup_state?myArray[b].pickup_state:"");
					new_pickup_address += (myArray[b].pickup_zip?", "+myArray[b].pickup_zip:"");
					if(myArray[b].route_type_id == '0')
					{	
						$('#'+trid+' td:eq(1)').html(new_pickup_address);
					} else 	if(myArray[b].route_type_id == '1')
					{
						$('#'+trid+' td:eq(1)').html('Zip Code/Airport Id:');
						$('#'+trid+' td:eq(1)').append(new_pickup_address);
					} else if(myArray[b].route_type_id == '2')
					{
						var o_pickup_address  = (myArray[b].o_pickup_street?myArray[b].o_pickup_street+", ":"");
						o_pickup_address += (myArray[b].o_pickup_city?myArray[b].o_pickup_city+", ":"");
						o_pickup_address += (myArray[b].o_pickup_state?myArray[b].o_pickup_state:"");
						o_pickup_address += (myArray[b].o_pickup_zip?", "+myArray[b].o_pickup_zip:"");
					var overnight_comments = myArray[b].overnight_comments;
					var overnight_address = "<strong>Overnight Leg: </strong>"+o_pickup_address+"<p>"+overnight_comments+"</p>";
					$('#'+trid+' td:eq(1)').html(overnight_address);
				}
			  }							
		    }
			if(flag=='')
			{
				//$('#leg_details_p').show();
				//$('#leg_details_div').show();
				//$('#leg_table tr:last').after(row);
				if(myArray[index-1].in_sort_order == 1)
				{
				$('#leg_table > tbody:first').append(row);  
				}
				else{
				$('#leg_table tr:last').after(row);				
				}
				//$('#leg_table tr:last').hide();
				//$('#leg_table tr:last').fadeIn('slow'); 
			}
			else
			{
				//alert(edit_q);
				//if(edit_q==1)
				if(myArray[i].in_sort_order==1)
				{
					//$('#leg_table  tr:nth-child('+edit_q+')').after(row);
					if(myArray[i].in_sort_order==1 && flag!='')
					{
						//console.log($('#leg_table > tbody tr').attr("id"));
						//alert($('#leg_table > tbody tr').attr("id"));
						if($('#leg_table > tbody tr').attr("id"))
						{
							var tr_id = $('#leg_table > tbody tr').attr("id");
							$('#'+tr_id).before(row);
						}
						else
						{
							$('#leg_table > tbody:first').append(row);  
						}
					}
					else
					{
						$('#leg_table  tr:nth-child('+myArray[i].in_sort_order+')').after(row);
					}
				}
				else
				{ 
					//alert(flag);
					//$('#tr_'+i).after(row);
					//$('#'+flag).after(row);
					/* if($('#'+flag).length)
					{
						$('#'+flag).after(row);						
					}else{
						$('#tr_'+(parseInt(edit_q)+parseInt(1))).before(row);						
					} */
					$('#tr_'+(parseInt(tr_cnt)-(parseInt(1)))).after(row);
				}

			}
			flag 	= '';
			edit_q 	= '';
			add_flg	= '';
			//console.log(myArray);
			//return false;
			renumber_table('#leg_table_body');
			legsArray = JSON.stringify(legsArray);
			$('#save_draft,#save_legs').fadeIn('slow');
			
	        	jQuery.post("<?php echo base_url(); ?>org_transportation/create_legs/<?php echo $transport_details['in_transportation_id'];?>/",{legsArray:legsArray,action:"save_legs"}, function( data ) {
		
				
				if(data !== 'update')
				{	
				
				
					var trid = $('tr[data-sort-order="'+index+'"]').attr('id');
					$('#'+trid).attr('data-leg-id',data);
					myArray[index-1].leg_id = data;
					//console.log(myArray[index-1]);	
				} else {
					var trid = editedTrid;	
					$('#'+trid).attr('data-leg-id',leg_id);
				}	
				
			});	
			renumber_table('#leg_table_body');
			jQuery.post("<?php echo base_url(); ?>org_transportation/get_distance_remain/<?php echo $transport_details['in_transportation_id'];?>/",{data_val:myArray,action:"save_legs"}, function( data ) {
				//alert(data);
				//return false;
				var e = eval('(' + data + ')');
				jQuery("#distance_remain").html("Distance Remaining: "+e.distance_remain+" miles");				
			});
			 
			document.getElementById("addlegs").reset();			
			$("#aviation_display,#address_display,#overnight_display").hide();
			$("#clockface_2_modal,#pickup_airport_clock,#leg_id").val('');
			//console.log(myArray);				
		return true;
	}
});	

$('#airport_submit').live('click',function(){	
		
		if(edit_q!='')
		{	
			edit_sort_order = myArray[edit_q-1].in_sort_order;
			delete myArray[edit_q-1];	
		}
	  //$("#addlegs").valid();
	  
	  var to_date = $('#dropoff_airport_clock').val();
	  var from_date = $('#pickup_airport_clock').val();
	 
	  var b;
	  var to_date_split = to_date.split('-');
	  var from_date_split = from_date.split('-');
	  
	  var start_time_date = new Date(from_date_split[0]);
	  var end_time_date = new Date(to_date_split[0]);
	  
	  var end_date = new Date(end_time_date.getFullYear(), end_time_date.getMonth(), end_time_date.getDate()); 
	  var start_date = new Date(start_time_date.getFullYear(), start_time_date.getMonth(), start_time_date.getDate()); 
	  
	  if (start_date > end_date) {
			alert("Start Date is greather than End Date.");
			return false;
	  } 
	  if (end_date < start_date) {
			alert("End Date is less than Start Date.");
			return false;
	  }
	  
	  if($('#addlegs').valid() == false) {
		return false;
	} else {
		
		var pickup_address = ($("#pickup_airport").val()?"Zip Code/Airport Id: "+$("#pickup_airport").val():"");
		var	pickaddress = ($("#pickup_airport_city").val()?", "+$("#pickup_airport_city").val():"");
			pickaddress += ($("#pickup_airport_state").val()?", "+$("#pickup_airport_state").val():"");
			if(pickaddress!='')
			{
				pickup_address += pickaddress;
			}
			//dropoff_airport_city,dropoff_airport_state
		var dropoff_address = ($("#dropoff_airport").val()?"Zip Code/Airport Id: "+$("#dropoff_airport").val():"");
		var	dropoffaddress = ($("#dropoff_airport_city").val()?", "+$("#dropoff_airport_city").val():"");
			dropoffaddress += ($("#dropoff_airport_state").val()?", "+$("#dropoff_airport_state").val():"");
		if(dropoffaddress!='')
			{
				dropoff_address += dropoffaddress;
			}	
				
		var start_time 		 = $("#pickup_airport_clock").val();	
			start_time 		+= " - "+$("#pickup_airport_zone").val();	
		var end_time 		 = $("#dropoff_airport_clock").val();	
			end_time 		+= " - "+$("#dropoff_airport_zone").val();
	
		var leg_id 			= $("#leg_id").val();	
		var update_leg 		= "update";		
		
		var pilot_meeting_location = $("#pilot_meeting_location").val();
		
		var no_of_pilots = $("#no_of_pilots").val();
		legsArray = [];
		
		if(edit_q!='')
		{
			var i 		= edit_q-1;
			var c=[];
			/*
			if(tr_cnt != '')
			{
				edit_q 	= tr_cnt;
			}*/
			var index 	= edit_q;	
			
			var sort_order = index;
			//console.log(myArray);
			//alert(q-2);
			/*if(myArray[i-1])
			{
				if(typeof myArray[i-1].in_sort_order === 'undefined')
				{
					//alert('sort_order ' + myArray[i-1].in_sort_order);
					sort_order = 1;				
				}else{
					sort_order = parseInt(myArray[i-1].in_sort_order) + parseInt(1);
					}
			}*/
	  	
			myArray[i]=({"pickup_street":addslashes($("#pickup_street").val()),"pickup_city":addslashes($("#pickup_city").val()),"pickup_state":addslashes($("#pickup_state").val()),"pickup_zip":addslashes($("#pickup_zip").val()),"pickup_country":addslashes($("#pickup_country").val()),"clockface_2_modal":$("#clockface_2_modal").val(),"pickup_zone":$("#pickup_zone").val(),"dropoff_street":addslashes($("#dropoff_street").val()),"dropoff_city":addslashes($("#dropoff_city").val()),"dropoff_state":addslashes($("#dropoff_state").val()),"dropoff_zip":addslashes($("#dropoff_zip").val()),"dropoff_country":addslashes($("#dropoff_country").val()),"clockface_3_modal":$("#clockface_3_modal").val(),"dropoff_zone":$("#dropoff_zone").val(),"leg_id":$("#leg_id").val(),"route_type":$("#route_type").val(),"route_type_id":$("#route_type_id").val(),"pickup_airport":addslashes($("#pickup_airport").val()),"pickup_airport_clock":$("#pickup_airport_clock").val(),"pickup_airport_zone":$("#pickup_airport_zone").val(),"dropoff_airport":addslashes($("#dropoff_airport").val()),"dropoff_airport_clock":$("#dropoff_airport_clock").val(),"dropoff_airport_zone":$("#dropoff_airport_zone").val(),"dropoff_airport_state":addslashes($("#dropoff_airport_state").val()),"dropoff_airport_city":addslashes($("#dropoff_airport_city").val()),"pickup_airport_state":addslashes($("#pickup_airport_state").val()),"pickup_airport_city":addslashes($("#pickup_airport_city").val()),"update_leg":"update","pilot_meeting_location":addslashes($("#pilot_meeting_location").val()),"no_of_pilots":addslashes($("#no_of_pilots").val()),"multiple_pilots":addslashes($("#multiple_pilots_txt").val()),"in_sort_order":edit_sort_order});
			legsArray[0] = ({"pickup_street":addslashes($("#pickup_street").val()),"pickup_city":addslashes($("#pickup_city").val()),"pickup_state":addslashes($("#pickup_state").val()),"pickup_zip":addslashes($("#pickup_zip").val()),"pickup_country":addslashes($("#pickup_country").val()),"clockface_2_modal":$("#clockface_2_modal").val(),"pickup_zone":$("#pickup_zone").val(),"dropoff_street":addslashes($("#dropoff_street").val()),"dropoff_city":addslashes($("#dropoff_city").val()),"dropoff_state":addslashes($("#dropoff_state").val()),"dropoff_zip":addslashes($("#dropoff_zip").val()),"dropoff_country":addslashes($("#dropoff_country").val()),"clockface_3_modal":$("#clockface_3_modal").val(),"dropoff_zone":$("#dropoff_zone").val(),"leg_id":$("#leg_id").val(),"route_type":$("#route_type").val(),"route_type_id":$("#route_type_id").val(),"pickup_airport":addslashes($("#pickup_airport").val()),"pickup_airport_clock":$("#pickup_airport_clock").val(),"pickup_airport_zone":$("#pickup_airport_zone").val(),"dropoff_airport":addslashes($("#dropoff_airport").val()),"dropoff_airport_clock":$("#dropoff_airport_clock").val(),"dropoff_airport_zone":$("#dropoff_airport_zone").val(),"dropoff_airport_state":addslashes($("#dropoff_airport_state").val()),"dropoff_airport_city":addslashes($("#dropoff_airport_city").val()),"pickup_airport_state":addslashes($("#pickup_airport_state").val()),"pickup_airport_city":addslashes($("#pickup_airport_city").val()),"update_leg":"update","pilot_meeting_location":addslashes($("#pilot_meeting_location").val()),"no_of_pilots":addslashes($("#no_of_pilots").val()),"multiple_pilots":addslashes($("#multiple_pilots_txt").val()),"in_sort_order":edit_sort_order});
			
			var sort_order_max = parseInt(edit_sort_order) + parseInt(1);
			var order_id = edit_sort_order; 	
			if(sort_order_max > 0)
			{	
				var counter= 0;	
				var count_loop=1;
				do {
					var inc_counter='0';	
					for(var k=0; k<myArray.length;++k)
					{
						inc_counter++;
						if(i != k)
						{	
							var value = myArray[k];
							if(myArray[k].update_leg !='delete')
							{
								if(sort_order_max == value.in_sort_order && value.route_type_id == '2' )
								{		
									sort_order_max = parseInt(sort_order_max) + parseInt(1);
									c[counter] = k;
									counter++;
									count_loop=1;
									break;
								//return indexvalue;
								} else if(sort_order_max == value.in_sort_order && value.route_type_id != '2' )
								{	
									c[counter] = k;
									counter++;
									count_loop=0;
									break;
								} else {
										next_counter_value = $.map(myArray, function( value, index ) {
														    if(index != i)
															{	
															   if(sort_order_max == value.in_sort_order && value.update_leg !='delete')
														    	return index;
															}	
														});
									 if(next_counter_value.length >0)
									 {
										 count_loop=1;
									 } else {
										 count_loop=0;
										 break;
									 }
								}
							}
						} else if(inc_counter == myArray.length ){
							count_loop=0;
						} 		
					}
				} while(count_loop!=0)		
				if(c.length >0)
				{		
					//b =	b[0];
				}	
				else 
				c = -1;
			} else {
				c = -1;				
			}
			
			if(c.length >0)
			{
				var k=0;
				for(var j=0;j<c.length;j++ )
				{
					b=c[j];
					if(myArray[b].route_type_id == '0')
					{
						var loc = $("#dropoff_airport").val();
						$.ajax({
							url: "<?php echo base_url(); ?>org_transportation/get_loc_details/" ,
							type: "POST",
							//dataType: "json",
							async:false,
							data:{
							loc:loc 
							},
							success: function (data)
							{
								if(data!='fail')
								{	
									var loc_details = JSON.parse(data);
									myArray[b].pickup_city = loc_details.city;
									myArray[b].pickup_state =loc_details.state;
									myArray[b].pickup_zip = loc_details.postal_code;
									myArray[b].pickup_country = loc_details.country;	
								}
							},
						});
					} else if(myArray[b].route_type_id == '1')
					{
						myArray[b].pickup_street = addslashes($("#dropoff_airport").val());
						myArray[b].pickup_city = addslashes($("#dropoff_airport_city").val());
						myArray[b].pickup_airport_city = addslashes($("#dropoff_airport_city").val());
						myArray[b].pickup_state = addslashes($("#dropoff_airport_state").val());
						myArray[b].pickup_airport_state = addslashes($("#dropoff_airport_state").val());
						myArray[b].pickup_airport = addslashes($("#dropoff_airport").val());
						myArray[b].pickup_zip     = '';
						myArray[b].pickup_country = '';
					
					} else if(myArray[b].route_type_id == '2') {
						var loc = $("#dropoff_airport").val();
						$.ajax({
							url: "<?php echo base_url(); ?>org_transportation/get_loc_details/" ,
							type: "POST",
							//dataType: "json",
							async:false,
							data:{
							loc:loc 
							},
							success: function (data)
							{
								if(data!='fail')
								{	
									var loc_details = JSON.parse(data);
									myArray[b].o_pickup_city = loc_details.city;
									myArray[b].o_pickup_state = loc_details.state;
									myArray[b].o_pickup_zip = loc_details.postal_code;
									myArray[b].o_pickup_country = loc_details.country;							
								}
							},
						});
					}
					k = parseInt(k) + parseInt(1);
					legsArray[k] = myArray[b];
				}		
			}	
			//console.log(myArray);	
		}
		else
		{
			/*if(q>8)	
			 {
				 alert("Maximum 9 Legs are allowed.");
				 return false;
			 }*/
			q++;
			c=-1;
			/*if(tr_cnt != '')
			{
				q 	= tr_cnt;
			}*/
			var index = q;
			var i = index;
			var sort_order = index;
			//console.log(myArray);
			//alert(q-2);
		//	if(myArray[q-2])
		//	{
		//		if(typeof myArray[q-2].in_sort_order === 'undefined')
				if(myArray.length == 0 )
				{
					//alert('sort_order ' + myArray[q-2].in_sort_order);
					sort_order = 1;				
				}else{
					var get_sort_order = $.map( myArray, function( value, index ) {
											return value.in_sort_order;
								});
								if(get_sort_order.length > 0)
								{	
									var max_order_value	 = 	Math.max.apply(Math,get_sort_order);
									
								} else {
											var max_order_value = 0;
								}
							sort_order   = parseInt(max_order_value) + parseInt(1);
						//	sort_order = parseInt(myArray[q-2].in_sort_order) + parseInt(1);
		//	var legsArray = ({"pickup_street":addslashes($("#pickup_street").val()),"pickup_city":addslashes($("#pickup_city").val()),"pickup_state":addslashes($("#pickup_state").val()),"pickup_zip":addslashes($("#pickup_zip").val()),"pickup_country":addslashes($("#pickup_country").val()),"clockface_2_modal":$("#clockface_2_modal").val(),"pickup_zone":$("#pickup_zone").val(),"dropoff_street":addslashes($("#dropoff_street").val()),"dropoff_city":addslashes($("#dropoff_city").val()),"dropoff_state":addslashes($("#dropoff_state").val()),"dropoff_zip":addslashes($("#dropoff_zip").val()),"dropoff_country":addslashes($("#dropoff_country").val()),"clockface_3_modal":$("#clockface_3_modal").val(),"dropoff_zone":$("#dropoff_zone").val(),"leg_id":$("#leg_id").val(),"route_type":$("#route_type").val(),"route_type_id":$("#route_type_id").val(),"pickup_airport":addslashes($("#pickup_airport").val()),"pickup_airport_clock":$("#pickup_airport_clock").val(),"pickup_airport_zone":$("#pickup_airport_zone").val(),"dropoff_airport":addslashes($("#dropoff_airport").val()),"dropoff_airport_clock":$("#dropoff_airport_clock").val(),"dropoff_airport_zone":$("#dropoff_airport_zone").val(),"dropoff_airport_state":addslashes($("#dropoff_airport_state").val()),"dropoff_airport_city":addslashes($("#dropoff_airport_city").val()),"pickup_airport_state":addslashes($("#pickup_airport_state").val()),"pickup_airport_city":addslashes($("#pickup_airport_city").val()),"update_leg":"update","pilot_meeting_location":addslashes($("#pilot_meeting_location").val()),"no_of_pilots":addslashes($("#no_of_pilots").val()),"multiple_pilots":addslashes($("#multiple_pilots_txt").val()),"in_sort_order":sort_order});
					}
		//	}
			var order_id = sort_order;				
			myArray.push({"pickup_street":addslashes($("#pickup_street").val()),"pickup_city":addslashes($("#pickup_city").val()),"pickup_state":addslashes($("#pickup_state").val()),"pickup_zip":addslashes($("#pickup_zip").val()),"pickup_country":addslashes($("#pickup_country").val()),"clockface_2_modal":$("#clockface_2_modal").val(),"pickup_zone":$("#pickup_zone").val(),"dropoff_street":addslashes($("#dropoff_street").val()),"dropoff_city":addslashes($("#dropoff_city").val()),"dropoff_state":addslashes($("#dropoff_state").val()),"dropoff_zip":addslashes($("#dropoff_zip").val()),"dropoff_country":addslashes($("#dropoff_country").val()),"clockface_3_modal":$("#clockface_3_modal").val(),"dropoff_zone":$("#dropoff_zone").val(),"leg_id":$("#leg_id").val(),"route_type":$("#route_type").val(),"route_type_id":$("#route_type_id").val(),"pickup_airport":addslashes($("#pickup_airport").val()),"pickup_airport_clock":$("#pickup_airport_clock").val(),"pickup_airport_zone":$("#pickup_airport_zone").val(),"dropoff_airport":addslashes($("#dropoff_airport").val()),"dropoff_airport_clock":$("#dropoff_airport_clock").val(),"dropoff_airport_zone":$("#dropoff_airport_zone").val(),"dropoff_airport_state":addslashes($("#dropoff_airport_state").val()),"dropoff_airport_city":addslashes($("#dropoff_airport_city").val()),"pickup_airport_state":addslashes($("#pickup_airport_state").val()),"pickup_airport_city":addslashes($("#pickup_airport_city").val()),"update_leg":"update","pilot_meeting_location":addslashes($("#pilot_meeting_location").val()),"no_of_pilots":addslashes($("#no_of_pilots").val()),"multiple_pilots":addslashes($("#multiple_pilots_txt").val()),"in_sort_order":sort_order});
			legsArray[0] = ({"pickup_street":addslashes($("#pickup_street").val()),"pickup_city":addslashes($("#pickup_city").val()),"pickup_state":addslashes($("#pickup_state").val()),"pickup_zip":addslashes($("#pickup_zip").val()),"pickup_country":addslashes($("#pickup_country").val()),"clockface_2_modal":$("#clockface_2_modal").val(),"pickup_zone":$("#pickup_zone").val(),"dropoff_street":addslashes($("#dropoff_street").val()),"dropoff_city":addslashes($("#dropoff_city").val()),"dropoff_state":addslashes($("#dropoff_state").val()),"dropoff_zip":addslashes($("#dropoff_zip").val()),"dropoff_country":addslashes($("#dropoff_country").val()),"clockface_3_modal":$("#clockface_3_modal").val(),"dropoff_zone":$("#dropoff_zone").val(),"leg_id":$("#leg_id").val(),"route_type":$("#route_type").val(),"route_type_id":$("#route_type_id").val(),"pickup_airport":addslashes($("#pickup_airport").val()),"pickup_airport_clock":$("#pickup_airport_clock").val(),"pickup_airport_zone":$("#pickup_airport_zone").val(),"dropoff_airport":addslashes($("#dropoff_airport").val()),"dropoff_airport_clock":$("#dropoff_airport_clock").val(),"dropoff_airport_zone":$("#dropoff_airport_zone").val(),"dropoff_airport_state":addslashes($("#dropoff_airport_state").val()),"dropoff_airport_city":addslashes($("#dropoff_airport_city").val()),"pickup_airport_state":addslashes($("#pickup_airport_state").val()),"pickup_airport_city":addslashes($("#pickup_airport_city").val()),"update_leg":"update","pilot_meeting_location":addslashes($("#pilot_meeting_location").val()),"no_of_pilots":addslashes($("#no_of_pilots").val()),"multiple_pilots":addslashes($("#multiple_pilots_txt").val()),"in_sort_order":sort_order});
		}
		//console.log(myArray);
		var pilot_meeting_location1 = '';
		if(pilot_meeting_location.length > 10)
		{
		  pilot_meeting_location1 = pilot_meeting_location.substring(0,9);
		  pilot_meeting_location1 = pilot_meeting_location1+'...';
		}
		//alert(meeting_location1);
		if(pilot_meeting_location1 == '' || pilot_meeting_location1.length == 0)
		{
			pilot_meeting_location1 = pilot_meeting_location;
		}
		
		if(no_of_pilots >= 2)
		{
		var multi_pilot_icon = '<span class=\"leg-fa-users\"><i class=\"fa fa-users\"></i></span>';
		}else{
		var multi_pilot_icon = '';
		}
		
		//var row  = "<tr id=\"tr_"+index+"\">";
			//row += "<td>"+index+"."+multi_pilot_icon+"</td>";
			var row  = "<tr id=\"tr_"+order_id+"\" data-sort-order="+index+">";
			row += "<td class=\"priority\"><span class=\"glyphicon glyphicon-move\"></span> "+order_id+"."+multi_pilot_icon+"</td>";
			row += "<td>"+pickup_address+"</td>";
			row += "<td>"+dropoff_address+"</td>";
			row += "<td>"+start_time+"</td>";
			row += "<td>"+end_time+"</td>";
			//row += "<td>"+pilot_meeting_location+"</td>";
			//row += "<td>"+pilot_meeting_location1+"<a class=\"eyeicon\" data-original-title=\""+pilot_meeting_location+"\" data-toggle=\"tooltip\" href=\"javascript:void(0);\"><i class=\"fa fa-eye\"></i></a></td>";
			if(pilot_meeting_location !=  '')
			{
			row += "<td class=\"meet-location\">"+pilot_meeting_location1+"<a class=\"eyeicon\" data-original-title=\""+pilot_meeting_location+"\" data-toggle=\"tooltip\" href=\"javascript:void(0);\"><i class=\"fa fa-eye\"></i></a></td>";
			}else
			{
			row += "<td></td>";	
			}
			row += "<td><a class=\"edit_legs\" href=\"javascript:void(0);\" title=\"Edit\" onClick=\"edit_leges('"+index+"',$(this));\"><i class=\"fa fa-edit\"></i> Edit</a><a  class=\"delete-leg\" href=\"javascript:void(0);\" title=\"Delete\" onClick=\"delete_leges('"+index+"',$(this));\" style='color:#000'><i class=\"fa fa-trash-o delete-icon\"></i></a></td>";
			row += "</tr>";
			if(c.length >0)
			{
				for(var j=0;j<c.length;j++ )
				{
					b=c[j];	
					var new_pickup_address  = (myArray[b].pickup_street?myArray[b].pickup_street+", ":"");
					var trid = $('tr[data-leg-id="'+myArray[b].leg_id+'"]').attr('id');
					new_pickup_address += (myArray[b].pickup_city?myArray[b].pickup_city+", ":"");
					new_pickup_address += (myArray[b].pickup_state?myArray[b].pickup_state:"");
					new_pickup_address += (myArray[b].pickup_zip?", "+myArray[b].pickup_zip:"");
					if(myArray[b].route_type_id == '0')
					{	
						$('#'+trid+' td:eq(1)').html(new_pickup_address);
					} else 	if(myArray[b].route_type_id == '1')
					{
						$('#'+trid+' td:eq(1)').html('Zip Code/Airport Id:');
						$('#'+trid+' td:eq(1)').append(new_pickup_address);
					} else if(myArray[b].route_type_id == '2')
					{
						var o_pickup_address  = (myArray[b].o_pickup_street?myArray[b].o_pickup_street+", ":"");
						o_pickup_address += (myArray[b].o_pickup_city?myArray[b].o_pickup_city+", ":"");
					    o_pickup_address += (myArray[b].o_pickup_state?myArray[b].o_pickup_state:"");
						o_pickup_address += (myArray[b].o_pickup_zip?", "+myArray[b].o_pickup_zip:"");
						var overnight_comments = myArray[b].overnight_comments;
						var overnight_address = "<strong>Overnight Leg: </strong>"+o_pickup_address+"<p>"+overnight_comments+"</p>";
						$('#'+trid+' td:eq(1)').html(overnight_address);
					}
				}			
			}
			if(flag=='')
			{
				//$('#leg_table tr:last').after(row);
				if(myArray[index-1].in_sort_order == 1)
				{
				$('#leg_table > tbody:first').append(row);  
				}
				else{
				$('#leg_table tr:last').after(row);				
				}
			}
			else
			{
				//alert(edit_q);
				/*if(edit_q==1)
				{
					$('#leg_table  tr:nth-child('+edit_q+')').after(row);
				}
				else
				{
					$('#'+flag).after(row);
				}*/
				
				if(myArray[i].in_sort_order==1)
				{
					//$('#leg_table  tr:nth-child('+edit_q+')').after(row);
					if(myArray[i].in_sort_order=='1' && flag!='')
					{
						//console.log($('#leg_table > tbody tr').attr("id"));
						//alert($('#leg_table > tbody tr').attr("id"));
						if($('#leg_table > tbody tr').attr("id"))
						{
							var tr_id = $('#leg_table > tbody tr').attr("id");
							$('#'+tr_id).before(row);
							//$('#leg_table > tbody tr').before(row);
							//$('#leg_table  tr:nth-child('+edit_q+')').after(row);
						}
						else
						{
							$('#leg_table > tbody:first').append(row);  
						}
						 //
						//$('#leg_table > tbody').insertAfter(closest( "#leg_table > tbody" ).after(row));
					}
					else
					{
						$('#leg_table  tr:nth-child('+myArray[i].in_sort_order+')').after(row);
					}
				}
				else
				{ 
					//alert(flag);
					//$('#tr_'+i).after(row);
					//$('#'+flag).after(row);
					/* if($('#'+flag).length)
					{
						$('#'+flag).after(row);						
					}else{
						$('#tr_'+(parseInt(edit_q)+parseInt(1))).before(row);						
					} */
					$('#tr_'+(parseInt(tr_cnt)-(parseInt(1)))).after(row);
				}				
			}
			flag 	= '';
			edit_q 	= '';
			add_flg	= '';
			//console.log(myArray);
			
			renumber_table('#leg_table_body');
			
			$('#save_draft,#save_legs').fadeIn('slow');
			
			legsArray = JSON.stringify(legsArray);
			 jQuery.post("<?php echo base_url(); ?>org_transportation/create_legs/<?php echo $transport_details['in_transportation_id'];?>/",{legsArray:legsArray}, function( data ) {
				//alert(data);
				//return false;
				if(data !== 'update')
				{
					var trid = $('tr[data-sort-order="'+index+'"]').attr('id');
					$('#'+trid).attr('data-leg-id',data);
					myArray[index-1].leg_id = data;
					//console.log(myArray[index-1]);	
				} else {
						var trid = editedTrid;
						$('#'+trid).attr('data-leg-id',leg_id);
				} 				
			});
			renumber_table('#leg_table_body');
			jQuery.post("<?php echo base_url(); ?>org_transportation/get_distance_remain/<?php echo $transport_details['in_transportation_id'];?>/",{data_val:myArray,action:"save_legs"}, function( data ) {
				var e = eval('(' + data + ')');
				jQuery("#distance_remain").html("Distance Remaining: "+e.distance_remain+" miles");
				//myArray.push({"dropoff_airport_zip":e.finish_postal_code,"pickup_airport_zip":e.start_postal_code});
			});
			 
			//$('#addlegs')[0].reset();
			document.getElementById("addlegs").reset();
			$("#address_display").hide();
			$("#aviation_display").hide();
			<?php /*?>$("#add_leg_a").show();<?php */?>
			$("#clockface_2_modal").val('');
			$("#pickup_airport_clock").val('');
			$("#leg_id").val('');
			
		return true;
	}
});	

$('#overnight_submit').live('click',function(){	

		if(edit_q!='')
		{	
			edit_sort_order = myArray[edit_q-1].in_sort_order;
			delete myArray[edit_q-1];	
		}
		
	  //$("#addlegs").valid();
	  
	  if($('#addlegs').valid() == false) {
		return false;
	} else {
		
		var o_pickup_address  = ($("#o_pickup_street").val()?$("#o_pickup_street").val()+", ":"");
			o_pickup_address += ($("#o_pickup_city").val()?$("#o_pickup_city").val()+", ":"");
			o_pickup_address += ($("#o_pickup_state").val()?$("#o_pickup_state").val():"");
			o_pickup_address += ($("#o_pickup_zip").val()?", "+$("#o_pickup_zip").val():"");
			
		
		var leg_id 			= $("#leg_id").val();	
		var update_leg 		= "update";		
		var b;
		legsArray = [];
		var overnight_comments = $("#overnight_comments").val();
		
		if(edit_q!='')
		{
			var i 		= edit_q-1;
			/*if(tr_cnt != '')
			{
				edit_q 	= tr_cnt;
			}*/
			
			var index 	= edit_q;	
			
			var sort_order = index;
			//console.log(myArray);
			//alert(q-2);
			if(myArray[i-1])
			{
				if(typeof myArray[i-1].in_sort_order === 'undefined')
				{
					//alert('sort_order ' + myArray[i-1].in_sort_order);
					sort_order = 1;				
				}else{
					sort_order = parseInt(myArray[i-1].in_sort_order) + parseInt(1);
					}
			}
				var sort_order_max = parseInt(edit_sort_order) + parseInt(1);
				var order_id = edit_sort_order;
			if(sort_order_max > 0)
			{	
				 b = $.map(myArray, function( value, index ) {
											if(index != i)
											{	
												if(sort_order_max == value.in_sort_order && value.update_leg !='delete' )
													return index;
											}	
								});
				if(b.length >0)				
					b =	b[0];
				else 
					b = -1;
			} else {
				b = -1;
			}
			
			if(b!=-1)
			{
				if(myArray[b].route_type_id == '0')
				{
					myArray[b].pickup_street = addslashes($("#o_pickup_street").val());
					myArray[b].pickup_city = addslashes($("#o_pickup_city").val());
					myArray[b].pickup_state = addslashes($("#o_pickup_state").val());
					myArray[b].pickup_zip = addslashes($("#o_pickup_zip").val());
					myArray[b].pickup_country = addslashes($("#o_pickup_country").val());
				} else if(myArray[b].route_type_id == '1')
				{
						var term = $("#o_pickup_zip").val();
						$.ajax({
						url: "<?php echo base_url(); ?>org_transportation/get_airports_by_zipcode_or_airport_id/" ,
						dataType: "json",
						async:false,
						data:{
						term:term 
						},
						success: function (data)
						{
							myArray[b].pickup_street = data[0].value;
							myArray[b].pickup_airport = data[0].value;
							myArray[b].pickup_airport_state = data[0].st_state;
							myArray[b].pickup_airport_city = data[0].st_city;
							myArray[b].pickup_city    = data[0].st_city;
							myArray[b].pickup_state   = data[0].st_state;
							/*$("#pickup_airport").val(data[0].value);
							$("#pickup_airport_city").val(stripslashes(data[0].st_city));
							$("#pickup_airport_state").val(stripslashes(data[0].st_state));*/	
						},
					});
						myArray[b].pickup_zip         = '';
						myArray[b].pickup_country     = '';
					/*if(myArray[b].pickup_city == '')
					{	
						myArray[b].pickup_city = addslashes($("#o_pickup_city").val());
						myArray[b].pickup_airport_city = addslashes($("#o_pickup_city").val());
					}

					if(myArray[b].pickup_state == '')
					{	
						myArray[b].pickup_state = addslashes($("#o_pickup_state").val());
						myArray[b].pickup_airport_state = addslashes($("#o_pickup_state").val());
					}	
					
					myArray[b].pickup_zip     = addslashes($("#o_pickup_zip").val());
					myArray[b].pickup_country = addslashes($("#o_pickup_country").val());*/
					
				} /*else if(myArray[b].route_type_id == '2') {
					
					myArray[b].o_pickup_street  = addslashes($("#o_pickup_street").val());
					myArray[b].o_pickup_city    = addslashes($("#o_pickup_city").val());
					myArray[b].o_pickup_state   = addslashes($("#o_pickup_state").val());
					myArray[b].o_pickup_zip     = addslashes($("#o_pickup_zip").val());
					myArray[b].o_pickup_country = addslashes($("#o_pickup_country").val());
					
				}*/		
			}		
			myArray[i]=({"o_pickup_street":addslashes($("#o_pickup_street").val()),"o_pickup_city":addslashes($("#o_pickup_city").val()),"o_pickup_state":addslashes($("#o_pickup_state").val()),"o_pickup_zip":addslashes($("#o_pickup_zip").val()),"o_pickup_country":addslashes($("#o_pickup_country").val()),"update_leg":"update","overnight_comments":addslashes($("#overnight_comments").val()),"leg_id":$("#leg_id").val(),"route_type":$("#route_type").val(),"route_type_id":$("#route_type_id").val(),"in_sort_order":edit_sort_order});
			legsArray[0] = ({"o_pickup_street":addslashes($("#o_pickup_street").val()),"o_pickup_city":addslashes($("#o_pickup_city").val()),"o_pickup_state":addslashes($("#o_pickup_state").val()),"o_pickup_zip":addslashes($("#o_pickup_zip").val()),"o_pickup_country":addslashes($("#o_pickup_country").val()),"update_leg":"update","overnight_comments":addslashes($("#overnight_comments").val()),"leg_id":$("#leg_id").val(),"route_type":$("#route_type").val(),"route_type_id":$("#route_type_id").val(),"in_sort_order":edit_sort_order});
			legsArray[1] = myArray[b];
		}
		else
		{
			/*if(q>8)	
			 {
				 alert("Maximum 9 Legs are allowed.");
				 return false;
			 }
			*/
			q++;
			/*if(tr_cnt != '')
			{
				q 	= tr_cnt;
			}*/
			var index = q;	
			b=-1;
			var i = index;
			var sort_order = index;
			//console.log(myArray);
			//alert(q-2);
			/*if(myArray[q-2])
			{
				if(typeof myArray[q-2].in_sort_order === 'undefined')
				{
					//alert('sort_order ' + myArray[q-2].in_sort_order);
					sort_order = 1;				
				}else{
						var get_sort_order = $.map( myArray, function( value, index ) {
											return value.in_sort_order;
								});
							var max_order_value	 = 	Math.max.apply(Math,get_sort_order);
				sort_order = parseInt(max_order_value) + parseInt(1);	
			//	sort_order = parseInt(myArray[q-2].in_sort_order) + parseInt(1);
					}
			}*/
			
				if(myArray.length == 0 )	
				{
					sort_order = 1;				
				}else{
					var get_sort_order = $.map( myArray, function( value, index ) {
											return value.in_sort_order;
								});
								if(get_sort_order.length > 0)
								{	
									var max_order_value	 = 	Math.max.apply(Math,get_sort_order);
									
								} else {
											var max_order_value = 0;
								}	
							
							        sort_order   = parseInt(max_order_value) + parseInt(1);
						//	sort_order = parseInt(myArray[q-2].in_sort_order) + parseInt(1);
			//var legsArray = ({"pickup_street":addslashes($("#pickup_street").val()),"pickup_city":addslashes($("#pickup_city").val()),"pickup_state":addslashes($("#pickup_state").val()),"pickup_zip":addslashes($("#pickup_zip").val()),"pickup_country":addslashes($("#pickup_country").val()),"clockface_2_modal":$("#clockface_2_modal").val(),"pickup_zone":$("#pickup_zone").val(),"dropoff_street":addslashes($("#dropoff_street").val()),"dropoff_city":addslashes($("#dropoff_city").val()),"dropoff_state":addslashes($("#dropoff_state").val()),"dropoff_zip":addslashes($("#dropoff_zip").val()),"dropoff_country":addslashes($("#dropoff_country").val()),"clockface_3_modal":$("#clockface_3_modal").val(),"dropoff_zone":$("#dropoff_zone").val(),"leg_id":$("#leg_id").val(),"route_type":$("#route_type").val(),"route_type_id":$("#route_type_id").val(),"pickup_airport":addslashes($("#pickup_airport").val()),"pickup_airport_clock":$("#pickup_airport_clock").val(),"pickup_airport_zone":$("#pickup_airport_zone").val(),"dropoff_airport":addslashes($("#dropoff_airport").val()),"dropoff_airport_clock":$("#dropoff_airport_clock").val(),"dropoff_airport_zone":$("#dropoff_airport_zone").val(),"dropoff_airport_state":addslashes($("#dropoff_airport_state").val()),"dropoff_airport_city":addslashes($("#dropoff_airport_city").val()),"pickup_airport_state":addslashes($("#pickup_airport_state").val()),"pickup_airport_city":addslashes($("#pickup_airport_city").val()),"update_leg":"update","pilot_meeting_location":addslashes($("#pilot_meeting_location").val()),"no_of_pilots":addslashes($("#no_of_pilots").val()),"multiple_pilots":addslashes($("#multiple_pilots_txt").val()),"in_sort_order":sort_order});
			}
			var order_id = sort_order;		
			myArray.push({"o_pickup_street":addslashes($("#o_pickup_street").val()),"o_pickup_city":addslashes($("#o_pickup_city").val()),"o_pickup_state":addslashes($("#o_pickup_state").val()),"o_pickup_zip":addslashes($("#o_pickup_zip").val()),"o_pickup_country":addslashes($("#o_pickup_country").val()),"update_leg":"update","overnight_comments":addslashes($("#overnight_comments").val()),"leg_id":$("#leg_id").val(),"route_type":$("#route_type").val(),"route_type_id":$("#route_type_id").val(),"in_sort_order":sort_order});
			legsArray[0] = ({"o_pickup_street":addslashes($("#o_pickup_street").val()),"o_pickup_city":addslashes($("#o_pickup_city").val()),"o_pickup_state":addslashes($("#o_pickup_state").val()),"o_pickup_zip":addslashes($("#o_pickup_zip").val()),"o_pickup_country":addslashes($("#o_pickup_country").val()),"update_leg":"update","overnight_comments":addslashes($("#overnight_comments").val()),"leg_id":$("#leg_id").val(),"route_type":$("#route_type").val(),"route_type_id":$("#route_type_id").val(),"in_sort_order":sort_order});
		}
		//console.log(myArray);
		//var row  = "<tr id=\"tr_"+index+"\">";
			//row += "<td>"+index+".</td>";
			var row  = "<tr id=\"tr_"+order_id+"\" data-sort-order="+index+">";
			row += "<td class=\"priority\"><span class=\"glyphicon glyphicon-move\"></span> "+order_id+".</td>";
			
			row += "<td colspan='5'><strong>Overnight Leg: </strong>"+o_pickup_address+"<p>"+overnight_comments+"</p></td>";
			//row += "<td>"+dropoff_address+"</td>";
			//row += "<td>"+start_time+"</td>";
			//row += "<td>"+end_time+"</td>";
			row += "<td><a class=\"edit_legs\" href=\"javascript:void(0);\" title=\"Edit\" onClick=\"edit_leges('"+index+"',$(this));\"><i class=\"fa fa-edit\"></i>Edit</a><a  class=\"delete-leg\" href=\"javascript:void(0);\" title=\"Delete\" onClick=\"delete_leges('"+index+"',$(this));\" style='color:#000'><i class=\"fa fa-trash-o delete-icon\"></i></a></td>";
			
			row += "</tr>";
			
			if(b!=-1)
			{
				var new_pickup_address  = (myArray[b].pickup_street?myArray[b].pickup_street+", ":"");
				var trid = $('tr[data-leg-id="'+myArray[b].leg_id+'"]').attr('id');
				new_pickup_address += (myArray[b].pickup_city?myArray[b].pickup_city+", ":"");
				new_pickup_address += (myArray[b].pickup_state?myArray[b].pickup_state:"");
				new_pickup_address += (myArray[b].pickup_zip?", "+myArray[b].pickup_zip:"");
				if(myArray[b].route_type_id == '0')
				{	
					$('#'+trid+' td:eq(1)').html(new_pickup_address);
				} else 	if(myArray[b].route_type_id == '1')
				{
					$('#'+trid+' td:eq(1)').html('Zip Code/Airport Id:');
					$('#'+trid+' td:eq(1)').append(new_pickup_address);
				} /*else if(myArray[b].route_type_id == '2')
				{
					var o_pickup_address  = (myArray[b].o_pickup_street?myArray[b].o_pickup_street+", ":"");
						o_pickup_address += (myArray[b].o_pickup_city?myArray[b].o_pickup_city+", ":"");
						o_pickup_address += (myArray[b].o_pickup_zip?myArray[b].o_pickup_zip:"");
						o_pickup_address += (myArray[b].o_pickup_zip?", "+myArray[b].o_pickup_zip:"");
						var overnight_comments = $("#overnight_comments").val();
						var overnight_address = "<strong>Overnight Leg: </strong>"+o_pickup_address+"<p>"+overnight_comments+"</p>";
						$('#'+trid+' td:eq(1)').append(overnight_address);
				}*/		
			}	
			
			if(flag=='')
			{
				//$('#leg_table tr:last').after(row);				
				if(myArray[index-1].in_sort_order == 1)
				{
				$('#leg_table > tbody:first').append(row);  
				}
				else{
				$('#leg_table tr:last').after(row);				
				}
			}
			else
			{
				//alert(edit_q);
				if(myArray[i].in_sort_order==1)
				{
					if(myArray[i].in_sort_order=='1' && flag!='')
					{
						//console.log($('#leg_table > tbody tr').attr("id"));
						if($('#leg_table > tbody tr').attr("id"))
						{
							var tr_id = $('#leg_table > tbody tr').attr("id");
							$('#'+tr_id).before(row);
						}
						else
						{
							$('#leg_table > tbody:first').append(row);  
						}
					}
					else
					{
						$('#leg_table  tr:nth-child('+myArray[i].in_sort_order+')').after(row);
					}
				}
				else
				{ 
					//alert(flag);
					//$('#tr_'+i).after(row);
					//$('#'+flag).after(row);
					/* if($('#'+flag).length)
					{
						$('#'+flag).after(row);						
					}else{
						$('#tr_'+(parseInt(edit_q)+parseInt(1))).before(row);						
					} */
					$('#tr_'+(parseInt(tr_cnt)-(parseInt(1)))).after(row);
				}				
			}
			flag 	= '';
			edit_q 	= '';
			add_flg	= '';
			//console.log(myArray);
			
			renumber_table('#leg_table_body');
			
			$('#save_draft,#save_legs').fadeIn('slow');
			legsArray = JSON.stringify(legsArray);
			jQuery.post("<?php echo base_url(); ?>org_transportation/create_legs/<?php echo $transport_details['in_transportation_id'];?>/",{legsArray:legsArray}, function( data ) {
				if(data !== 'update')
				{
					var trid = $('tr[data-sort-order="'+index+'"]').attr('id');
					//$('#tr_'+index).attr('data-leg-id',data);
					$('#'+trid).attr('data-leg-id',data);
					myArray[index-1].leg_id = data;
					//console.log(myArray[index-1]);	
				} else {
					var trid = editedTrid;
					$('#'+trid).attr('data-leg-id',leg_id);
				}	
				
			});
			renumber_table('#leg_table_body');
			
			jQuery.post("<?php echo base_url(); ?>org_transportation/get_distance_remain/<?php echo $transport_details['in_transportation_id'];?>/",{data_val:myArray,action:"save_legs"}, function( data ) {
				var e = eval('(' + data + ')');
				jQuery("#distance_remain").html("Distance Remaining: "+e.distance_remain+" miles");
				
			});
			 
			//$('#addlegs')[0].reset();
			document.getElementById("addlegs").reset();			
			$("#aviation_display,#address_display,#overnight_display").hide();
			<?php /*?>$("#add_leg_a").show();<?php */?>
			$("#clockface_2_modal,#pickup_airport_clock,#leg_id").val('');
			//console.log(myArray);				
		return true;
	}
});	


$('#overnight_more_submit').live('click',function(){	

		if(edit_q!='')
		{	
			edit_sort_order = myArray[edit_q-1].in_sort_order;
			delete myArray[edit_q-1];	
		}
		
	  //$("#addlegs").valid();
	  
	  if($('#addlegs').valid() == false) {
		return false;
	} else {
		
		var o_pickup_address  = ($("#o_pickup_street").val()?$("#o_pickup_street").val()+", ":"");
			o_pickup_address += ($("#o_pickup_city").val()?$("#o_pickup_city").val()+", ":"");
			o_pickup_address += ($("#o_pickup_state").val()?$("#o_pickup_state").val():"");
			o_pickup_address += ($("#o_pickup_zip").val()?", "+$("#o_pickup_zip").val():"");
			
		
		var leg_id 			= $("#leg_id").val();	
		var update_leg 		= "update";		
		var b;
		legsArray = [];	
		
		var overnight_comments = $("#overnight_comments").val();
		
		if(edit_q!='')
		{
			var i 		= edit_q-1;
			
			/*if(tr_cnt != '')
			{
				edit_q 	= tr_cnt;
			}*/
			
			var index 	= edit_q;				
			
			var sort_order = index;
			//console.log(myArray);
			//alert(q-2);
			if(myArray[i-1])
			{
				if(typeof myArray[i-1].in_sort_order === 'undefined')
				{
					//alert('sort_order ' + myArray[i-1].in_sort_order);
					sort_order = 1;				
				}else{
					sort_order = parseInt(myArray[i-1].in_sort_order) + parseInt(1);
			     }
			}
			var sort_order_max = parseInt(edit_sort_order) + parseInt(1);
			var order_id = edit_sort_order;			

			if(sort_order_max > 0)
			{	
				 b = $.map(myArray, function( value, index ) {
											if(index != i)
											{	
												if(sort_order_max == value.in_sort_order && value.update_leg !='delete')
													return index;
											}	
								});
				if(b.length >0)				
					b =	b[0];
				else 
					b = -1;
			} else {
				b = -1;
			}
			
			if(b!=-1)
			{
				if(myArray[b].route_type_id == '0')
				{
					myArray[b].pickup_street = addslashes($("#o_pickup_street").val());
					myArray[b].pickup_city = addslashes($("#o_pickup_city").val());
					myArray[b].pickup_state = addslashes($("#o_pickup_state").val());
					myArray[b].pickup_zip = addslashes($("#o_pickup_zip").val());
					myArray[b].pickup_country = addslashes($("#o_pickup_country").val());
				} else if(myArray[b].route_type_id == '1')
				{
						var term = $("#o_pickup_zip").val();
						$.ajax({
						url: "<?php echo base_url(); ?>org_transportation/get_airports_by_zipcode_or_airport_id/" ,
						dataType: "json",
						async:false,
						data:{
						term:term 
						},
						success: function (data)
						{
							myArray[b].pickup_street = data[0].value;
							myArray[b].pickup_airport = data[0].value;
							myArray[b].pickup_airport_state = data[0].st_state;
							myArray[b].pickup_airport_city = data[0].st_city;
							myArray[b].pickup_city    = data[0].st_city;
							myArray[b].pickup_state   = data[0].st_state;
							/*$("#pickup_airport").val(data[0].value);
							$("#pickup_airport_city").val(stripslashes(data[0].st_city));
							$("#pickup_airport_state").val(stripslashes(data[0].st_state));*/	
						},
					});
					myArray[b].pickup_zip         = '';
					myArray[b].pickup_country     = '';
					/*if(myArray[b].pickup_city == '')
					{	
						myArray[b].pickup_city = addslashes($("#o_pickup_city").val());
						myArray[b].pickup_airport_city = addslashes($("#o_pickup_city").val());
					}

					if(myArray[b].pickup_state == '')
					{	
						myArray[b].pickup_state = addslashes($("#o_pickup_state").val());
						myArray[b].pickup_airport_state = addslashes($("#o_pickup_state").val());
					}	
					
					myArray[b].pickup_zip     = addslashes($("#o_pickup_zip").val());
					myArray[b].pickup_country = addslashes($("#o_pickup_country").val());*/
					
				} /*else if(myArray[b].route_type_id == '2') {
					
					myArray[b].o_pickup_street  = addslashes($("#o_pickup_street").val());
					myArray[b].o_pickup_city    = addslashes($("#o_pickup_city").val());
					myArray[b].o_pickup_state   = addslashes($("#o_pickup_state").val());
					myArray[b].o_pickup_zip     = addslashes($("#o_pickup_zip").val());
					myArray[b].o_pickup_country = addslashes($("#o_pickup_country").val());
					
				}*/		
			}
			
			myArray[i]=({"o_pickup_street":addslashes($("#o_pickup_street").val()),"o_pickup_city":addslashes($("#o_pickup_city").val()),"o_pickup_state":addslashes($("#o_pickup_state").val()),"o_pickup_zip":addslashes($("#o_pickup_zip").val()),"o_pickup_country":addslashes($("#o_pickup_country").val()),"update_leg":"update","overnight_comments":addslashes($("#overnight_comments").val()),"leg_id":$("#leg_id").val(),"route_type":$("#route_type").val(),"route_type_id":$("#route_type_id").val(),"in_sort_order":edit_sort_order});
			
			legsArray[0] = ({"o_pickup_street":addslashes($("#o_pickup_street").val()),"o_pickup_city":addslashes($("#o_pickup_city").val()),"o_pickup_state":addslashes($("#o_pickup_state").val()),"o_pickup_zip":addslashes($("#o_pickup_zip").val()),"o_pickup_country":addslashes($("#o_pickup_country").val()),"update_leg":"update","overnight_comments":addslashes($("#overnight_comments").val()),"leg_id":$("#leg_id").val(),"route_type":$("#route_type").val(),"route_type_id":$("#route_type_id").val(),"in_sort_order":edit_sort_order});
			legsArray[1] = myArray[b];
		}
		else
		{
			/*if(q>8)	
			 {
				 alert("Maximum 9 Legs are allowed.");
				 return false;
			 }
			*/
			q++;
			/*if(tr_cnt != '')
			{
				q 	= tr_cnt;
			}*/
			b =-1;
			var index = q;
			var i = index;
			var sort_order = index;
			//console.log(myArray);
			//alert(q-2);
			/*if(myArray[q-2])
			{
				if(typeof myArray[q-2].in_sort_order === 'undefined')
				{
					//alert('sort_order ' + myArray[q-2].in_sort_order);
					sort_order = 1;				
				}else{
					var get_sort_order = $.map( myArray, function( value, index ) {
										return value.in_sort_order;
								});
							var max_order_value	 = 	Math.max.apply(Math,get_sort_order);
					sort_order = parseInt(max_order_value) + parseInt(1);
				//	sort_order = parseInt(myArray[q-2].in_sort_order) + parseInt(1);
					}
			}*/
				if(myArray.length == 0 )	
				{
					sort_order = 1;				
				}else{
					var get_sort_order = $.map( myArray, function( value, index ) {
											return value.in_sort_order;
								});
								if(get_sort_order.length > 0)
								{	
									var max_order_value	 = 	Math.max.apply(Math,get_sort_order);
									
								} else {
											var max_order_value = 0;
								}	
							
				 sort_order   = parseInt(max_order_value) + parseInt(1);
			}
			var order_id = sort_order;	
			myArray.push({"o_pickup_street":addslashes($("#o_pickup_street").val()),"o_pickup_city":addslashes($("#o_pickup_city").val()),"o_pickup_state":addslashes($("#o_pickup_state").val()),"o_pickup_zip":addslashes($("#o_pickup_zip").val()),"o_pickup_country":addslashes($("#o_pickup_country").val()),"update_leg":"update","overnight_comments":addslashes($("#overnight_comments").val()),"leg_id":$("#leg_id").val(),"route_type":$("#route_type").val(),"route_type_id":$("#route_type_id").val(),"in_sort_order":sort_order});
			legsArray[0] = ({"o_pickup_street":addslashes($("#o_pickup_street").val()),"o_pickup_city":addslashes($("#o_pickup_city").val()),"o_pickup_state":addslashes($("#o_pickup_state").val()),"o_pickup_zip":addslashes($("#o_pickup_zip").val()),"o_pickup_country":addslashes($("#o_pickup_country").val()),"update_leg":"update","overnight_comments":addslashes($("#overnight_comments").val()),"leg_id":$("#leg_id").val(),"route_type":$("#route_type").val(),"route_type_id":$("#route_type_id").val(),"in_sort_order":sort_order});
		}
		//console.log(myArray);
		//var row  = "<tr id=\"tr_"+index+"\">";
			//row += "<td>"+index+".</td>";
			var row  = "<tr id=\"tr_"+order_id+"\" data-sort-order="+index+">";
			row += "<td class=\"priority\"><span class=\"glyphicon glyphicon-move\"></span> "+order_id+".</td>";
			row += "<td colspan='5'><strong>Overnight Leg: </strong>"+o_pickup_address+"<p>"+overnight_comments+"</p></td>";
			//row += "<td>"+dropoff_address+"</td>";
			//row += "<td>"+start_time+"</td>";
			//row += "<td>"+end_time+"</td>";
			row += "<td><a class=\"edit_legs\" href=\"javascript:void(0);\" title=\"Edit\" onClick=\"edit_leges('"+index+"',$(this));\"><i class=\"fa fa-edit\"></i>Edit</a><a  class=\"delete-leg\" href=\"javascript:void(0);\" title=\"Delete\" onClick=\"delete_leges('"+index+"',$(this));\" style='color:#000'><i class=\"fa fa-trash-o delete-icon\"></i></a></td>";
			
			row += "</tr>";
				if(b!=-1)
			{
				var new_pickup_address  = (myArray[b].pickup_street?myArray[b].pickup_street+", ":"");
				var trid = $('tr[data-leg-id="'+myArray[b].leg_id+'"]').attr('id');
				new_pickup_address += (myArray[b].pickup_city?myArray[b].pickup_city+", ":"");
				new_pickup_address += (myArray[b].pickup_state?myArray[b].pickup_state:"");
				new_pickup_address += (myArray[b].pickup_zip?", "+myArray[b].pickup_zip:"");
				if(myArray[b].route_type_id == '0')
				{	
					$('#'+trid+' td:eq(1)').html(new_pickup_address);
				} else 	if(myArray[b].route_type_id == '1')
				{
					$('#'+trid+' td:eq(1)').html('Zip Code/Airport Id:');
					$('#'+trid+' td:eq(1)').append(new_pickup_address);
				} /*else if(myArray[b].route_type_id == '2')
				{
					var o_pickup_address  = (myArray[b].o_pickup_street?myArray[b].o_pickup_street+", ":"");
						o_pickup_address += (myArray[b].o_pickup_city?myArray[b].o_pickup_city+", ":"");
						o_pickup_address += (myArray[b].o_pickup_zip?myArray[b].o_pickup_zip:"");
						o_pickup_address += (myArray[b].o_pickup_zip?", "+myArray[b].o_pickup_zip:"");
					var overnight_comments = $("#overnight_comments").val();
					var overnight_address = "<strong>Overnight Leg: </strong>"+o_pickup_address+"<p>"+overnight_comments+"</p>";
						$('#'+trid+' td:eq(1)').append(overnight_address);
				}*/		
			}	
				
			if(flag=='')
			{
				//$('#leg_table tr:last').after(row);				
				if(myArray[index-1].in_sort_order == 1)
				{
				$('#leg_table > tbody:first').append(row);  
				}
				else{
				$('#leg_table tr:last').after(row);				
				}
			}
			else
			{
				//alert(edit_q);
				if(myArray[i].in_sort_order==1)
				{
					if(myArray[i].in_sort_order=='1' && flag!='')
					{
						//console.log($('#leg_table > tbody tr').attr("id"));
						if($('#leg_table > tbody tr').attr("id"))
						{
							var tr_id = $('#leg_table > tbody tr').attr("id");
							$('#'+tr_id).before(row);
						}
						else
						{
							$('#leg_table > tbody:first').append(row);  
						}
					}
					else
					{
						$('#leg_table  tr:nth-child('+myArray[i].in_sort_order+')').after(row);
					}
				}
				else
				{ 
					//alert(flag);
					//$('#tr_'+i).after(row);
					//$('#'+flag).after(row);
					/* if($('#'+flag).length)
					{
						$('#'+flag).after(row);						
					}else{
						$('#tr_'+(parseInt(edit_q)+parseInt(1))).before(row);						
					} */
					$('#tr_'+(parseInt(tr_cnt)-(parseInt(1)))).after(row);
				}				
			}
			flag 	= '';
			edit_q 	= '';
			add_flg	= '';
			//console.log(myArray);
			
			renumber_table('#leg_table_body');
			
			$('#save_draft,#save_legs').fadeIn('slow');
			legsArray = JSON.stringify(legsArray);
			jQuery.post("<?php echo base_url(); ?>org_transportation/create_legs/<?php echo $transport_details['in_transportation_id'];?>/",{legsArray:legsArray}, function( data ) {
				if(data !== 'update')
				{	
					var trid = $('tr[data-sort-order="'+index+'"]').attr('id');
					$('#'+trid).attr('data-leg-id',data);
					myArray[index-1].leg_id = data;
						
				} else {
					var trid = editedTrid;
					$('#tr_'+index).attr('data-leg-id',leg_id)
				}
			});
			renumber_table('#leg_table_body');
			jQuery.post("<?php echo base_url(); ?>org_transportation/get_distance_remain/<?php echo $transport_details['in_transportation_id'];?>/",{data_val:myArray,action:"save_legs"}, function( data ) {
				var e = eval('(' + data + ')');
				jQuery("#distance_remain").html("Distance Remaining: "+e.distance_remain+" miles");
				
			});
			 
			//$('#addlegs')[0].reset();
			document.getElementById("addlegs").reset();			
			$("#aviation_display,#address_display,#overnight_display").hide();
			<?php /*?>$("#add_leg_a").show();<?php */?>
			$("#clockface_2_modal,#pickup_airport_clock,#leg_id").val('');
			//console.log(myArray);
			
			//alert('myArray.length'+myArray.length);
			
			var	cnt = (myArray.length-1);
			
			$('#overnight_display').show();
			$('#aviation_display').hide();
			$('#address_display').hide();
			$("#route_type").val("Overnight");
			$("#route_type_id").val("2");
			
			var drop_state_list = '';
			
			if(myArray.length > 0 && myArray[cnt].route_type_id == 2 && myArray[cnt].o_pickup_country == 'USA') {
					drop_state_list += '<option value="">Select</option>';
					drop_state_list += '<?php foreach($this->common_function->state_list as $key=>$val) { ?>';
					drop_state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
					drop_state_list += '<?php } ?>';
				
			} else if(myArray.length > 0 && myArray[cnt].route_type_id == 2 && myArray[cnt].o_pickup_country == 'CANADA') {
					drop_state_list += '<option value="">Select</option>';
					drop_state_list += '<?php foreach($this->common_function->canadian_state_list as $key=>$val) { ?>';
					drop_state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
					drop_state_list += '<?php } ?>';
					
			} else {}
			
			$('#o_pickup_state').html(drop_state_list); 
			
			if(myArray.length > 0)
			{
				if(myArray[cnt].route_type_id == 2)
				{
				$("#o_pickup_street").val(stripslashes(myArray[cnt].o_pickup_street ? myArray[cnt].o_pickup_street : ''));
				$("#o_pickup_city").val(stripslashes(myArray[cnt].o_pickup_city));
				$("#o_pickup_state").val(stripslashes(myArray[cnt].o_pickup_state));
				$("#o_pickup_zip").val(stripslashes(myArray[cnt].o_pickup_zip));
				$("#o_pickup_country").val(stripslashes(myArray[cnt].o_pickup_country));
				}
			}
		
			return true;
	}
});	

$('#cancel_g,#cancel_a,#cancel_o').live('click',function(){
	/*-----------Route legs in edit mode and user click on cancel start--------------*/
	if((this.id=="cancel_g") && edit_q!='')
	{
		var a= edit_q-1;
		var pickup_address  = (stripslashes(myArray[a].pickup_street)?stripslashes(myArray[a].pickup_street)+", ":"");
			pickup_address += (stripslashes(myArray[a].pickup_city)?stripslashes(myArray[a].pickup_city)+", ":"");
			pickup_address += (stripslashes(myArray[a].pickup_state)?stripslashes(myArray[a].pickup_state):"");
			pickup_address += (stripslashes(myArray[a].pickup_zip)?", "+stripslashes(myArray[a].pickup_zip):"");
			
		var dropoff_address  = (stripslashes(myArray[a].dropoff_street)?stripslashes(myArray[a].dropoff_street)+", ":"");
			dropoff_address += (stripslashes(myArray[a].dropoff_city)?stripslashes(myArray[a].dropoff_city)+", ":"");
			dropoff_address += (stripslashes(myArray[a].dropoff_state)?stripslashes(myArray[a].dropoff_state):"");
			dropoff_address += (stripslashes(myArray[a].dropoff_zip)?", "+stripslashes(myArray[a].dropoff_zip):"");
		var start_time 		 = myArray[a].clockface_2_modal;	
			start_time 		+= " - "+myArray[a].pickup_zone;	
		var end_time 		 = myArray[a].clockface_3_modal;	
			end_time 		+= " - "+myArray[a].pickup_zone;	
			
		var meeting_location = (myArray[a].meeting_location) ? myArray[a].meeting_location : "";
		//alert(meeting_location+'meeting_location');
		//alert(meeting_location.length);
		var meeting_location1 = '';
		if(meeting_location.length > 10)
		{
		  meeting_location1 = meeting_location.substring(0,9);
		  meeting_location1 = meeting_location1+'...';
		}
		//alert(meeting_location1);
		if(meeting_location1 == '' || meeting_location1.length == 0)
		{
			meeting_location1 = meeting_location;
		}
		
		var no_of_drivers = $("#no_of_drivers").val();
		var leg_id =  $('#leg_id').val();
		if(edit_q!='')
		{
			//var index 	= edit_q;	
			var i 		= edit_q-1;
			
			/*if(tr_cnt != '')
			{
				edit_q 	= tr_cnt;
			}*/
			var index 	= edit_q;
			
			
		}
		else
		{
			q++;
			var index = q;				
		}
		
		if(no_of_drivers >= 2)
		{
		var multi_driver_icon = '<span class=\"leg-fa-users\"><i class=\"fa fa-users\"></i></span>';
		}else{
		var multi_driver_icon = '';
		}


		//var row  = "<tr id=\"tr_"+index+"\">";
			//row += "<td>"+index+"."+multi_driver_icon+"</td>";
			var row  = "<tr id=\"tr_"+myArray[a].in_sort_order+"\" data-sort-order="+index+">";
			row += "<td class=\"priority\"><span class=\"glyphicon glyphicon-move\"></span> "+myArray[a].in_sort_order+"."+multi_driver_icon+"</td>";
			
			row += "<td>"+pickup_address+"</td>";
			row += "<td>"+dropoff_address+"</td>";
			row += "<td>"+start_time+"</td>";
			row += "<td>"+end_time+"</td>";
			//row += "<td>"+meeting_location+"</td>";
			if(meeting_location !=  '')
			{
			row += "<td class=\"meet-location\">"+meeting_location1+"<a class=\"eyeicon\" data-original-title=\""+meeting_location+"\" data-toggle=\"tooltip\" href=\"javascript:void(0);\"><i class=\"fa fa-eye\"></i></a></td>";
			}else
			{
			row += "<td></td>";	
			}
			row += "<td><a class=\"edit_legs\" href=\"javascript:void(0);\" title=\"Edit\" onClick=\"edit_leges('"+index+"',$(this));\"><i class=\"fa fa-edit\"></i> Edit</a><a  class=\"delete-leg\" href=\"javascript:void(0);\" title=\"Delete\" onClick=\"delete_leges('"+index+"',$(this));\" style='color:#000'><i class=\"fa fa-trash-o delete-icon\"></i></a></td>";
			row += "</tr>";
			if(flag=='')
			{
				//$('#leg_table tr:last').after(row);
				if(myArray.length == 1)
				{
				$('#leg_table > tbody:first').append(row);  
				}
				else{
				$('#leg_table tr:last').after(row);				
				}
				//$('#leg_table tr:last').hide();
				//$('#leg_table tr:last').fadeIn('slow'); 
			}
			else
			{
				//alert(edit_q);
				if(myArray[a].in_sort_order==1)
				{
					//$('#leg_table  tr:nth-child('+edit_q+')').after(row);
					if(myArray[a].in_sort_order=='1' && flag!='')
					{
						//console.log($('#leg_table > tbody tr').attr("id"));
						//alert($('#leg_table > tbody tr').attr("id"));
						if($('#leg_table > tbody tr').attr("id"))
						{
							var tr_id = $('#leg_table > tbody tr').attr("id");
							$('#'+tr_id).before(row);
							//$('#leg_table > tbody tr').before(row);
							//$('#leg_table  tr:nth-child('+edit_q+')').after(row);
						}
						else
						{
							$('#leg_table > tbody:first').append(row);  
						}
						 //
						//$('#leg_table > tbody').insertAfter(closest( "#leg_table > tbody" ).after(row));
					}
					else
					{
						$('#leg_table  tr:nth-child('+edit_q+')').after(row);
					}
				}
				else
				{ 
					//alert(flag);
					//$('#tr_'+i).after(row);
					//$('#'+flag).after(row);
					/* if($('#'+flag).length)
					{
						$('#'+flag).after(row);						
					}else{
						$('#tr_'+(parseInt(edit_q)+parseInt(1))).before(row);						
					} */
					$('#tr_'+(parseInt(tr_cnt)-(parseInt(1)))).after(row);					
				}				
			}
			flag 	= '';
			edit_q 	= '';
			add_flg	= '';
			var trid = editedTrid;
			$('#'+trid).attr('data-leg-id',leg_id);
	}
	
	if((this.id=="cancel_a") && edit_q!='')
	{
		var a= edit_q-1;
		var pickup_address = (stripslashes(myArray[a].pickup_airport)?"Zip Code/Airport Id: "+stripslashes(myArray[a].pickup_airport):"");
		var	pickaddress = (stripslashes(myArray[a].pickup_airport_city)?", "+stripslashes(myArray[a].pickup_airport_city):"");
			pickaddress += (stripslashes(myArray[a].pickup_airport_state)?", "+stripslashes(myArray[a].pickup_airport_state):"");
			if(pickaddress!='')
			{
				pickup_address += pickaddress;
			}
			//dropoff_airport_city,dropoff_airport_state
		var dropoff_address = (stripslashes(myArray[a].dropoff_airport)?"Zip Code/Airport Id: "+stripslashes(myArray[a].dropoff_airport):"");
		var	dropoffaddress = (stripslashes(myArray[a].dropoff_airport_city)?", "+stripslashes(myArray[a].dropoff_airport_city):"");
			dropoffaddress += (stripslashes(myArray[a].dropoff_airport_state)?", "+stripslashes(myArray[a].dropoff_airport_state):"");
		if(dropoffaddress!='')
			{
				dropoff_address += dropoffaddress;
			}	
				
		var start_time 		 = myArray[a].pickup_airport_clock;	
			start_time 		+= " - "+myArray[a].pickup_airport_zone;	
		var end_time 		 = myArray[a].dropoff_airport_clock;	
			end_time 		+= " - "+myArray[a].dropoff_airport_zone;
		
		
		var pilot_meeting_location = (myArray[a].pilot_meeting_location) ? myArray[a].pilot_meeting_location : "";
		var leg_id =  $('#leg_id').val();
		var no_of_pilots = $("#no_of_pilots").val();
		//alert(no_of_pilots);	
		if(edit_q!='')
		{
			var i 		= edit_q-1;
			/*if(tr_cnt != '')
			{
				edit_q 	= tr_cnt;
			}*/
			var index 	= edit_q;
			
		}
		else
		{
			q++;
			var index = q;	
		}
		//console.log(myArray);
		
		var pilot_meeting_location1 = '';
		if(pilot_meeting_location.length > 10)
		{
		  pilot_meeting_location1 = pilot_meeting_location.substring(0,9);
		  pilot_meeting_location1 = pilot_meeting_location1+'...';
		}
		//alert(meeting_location1);
		if(pilot_meeting_location1 == '' || pilot_meeting_location1.length == 0)
		{
			pilot_meeting_location1 = pilot_meeting_location;
		}
		
		if(no_of_pilots >= 2)
		{
		var multi_pilot_icon = '<span class=\"leg-fa-users\"><i class=\"fa fa-users\"></i></span>';
		}else{
		var multi_pilot_icon = '';
		}
		
		//var row  = "<tr id=\"tr_"+index+"\">";
			//row += "<td>"+index+"."+multi_pilot_icon+"</td>";
			var row  = "<tr id=\"tr_"+myArray[a].in_sort_order+"\" data-sort-order="+index+">";
			row += "<td class=\"priority\"><span class=\"glyphicon glyphicon-move\"></span> "+myArray[a].in_sort_order+"."+multi_pilot_icon+"</td>";
			row += "<td>"+pickup_address+"</td>";
			row += "<td>"+dropoff_address+"</td>";
			row += "<td>"+start_time+"</td>";
			row += "<td>"+end_time+"</td>";
			//row += "<td>"+pilot_meeting_location+"</td>";
			//row += "<td>"+pilot_meeting_location1+"<a class=\"eyeicon\" data-original-title=\""+pilot_meeting_location+"\" data-toggle=\"tooltip\" href=\"javascript:void(0);\"><i class=\"fa fa-eye\"></i></a></td>";
			if(pilot_meeting_location !=  '')
			{
			row += "<td class=\"meet-location\">"+pilot_meeting_location1+"<a class=\"eyeicon\" data-original-title=\""+pilot_meeting_location+"\" data-toggle=\"tooltip\" href=\"javascript:void(0);\"><i class=\"fa fa-eye\"></i></a></td>";
			}else
			{
			row += "<td></td>";	
			}
			row += "<td><a class=\"edit_legs\" href=\"javascript:void(0);\" title=\"Edit\" onClick=\"edit_leges('"+index+"',$(this));\"><i class=\"fa fa-edit\"></i> Edit</a><a  class=\"delete-leg\" href=\"javascript:void(0);\" title=\"Delete\" onClick=\"delete_leges('"+index+"',$(this));\" style='color:#000'><i class=\"fa fa-trash-o delete-icon\"></i></a></td>";
			row += "</tr>";
			if(flag=='')
			{
				$('#leg_table tr:last').after(row);
			}
			else
			{				
				if(myArray[a].in_sort_order==1)
				{
					if(myArray[a].in_sort_order=='1' && flag!='')
					{
						if($('#leg_table > tbody tr').attr("id"))
						{
							var tr_id = $('#leg_table > tbody tr').attr("id");
							$('#'+tr_id).before(row);
						}
						else
						{
							$('#leg_table > tbody:first').append(row);  
						}
					}
					else
					{
						$('#leg_table  tr:nth-child('+myArray[a].in_sort_order+')').after(row);
					}
				}
				else
				{ 
					$('#tr_'+(parseInt(tr_cnt)-(parseInt(1)))).after(row);
					//$('#'+flag).after(row);
					/*if($('#'+flag).length)
					{
						$('#'+flag).after(row);						
					}else{
						$('#tr_'+(parseInt(tr_cnt)-(parseInt(1)))).after(row);
						//$('#tr_'+(parseInt(myArray[a].in_sort_order)-(parseInt(1)))).after(row);
						//$('#tr_'+(parseInt(myArray[a].in_sort_order)+parseInt(1))).before(row);						
					}*/
				}

			}
			flag 	= '';
			edit_q 	= '';
			add_flg	= '';
			var trid = editedTrid;
			$('#'+trid).attr('data-leg-id',leg_id);
			
	}
	
	if((this.id=="cancel_o") && edit_q!='')
	{
		var a= edit_q-1;
		var o_pickup_address  = (stripslashes(myArray[a].o_pickup_street)?stripslashes(myArray[a].o_pickup_street)+", ":"");
			o_pickup_address += (stripslashes(myArray[a].o_pickup_city)?stripslashes(myArray[a].o_pickup_city)+", ":"");
			o_pickup_address += (stripslashes(myArray[a].o_pickup_state)?stripslashes(myArray[a].o_pickup_state):"");
			o_pickup_address += (stripslashes(myArray[a].o_pickup_zip)?", "+stripslashes(myArray[a].o_pickup_zip):"");
		
		var overnight_comments = (stripslashes(myArray[a].overnight_comments)? stripslashes(myArray[a].overnight_comments):"");
		var leg_id =  $('#leg_id').val();
		if(edit_q!='')
		{
			var i 		= edit_q-1;
			
			/*if(tr_cnt != '')
			{
				edit_q 	= tr_cnt;
			}*/
			var index 	= edit_q;			
			
		}
		else
		{
			q++;
			var index = q;				
		}
		
		//var row  = "<tr id=\"tr_"+index+"\">";
			//row += "<td>"+index+".</td>";
			var row  = "<tr id=\"tr_"+myArray[a].in_sort_order+"\" data-sort-order="+index+">";
			row += "<td class=\"priority\"><span class=\"glyphicon glyphicon-move\"></span> "+myArray[a].in_sort_order+".</td>";
			
			row += "<td colspan='5'><strong>Overnight Leg: </strong>"+o_pickup_address+"<p>"+overnight_comments+"</p></td>";
			row += "<td><a class=\"edit_legs\" href=\"javascript:void(0);\" title=\"Edit\" onClick=\"edit_leges('"+index+"',$(this));\"><i class=\"fa fa-edit\"></i>Edit</a><a  class=\"delete-leg\" href=\"javascript:void(0);\" title=\"Delete\" onClick=\"delete_leges('"+index+"',$(this));\" style='color:#000'><i class=\"fa fa-trash-o delete-icon\"></i></a></td>";
			
			row += "</tr>";
			
			if(flag=='')
			{
				if(myArray.length == 1)
				{
				$('#leg_table > tbody:first').append(row);  
				}
				else{
				$('#leg_table tr:last').after(row);				
				}
			}
			else
			{
				//alert(edit_q);
				if(myArray[a].in_sort_order==1)
				{
					//$('#leg_table  tr:nth-child('+edit_q+')').after(row);
					if(myArray[a].in_sort_order=='1' && flag!='')
					{
						//console.log($('#leg_table > tbody tr').attr("id"));
						//alert($('#leg_table > tbody tr').attr("id"));
						if($('#leg_table > tbody tr').attr("id"))
						{
							var tr_id = $('#leg_table > tbody tr').attr("id");
							$('#'+tr_id).before(row);
							//$('#leg_table > tbody tr').before(row);
							//$('#leg_table  tr:nth-child('+edit_q+')').after(row);
						}
						else
						{
							$('#leg_table > tbody:first').append(row);  
						}
						 //
						//$('#leg_table > tbody').insertAfter(closest( "#leg_table > tbody" ).after(row));
					}
					else
					{
						$('#leg_table  tr:nth-child('+myArray[a].in_sort_order+')').after(row);
					}
				}
				else
				{ 
					$('#tr_'+(parseInt(tr_cnt)-(parseInt(1)))).after(row);
					//alert(flag);
					//$('#tr_'+i).after(row);
					//$('#'+flag).after(row);
					/*if($('#'+flag).length)
					{
						$('#'+flag).after(row);						
					}else{
						$('#tr_'+(parseInt(tr_cnt)-(parseInt(1)))).after(row);
						//$('#tr_'+(parseInt(myArray[a].in_sort_order)-(parseInt(1)))).after(row);
						//$('#tr_'+(parseInt(myArray[a].in_sort_order)+parseInt(1))).before(row);						
					}*/
				}				
			}
			flag 	= '';
			edit_q 	= '';
			add_flg	= '';
			var trid = editedTrid;
			$('#'+trid).attr('data-leg-id',leg_id);
			
	}
	
	/*-----------Route legs in edit mode and user click on cancel end--------------*/		
	document.getElementById("addlegs").reset();
	$("#address_display").hide();
	$("#aviation_display").hide();
	$("#overnight_display").hide();
	$("#clockface_2_modal").val('');
	$("#pickup_airport_clock").val('');
	$("#leg_id").val('');
});

function edit_leges(q,e)
{
	if(add_flg!='' && edit_q=='')
	{
		$("#address_display").hide();
		$("#aviation_display").hide();	
		$("#overnight_display").hide();	
	}
	if(flag=='')
	{
		
	if($("#tr_"+q).prev().attr('id'))
	{
		
		flag 	= $("#tr_"+q).prev().attr('id');
	}
	else
	{
		//flag 	= "#tr_"+q;	
		var tr_no = q-1;		
		flag 	= "tr_"+tr_no;	
	}

	edit_q	= q;	//$('#tr_'+ q).fadeOut('slow'); 
	//$('#tr_'+ q).remove();
	
	var trId = e.closest('tr').prop('id');
	editedTrid = e.closest('tr').prop('id');
	tr_cnt = trId.substr(trId.indexOf("_") + 1);
	//alert('tr_cnt'+tr_cnt);
	$('#'+trId).remove();
	
	var a = q-1;
	//console.log(myArray);
	
	if(myArray[a].route_type_id=='1')
	{
		$("#aviation_display").show();	
		
		if(myArray[a].multiple_drivers_pilots == 1)
		{
			$('#multiple_pilots').parent().addClass('checked');
			$('#multiple_pilots').prop('checked', true);
			$('#multiple_pilots_txt').val('1');
			
		}
		if(myArray[a].no_of_pilots >= 2)
		{
			$("#no_of_pilots_div").show();
			$("#pilot_meeting_location_div").show();
			$("#no_of_pilots").val(stripslashes(myArray[a].no_of_pilots));
			$("#pilot_meeting_location").val(stripslashes(myArray[a].pilot_meeting_location));
		}
		
		
	}
	else if(myArray[a].route_type_id=='0')
	{
		$("#address_display").show();
		
			var drop_state_list = '';
			if(myArray[a].dropoff_country == 'USA') {
					drop_state_list += '<option value="">Select</option>';
					drop_state_list += '<?php foreach($this->common_function->state_list as $key=>$val) { ?>';
					drop_state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
					drop_state_list += '<?php } ?>';
				
			} else {
					drop_state_list += '<option value="">Select</option>';
					drop_state_list += '<?php foreach($this->common_function->canadian_state_list as $key=>$val) { ?>';
					drop_state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
					drop_state_list += '<?php } ?>';
					
			}
			$('#dropoff_state').html(drop_state_list); 
			var pick_state_list = '';
			if(myArray[a].pickup_country == 'USA') {
					pick_state_list += '<option value="">Select</option>';
					pick_state_list += '<?php foreach($this->common_function->state_list as $key=>$val) { ?>';
					pick_state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
					pick_state_list += '<?php } ?>';
				
			} else {
					pick_state_list += '<option value="">Select</option>';
					pick_state_list += '<?php foreach($this->common_function->canadian_state_list as $key=>$val) { ?>';
					pick_state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
					pick_state_list += '<?php } ?>';
					
			}
			$('#pickup_state').html(pick_state_list); 
			
	}
	else if(myArray[a].route_type_id=='2')
	{
		$("#overnight_display").show();	
		
		var o_pick_state_list = '';
		if(myArray[a].o_pickup_country == 'USA') {
				o_pick_state_list += '<option value="">Select</option>';
				o_pick_state_list += '<?php foreach($this->common_function->state_list as $key=>$val) { ?>';
				o_pick_state_list += '<option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
				o_pick_state_list += '<?php } ?>';
			
		} else {
				o_pick_state_list += '<option value="">Select</option>';
				o_pick_state_list += '<?php foreach($this->common_function->canadian_state_list as $key=>$val) { ?>';
				o_pick_state_list += '<option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
				o_pick_state_list += '<?php } ?>';
				
		}
		$('#o_pickup_state').html(o_pick_state_list); 
		
		$("#o_pickup_street").val(stripslashes(myArray[a].o_pickup_street));
		$("#o_pickup_city").val(stripslashes(myArray[a].o_pickup_city));
		$("#o_pickup_state").val(stripslashes(myArray[a].o_pickup_state));
		$("#o_pickup_country").val(stripslashes(myArray[a].o_pickup_country));
		$("#o_pickup_zip").val(stripslashes(myArray[a].o_pickup_zip));
		$("#overnight_comments").val(stripslashes(myArray[a].overnight_comments));
		
			var c = $("#o_pickup_city").val();
			var co = $("#o_pickup_country").val();
			var s = $("#o_pickup_state").val();	
			var z =$("#o_pickup_zip").val();
			var pickval = z+', '+c+', '+s+', '+co;
			$('#o_pickup_location').val(pickval);
	}
	
	$("#pickup_street").val(stripslashes(myArray[a].pickup_street));
	$("#pickup_city").val(stripslashes(myArray[a].pickup_city));
	$("#pickup_state").val(stripslashes(myArray[a].pickup_state));
	$("#pickup_zip").val(stripslashes(myArray[a].pickup_zip));
	$("#pickup_country").val(stripslashes(myArray[a].pickup_country));
	$("#dropoff_street").val(stripslashes(myArray[a].dropoff_street));
	$("#dropoff_country").val(stripslashes(myArray[a].dropoff_country));
	$("#dropoff_city").val(stripslashes(myArray[a].dropoff_city));
	$("#dropoff_state").val(stripslashes(myArray[a].dropoff_state));
	$("#dropoff_zip").val(stripslashes(myArray[a].dropoff_zip));
	$("#clockface_2_modal").val(myArray[a].clockface_2_modal);	
	$("#clockface_3_modal").val(myArray[a].clockface_3_modal);
	$("#leg_id").val(myArray[a].leg_id);	
	$("#route_type").val(myArray[a].route_type);
	$("#route_type_id").val(myArray[a].route_type_id);
	
	$("#dropoff_airport").val(stripslashes(myArray[a].dropoff_airport));
	$("#dropoff_airport_clock").val(myArray[a].dropoff_airport_clock);
	$("#dropoff_airport_zone").val(myArray[a].dropoff_airport_zone);
	$("#dropoff_airport_city").val(stripslashes(myArray[a].dropoff_airport_city));
	$("#dropoff_airport_state").val(stripslashes(myArray[a].dropoff_airport_state));
	
	$("#pickup_airport").val(stripslashes(myArray[a].pickup_airport));
	$("#pickup_airport_clock").val(myArray[a].pickup_airport_clock);
	$("#pickup_airport_zone").val(myArray[a].pickup_airport_zone);
	$("#pickup_airport_city").val(stripslashes(myArray[a].pickup_airport_city));
	$("#pickup_airport_state").val(stripslashes(myArray[a].pickup_airport_state));
		
	document.getElementById("dropoff_zone").value = myArray[a].dropoff_zone;
	document.getElementById("pickup_zone").value = myArray[a].pickup_zone;
	//myArray.splice($.inArray(myArray[a], myArray),1);
	//console.log(myArray);
	//delete myArray[a];
	$("#no_of_drivers").val(stripslashes(myArray[a].no_of_drivers));
	$("#meeting_location").val(stripslashes(myArray[a].meeting_location));
	$("#multiple_drivers_pilots").val(stripslashes(myArray[a].multiple_drivers_pilots));
	
	var c = $("#pickup_city").val();
			var co = $("#pickup_country").val();
			var s = $("#pickup_state").val();	
			var z =$("#pickup_zip").val();
			var pickval = z+', '+c+', '+s+', '+co;
			$('#pickup_location').val(pickval);
			
	var c = $("#dropoff_city").val();
			var co = $("#dropoff_country").val();
			var s = $("#dropoff_state").val();	
			var z =$("#dropoff_zip").val();
			var pickval = z+', '+c+', '+s+', '+co;
			$('#dropoff_location').val(pickval);		
	
	if(myArray[a].multiple_drivers_pilots == 1)
	{
		$('#multiple_drivers').parent().addClass('checked');
		$('#multiple_drivers').prop('checked', true);
		$('#multiple_drivers_txt').val('1');
		
	}
	if(myArray[a].no_of_drivers >= 2)
	{
		$("#no_of_drivers_div").show();
		$("#meeting_location_div").show();
		$("#no_of_drivers").val(stripslashes(myArray[a].no_of_drivers));
		$("#meeting_location").val(stripslashes(myArray[a].meeting_location));
	}
	
	}
	else
	{
		//alert("Update your current leg.");
		alert("Please scroll down to complete editing the currently selected leg.");
	}
}

function delete_leges(q,e)
{
	if(confirm("Are you sure, Do you want to delete this leg?"))
	{
		$('#leg_deleted').val(1);
		//$('#tr_'+ q).remove();
		
		var trId = e.closest('tr').prop('id');
		tr_cnt = trId.substr(trId.indexOf("_") + 1);
		$('#'+trId).remove();
		
		var a = q-1;
		//myArray.splice($.inArray(myArray[a], myArray),1);
		//alert(myArray.length);
		var leg_id = myArray[a].leg_id;
		//alert(leg_id);
		//console.log(myArray[a]);
		var in_distance_covered = jQuery("#distance_covered").val() ;
		var distance_total = jQuery("#distance_total").val() ;
		var distance_remaining = jQuery("#distance_remaining").val() ;
		
		var distance_remain_total = jQuery("#distance_remain").html() ;
		var distance_remain_total_array = distance_remain_total.split(" ");
		//alert('distance_remain_total'+distance_remain_total_array[2]);
		
		//alert('in_distance_covered'+in_distance_covered);
		//alert('distance_total'+distance_total);
		//alert('distance_remaining'+distance_remaining);
		var delete_leg	 = new Array();
		delete_leg = myArray[a];
		
		var route_type = myArray[a].route_type_id;
		
		var prev_sort_order = myArray[a].in_sort_order;
		//alert('prev_sort_order'+prev_sort_order);
		
		delete myArray[a];		
		//myArray.splice(a, 1);
		
		//alert(myArray.length);		
		myArray[a]=({"leg_id":leg_id,"update_leg":"delete"});
		//var legsArray = ({"leg_id":leg_id,"update_leg":"delete"});
		legsArray = [];
		legsArray[0] = ({"leg_id":leg_id,"update_leg":"delete"});
		console.log(myArray);
		//alert(myArray.length);
		
		//for(var i=a+parseInt(1);i<myArray.length;i++)
		/* for(var i=a+parseInt(1);i<myArray.length;i++)
		{
			//alert('i is'+i);
			if(myArray[i].update_leg != "delete")
			{
				myArray[i].in_sort_order = parseInt(prev_sort_order);							
				prev_sort_order++;
			}
		}
		 */
		 
		 renumber_table('#leg_table_body');
		 	var jsondata = JSON.stringify(myArray);
			$('#legs_reorder').modal('show');
		  jQuery.post("<?php echo base_url(); ?>org_transportation/create_legs/<?php echo $transport_details['in_transportation_id'];?>/",{legsArray:jsondata}, function( data ) {
				//alert(data);
				//return false;
				//var e = eval('(' + data + ')');
				$('#legs_reorder').modal('hide');
				//jQuery("#distance_remain").html("Distance Remaining: "+e.distance_remain+" miles");				
			});
		
		
		if(route_type != 2){
		jQuery.post("<?php echo base_url(); ?>org_transportation/get_distance_remain_after_leg_delete/<?php echo $transport_details['in_transportation_id'];?>/",{data_val:delete_leg}, function( data ) {
				//alert('deleted leg distance'+data);
				var e = eval('(' + data + ')');
				var remain_distance = parseFloat(parseFloat(distance_remain_total_array[2]) + parseFloat(e.distance_remain)).toFixed(2);
				
				//alert('remain_distance'+remain_distance);
				jQuery("#distance_remain").html("Distance Remaining: "+remain_distance+" miles");
				jQuery("#distance_remaining").val(remain_distance);
				
				return false;
				
			});
		}
	}
	else
	{
		return false;
	}
}
$('#pickup_country,#dropoff_country,#o_pickup_country').live('change',function(){
			var country_name = $(this).val();
			var state_id = $(this).attr('data-address');
			var state_list = '';
			if(country_name == 'USA') {
					state_list += '<option value="">Select</option>';
					state_list += '<?php foreach($this->common_function->state_list as $key=>$val) { ?>';
					state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
					state_list += '<?php } ?>';
				
			} else {
					state_list += '<option value="">Select</option>';
					state_list += '<?php foreach($this->common_function->canadian_state_list as $key=>$val) { ?>';
					state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
					state_list += '<?php } ?>';
					
			}
			$('#'+state_id+'_state').html(state_list); 
	});

function addslashes(str) {
	if(str)
	{
		str=str.replace(/\\/g,'\\\\');
		str=str.replace(/\'/g,'\\\'');
		str=str.replace(/\"/g,'\\"');
		str=str.replace(/\0/g,'\\0');
		return str;
	}
	else{
		return "";
	}
}
function stripslashes(str) {
	if(str)
	{
		str=str.replace(/\\'/g,'\'');
		str=str.replace(/\\"/g,'"');
		str=str.replace(/\\0/g,'\0');
		str=str.replace(/\\\\/g,'\\');
		return str;
	}
	else{
		return "";
	}
}
function country_state(country_name,state_id)
{
			var state_list = '';
			if(country_name == 'USA') {
					state_list += '<option value="">Select</option>';
					state_list += '<?php foreach($this->common_function->state_list as $key=>$val) { ?>';
					state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
					state_list += '<?php } ?>';
				
			} else {
					state_list += '<option value="">Select</option>';
					state_list += '<?php foreach($this->common_function->canadian_state_list as $key=>$val) { ?>';
					state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
					state_list += '<?php } ?>';
					
			}
			$('#'+state_id+'_state').html(state_list);
}
function get_zip(city,state,zip)
{
	//alert($("#"+city).val());
	//alert($("#"+state).val());
	if($("#"+state).val()!='' && $("#"+city).val()!='')
	{
	 	jQuery.post("<?php echo base_url(); ?>org_transportation/get_zip_code/",{state:$("#"+state).val(),city:$("#"+city).val(),action:"zip"}, function( data ) {
		//alert(data)
			if(data)
			{
				if(data=="1")
				{
					window.location.href="<?php echo base_url() ?>";
				}
				else
				{
					var newdaata = data.split("#*#"); 
					$("#"+zip).val(newdaata[0]);
					$("#"+city).val(newdaata[1]);
				}
			}
		});
	}
}
//console.log(myArray);
</script>
<!-- END JAVASCRIPTS -->

<script>            
	jQuery(document).ready(function() {
		var offset = 220;
		var duration = 500;
		jQuery(window).scroll(function() {
			if (jQuery(this).scrollTop() > offset) {
				jQuery('.crunchify-top').fadeIn(duration);
			} else {
				jQuery('.crunchify-top').fadeOut(duration);
			}
		});
 
		jQuery('.crunchify-top').click(function(event) {
			event.preventDefault();
			jQuery('html, body').animate({scrollTop: 0}, duration);
			return false;
		})
		
			var isMobile = {
			Android: function() {
				return navigator.userAgent.match(/Android/i);
			},
			BlackBerry: function() {
				return navigator.userAgent.match(/BlackBerry/i);
			},
			iOS: function() {
				return navigator.userAgent.match(/iPhone|iPad|iPod/i);
			},
			Opera: function() {
				return navigator.userAgent.match(/Opera Mini/i);
			},
			Windows: function() {
				return navigator.userAgent.match(/IEMobile/i);
			},
			any: function() {
				return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
			}
		};
		
		if(isMobile.any()) {
			//alert('this is mobile');
			$('#crunchify-top').addClass('crunchify-top-display-important');	
			$('#crunchify-top').removeClass('crunchify-top-hide-important');	
				
		}else{
			//alert('this is not mobile');
			$('#crunchify-top').removeClass('crunchify-top-display-important');
			$('#crunchify-top').addClass('crunchify-top-hide-important');			
			} 
	});
</script>

<script src="<?php echo base_url(); ?>map/application.js"></script>

<script>
jQuery.noConflict();
</script>

<?php /*?><script type="text/javascript" src="//maps.googleapis.com/maps/api/js?v=3.14&key=AIzaSyCDPF-QVSk3S01ASoLgT-bQgpgMIZmaDl8&sensor=false&libraries=geometry&language=en"></script><?php */?>
<!--<script type="text/javascript" src="//maps.googleapis.com/maps/api/js?v=3.14&key=AIzaSyDHWsjEomsjGFW3rtDig5MjC5Ydi63Lj_Q&sensor=false&libraries=geometry&language=en"></script>-->
<!--Reset form height start here-->
<script type="text/javascript" src="//maps.googleapis.com/maps/api/js?v=3.14&key=&sensor=false&libraries=geometry&language=en"></script>
<script src="<?php echo base_url(); ?>assets/scripts/custom/jquery.matchHeight.js" type="text/javascript"></script>
<script src="<?php echo base_url(); ?>assets/scripts/custom/test.js" type="text/javascript"></script>
<script type="text/javascript" src="<?php echo base_url(); ?>assets/plugins/bootstrap-fileinput/bootstrap-fileinput.js"></script> 
<script type="text/javascript">
            (function() {
                /* matchHeight example */
                $(function() {
                    // apply your matchHeight on DOM ready (they will be automatically re-applied on load or resize)
                    // get test settings
                    var byRow = $('body').hasClass('test-rows');
                    // apply matchHeight to each item container's items
                    $('.dobt-form').each(function() {
                        jQuery(this).children('.gr-wrap').matchHeight(byRow);
                    });
                    // Reset Height on Submit form
					$('#submit,#transport_submit,.legs_btn,.edit_legs,#airport_submit,#cancel_g,cancel_a').live('click',function(){
							setTimeout(function(){
							$('.dobt-form').each(function() {
								jQuery(this).children('.gr-wrap').matchHeight(byRow);
							});
						  }, 10);
						  
						   $('.dobt-form').each(function() {
								jQuery(this).children('.gr-wrap').matchHeight(byRow);
							});
						});
						
                	$('.delete-leg').live('click',function(){
					$.fn.matchHeight._update()
					});
            }) });
				
        </script>
<!-- END PAGE LEVEL SCRIPTS -->
<script defer src="<?php echo base_url(); ?>assets/scripts/core/app.js"></script>
<script defer src="<?php echo base_url(); ?>assets/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>

<script type="text/javascript">

function initialize() {
// create the map
	//alert('display map');
	 return Doobert.components.transportation_route.Base = flight.component(function () {
            return this.after("initialize", function () {
                var t = this;
                return void 0 !== Doobert.components.Overlay && Doobert.components.Overlay.attachTo("#main-transportation-route"), 
				 this.trigger("map.initialize", {
                    routeMapSelector: "#route-map"
                })
            })
        }), Doobert.components.transportation_route.Base.attachTo("#main-transportation-route")
	}

	
$(document).ready(function(){

//$(".transport-view-map").html('<i class="fa fa-eye-slash"></i> Hide Map'); 
$("#main-transportation-route").attr("style", "position:relative; display: none;"); 

$( ".map" ).click(function() {
 		if($(".transport-view-map").html() == '<i class="fa fa-eye"></i> View Map')
		{
			//$("#main-transportation-route").height($("#leftheight").height());
			$(".transport-view-map").html('<i class="fa fa-eye-slash"></i> Hide Map');
			$(".transport-view-map").attr('title','Hide Map');	 
			$("#main-transportation-route").attr("style", "position:relative; display: block;"); 	
			initialize();
			
		}
		else if($(".transport-view-map").html() == '<i class="fa fa-eye-slash"></i> Hide Map')
		{
			//$("#main-transportation-route").height($("#leftheight").height());
			$(".transport-view-map").html('<i class="fa fa-eye"></i> View Map');
			$(".transport-view-map").attr('title','View Map');
			$(".view_map_tg").attr('id' , 'grid-view');
			$("#main-transportation-route").attr("style", "position:relative; display: none;"); 
		}
});

$('#leg_deleted').val(0);
var multi_drive = $('#multiple_drivers').prop('checked');
if(multi_drive){
$('#multiple_drivers_txt').val('1');
}else{
$('#multiple_drivers_txt').val('');
}

var multi_pilot = $('#multiple_pilots').prop('checked');
//alert('multi_pilot'+multi_pilot);
if(multi_pilot){
$('#multiple_pilots_txt').val('1');
}else{
$('#multiple_pilots_txt').val('');
}

$('#multiple_drivers').on('click', function() {

var multi_drive = $('#multiple_drivers').prop('checked');
//alert('multi_drive'+multi_drive);
if(multi_drive){
$('#multiple_drivers_txt').val('1');
$('#no_of_drivers_div').show();
$('#meeting_location_div').show();
}else{
$('#no_of_drivers_div').hide();
//$('#meeting_location_div').hide();
$('#multiple_drivers_txt').val('');
$('#no_of_drivers').val('');
$('#meeting_location').val('');
}

});

$('#multiple_pilots').on('click', function() {

var multi_pilot = $('#multiple_pilots').prop('checked');
//alert('multi_pilot'+multi_pilot);
if(multi_pilot){
$('#multiple_pilots_txt').val('1');
$('#no_of_pilots_div').show();
$('#pilot_meeting_location_div').show();
}else{
$('#no_of_pilots_div').hide();
//$('#pilot_meeting_location_div').hide();
$('#no_of_pilots').val('');
$('#multiple_pilots_txt').val('');
}

});


});

function calculateDistance(lat1, lon1, lat2, lon2, unit) {
        var radlat1 = Math.PI * lat1/180
        var radlat2 = Math.PI * lat2/180
        var radlon1 = Math.PI * lon1/180
        var radlon2 = Math.PI * lon2/180
        var theta = lon1-lon2
        var radtheta = Math.PI * theta/180
        var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
        dist = Math.acos(dist)
        dist = dist * 180/Math.PI
        dist = dist * 60 * 1.1515
        if (unit=="K") { dist = dist * 1.609344 }
        if (unit=="N") { dist = dist * 0.8684 }
        return dist
    }
	
// by bhushan for autocomplate 
$('#pickup_location').autocomplete ({
	//source:"<?php echo base_url(); ?>org_transportation/get_zip_code/", 
	source: function (request, response)
    {
		request.term = $.trim(request.term);
		var str	= request.term;
		var letters = /^[a-zA-Z ]+$/;	
		if(str.match(letters))
		{
			request.term = str; 
		} else {
			str = str.toUpperCase();
			request.term = str.replace(/\s/g, ''); 
		}	
        $.ajax(
        {
            url: "<?php echo base_url(); ?>org_transportation/get_zip_code2/" ,
            dataType: "json",
            data:
            {
                term: request.term,
				city: $("#pick_city" ).val(),
				state: $("#pick_state" ).val()
            },
            success: function (data)
            {
				//console.log(data);
				if(data=="1")
				{
					window.location.href="<?php echo base_url() ?>";
				}
				else
				{
                	response(data);
				}
            }
        });
    },
	minLength:1,
	open: function() { $('.ui-menu').width($("#pickup_location" ).width())},
	focus: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			$("#pickup_location" ).val(name);
			$("#pickup_country" ).val(ui.item.st_country);
			country_state(ui.item.st_country,"pick");
			$("#pickup_city" ).val(ui.item.city);
			$("#pickup_state" ).val(ui.item.state_prefix);
			$("#pickup_zip").val(name);
			//alert('value replace');
			return false;
	},     
	select: function( event, ui ) {
		var id = ui.item.label;
		var name = ui.item.value;
		//$("#pick_zip" ).val(name);
		$("#pickup_location" ).val(id);
		$("#pickup_country" ).val(ui.item.st_country);
		country_state(ui.item.st_country,"pick");
		$("#pickup_city" ).val(ui.item.city);
		$("#pickup_state" ).val(ui.item.state_prefix);
		$("#pickup_zip").val(name);
		
		return false;
	}
	});
	
$('#pickup_location').live('change',function(){
//var selected_zipcode = $(this).val();
var selected_zipcode = $.trim($(this).val());
var str	= selected_zipcode; 
//selected_zipcode = str.replace(/\s/g, '');  

var letters = /^[a-zA-Z ]+$/;	
if(str.match(letters))
{
			 selected_zipcode = str; 
} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
}

//alert(selected_zipcode);
//alert($("#pick_city" ).val());
var select_pickup_city = $("#pickup_city" ).val();
//alert(select_pickup_city);
var select_pickup_state = $("#pickup_state" ).val();
//alert(select_pickup_state);
var select_pickup_country = $("#pickup_country" ).val();
//alert(select_pickup_country);
//alert($("#pick_zip").val());
//alert($("#pick_zip").val().indexOf(','));

if ($("#pickup_location").val().indexOf(',') != -1 && $("#pickup_location").val().indexOf('USA') != -1 && $("#pickup_location").val().indexOf('Canada') != -1) {
	if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
	{
		$("#pickup_location").val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
	}
}
else
{
	if(selected_zipcode!=''){
	  $.ajax({
            url: "<?php echo base_url(); ?>org_transportation/get_zip_code2/" ,
            dataType: "json",
            data:
            {
                term: selected_zipcode,
				city: $("#pickup_city" ).val(),
				state: $("#pickup_state" ).val()
            },
            success: function (data)
            {
				//alert(data);
				//alert(data.length);
				console.log(data);
				//console.log(data[0].label);
				if(data)
				{
				$("#pickup_location").val(data[0].label);
				$("#pickup_country" ).val(data[0].st_country);
				country_state(data[0].st_country,"pick");
				$("#pickup_city" ).val(data[0].city);
				$("#pickup_state" ).val(data[0].state_prefix);
				$("#pickup_zip").val(data[0].value);
				}
				else
				{
					if($("#pickup_location").val().indexOf(',') == -1)
					{
						alert('Please enter valid pickup location');
						$("#pickup_location").val('');
					}
				}
				
            }
        });
	}//!=''		
}
});
// for drop off 
$('#dropoff_location').autocomplete ({
	//source:"<?php echo base_url(); ?>org_transportation/get_zip_code/", 
	source: function (request, response)
    {
		request.term = $.trim(request.term);
		var str	= request.term;
		var letters = /^[a-zA-Z ]+$/;	
		if(str.match(letters))
		{
			request.term = str; 
		} else {
			str = str.toUpperCase();
			request.term = str.replace(/\s/g, ''); 
		}	
        $.ajax(
        {
            url: "<?php echo base_url(); ?>org_transportation/get_zip_code2/" ,
            dataType: "json",
            data:
            {
                term: request.term,
				city: $("#dropoff_city" ).val(),
				state: $("#dropoff_state" ).val()
            },
            success: function (data)
            {
				//console.log(data);
				if(data=="1")
				{
					window.location.href="<?php echo base_url() ?>";
				}
				else
				{
                	response(data);
				}
            }
        });
    },
	minLength:1,
	open: function() { $('.ui-menu').width($("#dropoff_location" ).width())},
	focus: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			$("#dropoff_location" ).val(name);
			$("#dropoff_country" ).val(ui.item.st_country);
			country_state(ui.item.st_country,"pick");
			$("#dropoff_city" ).val(ui.item.city);
			$("#dropoff_state" ).val(ui.item.state_prefix);
			$("#dropoff_zip").val(name);
			//alert('value replace');
			return false;
	},     
	select: function( event, ui ) {
		//alert('in select');
		var id = ui.item.label;
		var name = ui.item.value;
		//$("#pick_zip" ).val(name);
		$("#dropoff_location" ).val(id);
		$("#dropoff_country" ).val(ui.item.st_country);
		country_state(ui.item.st_country,"pick");
		$("#dropoff_city" ).val(ui.item.city);
		$("#dropoff_state" ).val(ui.item.state_prefix);
		$("#dropoff_zip").val(name);
		
		return false;
	}
	});
	
$('#dropoff_location').live('change',function(){
//var selected_zipcode = $(this).val();
var selected_zipcode = $.trim($(this).val());
var str	= selected_zipcode; 
//selected_zipcode = str.replace(/\s/g, '');  

var letters = /^[a-zA-Z ]+$/;	
if(str.match(letters))
{
			 selected_zipcode = str; 
} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
}

//alert(selected_zipcode);
//alert($("#pick_city" ).val());
var select_pickup_city = $("#dropoff_city" ).val();
//alert(select_pickup_city);
var select_pickup_state = $("#dropoff_state" ).val();
//alert(select_pickup_state);
var select_pickup_country = $("#dropoff_country" ).val();
//alert(select_pickup_country);
//alert($("#pick_zip").val());
//alert($("#pick_zip").val().indexOf(','));

if ($("#dropoff_location").val().indexOf(',') != -1 && $("#dropoff_location").val().indexOf('USA') != -1 && $("#dropoff_location").val().indexOf('Canada') != -1) {
	if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
	{
		$("#dropoff_location").val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
	}
}
else
{
	if(selected_zipcode!=''){
	  $.ajax({
            url: "<?php echo base_url(); ?>org_transportation/get_zip_code2/" ,
            dataType: "json",
            data:
            {
                term: selected_zipcode,
				city: $("#dropoff_city" ).val(),
				state: $("#dropoff_state" ).val()
            },
            success: function (data)
            {
				//alert(data);
				//alert(data.length);
				console.log(data);
				//console.log(data[0].label);
				if(data)
				{
				$("#dropoff_location").val(data[0].label);
				$("#dropoff_country" ).val(data[0].st_country);
				country_state(data[0].st_country,"drop");
				$("#dropoff_city" ).val(data[0].city);
				$("#dropoff_state" ).val(data[0].state_prefix);
				$("#dropoff_zip").val(data[0].value);
				}
				else
				{
					if($("#dropoff_location").val().indexOf(',') == -1)
					{
						alert('Please enter valid dropoff location');	
						$('#dropoff_location').val('');
					}
				}
				
            }
        });	
	}//!=''		
}
});

// for overnight pick up
$('#o_pickup_location').autocomplete ({
	//source:"<?php echo base_url(); ?>org_transportation/get_zip_code/", 
	source: function (request, response)
    {
		request.term = $.trim(request.term);
		var str	= request.term;
		var letters = /^[a-zA-Z ]+$/;	
		if(str.match(letters))
		{
			request.term = str; 
		} else {
			str = str.toUpperCase();
			request.term = str.replace(/\s/g, ''); 
		}	
        $.ajax(
        {
            url: "<?php echo base_url(); ?>org_transportation/get_zip_code2/" ,
            dataType: "json",
            data:
            {
                term: request.term,
				city: $("#o_pick_city" ).val(),
				state: $("#o_pick_state" ).val()
            },
            success: function (data)
            {
				//console.log(data);
				if(data=="1")
				{
					window.location.href="<?php echo base_url() ?>";
				}
				else
				{
                	response(data);
				}
            }
        });
    },
	minLength:1,
	open: function() { $('.ui-menu').width($("#o_pickup_location" ).width())},
	focus: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			$("#o_pickup_location" ).val(name);
			$("#o_pickup_country" ).val(ui.item.st_country);
			country_state(ui.item.st_country,"pick");
			$("#o_pickup_city" ).val(ui.item.city);
			$("#o_pickup_state" ).val(ui.item.state_prefix);
			$("#o_pickup_zip").val(name);
			//alert('value replace');
			return false;
	},     
	select: function( event, ui ) {
		var id = ui.item.label;
		var name = ui.item.value;
		//$("#pick_zip" ).val(name);
		$("#o_pickup_location" ).val(id);
		$("#o_pickup_country" ).val(ui.item.st_country);
		country_state(ui.item.st_country,"pick");
		$("#o_pickup_city" ).val(ui.item.city);
		$("#o_pickup_state" ).val(ui.item.state_prefix);
		$("#o_pickup_zip").val(name);
		
		return false;
	}
	});
	
$('#o_pickup_location').live('change',function(){
//var selected_zipcode = $(this).val();
var selected_zipcode = $.trim($(this).val());
var str	= selected_zipcode; 

var letters = /^[a-zA-Z ]+$/;	
if(str.match(letters))
{
			 selected_zipcode = str; 
} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
}

//alert(selected_zipcode);
//alert($("#pick_city" ).val());
var select_pickup_city = $("#o_pickup_city" ).val();
//alert(select_pickup_city);
var select_pickup_state = $("#o_pickup_state" ).val();
//alert(select_pickup_state);
var select_pickup_country = $("#o_pickup_country" ).val();
//alert(select_pickup_country);
//alert($("#pick_zip").val());
//alert($("#pick_zip").val().indexOf(','));

if ($("#o_pickup_location").val().indexOf(',') != -1 && $("#o_pickup_location").val().indexOf('USA') != -1 && $("#o_pickup_location").val().indexOf('Canada') != -1) {
	if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
	{
		$("#o_pickup_location").val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
	}
}
else
{
	if(selected_zipcode!=''){
	  $.ajax({
            url: "<?php echo base_url(); ?>org_transportation/get_zip_code2/" ,
            dataType: "json",
            data:
            {
                term: selected_zipcode,
				city: $("#o_pickup_city" ).val(),
				state: $("#o_pickup_state" ).val()
            },
            success: function (data)
            {
				//alert(data);
				//alert(data.length);
				console.log(data);
				//console.log(data[0].label);
				if(data)
				{
				$("#o_pickup_location").val(data[0].label);
				$("#o_pickup_country" ).val(data[0].st_country);
				country_state(data[0].st_country,"pick");
				$("#o_pickup_city" ).val(data[0].city);
				$("#o_pickup_state" ).val(data[0].state_prefix);
				$("#o_pickup_zip").val(data[0].value);
				}
				else
				{
					if($("#o_pickup_location").val().indexOf(',') == -1)
					{
						alert('Please enter valid overnight location');
						$("#o_pickup_location").val('');
					}
				}
				
            }
        });		
	}//!=''
}
});


function country_state(country_name,state_id)
{
			//var country_name = $(this).val();
			//var state_id = $(this).attr('data-address');
			var state_list = '';
			if(country_name == 'USA') {
					state_list += '<option value="">Select</option>';
					state_list += '<?php foreach($this->common_function->state_list as $key=>$val) { ?>';
					state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
					state_list += '<?php } ?>';
				
			} else {
					state_list += '<option value="">Select</option>';
					state_list += '<?php foreach($this->common_function->canadian_state_list as $key=>$val) { ?>';
					state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
					state_list += '<?php } ?>';
					
			}
			$('#'+state_id+'_state').html(state_list);
}
	
//});
// end 	

</script>
<script type="text/javascript">
$(window).resize(function() {
	$('.ui-autocomplete').hide();
});
</script>
<script>
<?php // added by amit ...7-2-2017 #c_date and #c_date1?>
$('#c_date').live('click',function(){
  $('#portlet-config').modal('hide');
});
$('#c_date1').live('click',function(){
	window.location.href="<?php echo base_url();?>org_transportation/draft_transport/";
});

</script>      
<!--Reset form height end here-->


</body>
<!-- END BODY -->
</html>