<?php $base_url = $this->config->item('base_url');
$user_verified = $this->common_model->get_user_verified($this->session->userdata('userid'));
$auto_login_status = $this->common_function->check_auto_login_status();

require $this->config->item('doc_root').'/fbt/facebook/facebook.php';
//require $_SERVER['DOCUMENT_ROOT'].'/fbt/config/fbconfig.php'; 

$facebook = new Facebook(array(
  'appId'  => '1227281144047868',
  'secret' => '0aaa80ceefd34f765da47fbd47cbe42b',
));
 ?>
<!DOCTYPE html>
<html lang="en" class="no-js">
    <!--<![endif]-->
    <!-- BEGIN HEAD --><head>
        <meta charset="utf-8"/>
        <title>Doobert - Animal rescue made simple</title>
		<meta name='robots' content='index,follow' />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        
<?php include APPPATH."views/inc/header-css-js.php";?>
<?php include APPPATH.'views/inc/header.php';?>
<style type="text/css">
#map_canvas {
	max-width:100% !important;
	height: 600px;
}
.bootstrap-select.btn-group .dropdown-menu { min-width:170px !important; }
</style>

<link href="<?php echo base_url(); ?>assets/css/plugins.css" rel="stylesheet" type="text/css"/>
<link rel="stylesheet" type="text/css" href="<?php echo base_url();?>assets/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.css"/>
<section class="breadcrumb">
	<div class="container">
		<div class="text-center">
			<h1 class="entry-title">Animal Shelters in Disaster Areas</h1>
			<a href="<?php echo base_url(); ?>">Home</a><i class="material-icons">arrow_forward</i>Animal Shelters in Disaster Areas
		</div>
	</div>
</section>
<script type="text/javascript" src="https://maps.google.com/maps/api/js?key=<?php echo $this->config->item('googleapi_key'); ?>&sensor=false&libraries=geometry&language=en"></script>
<div id="fb-root"></div>
<script>
window.fbAsyncInit = function() {
    FB.init({
          appId: '<?php echo $facebook->getAppID() ?>',
          cookie: true,
          xfbml: true,
          oauth: true
        });
  };
function fb_login(){
    FB.login(function(response) {
        if (response.authResponse) {
            <?php /*?>access_token = response.authResponse.accessToken; //get access token
            user_id = response.authResponse.userID; //get FB UID<?php */?>
			window.location ='<?php echo $base_url?>fbt/login-facebook.php';
        } else {
            //user hit cancel button
            //console.log('User cancelled login or did not fully authorize.');
        }
    }, {
        scope: 'email'
    });
}
(function() {
    var e = document.createElement('script');
    e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
    e.async = true;
    document.getElementById('fb-root').appendChild(e);
}());
</script> 

<script type="text/javascript">

google.maps.event.addDomListener(window, 'load', initialize);
var rescue_markers = [];	
function initialize() {
	var map;
 	var infoWindow=null;
	var bounds = new google.maps.LatLngBounds();
    var myOptions = {
    //	 scrollwheel: false, 
        zoom:8,
		streetViewControl: false,
        //center: new google.maps.LatLng(41.2324,-98.4160),//43.721759 -79.350428
		center: new google.maps.LatLng(42.458099,-88.519997),
		zoomControlOptions: {
                 //style: google.maps.ZoomControlStyle.SMALL,
				//position: google.maps.ControlPosition.RIGHT_BOTTOM
				position: google.maps.ControlPosition.LEFT_TOP
			},			
       	
    };
	
	map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
	
	map.controls[google.maps.ControlPosition.RIGHT_TOP].push(document.getElementById('sheter_legend'));
	
	//return false;
	//mcluster = new MarkerClusterer(map);
	
	updateRescueMap(map);
	
	
}

function removeMapmarkers(map) {
	
  for (var i = 0; i < rescue_markers.length; i++) {
	rescue_markers[i].setMap(null);
  }

}
function updateRescueMap(map)
{   
	

	//var mclusterOptions = { gridSize: 50,    styles: clusterStyles,    maxZoom: 10};
	
	removeMapmarkers(map);
	var infoWindow = new google.maps.InfoWindow(), marker, i;
	
	var user_type = $('#recent-activity').val();			
	var file_name = $("#my-dropdown").val();
    var txtsearch = $("#txtsearch").val();		
	
	$("#go").click(function(){
	
		removeMapmarkers(map);
		var user_type = $('#recent-activity').val();
		var file_name = $("#my-dropdown").val();
		var txtsearch = $("#txtsearch").val();
		
		if(txtsearch!=''){
		
			var tsearch=txtsearch.split(',')[0];	
			$('#my-dropdown option[value=""]').prop("selected", true);
			
				var retrive_lat_lon = $.ajax({
									type: "POST",
									url: base_url+'animal_shelter/retrive_zip_code',
									data: {
										zip:tsearch,
										//in_id:in_id
										}, 
									async:false,	
									dataType:"json",
									success:function(data) 
									{
									}
								});		
		    var infoWindow = new google.maps.InfoWindow(), marker, i;		
			var map; 	
			var bounds = new google.maps.LatLngBounds();
			var lat_long = retrive_lat_lon.responseJSON;
		    var myOptions = {
		    	//	 scrollwheel: false, 
		        zoom:8,
				streetViewControl: false,
				//center: new google.maps.LatLng(42.458099,-88.519997),				
				center:new google.maps.LatLng(lat_long['lat'], lat_long['lon']),
				zoomControlOptions: {
					position: google.maps.ControlPosition.LEFT_TOP
				},
	    	};
		
			map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
			
			map.controls[google.maps.ControlPosition.RIGHT_TOP].push(document.getElementById('sheter_legend'));
			
			$("#total_user_cnt").html('TOTAL ORGANIZATION: 0');
			
		 	$.ajax({
					type: "POST",
					url: '<?php echo base_url(); ?>animal_shelter/get_user_map_json2',
					cache: false,
					beforeSend: function(){
						  $('#loader').show();
					 },
					data: {user_type:user_type,file_name:file_name,txtsearch:tsearch},
					dataType:'json',
					complete: function(){
					$('#loader').hide();
				    },
					success:function(data){										
						 	
						console.log("test");
						console.log(data);
						if(data=='0'){
						alert('Please enter valid City / Postal Code');			
						}
						if(data.hasOwnProperty('all_zip')){
							$("#total_user_cnt").html('TOTAL ORGANIZATION: '+data.all_zip.length);
							
							for(var i=0; i<data.all_zip.length; i++)
							{  
								if(data.lat[i]!='' && data.lon[i]!='')
								{   
								
									var temp1_lat = JSON.parse(data.lat[i]);
									var temp1_lon = JSON.parse(data.lon[i]); 						
									
									var currentMarkerLat = parseFloat(temp1_lat);
									var currentMarkerLon = parseFloat(temp1_lon);
									
									if(i>0){
									var temp2_lat = JSON.parse(data.lat[i-1]);
									var temp2_lon = JSON.parse(data.lon[i-1]);
									}
								
									if(i>0){
									var existingMarkerLat = parseFloat(temp2_lat);
									var existingMarkerLon = parseFloat(temp2_lon);

									var cur_new_distance = distance(existingMarkerLat, existingMarkerLon, currentMarkerLat, currentMarkerLon,'K');
									
									//if a marker already exists in the same position as this marker
										if (cur_new_distance == 0 || cur_new_distance < 0.01 ) {
											
											var currentMarkerLat = currentMarkerLat + (Math.random() -.5) / 10;// * (Math.random() * (max - min) + min);
											var currentMarkerLon = currentMarkerLon + (Math.random() -.5) / 10;// * (Math.random() * (max - min) + min);
											
										}
									}
														    
									map.setCenter({lat:+data.lat[i], lng:+data.lon[i]});	
									var html_desc = data.pop_up_desc[i];
									var final_html_desc = html_desc.replace(/\\/g, '');	
									var marker = new google.maps.Marker({
									position: new google.maps.LatLng(parseFloat(currentMarkerLat), parseFloat(currentMarkerLon)),							
									map: map,							
									icon: '<?php echo base_url(); ?>assets/img/rescue_map_icon/'+data.img[i],
									zIndex: temp1_lon,
									html: final_html_desc
									});	
									//rescue_markers.push(marker);												
									google.maps.event.addListener(marker, 'click', (function(marker, i){
									return function() {								
										infoWindow.setContent(this.html);
										infoWindow.open(map, marker);
										//bounds.extend(currentMarkerLat);
										//map.fitBounds(bounds);
		                                //map.panToBounds(bounds);				
									  }
								})(marker, i));	
								bounds.extend(marker.getPosition());							
							  }					 
							}
							map.fitBounds(bounds);		
						}
															
					}, 				
			});
			 
		}
			 
		if(txtsearch == ''){  
			 
			
				var retrive_lat_lon = $.ajax({
									type: "POST",
									url: base_url+'animal_shelter/retrive_state_code',
									data: {
										state:file_name,
										//in_id:in_id
										}, 
									async:false,	
									dataType:"json",
									success:function(data) 
									{
									}
								});
			var lat_long = retrive_lat_lon.responseJSON;
			 
			var rescue_markers = [];	
		
			var infoWindow = new google.maps.InfoWindow(), marker, i;			
			
			var map;
			
			var bounds = new google.maps.LatLngBounds();
			var myOptions = {	
				zoom:8,	
				streetViewControl: false,
				center:new google.maps.LatLng(lat_long['lat'], lat_long['lon']),	
				//center: new google.maps.LatLng(42.458099,-88.519997),
				zoomControlOptions: {                
					position: google.maps.ControlPosition.LEFT_TOP
				},	
			};
			
			map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
			
			map.controls[google.maps.ControlPosition.RIGHT_TOP].push(document.getElementById('sheter_legend'));
			$("#total_user_cnt").html('TOTAL ORGANIZATION: 0');
			 
			 	 $.ajax({
					type: "POST",
					url: '<?php echo base_url(); ?>animal_shelter/get_user_map_json',
					cache: false,
					beforeSend: function(){
						  $('#loader').show();
					 },
					data: {user_type:user_type,file_name:file_name},
					dataType:'json',				
					complete: function(){
					$('#loader').hide();
				  },
					success:function(data){
						
						$("#total_user_cnt").html('TOTAL ORGANIZATION: 0');
						
						if(data.hasOwnProperty('all_zip')){
							console.log(data.all_zip.length);
							$("#total_user_cnt").html('TOTAL ORGANIZATION: '+data.all_zip.length);
							for(var i=0; i<data.all_zip.length; i++)
							{  
									
								if(data.lat[i]!='' && data.lon[i]!='')
								{  
									
									var temp1_lat = JSON.parse(data.lat[i]);
									var temp1_lon = JSON.parse(data.lon[i]); 						
									
									var currentMarkerLat = parseFloat(temp1_lat);
									var currentMarkerLon = parseFloat(temp1_lon);					
									
									
									if(i>0){

										
										var temp2_lat = JSON.parse(data.lat[i-1]);
														
										var temp2_lon = JSON.parse(data.lon[i-1]);
										
									}
									if(i>0){
										var existingMarkerLat = parseFloat(temp2_lat);
										var existingMarkerLon = parseFloat(temp2_lon);

										var cur_new_distance = distance(existingMarkerLat, existingMarkerLon, currentMarkerLat, currentMarkerLon,'K');
										
										//if a marker already exists in the same position as this marker
											if (cur_new_distance == 0 || cur_new_distance < 0.01 ) {
												
												var currentMarkerLat = currentMarkerLat + (Math.random() -.5) / 10;// * (Math.random() * (max - min) + min);
												var currentMarkerLon = currentMarkerLon + (Math.random() -.5) / 10;// * (Math.random() * (max - min) + min);
												
											}
									}
								
								
														    
									map.setCenter({lat:+data.lat[i], lng:+data.lon[i]});	
									var html_desc = data.pop_up_desc[i];
									var final_html_desc = html_desc.replace(/\\/g, '');	
									var marker = new google.maps.Marker({
									//position: new google.maps.LatLng(data.lat[i], data.lon[i]),	
									position: new google.maps.LatLng(parseFloat(currentMarkerLat), parseFloat(currentMarkerLon)),						
									map: map,							
									icon: '<?php echo base_url(); ?>assets/img/rescue_map_icon/'+data.img[i],
									zIndex: temp1_lon,
									html: final_html_desc
									});	
									rescue_markers.push(marker);												
									google.maps.event.addListener(marker, 'click', (function(marker, i){
										return function() {								
											infoWindow.setContent(this.html);
											infoWindow.open(map, marker);	
											//bounds.extend(currentMarkerLat);
											//map.fitBounds(bounds);
			                                //map.panToBounds(bounds);			
										  }
									})(marker, i));	
									bounds.extend(marker.getPosition());						
							  	}					 
							}
							map.fitBounds(bounds);
						}											
						//map.fitBounds(bounds);  
					}, 
			 });
		}
	
	});
	
	
	
		var srch	=	"<?php echo isset($_POST['txtsearch'])?$_POST['txtsearch']:'';?>";
		
		var srchstate	=	"<?php echo $this->uri->segment(3);?>";
		if(srchstate == ''){
			var srchstate = "<?php echo $this->session->userdata('ststate');?>";
		}
		
		if(srchstate!='')
		{   $("#my-dropdown option[value='"+srchstate+"']").prop("selected", true);
			var user_type = 0;
			var file_name = srchstate;
			var rescue_markers = [];
			var infoWindow = new google.maps.InfoWindow(), marker, i;			
		
			var map;
		
			var bounds = new google.maps.LatLngBounds();
			var myOptions = {	
			zoom:8,		
			streetViewControl: false,
			center: new google.maps.LatLng(42.458099,-88.519997),
			zoomControlOptions: {
                 //style: google.maps.ZoomControlStyle.SMALL,
				//position: google.maps.ControlPosition.RIGHT_BOTTOM
				position: google.maps.ControlPosition.LEFT_TOP
			},		
			};
		
			map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
		
			map.controls[google.maps.ControlPosition.RIGHT_TOP].push(document.getElementById('sheter_legend'));
			$("#total_user_cnt").html('TOTAL ORGANIZATION: 0');
		 
		 	 $.ajax({
				type: "POST",
				url: '<?php echo base_url(); ?>animal_shelter/get_user_map_json',
				cache: false,
				beforeSend: function(){
					  $('#loader').show();
				 },
				data: {user_type:user_type,file_name:file_name},
				dataType:'json',
				complete: function(){
				$('#loader').hide();
			  },
				success:function(data){							
					console.log("asd2");
					$("#total_user_cnt").html('TOTAL ORGANIZATION: '+data.all_zip.length);
					
					for(var i=0; i<data.all_zip.length; i++)
					{  
						if(data.lat[i]!='' && data.lon[i]!='')
						{   	
						
						
							var temp1_lat = JSON.parse(data.lat[i]);
							var temp1_lon = JSON.parse(data.lon[i]);						
							var currentMarkerLat = parseFloat(temp1_lat);
							var currentMarkerLon = parseFloat(temp1_lon);
							
							if(i>0){
							var temp2_lat = JSON.parse(data.lat[i-1]);
							var temp2_lon = JSON.parse(data.lon[i-1]);
							}
						if(i>0){
							var existingMarkerLat = parseFloat(temp2_lat);
							var existingMarkerLon = parseFloat(temp2_lon);

							var cur_new_distance = distance(existingMarkerLat, existingMarkerLon, currentMarkerLat, currentMarkerLon,'K');
							
							//if a marker already exists in the same position as this marker
								if (cur_new_distance == 0 || cur_new_distance < 0.01 ) {
									//alert('cur_new_distance '+cur_new_distance);
									var currentMarkerLat = currentMarkerLat + (Math.random() -.5) / 10;// * (Math.random() * (max - min) + min);
									var currentMarkerLon = currentMarkerLon + (Math.random() -.5) / 10;// * (Math.random() * (max - min) + min);
									
								}
							}
							
							
												    
							map.setCenter({lat:+data.lat[i], lng:+data.lon[i]});	
							var html_desc = data.pop_up_desc[i];
							var final_html_desc = html_desc.replace(/\\/g, '');	
							var marker = new google.maps.Marker({
							position: new google.maps.LatLng(parseFloat(currentMarkerLat), parseFloat(currentMarkerLon)),							
							map: map,							
							icon: '<?php echo base_url(); ?>assets/img/rescue_map_icon/'+data.img[i],
							zIndex: 9999,
							html: final_html_desc
							});	
							//rescue_markers.push(marker);												
							google.maps.event.addListener(marker, 'click', (function(marker, i){
							return function() {								
								infoWindow.setContent(this.html);
								infoWindow.open(map, marker);	
								//bounds.extend(currentMarkerLat);
								//map.fitBounds(bounds);
                                //map.panToBounds(bounds);			
							  }
						})(marker, i));	
						//bounds.extend(marker.getPosition());						
					  }					 
					}											
				}, 
		 });
			
		
		}
		
		
		
		
		
		if(srch!='')
		{  
			//removeMapmarkers(map);
			var tsearch=srch.split(',')[0];
			
			var user_type = 0;
			var file_name = '';
			var txtsearch = tsearch;
			$('#my-dropdown option[value=""]').prop("selected", true);
			$('#txtsearch').val(srch);
			
			var rescue_markers = [];	
			var infoWindow = new google.maps.InfoWindow(), marker, i;		
			var map; 	
			var bounds = new google.maps.LatLngBounds();
			var myOptions = {
			//	 scrollwheel: false, 
				zoom:8,
				streetViewControl: false,
				//center: new google.maps.LatLng(41.2324,-98.4160),//43.721759 -79.350428
				center: new google.maps.LatLng(42.458099,-88.519997),				
				//mapTypeId: 'roadmap'//google.maps.MapTypeId.TERRAIN
				zoomControlOptions: {
                 //style: google.maps.ZoomControlStyle.SMALL,
				//position: google.maps.ControlPosition.RIGHT_BOTTOM
				position: google.maps.ControlPosition.LEFT_TOP
			},
			};
			
			map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
			
			map.controls[google.maps.ControlPosition.RIGHT_TOP].push(document.getElementById('sheter_legend'));
			
			$("#total_user_cnt").html('TOTAL ORGANIZATION: 0');
			
			
			 $.ajax({
					type: "POST",
					url: '<?php echo base_url(); ?>animal_shelter/get_user_map_json2',
					cache: false,
					beforeSend: function(){
						  $('#loader').show();
					 },
					data: {user_type:user_type,file_name:file_name,txtsearch:txtsearch},
					dataType:'json',
					complete: function(){
					$('#loader').hide();
			  		},
					success:function(data){	
							console.log("asd3");
						if(data=='0'){
						alert('Please enter valid City / Postal Code');			
						}			
						$("#total_user_cnt").html('TOTAL ORGANIZATION: '+data.all_zip.length);
						
						for(var i=0; i<data.all_zip.length; i++)
						{  
							if(data.lat[i]!='' && data.lon[i]!='')
							{   					
							
							
								var temp1_lat = JSON.parse(data.lat[i]);
								var temp1_lon = JSON.parse(data.lon[i]); 						
								
								var currentMarkerLat = parseFloat(temp1_lat);
								var currentMarkerLon = parseFloat(temp1_lon);					
						
						
								if(i>0){
									var temp2_lat = JSON.parse(data.lat[i-1]);
									var temp2_lon = JSON.parse(data.lon[i-1]);
								}
						
								if(i>0){
							var existingMarkerLat = parseFloat(temp2_lat);
							var existingMarkerLon = parseFloat(temp2_lon);

							var cur_new_distance = distance(existingMarkerLat, existingMarkerLon, currentMarkerLat, currentMarkerLon,'K');
							
							//if a marker already exists in the same position as this marker
								if (cur_new_distance == 0 || cur_new_distance < 0.01 ) {
									//alert('cur_new_distance '+cur_new_distance);
									var currentMarkerLat = currentMarkerLat + (Math.random() -.5) / 10;// * (Math.random() * (max - min) + min);
									var currentMarkerLon = currentMarkerLon + (Math.random() -.5) / 10;// * (Math.random() * (max - min) + min);
									
								}
							}
													    
								map.setCenter({lat:+data.lat[i], lng:+data.lon[i]});	
								var html_desc = data.pop_up_desc[i];
								var final_html_desc = html_desc.replace(/\\/g, '');	
								var marker = new google.maps.Marker({
								position: new google.maps.LatLng(parseFloat(currentMarkerLat), parseFloat(currentMarkerLon)),						
								map: map,							
								icon: '<?php echo base_url(); ?>assets/img/rescue_map_icon/'+data.img[i],
								zIndex: 9999,
								html: final_html_desc
								});	
								//rescue_markers.push(marker);												
								google.maps.event.addListener(marker, 'click', (function(marker, i){
								return function() {								
									infoWindow.setContent(this.html);
									infoWindow.open(map, marker);	
									//bounds.extend();
									//map.fitBounds(bounds);
									//map.panToBounds(bounds);			
								  }
							})(marker, i));	
							//bounds.extend(marker.getPosition());							
						  }					 
						}											
					}, 				
			 });
			
		
		}
		if(txtsearch == ''){  
			 
			var rescue_markers = [];	
		
			var infoWindow = new google.maps.InfoWindow(), marker, i;			
			
			var map;
			
			var bounds = new google.maps.LatLngBounds();
			var myOptions = {	
				zoom:8,	
				streetViewControl: false,	
				center: new google.maps.LatLng(42.458099,-88.519997),
				zoomControlOptions: {                
					position: google.maps.ControlPosition.LEFT_TOP
				},	
			};
			
			map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
			
			map.controls[google.maps.ControlPosition.RIGHT_TOP].push(document.getElementById('sheter_legend'));
			$("#total_user_cnt").html('TOTAL ORGANIZATION: 0');
			 
			 	 $.ajax({
					type: "POST",
					url: '<?php echo base_url(); ?>animal_shelter/get_user_map_json',
					cache: false,
					beforeSend: function(){
						  $('#loader').show();
					 },
					data: {user_type:user_type,file_name:file_name},
					dataType:'json',				
					complete: function(){
					$('#loader').hide();
				  },
					success:function(data){	
						console.log(data);
						console.log("asd8");
						
						$("#total_user_cnt").html('TOTAL ORGANIZATION: 0');
						
						if(data){
							console.log(data.all_zip.length);
							$("#total_user_cnt").html('TOTAL ORGANIZATION: '+data.all_zip.length);
							for(var i=0; i<data.all_zip.length; i++)
							{  
									
								if(data.lat[i]!='' && data.lon[i]!='')
								{  
									
									var temp1_lat = JSON.parse(data.lat[i]);
									var temp1_lon = JSON.parse(data.lon[i]); 						
									
									var currentMarkerLat = parseFloat(temp1_lat);
									var currentMarkerLon = parseFloat(temp1_lon);					
									
									
									if(i>0){

										
										var temp2_lat = JSON.parse(data.lat[i-1]);
														
										var temp2_lon = JSON.parse(data.lon[i-1]);
										
									}
									if(i>0){
										var existingMarkerLat = parseFloat(temp2_lat);
										var existingMarkerLon = parseFloat(temp2_lon);

										var cur_new_distance = distance(existingMarkerLat, existingMarkerLon, currentMarkerLat, currentMarkerLon,'K');
										
										//if a marker already exists in the same position as this marker
											if (cur_new_distance == 0 || cur_new_distance < 0.01 ) {
												
												var currentMarkerLat = currentMarkerLat + (Math.random() -.5) / 10;// * (Math.random() * (max - min) + min);
												var currentMarkerLon = currentMarkerLon + (Math.random() -.5) / 10;// * (Math.random() * (max - min) + min);
												
											}
									}
								
								
														    
									map.setCenter({lat:+data.lat[i], lng:+data.lon[i]});	
									var html_desc = data.pop_up_desc[i];
									var final_html_desc = html_desc.replace(/\\/g, '');	
									var marker = new google.maps.Marker({
									//position: new google.maps.LatLng(data.lat[i], data.lon[i]),	
									position: new google.maps.LatLng(parseFloat(currentMarkerLat), parseFloat(currentMarkerLon)),						
									map: map,							
									icon: '<?php echo base_url(); ?>assets/img/rescue_map_icon/'+data.img[i],
									zIndex: temp1_lon,
									html: final_html_desc
									});	
									rescue_markers.push(marker);												
									google.maps.event.addListener(marker, 'click', (function(marker, i){
										return function() {								
											infoWindow.setContent(this.html);
											infoWindow.open(map, marker);	
											//bounds.extend(currentMarkerLat);
											//map.fitBounds(bounds);
			                                //map.panToBounds(bounds);			
										  }
									})(marker, i));	
									bounds.extend(marker.getPosition());						
							  	}					 
							}
						}											
						map.fitBounds(bounds);  
					}, 
			 });
		};

	
			
		 
}


function showmap()
{   
	
	//google.maps.event.addDomListener(window, 'load', initialize);
	var rescue_markers = [];	
	
    var infoWindow = new google.maps.InfoWindow(), marker, i;		
	var user_type = $('#recent-activity').val();
	var file_name = $("#my-dropdown").val();
	var txtsearch = $("#txtsearch").val();
	

	if(txtsearch!=''){
	var tsearch=txtsearch.split(',')[0];
	var map;
 	
	//var bounds = new google.maps.LatLngBounds();
    var myOptions = {
    //	 scrollwheel: false, 
        zoom:8,
		streetViewControl: false,
        //center: new google.maps.LatLng(41.2324,-98.4160),//43.721759 -79.350428
		center: new google.maps.LatLng(42.458099,-88.519997),				
        //mapTypeId: 'roadmap'//google.maps.MapTypeId.TERRAIN
		zoomControlOptions: {
                 //style: google.maps.ZoomControlStyle.SMALL,
				//position: google.maps.ControlPosition.RIGHT_BOTTOM
				position: google.maps.ControlPosition.LEFT_TOP
			},
    };
	
	map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
	
	map.controls[google.maps.ControlPosition.RIGHT_TOP].push(document.getElementById('sheter_legend'));
	
	

	$('#my-dropdown option[value=""]').prop("selected", true);
	 $.ajax({
				type: "POST",
				url: '<?php echo base_url(); ?>animal_shelter/get_user_map_json2',
				cache: false,
				beforeSend: function(){
				  $('#loader').show();
				},
				data: {user_type:user_type,file_name:file_name,txtsearch:tsearch},
				dataType:'json',
				complete: function(){
				$('#loader').hide();
			  },
				success:function(data){	
					console.log("asd6");
					if(data=='0'){
					alert('Please enter valid City / Postal Code');			
					}

					$("#total_user_cnt").html('TOTAL ORGANIZATION: 0');
					if(data){			
						$("#total_user_cnt").html('TOTAL ORGANIZATION: '+data.all_zip.length);
					
						for(var i=0; i<data.all_zip.length; i++)
						{  
							if(data.lat[i]!='' && data.lon[i]!='')
							{   
							
								var temp1_lat = JSON.parse(data.lat[i]);
								var temp1_lon = JSON.parse(data.lon[i]); 						
								
								var currentMarkerLat = parseFloat(temp1_lat);
								var currentMarkerLon = parseFloat(temp1_lon);					
							
							
								if(i>0){
									var temp2_lat = JSON.parse(data.lat[i-1]);
									var temp2_lon = JSON.parse(data.lon[i-1]);
								}
							
								if(i>0){
								var existingMarkerLat = parseFloat(temp2_lat);
								var existingMarkerLon = parseFloat(temp2_lon);

								var cur_new_distance = distance(existingMarkerLat, existingMarkerLon, currentMarkerLat, currentMarkerLon,'K');
								//alert(cur_new_distance);
								//if a marker already exists in the same position as this marker
									if (cur_new_distance == 0 || cur_new_distance < 0.01 ) {
										//alert('cur_new_distance '+cur_new_distance);
										var currentMarkerLat = currentMarkerLat + (Math.random() -.5) / 10;// * (Math.random() * (max - min) + min);
										var currentMarkerLon = currentMarkerLon + (Math.random() -.5) / 10;// * (Math.random() * (max - min) + min);
										
									}
								}
							
							
													    
								map.setCenter({lat:+data.lat[i], lng:+data.lon[i]});	
								var html_desc = data.pop_up_desc[i];
								var final_html_desc = html_desc.replace(/\\/g, '');	
								var marker = new google.maps.Marker({
								position: new google.maps.LatLng(parseFloat(currentMarkerLat), parseFloat(currentMarkerLon)),					
								map: map,							
								icon: '<?php echo base_url(); ?>assets/img/rescue_map_icon/'+data.img[i],
								zIndex: temp1_lon,
								html: final_html_desc
								});	
								rescue_markers.push(marker);												
								google.maps.event.addListener(marker, 'click', (function(marker, i){
								return function() {								
									infoWindow.setContent(this.html);
									infoWindow.open(map, marker);
									//bounds.extend(currentMarkerLat);
									//map.fitBounds(bounds);
	                                //map.panToBounds(bounds);				
								  }
							})(marker, i));	
							bounds.extend(marker.getPosition());							
						  }					 
						}
					}
					map.fitBounds(bounds);										
				}, 				
		 }); 
	
	}

	if(txtsearch ==''){	
	
	google.maps.event.addDomListener(window, 'load', initialize);
	var rescue_markers = [];	
	
	var map; 	
	var bounds = new google.maps.LatLngBounds();
    var myOptions = {
    //	 scrollwheel: false, 
        zoom:8,
		streetViewControl: false,
        //center: new google.maps.LatLng(41.2324,-98.4160),//43.721759 -79.350428
		//center: new google.maps.LatLng(42.458099,-88.519997),				
        //mapTypeId: 'roadmap'//google.maps.MapTypeId.TERRAIN
		zoomControlOptions: {
                 //style: google.maps.ZoomControlStyle.SMALL,
				//position: google.maps.ControlPosition.RIGHT_BOTTOM
				position: google.maps.ControlPosition.LEFT_TOP
			},
    };
	
	map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);	
	map.controls[google.maps.ControlPosition.RIGHT_TOP].push(document.getElementById('sheter_legend'));
	$("#total_user_cnt").html('TOTAL ORGANIZATION: 0');

    var infoWindow = new google.maps.InfoWindow(), marker, i;
	
	 $.ajax({
				type: "POST",
				url: '<?php echo base_url(); ?>animal_shelter/get_user_map_json',
				cache: false,
			    beforeSend: function(){
				  $('#loader').show();
			    },
				data: {user_type:user_type,file_name:file_name},
				dataType:'json',
				complete: function(){
				$('#loader').hide();
			    },
				success:function(data){						 
						console.log("asd7");
					rescue_markers=[];			
					$("#total_user_cnt").html('TOTAL ORGANIZATION: 0');
					if(data){
						$("#total_user_cnt").html('TOTAL ORGANIZATION: '+data.all_zip.length);
						for(var i=0; i<data.all_zip.length; i++)
						{  
							if(data.lat[i]!='' && data.lon[i]!='')
							{   	
							
								var temp1_lat = JSON.parse(data.lat[i]);
								var temp1_lon = JSON.parse(data.lon[i]); 						
								
								var currentMarkerLat = parseFloat(temp1_lat);
								var currentMarkerLon = parseFloat(temp1_lon);					
							
							
								if(i>0){
									var temp2_lat = JSON.parse(data.lat[i-1]);
									var temp2_lon = JSON.parse(data.lon[i-1]);
								}
							
								if(i>0){
								var existingMarkerLat = parseFloat(temp2_lat);
								var existingMarkerLon = parseFloat(temp2_lon);

								var cur_new_distance = distance(existingMarkerLat, existingMarkerLon, currentMarkerLat, currentMarkerLon,'K');
								//alert(cur_new_distance);
								//if a marker already exists in the same position as this marker
									if (cur_new_distance == 0 || cur_new_distance < 0.01 ) {
										//alert('cur_new_distance '+cur_new_distance);
										var currentMarkerLat = currentMarkerLat + (Math.random() -.5) / 10;// * (Math.random() * (max - min) + min);
										var currentMarkerLon = currentMarkerLon + (Math.random() -.5) / 10;// * (Math.random() * (max - min) + min);
										
									}
								}
												    
								map.setCenter({lat:+data.lat[i], lng:+data.lon[i]});	
								var html_desc = data.pop_up_desc[i];
								var final_html_desc = html_desc.replace(/\\/g, '');	
								var marker = new google.maps.Marker({
								position: new google.maps.LatLng(parseFloat(currentMarkerLat), parseFloat(currentMarkerLon)),						
								map: map,							
								icon: '<?php echo base_url(); ?>assets/img/rescue_map_icon/'+data.img[i],
								zIndex: temp1_lon,
								html: final_html_desc
								});	
								rescue_markers.push(marker);												
								google.maps.event.addListener(marker, 'click', (function(marker, i){
								return function() {								
									infoWindow.setContent(this.html);
									infoWindow.open(map, marker);
									//bounds.extend(currentMarkerLat);
									//map.fitBounds(bounds);
	                                //map.panToBounds(bounds);				
								  }
							})(marker, i));	
							bounds.extend(marker.getPosition());								
						  }					 
						}
					}
					map.fitBounds(bounds);  											
				}, 
		 });		
 	 
	}

}
</script>

</head>
<body>


<div id="loader1" style="display:none;"><img src="<?php echo base_url(); ?>assets/img/ajax-modal-loading.gif" width="32" height="32" align="absmiddle">&nbsp;<span id="loadertext">Sending Mail</span></div>

<section class="main-content-wrapper">
        <div class="container">
            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
	               <article>
						<div class="entry-content">
							<div class="sub-content clearfix main-sign-up">
							<p>The shelters indicated on the map below have enabled their Disaster Mode to indicate they are in a disaster area. Please click the pin and the shelter name for special contact information or to request support for an animal in distress in their disaster area.</p>	
								<div class="user-map-wrap marb20" id="map_wrap" > 
									<form name="rescue_map_frm" id="rescue_map_frm" action="<?php echo base_url(); ?>animal_shelter/" method="post" class="form-horizontal form-row-seperated">
          								<div class="transports_map user-map rescue-map">
            								<div class="col-md-12 no-space select-box-wrp">								                   
              									<div class="form-group">
                  									<label class="show" for="my-dropdown">State:</label>
		                  								<div class="select-style">
		                  									<select class="form-control" id="my-dropdown" name="state"> 
		                  										<option value="">Select</option>                 
												                    <?php
												                    $state = ""; 
																   foreach($state_list as $key=>$value)
																   { 
																		if($this->input->post('state')!=''){
																		?>
																		<option  <?php echo ($this->input->post('state') == $key)?'selected':''; ?>  value="<?php echo $key;?>"><?php echo $value;?></option>
																		<?php 
																		}
																		else{?>
																		 <option  <?php echo ($key== $state)?'selected':''; ?>  value="<?php echo $key;?>"><?php echo $value;?></option>
							 
																  <?php
																  }
																   }
																   ?>
												            </select>
						  								</div>
                								</div>   
	                							<div class="form-group show-or-info">
	                 								<label class="show" style="font-size:18px; padding:8px 0 0">OR</label> 
	                 							</div>      
            								</div>
           								</div>
          								<input type="hidden" name="frm_action"  id="frm_value"> <!--value="frm_value"-->
								        <input type="hidden" name="total_all_org_files"  id="total_all_org_files" value="<?php echo $total_all_org_files; ?>">
								        <input type="hidden" name="total_non_doobert_org_files"  id="total_non_doobert_org_files" value="<?php echo $total_non_doobert_org_files; ?>">
								        <input type="hidden" name="total_org_files"  id="total_org_files" value="<?php echo $total_org_files; ?>">                                
         
          
        
          <div class="col-md-12 no-space select-box-wrp form-city-map" >
          <div class="form-group">
                  <input type="text" class="form-control" placeholder="Enter From City, State or Zip" id="txtsearch" name="txtsearch"  <?php if(isset($_POST['txtsearch']) && $_POST['txtsearch']!=''){ echo 'selected';} ?>>
                </div>
          </div>             
            <input type="button" value="Go" name="go" id="go" class="go-button">
          
          
            <span class="total-user" id="total_user_cnt">TOTAL ORGANIZATION: </span>
          <div class="clearfix"></div>
        </form>
        
        <div class="clearfix"></div>
        <div class="img_map_wrp">
          <div id="avia-route">
            <div id="my-leg">
              <div id="map_canvas">
              <div id="loader"><img src="<?php echo base_url(); ?>assets/img/ajax-modal-loading.gif" width="100" height="100" align="absmiddle">&nbsp;<span id="loadertext">Loading...</span></div>
            
              </div>                                
              </div>
            </div>
          </div>
        </div>
        
   		</div><!-- .entry-content -->
					</article><!-- #post-## -->
                </div>
            </div>
			<div class="col-md-12 col-sm-12 col-xs-12 text-center marb20">
				<a data-toggle="modal" href="javascript:void(0);"  onclick="request_trans_assist();" class="btn white-btn">Request Transport Assistance</a>
			</div>
        </div>
		</div>
</section> 
        
<a href="#" class="crunchify-top" id="crunchify-top" title="Top" style="bottom: 12rem;">&#8593;Top</a>     
      
<div id="responsive">
            <div class="modal fade" id="map-user-contact" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false" style="z-index:9999;">
                    <div class="modal-dialog">
                        <form class="horizontal-form" role="form" id="send-request" name="send_request" action="" method="post">
                            <!--<input type="hidden" id="contact_name" name="contact_name" value="">
                            <input type="hidden" id="contact_email2" name="contact_email" value="">
							<input type="hidden" id="org_id" name="org_id" value="">-->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button aria-hidden="true" data-dismiss="modal" class="close empty_dates" type="button" title="Close" id="close_button"></button>
                                    <h4 class="modal-title">Request Transport Assistance</h4>
                                </div>							
                                <div class="modal-body">
									<div class="form-group col-md-12 padl0 padr0">
                                       <input id="pickup_zip" name="pickup_zip"  class="form-control w100p" Placeholder="Enter Pickup location *">
                                    </div>
									<div class="form-group col-md-12 padl0 padr0">
                                       <input id="dropoff_zip" name="dropoff_zip"  class="form-control w100p" Placeholder="Enter Dropoff location *">
                                    </div>
                                    <div class="form-group col-md-12 padl0 padr0">
                                       <input id="user-name" name="user-name"  class="form-control w100p" maxlength='50' Placeholder="Enter Your Name *">
                                    </div>
									<div class="form-group col-md-12 padl0 padr0">
                                       <input type="tel" id="pphone" name="pphone" class="form-control w100p" >
                                    </div>
									<div class="form-group col-md-12 padl0 padr0">
                                       <input id="user-email" name="user-email" class="form-control w100p" maxlength='50' Placeholder="Enter Your Email *">
                                    </div>
                                    <div class="form-group col-md-12 padl0 padr0">
                                       <textarea id="contactmessage" name="contactmessage" rows="3" class="form-control" maxlenght="500" Placeholder="Enter Your Message *" ></textarea>
                                    </div>
                                    <div class="form-group col-md-12 padl0 padr0 btm-button marb0">
                                            <a href="javascript:void(0);" class="btn btn-big orange waves-effect waves-light" id="send_request_btn1" >Send</a>
                                           <!-- <input type="submit" class="btn orange mart20 fr wht"  id="send_request_btn" value="Send">-->
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </form>
                        <!-- /.modal-content --> 
                    </div>
                    <!-- /.modal-dialog --> 
                       
                    
</div>
              
           
<!-- BEGIN THANK YOU MODAL POPUP-->
            <div class="modal fade" id="thankyou-config" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="z-index:9999;">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header"> 
                            <button aria-hidden="true" data-dismiss="modal" class="close" type="button"></button>
                            <h4 class="modal-title">THANK YOU</h4>
                        </div>
                        <div class="modal-body"><h5>Mail sent successfully.</h5></div>
                        <div class="modal-footer text-center no-margin"><a class="btn black waves-effect waves-light" data-dismiss="modal" title="Close">Close</a> </div>
                        </div>

                    </div>
                    <!-- /.modal-content --> 
                </div>
                <!-- /.modal-dialog --> 
            </div>
<!-- END THANK YOU MODAL POPUP-->
			
<!-- END PAGE LEVEL SCRIPTS --> 
<?php include APPPATH.'views/inc/footer.php';?>
<script type="text/javascript" src="<?php echo base_url(); ?>assets/plugins/jquery.ui.touch-punch.js"></script>
<script type='text/javascript' src='<?php echo $base_url; ?>js/jquery.mask.min.js'></script>  
<!-- END PAGE LEVEL SCRIPTS --> 
<script>
$(document).ready(function(e) {
$('#pphone').mask('(999) 999-9999',{placeholder: "(___) ___-____"},{'translation': {0: {pattern: /[0-9*]/}}});
$('#txtsearch').autocomplete({ 
	
	source: function (request, response)
    {
			var term= request.term;
		 
			term = $.trim(term);
			var str	= term;
			var letters = /^[a-zA-Z ]+$/;	
			if(str.match(letters))
			{
				request.term = str; 
			} else {
				str = str.toUpperCase();
				request.term = str.replace(/\s/g, ''); 
			}		
		$.ajax({
            //url: "<?php echo base_url(); ?>partner/get_zip_code/",
			url:"<?php echo base_url(); ?>org_transportation/get_zip_code2/",
            dataType: "json",
            data:
            {
				term: request.term,
            },
            success: function (data)
            {  			
				$('#my-dropdown option[value=""]').prop("selected", true);            	
                response(data);				
            }
        });
	  
    },
	minLength:1,
	delay: 0,
	open: function() { $('.ui-menu').width($("#txtsearch" ).width())},
	focus: function( event, ui )
	{
			var id = ui.item.label;
			var name = ui.item.value;
			$("#txtsearch" ).val(id);			
			return false;
	},     
	select: function( event, ui ) 
	{ 
		var id = ui.item.label;
		var name = ui.item.value;		
		$("#txtsearch" ).val(id);
		return false;		
	}	
	});	
	
	
$(document).on('change', '#txtsearch', function(){

var selected_zipcode = $.trim($(this).val());
var str	= selected_zipcode; 
var letters = /^[a-zA-Z ]+$/;	
if(str.match(letters))
{
			 selected_zipcode = str; 
} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
} 
	
	if(selected_zipcode!=''){ 
	
			$.ajax({
            //url: "<?php echo base_url(); ?>partner/get_zip_code/",
			url:"<?php echo base_url(); ?>org_transportation/get_zip_code2/",
            dataType: "json",
            data:
            {  
                term: selected_zipcode,			
				
            },
            success: function (data)
            {
				
				
				if(data && data!='NULL')
				{  
					$("#txtsearch").val(data[0].label);
				}
				else
				{
					if($("#txtsearch").val().indexOf(',') == -1)
					{
						alert('Please enter valid zipcode');	
						$("#txtsearch").val('');	
					}
				}
            }
        });	
		
  }
});

});
</script>
<script>
function request_trans_assist()
{
	<?php if($this->session->userdata('userid')) { ?>
		$.ajax({
				type: "POST",
				url: '<?php echo base_url(); ?>animal_shelter/get_user_info',
				async:false,
				success:function(data){
					var data = $.parseJSON(data);
					if(data.success == 1)
					{
						$('#user-name').val(data.name);
						$('#pphone').val(data.phone);
						$('#pphone').mask('(999) 999-9999');
						$('#user-email').val(data.email);
					}
				}, 
			   });
	<?php } ?>
	$('#map-user-contact').modal('show');
}
</script>
<script>
      jQuery(document).ready(function() {       
           // initiate layout and plugins
           //App.init();
          // ComponentsDropdowns.init();
		});
	
	jQuery(document).ready(function() {
		var offset = 700;
		var duration = 250;
		jQuery(window).scroll(function() {
			if (jQuery(this).scrollTop() > offset) { 
				jQuery('.crunchify-top').fadeIn(duration);
			} else {
				jQuery('.crunchify-top').fadeOut(duration);
			}
		});
 
		jQuery('.crunchify-top').click(function(event) {
			event.preventDefault();
			jQuery('html, body').animate({scrollTop: 0}, duration);
			return false;
		})
		
			var isMobile = {
			Android: function() {
				return navigator.userAgent.match(/Android/i);
			},
			BlackBerry: function() {
				return navigator.userAgent.match(/BlackBerry/i);
			},
			iOS: function() {
				return navigator.userAgent.match(/iPhone|iPad|iPod/i);
			},
			Opera: function() {
				return navigator.userAgent.match(/Opera Mini/i);
			},
			Windows: function() {
				return navigator.userAgent.match(/IEMobile/i);
			},
			any: function() {
				return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
			}
		};
		
		if(isMobile.any()) {
			//alert('this is mobile');
			//$('#crunchify-top').addClass('crunchify-top-display-important');	
			//$('#crunchify-top').removeClass('crunchify-top-hide-important');	
				
		}else{
			//alert('this is not mobile');
			$('#crunchify-top').removeClass('crunchify-top-display-important');
			$('#crunchify-top').addClass('crunchify-top-hide-important');			
			} 
	});

	   
			
		
		
		function contactUser2(uid)
		{	 
		   
		$.ajax({
				type: "POST",
				url: '<?php echo base_url(); ?>animal_shelter/get_user_details',
				beforeSend: function(){
				$('#loader').show();
				},
				data: {uid:uid ,role:'org'},	
				 // data : { },
					dataType:'json',
					complete: function(){
					$('#loader').hide();
					},
					success:function(data){
					
						if(data.success == 1){
						//$('.modal-title').html('Contact Request to ' + data.name + '<span class="required-filed">*</span>')
							$('.modal-title').html('Contact Request to ' + data.name + '')
							$('#contact_name').val(data.name);
							$('#contact_email2').val(data.email);
							$('#user-name').val(data.fromname);
							$('#user-email').val(data.fromemail);
							$('#org_id').val(data.id);
							$('#map-user-contact').modal('show');
						}
					}, 
					//return true;
			   });
			}
		
			   
		//$('#send_request_btn').on('click', function (){ 
		
		$(document).on('click', '#send_request_btn1', function()
		{
			var mess='';
			mess = $('#contactmessage').val(); 
			var username = $("#user-name").val();
			var useremail = $("#user-email").val();				
			//var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
			var emailReg = /^([\w-\.\+]+@([\w-]+\.)+[\w-]{2,4})?$/;
			var pickup_zip = $("#pickup_zip").val();
			var dropoff_zip = $("#dropoff_zip").val();
			var org_id      = $('#org_id').val();
			var phone_no = $('#pphone').val();
			var flag = 1;
			var error_message = '';		
			if(pickup_zip == '')
			{
				flag =0;
				error_message += 'Please enter pickup location. \n';
			}
			if(dropoff_zip == '')
			{
				flag =0;
				error_message += 'Please enter dropoff location. \n';
			}
			if(username == '')
			{
				flag =0;
				error_message += 'Please enter name. \n';
			}
			if(useremail == '')
			{
				flag =0;
				error_message += 'Please enter Email address. \n';
			}
			if(phone_no!='')
			{
				  var a = /^(1\s|1|)?((\(\d{3}\))|\d{3})(\-|\s)?(\d{3})(\-|\s)?(\d{4})$/.test(phone_no);
				  if(a==false)
				  {
					  flag =0;
					  error_message += 'Please enter valid telephone Number. \n';
				  }	  
			}		
			if(!emailReg.test( useremail ))
			{
				flag =0;
				error_message += 'Please enter valid email address. \n';
			}
			if(mess == '')
			{
				flag =0;
				error_message += 'Please enter your message. \n';
			}	


					if(flag == 1)
					{
						var name  = $('#contact_name').val();
	                    var email = $('#contact_email2').val();	
					
												
						 $.ajax({
								type: "POST",
								url: '<?php echo base_url(); ?>animal_shelter/map_send_mail',
								beforeSend: function(){
								$('#map-user-contact').modal('hide');	
								//$.modal.close();
								//$('#user-contact').hide();
								//$.modal.close();
								$('#loader1').show();
								},
								data: {phone_no:phone_no,contactmessage:mess, username:username, useremail:useremail,pickup_zip:pickup_zip,dropoff_zip:dropoff_zip},
			
								dataType:'json',
			  					complete: function(){
								$('#loader1').hide();
				    			},
								  success:function(data){ 								  		
									if(data.success == 1) 
										$('#map-user-contact').modal('hide');
										//$('.modal-title').html('Thank You')	
										$('#contactmessage').val('');
														
										$("#user-name").val('');
										$("#user-email").val('');
										$("#pickup_zip").val('');
										$("#dropoff_zip").val('');
										$("#pphone").val('');
										$('#thankyou-config').modal('show');
								}, 
                        //return true;
						 });
                    }else{ 
							alert(error_message);
					}	
		});
		
		
		  
	
	function validateEmail(email) {
    var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    return re.test(email);
}	
$(document).on('click', '#close_button', function(){
		$('#user-name').val('');
		$('#user-email').val('');
		$('#contactmessage').val('');
		$('#pphone').val('');
		$('#pickup_zip').val('');
		$('#dropoff_zip').val('');
	});
</script>

<script type="text/javascript">
$("#my-dropdown").on("change", function () {
   $('#txtsearch').val('');
});




function distance(lat1, lon1, lat2, lon2, unit) {
	var radlat1 = Math.PI * lat1/180
	var radlat2 = Math.PI * lat2/180
	var radlon1 = Math.PI * lon1/180
	var radlon2 = Math.PI * lon2/180
	var theta = lon1-lon2
	var radtheta = Math.PI * theta/180
	var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
	dist = Math.acos(dist)
	dist = dist * 180/Math.PI
	dist = dist * 60 * 1.1515
	if (unit=="K") { dist = dist * 1.609344 }
	if (unit=="N") { dist = dist * 0.8684 }
	return dist
} 

</script>
<script>
$(document).ready(function(e) {

$('#pickup_zip').autocomplete({ 
	
	source: function (request, response)
    {
			var term= request.term;
		 
			term = $.trim(term);
			var str	= term;
			var letters = /^[a-zA-Z ]+$/;	
			if(str.match(letters))
			{
				request.term = str; 
			} else {
				str = str.toUpperCase();
				request.term = str.replace(/\s/g, ''); 
			}		
		$.ajax(
        {
            url: "<?php echo base_url(); ?>animal_shelter/get_zip_code/",
            dataType: "json",
            data:
            {
				  term: request.term,
            },
            success: function (data)
            {  	
				if(data=="1")
				{

				}
				else
				{
					$('#my-dropdown option[value=""]').prop("selected", true);
                	response(data);
				}				
            }
        });
	  
    },
	minLength:1,
	delay: 0,
	open: function() { $('.ui-menu').width($("#pickup_zip" ).width())},
	focus: function( event, ui ){
			var id = ui.item.label;
			var name = ui.item.value;
			$("#pickup_zip" ).val(id);		
			return false;
	},     
	select: function( event, ui ) { 
		var id = ui.item.label;
		
		var name = ui.item.value;		
		$("#pickup_zip" ).val(id);
		return false;		
	}	
	});	
	
	
$(document).on('change', '#pickup_zip', function(){
var selected_zipcode = $.trim($(this).val());
var str	= selected_zipcode; 
 
 $.ajax({
			url: "<?php echo base_url(); ?>animal_shelter/get_zip_code/",
            dataType: "json",
            data:
            {  
                term: selected_zipcode,	
            },
            success: function (data)
            {
				
				
				if(data && data!='NULL')
				{  
				$("#pickup_zip").val(data[0].label);
				//$("#pick_country" ).val(data[0].st_country);
				//country_state(data[0].st_country,"pick");
				}
				else
				{
					if($("#pickup_zip").val().indexOf(',') == -1)
					{
						alert('Please enter valid zipcode');	
						$("#pickup_zip").val('');	
					}
				}
            }
        });	
});

});
</script>
<script>
$(document).ready(function(e) {

$('#dropoff_zip').autocomplete({ 
	
	source: function (request, response)
    {
			var term= request.term;
		 
			term = $.trim(term);
			var str	= term;
			var letters = /^[a-zA-Z ]+$/;	
			if(str.match(letters))
			{
				request.term = str; 
			} else {
				str = str.toUpperCase();
				request.term = str.replace(/\s/g, ''); 
			}		
		$.ajax({
            url: "<?php echo base_url(); ?>animal_shelter/get_zip_code/",
            dataType: "json",
            data:
            {
				  term: request.term,
            },
            success: function (data)
            {  	
				if(data=="1")
				{
				}
				else
				{
					$('#my-dropdown option[value=""]').prop("selected", true);
                	response(data);
				}			
            }
        });
	  
    },
	minLength:1,
	delay: 0,
	open: function() { $('.ui-menu').width($("#dropoff_zip" ).width())},
	focus: function( event, ui ){
			var id = ui.item.label;
			var name = ui.item.value;
			$("#dropoff_zip" ).val(id);		
			return false;
	},     
	select: function( event, ui ) { 
		var id = ui.item.label;
		
		var name = ui.item.value;		
		$("#dropoff_zip" ).val(id);
		return false;		
	}	
	});	
	
	
$(document).on('change', '#dropoff_zip', function(){
var selected_zipcode = $.trim($(this).val());
var str	= selected_zipcode; 
 
 $.ajax({
			url: "<?php echo base_url(); ?>animal_shelter/get_zip_code/",
            dataType: "json",
            data:
            {  
                term: selected_zipcode,	
            },
            success: function (data)
            {
				if(data && data!='NULL')
				{  
					$("#dropoff_zip").val(data[0].label);
				}
				else
				{
					if($("#dropoff_zip").val().indexOf(',') == -1)
					{
						alert('Please enter valid zipcode');	
						$("#dropoff_zip").val('');	
					}
				}
            }
        });	
});

});

</script>

<!-- END GOOGLE RECAPTCHA --> 
<!-- END JAVASCRIPTS -->
</body>
</html>