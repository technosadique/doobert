<?php $base_url = $this->config->item('base_url');
/*
$check_user_arpa = $this->common_model->check_arpa_certifcate_status($this->session->userdata('userid'));
$user_verified = $this->common_model->get_user_verified($this->session->userdata('userid'));
$common_profile = $this->common_function->get_user_profile($this->session->userdata('userid'));
$default_org_url = '';
*/
$org_list =  $this->common_model->get_organization_list();

$request_board_status = $this->common_model->transport_routing_enable($this->session->userdata('userid'));

$invitation_count = $this->common_function->pending_invitation_cnt($this->session->userdata('userid'));
$invitation_name = $this->common_function->pending_invitation_name($this->session->userdata('userid'));	

//My Notification Count
	if($this->router->class == 'user_settings_and_notification' && $this->router->method == 'my_notifications') {  
		$data['user_visit_data'] = array('in_user_id'			=>	$this->session->userdata('userid'),
										 'st_visit_type'		=>	'MYNOTIFICATIONS',
										 'st_ip_address'		=>	$this->input->ip_address(),
										 'dt_created'			=>	date('Y-m-d H:i:s')
										);
		$data['visit_created'] = $this->common_model->insert_last_visit_date($data['user_visit_data']);
	}
	$data['created_date_user'] = $this->common_model->last_visit_date_front($this->session->userdata('userid'),'MYNOTIFICATIONS');
	//print_r($data['created_date_user']);die;
	
	if(!empty($data['created_date_user'])) { 
		$pending_notifications_front = $this->common_function->pending_notifications_message($this->session->userdata('userid'),$data['created_date_user']['dt_created']);		
		//print_r($pending_notifications_front);die;
		
	} else { 
		$pending_notifications_front = $this->common_function->pending_notifications_message($this->session->userdata('userid'));
		
	}


?>

<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<title>Volunteer Dashboard</title>
<?php include 'includes/modern/header.php';?>

<?php 
$picture = $common_profile['st_profile_image'];
//print_r($picture);exit;
$profile_image = '';
if(trim($picture) != '' && file_exists($this->config->item('upload').'profile/250x250/'.$picture)) 
{
	$profile_image = $picture;
	$user_profile_src = $this->config->item('upload_url').'profile/250x250/'.$profile_image; 
} else {
	$profile_image = 'no_photo_icon.png';
	$user_profile_src = $this->config->item('upload_url').'profile/250x250/'.$profile_image; 
}
?>

<style>
.loadmr{
	background-color: #ec6e34;
    font: 400 20px 'Roboto', sans-serif !important;
    color: #fff !important;
    border-radius: 6px;
    padding: 10px 50px;
    display: table;
    margin: 10px auto;
    text-transform: uppercase;
    clear: both;
    text-decoration: none;
}
.ui-widget-content{ width:227px !important;}
</style>
<link rel="stylesheet" type="text/css" href="<?php echo base_url();?>assets/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.css"/>
</head>

<body>
	<div id="wrapper" class="dashboard">
		<header id="header-info">
			<div class="container">
			
			
				<div class="dashboard-left-cont">
					<div class="doobertverify">
						  <?php if(empty($user_verified)) { ?>
							<a href="<?php echo base_url(); ?>verification/verify/"><img src="<?php echo base_url()."assets/img/doobert-verified-inactive.png" ?>" alt="Doobert Non Verified"></a>						
							
							<?php } else { ?>
							<a href="<?php echo base_url(); ?>user/verify_status/"><img src="<?php echo base_url()."assets/img/doobert_verified1.png" ?>" alt="Doobert Verified" title="<?php 					
							
							if(isset($user_verified['dt_doobert_verified']) && !empty($user_verified['dt_doobert_verified']) && $user_verified['dt_doobert_verified'] != '0000-00-00')
							{
							   echo date('F d, Y',strtotime($user_verified['dt_doobert_verified']));
							}
							else
							{
							  echo '';
							}
							
							?>"></a>							
							<?php } ?>		
					
					</div>
					<div class="arpaverify">
						<?php if(!empty($check_user_arpa['st_arpa_cert']) && $check_user_arpa['st_arpa_cert'] =='Y') { ?>
						<a href="<?php  echo $base_url; ?>user/verified_arpa/"> <img src="<?php echo base_url().'assets/img/arpa-app_rescue_transporter.png'; ?>" title="Certified Animal Rescue Transporter" /></a>
						<?php } else { ?>
						<a target='_blank' data-toggle="modal" href="#infoarpapopup"><img src="<?php echo base_url().'assets/img/arpa-app_rescue_transporter_grey.png'; ?>"  /></a>						
						<?php } ?>
						
						<?php if(!empty($check_user_arpa['st_arpa_cert_foster']) && $check_user_arpa['st_arpa_cert_foster'] =='Y') { ?>
						<a href="<?php  echo $base_url; ?>user/verified_arpa/"> <img src="<?php echo base_url().'assets/img/arpa-app_foster-home.png'; ?>" title="Certified Foster Home" /></a>
						<?php } else { ?>
						<a target='_blank' data-toggle="modal" href="#infoarpapopup"><img src="<?php echo base_url().'assets/img/arpa-app_foster-home_grey.png'; ?>"  /></a>						
						<?php } ?>
						
						<?php if(!empty($check_user_arpa['st_arpa_cert_tnr']) && $check_user_arpa['st_arpa_cert_tnr'] =='Y') { ?>
						<a href="<?php  echo $base_url; ?>user/verified_arpa/"> <img src="<?php echo base_url().'assets/img/arpa-app_tnr_professional.png'; ?>" title="Certified TNR Professional" /></a>
						<?php } else { ?>
						<a target='_blank' data-toggle="modal" href="#infoarpapopup"><img src="<?php echo base_url().'assets/img/arpa-app_tnr_professional_grey.png'; ?>"  /></a>						
						<?php } ?>
					</div>
					<div class="br"></div>
				</div>
				
<?php 
$bubblecount='';
$bubblecount =  $pending_notifications_front['count'] + $invitation_count;
?>		

				<div class="clearfix dashboard-right-cont">
					<nav class="navbar navbar-inverse">
						<div class="container-fluid">
							<div class="navbar-header">
								<button type="button" class="overlay">
                            	<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
                        		</button>							
							</div>
							<div class="overlayp" id="myNavbar">
								<div class="menu-menu-1-container">
									<ul id="primary-menu" class="menu">
										<li><a href="<?php echo $base_url;?>shop/" target="_blank"><img src="<?php echo $base_url;?>modernview/images/icon_shopping.png" alt="shop" title="shop"/></a></li>
										
										<li><a href="javascript:void(0);" class="notification-info dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true" title="Notification"><img src="<?php echo $base_url;?>modernview/images/icon_notification.png" alt=""/><?php if($bubblecount > 0){?><span class="red-circle"><?php echo $bubblecount;?></span><?php } ?></a><ul class="dropdown-menu notification-menu"><li class="notification-heading">You have <?php echo $invitation_count;?> <span style="font-weight:600;font-style:italic;">PENDING INVITATIONS</span></li>
<?php if(isset($invitation_count) && $invitation_count > 0)	{ ?>
<?php  foreach($invitation_name as $key => $value) { ?>	
<li class="pending-invet"><i class="material-icons">keyboard_arrow_right</i><?php echo $value['st_org_name']; ?></li>	
<?php } }?>
		
<li class="view-all"><a href="<?php echo base_url().'pending_invitation'; ?>">View All<i class="material-icons">keyboard_arrow_right</i></a></li>
<li class="other-notification-heading">You have <?php echo $pending_notifications_front['count']; ?> <span style="font-weight:600;font-style:italic;">OTHER NOTIFICATIONS</span></li>
	
	
<?php 
if((count($pending_notifications_front['notification_msg'])>0) && is_array($pending_notifications_front['notification_msg'])) { 
?>
<?php foreach($pending_notifications_front['notification_msg'] as $key => $value) { ?>	
<li class="pending-notification"><span><div class="">
<span><?php echo $value;?></div> </span></li>
<?php }} ?>
							
							
<li class="view-all"><a href="<?php echo base_url(); ?>notification/">View All<i class="material-icons">keyboard_arrow_right</i></a></li>

<?php if($bubblecount > 0){?>
<li class="view-all"><a href="javascript:void(0);" class="markallread">Mark All Read</a></li>
<?php } ?>

</ul></li>
										<li class="right"><a href="#search-info-box" data-toggle="modal" title="Search" class="search"><i class="material-icons font-31" >search</i></a></li>
										<li class="orgd"><a href="<?php echo base_url();?>dashboard_modern/" title="My Dashboard"><i class="material-icons" title="My Dashboard">dashboard</i><span>My Dashboard</span></a></li>
										
										
										<li class="last dropdown dropdown-user">
											<a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
											<img id="fileupload" src="<?php echo $user_profile_src; ?>" alt="noravmotta User" title="<?php echo $common_profile['st_display_name'].' '.$common_profile['st_last_name']; ?>"><i class="material-icons">keyboard_arrow_down</i></a>										
											<ul class="dropdown-menu dropdown-menu-default">
												<li><a href="<?php echo $base_url.'notification-overview/'; ?>">Notifications</a></li>
												
												<?php	if($this->session->userdata('userid')){ ?>
											<li><a href="<?php echo base_url(); ?>profile-privacy-setting/" class="">Privacy Settings</a></li>
											<?php } ?>
												<?php if(isset($common_profile['st_facebook_uid']) && !empty($common_profile['st_facebook_uid'])) { ?>
												<li><a  href="javascript:void(0);" onclick="javascript:window.open('<?php echo $base_url;?>fbt/link-facebook.php','Facebook','location=yes,menubar=yes,resizable=yes,scrollbars=yes,status=no,toolbar=no,top=200,left=400,width=1000,height=500');">Link Facebook</a></li>
												<?php } else { ?>
												<li><a  href="javascript:void(0);" onClick="javascript:window.open('<?php echo $base_url?>fbt/link-facebook.php','Facebook','location=yes,menubar=yes,resizable=yes,scrollbars=yes,status=no,toolbar=no,top=200,left=400,width=1000,height=500');">Link Facebook</a></li>
											<?php } ?>
												<li><a href="<?php echo $base_url.'account-setting/'; ?>">Update Email/Password</a></li>
												<li><a href="<?php echo $base_url.'my-account-settings/'; ?>">Account Settings</a></li>
												<li><a href="<?php echo $base_url.'my-transportation-history/'; ?>">Charitable Tracking</a></li>
												<?php /* ?>
												<?php if(isset($request_board_status) && $request_board_status == 2) { ?>
											<li><a  href="<?php echo $base_url.'org_transportation/submitted_routing_request'; ?>">TC Request Board</a></li>
											<?php } else if(isset($request_board_status) && $request_board_status ==1) { ?>
											<li><a href="<?php echo $base_url.'org_transportation/request_assigned_to_me'; ?>">TC Request Board</a></li>
											<?php } ?>
											<?php */ ?>
											<!--<li>_____________________________________</li>
											<li></li>-->
											<?php if(!empty($org_list)) { ?>
											<li class="temp1"><strong>ORGANIZATIONS I MANAGE</strong></li>
											<?php for($i=0;$i<count($org_list);$i++) { ?> 
											<li class="temp"><a href="<?php echo base_url()."org-dashboard/".$org_list[$i]['in_organization_id']."/"; ?>"><?php echo $org_list[$i]['st_org_name']; ?></a></li>
											<?php } } ?>
											<li><a href="<?php echo base_url(); ?>rescue-organization/"><strong>Apply for an Organization account&nbsp;&nbsp;</strong></a></li>
											<li><a href="#per_frm" data-toggle="modal"><strong>Request user permissions to existing organization&nbsp;&nbsp;</strong></a></li>
											<li class="temp"><a href="<?php echo $base_url.'user/logout'; ?>">Log Out</a></li>
											</ul>
										</li>
										
										
									</ul>
								</div>
							</div>

						</div>
					</nav>
				</div>

			</div>
		</header>
		<section id="volunteerinfo">
			<div class="container">
				<div class="row">
				<div class="col-md-12 col-sm-12 col-xs-12">
					<article>
						<div class="entry-content">
							<div class="volunteer-detail clearfix">
								<div class="volunteer">
									<div class="volunteer-pic <?php if(isset($user_verified) && !empty($user_verified)) { ?>verified <?php } ?>">                                      
                                        <form  method="post" enctype="multipart/form-data" action="<?php echo base_url().'user/update_user_profile_pic'; ?>" name="user_photo_frm" id="user_photo_frm">
                                        <div class="change-img">                                        
                                            <img id="fileupload" src="<?php echo $user_profile_src; ?>" alt="<?php echo $profile_details['st_display_name'].' '.$profile_details['st_last_name']; ?>" title="<?php echo $profile_details['st_display_name'].' '.$profile_details['st_last_name']; ?>">											
											</div><span class="active"><i class="material-icons">done</i></span>
											<div class="camera-icon foobox" id="fileupload_camera"></div>
                                           <!--<div class="foobox" id="fileupload_camera"><i class="material-icons">file_upload</i>Upload Image</div>-->
                                            <input type="file" name="user_photo1" id="user_photo1" onChange="profile_readURL(this)" style="display:none;">
                                            </label>  
                                            <input type="hidden" id="rotate_angle1" name="rotate_angle1" value="0"/>
                                            <input type="hidden" id="crop_x1" name="x1"/>
                                            <input type="hidden" id="crop_y1" name="y1"/>
                                            <input type="hidden" id="crop_w1" name="w1"/>
                                            <input type="hidden" id="crop_h1" name="h1"/>          
                                            <input type="hidden" id="user_uploaded_photo1" name="user_uploaded_photo1" value="" />
                                            <input type="hidden" id="crop_upload_path" name="crop_upload_path" value="<?php echo base_url(); ?>user/user_profile_pic_upload" />
                                        </form>
                                    </div>
									<div class="volunteer-info">
										<p class="view"><a id="classic_view">Classic View</a></p>
										<p class="heading"><?php echo $profile_details['st_display_name'].' '.$profile_details['st_last_name']; ?></p>
										<p class="paw-info">

										<?php //print_r($tc_count);
												  if(isset($tc_count['average_rating']) && $tc_count['average_rating'] > 0 ) { ?>
												 <a class="fb-user-rating" href="<?php echo $base_url.'feedback/feedback_transactions/'.$this->session->userdata('userid').'/tc/';?>">
												 <?php for($i=0; $i<$tc_count['average_rating']; $i++){ ?>
                                                       <img src="<?php echo $base_url; ?>img/paw-orange.png" alt="Paw" title="Paw">
                                                 <?php } for($j=0;$j<5-$tc_count['average_rating'];$j++) { ?>
                                                      <img src="<?php echo $base_url; ?>img/paw-gray.png" alt="Paw" title="Paw">
                                                 <?php } ?> 
												 </a>
												 <?php } else{ ?>
                                                 <a class="fb-user-rating" href="<?php echo $base_url.'feedback/feedback_transactions/'.$this->session->userdata('userid').'/vol/';?>">
                                                  <?php for($i=0; $i<$vol_count['average_rating']; $i++){ ?>
                                                      <img src="<?php echo $base_url; ?>img/paw-orange.png" alt="Paw" title="Paw">
                                                 <?php } for($j=0;$j<5-$vol_count['average_rating'];$j++) { ?>
                                                      <img src="<?php echo $base_url; ?>img/paw-gray.png" alt="Paw" title="Paw">
                                                 <?php  } ?>
                                                 </a>
                                                 <?php } ?>

										<a class="feedback" href="<?php echo $base_url;?>feedback/">Feedback</a>
										</p>
										<p class="text16"><?php 
															$profile_types = '';
															if($enabled_driver_pilot_status == '1')
															{
																$profile_types.= 'Transporter, ';
															}
															if($foster_profile_status == '1')
															{
																$profile_types.= 'Foster, ';
															}
															if($photographer_profile_status == '1')
															{
																$profile_types.= 'Photographer, ';
															}					
															$profile_types = substr($profile_types, 0, -2);						
															echo $profile_types;
															?>
												<br><span>Saving Animals since <?php echo  date("F d, Y",strtotime($profile_details['dt_created'])); ?></span></p>
									</div>
								</div>
								<div class="changeview">
									<div class="switch-container clearfix">
                          				<span class="mv">Classic View</span><label class="switch float-r-custom"><input type="checkbox" name="allow_pics" id="allow_pics" checked><span class="slider round margin-tb0"></span></label><span class="cv selected">Modern View</span>
                      			    </div>									
								</div>
								<div class="br"></div>
							</div>
						</div>
					</article>
				</div>
			</div>
			</div>
		</section>
		
		<section id="middle">
			<div class="container">
			<div class="row">
				<div class="col-md-12 col-sm-12 col-xs-12">
				
				<?php /* ?>
					<div class="tcrequest">
					<?php if(isset($request_board_status) && $request_board_status == 2) { ?>
					<a href="<?php echo $base_url;?>org_transportation/submitted_routing_request">TC Request Board</a>
					<?php } else if(isset($request_board_status) && $request_board_status ==1) { ?>
					<a href="<?php echo $base_url.'org_transportation/request_assigned_to_me'; ?>">TC Request Board</a>
					<?php } ?>		
					
					</div>
					<?php  */ ?>
					
					<article class="h160">
					<div class="col-md-9 col-sm-9 col-xs-12 tabular">
						<div class="padr45 <?php if(isset($request_board_status) && $request_board_status == 2) { ?> tc <?php } ?>">
							<div class="layer">
							<a href="<?php echo base_url(); ?>open_leg/" class="links01"><span class="img"><img src="<?php echo $base_url;?>modernview/images/icon_nearme.png" alt="" class="desktop" /><img src="<?php echo $base_url;?>modernview/images/icon_nearme_mobile.png" alt="" class="mobile" /></span><span class="text">TRANSPORTS NEAR ME</span></a>
							<div class="filters02 single"><h3><span class="img"><img src="<?php echo $base_url;?>modernview/images/icon_mytrips.png" alt="" class="desktop" /><img src="<?php echo $base_url;?>modernview/images/icon_mytrips_mobile.png" alt="" class="mobile" /></span><span class="text w58p">MY TRIPS</span><img src="<?php echo $base_url;?>modernview/images/filterarrow.png" alt="" class="arrow desktop" /><img src="<?php echo $base_url;?>modernview/images/filterarrow_mobile.png" alt="" class="arrow mobile" /></h3>
								<div class="filterlist02">
									<ul>
									   <li><a href="<?php echo base_url(); ?>upcoming-trips/">Manage My Trips</a></li>
									   <li><a href="<?php echo base_url(); ?>past-trips/">Trip History</a></li>
									</ul>
								</div>
							</div>
							<a href="<?php echo $base_url;?>my-profiles/" class="links03 single"><span class="img center"><img src="<?php echo $base_url;?>modernview/images/icon_profile.png" alt="" class="desktop" /><img src="<?php echo $base_url;?>modernview/images/icon_profile_mobile.png" alt="" class="mobile" /></span><span class="text">PROFILE</span></a>
							<div class="br"></div>
							</div>
							<div class="spacer"></div>
							<div class="right desktop">
							<?php if(isset($request_board_status) && $request_board_status == 2) { ?>
							<a href="<?php echo $base_url;?>org_transportation/submitted_routing_request" class="tcboard">TC Request Board</a>
							<?php } else if(isset($request_board_status) && $request_board_status ==1) { ?>
							<a href="<?php echo $base_url.'org_transportation/request_assigned_to_me'; ?>" class="tcboard">TC Request Board</a>
							<?php } ?>
							<a href="<?php echo $base_url.'manage-my-transports/1'; ?>">Manage My Transports</a>
							</div>
							<?php if($enabled_driver_pilot_status == '1') { ?>
							<h1 class="title">MY UPCOMING TRANSPORTS</h1>
							<?php } ?>
							<div class="br"></div>
						</div>	
					</div>
					<!--<div class="col-md-3 col-sm-3 col-xs-12 ads">&nbsp;</div>-->
					<div class="br"></div>
				</article>
				</div>
			</div>				
				<div class="col-md-12 col-sm-12 col-xs-12 pad0">
					<article>
					<div class="col-md-9 col-sm-9 col-xs-12 tabular">
						<div class="padr25" id="orgdashboard">
							<div id="loader" style="display:none;"><div class="modern"><div><img src="<?php echo base_url(); ?>assets/img/ajax-modal-loading.gif" width="50" height="50" align="absmiddle">&nbsp;<span id="loadertext">Loading...</span></div></div></div>
							
							<div class="btngrey"><a href="javascript:void(0);" id="list-view" class="active"></a> <a href="javascript:void(0);" id="calendar-view" class=""></a></div>
<div class="section">
  <div class="containerbox">
    <table id="card-table" class="table list-animal-profile stacktable large-only">
      <thead>
        <tr id="heading">
          <th class="w100">ID<div>ID</div></th>
          <th>Date<div>Date</div></th>
          <th>Pickup / Drop off<div>Pickup / Drop off</div></th>
          <th class="w100"># of Legs<div># of Legs</div></th>
          <th>Coordinator<div>Coordinator</div></th>
        </tr>
      </thead>
	  
      <tbody id='ajax_data'>
	  
	  
	  
											<?php
											
											if(!empty($all_trasport))
											{
												for($a=0;$a<count($all_trasport);$a++)
												{		
													if($all_trasport[$a]['st_trans_type'] == 'P'){ $css="predefined"; $trimg='icon_dashboard_predefined.png'; }
													if($all_trasport[$a]['st_trans_type'] == 'RO'){ $css="route";$trimg='icon_dashboard_car.png'; }
													if($all_trasport[$a]['st_trans_type'] == 'R'){ $css="ride";$trimg='icon_dashboard_ride.png'; }
													if($all_trasport[$a]['in_airline_transport'] == '1' && $all_trasport[$a]['st_trans_type'] == 'D'){ $css="airline";$trimg='icon_dashboard_airline.png'; }
													if($all_trasport[$a]['in_airline_transport'] == '0' && $all_trasport[$a]['st_trans_type'] == 'D'){ $css="airline";$trimg='icon_dashboard_assisted.png'; }
													

													$sqlprogressstatus  = "SELECT in_photography_profile FROM tbl_transportation_participants  where in_transportation_id = '".$all_trasport[$a]['in_transportation_id']."'";
													$sqlprogressstat	=	$this->db->query($sqlprogressstatus);
													$numrowprostat		=	$sqlprogressstat->num_rows($sqlprogressstat);	
													$prostatus			=	$sqlprogressstat->result();
													$in_photography_profile		=	$prostatus[0]->in_photography_profile;
													
													if($in_photography_profile == 1)
													{														
														$img_photographer = '<span class="photographerin">Handoff Photographer in:'.'<i id="iconr" class="material-icons">camera_alt</i></span>';
													}
													else  if($in_photography_profile == 0 and $all_trasport[$a]['in_airline_transport']==1)
													{
														$img_photographer = '<i id="iconr" class="material-icons">airplanemode_active</i>';
													}
													else
													{
														$img_photographer = '<i id="iconr" class="material-icons">directions_car</i>';
													}
													
												
												$all_legs_count = 0;
												$transport_all_legs 	= $this->common_model->get_all_legs_count($all_trasport[$a]['in_transportation_id']);
												
												if(isset($transport_all_legs['total_count']) && !empty($transport_all_legs['total_count']))
												{
													$all_legs_count	= $transport_all_legs['total_count'];
												}
												
												$transport_filled_data 	= $this->common_model->get_transport_filled_status($all_trasport[$a]['in_transportation_id']);
												$total_filled_legs = 0;
												if(isset($transport_filled_data['filled_legs_count']) && !empty($transport_filled_data['filled_legs_count']))
												{
													$total_filled_legs	= count($transport_filled_data['filled_legs_count']);
												}
												$filled_legs_count 	= $this->common_function->get_filled_legs_count($all_trasport[$a]['in_transportation_id']);
												$non_doobert_filled_legs_count 	= $this->common_model->get_non_doobert_filled_legs_count($all_trasport[$a]['in_transportation_id']);
												if($all_trasport[$a]['perc']>0)
												{
													$transport_comp_perc = (($all_trasport[$a]['perc']>100)? "100%":$all_trasport[$a]['perc']."%");
												}
												else
												{
														$transport_comp_perc = "0%";
												} 
												$org_code = ($all_trasport[$a]['st_org_code'])? $all_trasport[$a]['st_org_code']:'DBT';	
												
												$joined_leg 			= $this->common_model->get_user_leg_joined($all_trasport[$a]['in_transportation_id'],$this->session->userdata('userid'));
												
												?>
	  
	  
	 
        <tr>
          <td class="id"><a href="<?php echo base_url()."org-transportation-scheduled/".$all_trasport[$a]['in_transportation_id']."/";?>" class="<?php echo $css;?>"><?php echo $org_code;?><?php echo $all_trasport[$a]['in_transportation_id'];?><span><img src="<?php echo $base_url;?>modernview/images/<?php echo $trimg;?>" alt=""/></span></a></td>
          <td><?php echo date("M d",strtotime($all_trasport[$a]['dt_pickup_date'])); ?> - <br><?php echo date("M d",strtotime($all_trasport[$a]['dt_target']));?></td>
<td><?php echo $all_trasport[$a]['st_from_city'].', '.$all_trasport[$a]['st_from_state']; ?> <i class="material-icons backspace">arrow_right_alt</i> <?php echo $img_photographer;?> <?php echo '<br>'.$all_trasport[$a]['st_to_city'].', '.$all_trasport[$a]['st_to_state']; ?><br><a href="<?php echo $base_url;?>org-transportation-scheduled/<?php echo $all_trasport[$a]['in_transportation_id'];?>" class="linkgreyu"><?php echo $all_trasport[$a]['st_trans_name']; ?></a></td>
          <td><?php echo $all_legs_count; ?> legs <span class="lightgrey"><?php echo ($all_trasport[$a]['in_tot_distance']!=''?$all_trasport[$a]['in_tot_distance']:"0");?> miles</span>
		  <?php if($joined_leg > 0 && $all_trasport[$a]['in_status'] == 1) { ?>
													&nbsp;
													<a href="javascript:void(0);" title='Exit From Leg' onClick="exit_from_leg('<?php echo $all_trasport[$a]['in_transportation_id']; ?>');" class="link-orange highlight_off"><i class="material-icons">highlight_off</i></a>
													<?php } ?>
		  </td>
          <td class="text-break"><?php echo $all_trasport[$a]['co_name']; ?><br><a href="mailto:<?php echo $all_trasport[$a]['st_email']; ?>" class="linkgrey"><?php echo $all_trasport[$a]['st_email']; ?></a></td>
        </tr>		
		
											<?php } 
											}
											else
											{
												?>
                                               <tr>
                                               <td class="" colspan="6" align="center">No Transportation found.</td>
												</tr>
												<?php    
													}
												?>
		
		 
		 
		 
		 
		 
      </tbody>
	  
    </table>
	
    <div class="clear"></div>	
						<?php if($total_record > 10){ ?>	
									<div class="loadmore load_more" ><a href="javascript:void(0);" id="load_more" class="loadmr">Load More</a></div>
								<?php }	 ?>					
  
  </div>
</div>
<div class="listsectionmobile">
<div id="loader" style="display:none;"><div class="modern"><div><img src="<?php echo base_url(); ?>assets/img/ajax-modal-loading.gif" width="50" height="50" align="absmiddle">&nbsp;<span id="loadertext">Loading...</span></div></div></div>
	<ul id="ajax_data_mobile">
											<?php
											if(!empty($all_trasport))
											{
												for($a=0;$a<count($all_trasport);$a++)
												{		
													if($all_trasport[$a]['st_trans_type'] == 'P'){ $css="predefined"; $trimg='icon_dashboard_predefined.png'; }
													if($all_trasport[$a]['st_trans_type'] == 'RO'){ $css="route";$trimg='icon_dashboard_car.png'; }
													if($all_trasport[$a]['st_trans_type'] == 'R'){ $css="ride";$trimg='icon_dashboard_ride.png'; }
													if($all_trasport[$a]['in_airline_transport'] == '1' && $all_trasport[$a]['st_trans_type'] == 'D'){ $css="airline";$trimg='icon_dashboard_airline.png'; }
													if($all_trasport[$a]['in_airline_transport'] == '0' && $all_trasport[$a]['st_trans_type'] == 'D'){ $css="airline";$trimg='icon_dashboard_assisted.png'; }
													

													$sqlprogressstatus  = "SELECT in_photography_profile FROM tbl_transportation_participants  where in_transportation_id = '".$all_trasport[$a]['in_transportation_id']."'";
													$sqlprogressstat	=	$this->db->query($sqlprogressstatus);
													$numrowprostat		=	$sqlprogressstat->num_rows($sqlprogressstat);	
													$prostatus			=	$sqlprogressstat->result();
													$in_photography_profile		=	$prostatus[0]->in_photography_profile;
													
													if($in_photography_profile == 1)
													{														
														$img_photographer = '<span class="photographerin">Handoff Photographer in:'.'<i id="iconr" class="material-icons">camera_alt</i></span>';
													}
													else  if($in_photography_profile == 0 and $all_trasport[$a]['in_airline_transport']==1)
													{
														$img_photographer = '<i id="iconr" class="material-icons">airplanemode_active</i>';
													}
													else
													{
														$img_photographer = '<i id="iconr" class="material-icons">directions_car</i>';
													}
													
												
												$all_legs_count = 0;
												$transport_all_legs 	= $this->common_model->get_all_legs_count($all_trasport[$a]['in_transportation_id']);
												
												if(isset($transport_all_legs['total_count']) && !empty($transport_all_legs['total_count']))
												{
													$all_legs_count	= $transport_all_legs['total_count'];
												}
												
												$transport_filled_data 	= $this->common_model->get_transport_filled_status($all_trasport[$a]['in_transportation_id']);
												$total_filled_legs = 0;
												if(isset($transport_filled_data['filled_legs_count']) && !empty($transport_filled_data['filled_legs_count']))
												{
													$total_filled_legs	= count($transport_filled_data['filled_legs_count']);
												}
												$filled_legs_count 	= $this->common_function->get_filled_legs_count($all_trasport[$a]['in_transportation_id']);
												$non_doobert_filled_legs_count 	= $this->common_model->get_non_doobert_filled_legs_count($all_trasport[$a]['in_transportation_id']);
												if($all_trasport[$a]['perc']>0)
												{
													$transport_comp_perc = (($all_trasport[$a]['perc']>100)? "100%":$all_trasport[$a]['perc']."%");
												}
												else
												{
														$transport_comp_perc = "0%";
												}	
												$org_code = ($all_trasport[$a]['st_org_code'])? $all_trasport[$a]['st_org_code']:'DBT';	
												$joined_leg 			= $this->common_model->get_user_leg_joined($all_trasport[$a]['in_transportation_id'],$this->session->userdata('userid'));
												?>
	
		<li>
			<div class="id"><a href="<?php echo base_url()."org-transportation-scheduled/".$all_trasport[$a]['in_transportation_id']."/";?>" class="<?php echo $css;?>"><?php echo $org_code;?><?php echo $all_trasport[$a]['in_transportation_id'];?><span><img src="<?php echo $base_url;?>modernview/images/<?php echo $trimg;?>" alt=""/></span></a></div>
			<div class="details">
				<p class="date"><?php echo date("M d",strtotime($all_trasport[$a]['dt_pickup_date'])); ?> - <?php echo date("M d",strtotime($all_trasport[$a]['dt_target']));?> <?php echo $img_photographer;?></p>
				<p class="pickdrop"><?php echo $all_trasport[$a]['st_from_city'].', '.$all_trasport[$a]['st_from_state']; ?> <i class="material-icons backspace">arrow_right_alt</i> <?php echo $all_trasport[$a]['st_to_city'].', '.$all_trasport[$a]['st_to_state']; ?><br><a href="<?php echo $base_url;?>org-transportation-scheduled/<?php echo $all_trasport[$a]['in_transportation_id'];?>" class="linkgreyu"><?php echo $all_trasport[$a]['st_trans_name']; ?></a></p>
				<p class="legs"><?php echo $all_legs_count; ?> legs <span class="lightgrey"><?php echo ($all_trasport[$a]['in_tot_distance']!=''?$all_trasport[$a]['in_tot_distance']:"0");?> miles</span>
				 <?php if($joined_leg > 0 && $all_trasport[$a]['in_status'] == 1) { ?>
													&nbsp;
													<a href="javascript:void(0);" title='Exit From Leg' onClick="exit_from_leg('<?php echo $all_trasport[$a]['in_transportation_id']; ?>');" class="link-orange highlight_off"><i class="material-icons">highlight_off</i></a>
													<?php } ?>
				</p>
				<p class="coordinator"><?php echo $all_trasport[$a]['co_name']; ?><br><a href="mailto:<?php echo $all_trasport[$a]['st_email']; ?>" class="linkgrey"><?php echo $all_trasport[$a]['st_email']; ?></a></p>
			</div>
			<div class="br"></div>
		</li>
		
											<?php } 
											}
											else
											{
												?>
                                               <li><p>No Transportation found.</p></li>
												<?php    
											}
											?>
		
		
	</ul>
	<?php if($total_record > 10){ ?>
	<div class="loadmore load_more_mobile" ><a href="javascript:void(0);" id="load_more_mobile">Load More</a>	
	</div>
	<?php } ?>
</div>
							
							 <div class="portlet box calendar" id="dashboard-calendar" style="display: none;">
								<div class="portlet-title no-space">
										<div class="title-patch padb0">Calendar 
                                                <?php 
                                                $check_event_permission = '';
                                                if($owner_id != $this->session->userdata('userid')) {
                                                    $get_permission = isset($get_user_permission['st_permission'])?unserialize($get_user_permission['st_permission']):'';
                                                    if(isset($get_permission['transport']) || isset($get_permission['fundraiser']) || isset($get_permission['profile_manager'])) {
                                                        $check_event_permission = 1;	
                                                    }
                                                }
                                                //echo "<pre>";print_r($get_permission);echo "</pre>";die;
                                                if($owner_id == $this->session->userdata('userid') || $check_event_permission == 1) { 
                                                
                                                ?>
                                                <a href="<?php echo base_url().'add-organization-event'; ?>" class="add-event" title="Add Event">Add Event</a>
                                                <?php } ?>
                                                <?php /*?><!--<a href="javascript:void(0);" title="iCal" id="ical"><img src="<?php echo base_url(); ?>assets/img/ical.png" alt="iCal">iCal</a>--><?php */?>
                                        </div>
								</div>
								<div class="portlet-body light-grey">
                                                <div id="calendar">
                                                </div>
                                </div>
							</div>
							
							
							
							
							<div class="clear"></div>
						</div>	
					</div>
					<div class="col-md-3 col-sm-3 col-xs-12 ads">
					
						<div class="box"><div class="text">
						<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
						<!-- Volunteer Dashboard -->

						<ins class="adsbygoogle"

						style="display:inline-block;width:300px;height:600px"

						data-ad-client="ca-pub-8745101436469640"

						data-ad-slot="5208137377"></ins>

						<script>

						(adsbygoogle = window.adsbygoogle || []).push({});

						</script>
						</div></div>

						
					</div>
					
					
					<div class="br"></div>
				</article>
				</div>
			</div>
		</section>
		
		<div class="modal fade" id="user_crop_img_popup" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
      <div class="modal-dialog message-modal">
        <div class="modal-content">
          <div class="modal-header"> 
            <button aria-hidden="true" data-dismiss="modal" class="close cancel_close1" title="Close" type="button"></button>
            <h4 class="modal-title">Profile Picture</h4>
          </div>
          <div class="modal-body">
          <div class="scroller crop-scroller" data-always-visible="1" data-rail-visible1="1" style="height:100%;overflow-y: scroll; overflow-x: scroll;">

          	<p>Select an area of an image and then click on Save Photo button to save photo.<img id="ajax-loader-bar-rotate1" src="<?php echo $base_url; ?>assets/img/ajax-loader-bar.gif" alt="image" style="display:none;"/></p>
            <div class="crop-img-here1">
            	<img id="ajax-loader-bar1" src="<?php echo $base_url; ?>assets/img/ajax-loader-bar.gif" alt="image" style="display:none;"/>
            </div>
            </div>
          </div>
          <div class="modal-footer text-center no-margin"> 
          <button class="btn orange-small waves-effect waves-light save_popup1" style="display:none;" data-dismiss="modal" onClick="javascript:void(0);" type="button" title="Save Photo">Save Photo</button>
          <button class="btn black waves-effect waves-light cancel_popup1" data-dismiss="modal" onClick="javascript:void(0);" type="button" title="Cancel">Cancel</button>
          </div>
         </div>
        <!-- /.modal-content --> 
      </div>
      <!-- /.modal-dialog --> 
	</div>
	
	
	
	<div class="modal fade" id="markallread" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog message-modal">
        <div class="modal-content">
          <div class="modal-header"> 
            <button aria-hidden="true" data-dismiss="modal" class="close" type="button"></button>
            <h4 class="modal-title">Information</h4>
          </div>
          <div class="modal-body"><p>All notifications marked as read.</p></div>
          <div class="modal-footer text-center no-margin"> 
          	<button class="btn orange" data-dismiss="modal" type="button" onclick="javascript:window.location='<?php echo base_url();?>dashboard_modern/'">OK</button>
          </div>
         </div>
        <!-- /.modal-content --> 
      </div>
      <!-- /.modal-dialog --> 
</div>






<div class="modal fade existingorg" id="per_frm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
<div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"> 
        <a href="javascript:void(0);" aria-hidden="true" data-dismiss="modal" class="close" type="button" title="Close"></a><h3>If you work with or for an existing Doobert organization, you can request security privileges to act on behalf of the organization.</h3>
      </div>		
      <div class="modal-body border-bottom">
      <form class="horizontal-form" role="form" method="post" action="" name="invite_frm" id="invite_frm">
		  <div class="form-group">
		  <label class="control-label" for="pick_org">Select the organization:</label><input type="text" class="form-control" id="pick_org" value="" name="pick_org" maxlength="50"><div class="clearfix"></div> 							  
		</div>
		
	   <p class="modal-title">Indicate the permissions you are requesting</p>
          <div class="form-body doobert-form no-space"> 
          
              <div class="roll-wrapp"><span class="org-certificats">Transport Coordinator</span>
<div class="custom-checkbox margin-top-6"><input type="checkbox" name="transport[]" class="access_level" id="tr_create" value="transport_cr"><label for="tr_create">Create</label><input type="checkbox" name="transport[]" class="access_level" id="tr_edit" value="transport_ed"><label for="tr_edit">Edit</label><input type="checkbox" name="transport[]" class="access_level" id="tr_confirm" value="transport_cnf"><label for="tr_confirm">Confirm</label><input type="checkbox" name="transport[]" class="access_level" id="tr_delete" value="transport_del"><label for="tr_delete">Delete</label></div>
</div>
<div class="roll-wrapp"><span class="org-certificats">Fundraiser</span>
<div class="custom-checkbox margin-top-6"><input type="checkbox" name="fundraiser[]" class="access_level" id="fn_create" value="fundraiser_cr"><label for="fn_create">Create</label><input type="checkbox" name="fundraiser[]" class="access_level" id="fn_edit" value="fundraiser_ed"><label for="fn_edit">Edit</label><input type="checkbox" name="fundraiser[]" class="access_level" id="fn_confirm" value="fundraiser_cnf"><label for="fn_confirm">Confirm</label><input type="checkbox" name="fundraiser[]" class="access_level" id="fn_delete" value="fundraiser_del"><label for="fn_delete">Delete</label></div></div>
<div class="roll-wrapp"><span class="org-certificats">Animal Profile Manager</span>
<div class="custom-checkbox margin-top-6"><input type="checkbox" name="profile_manager[]" class="access_level" id="pr_create" value="pr_manager_cr"><label for="pr_create">Create</label><input type="checkbox" name="profile_manager[]" class="access_level" id="pr_edit" value="pr_manager_ed"><label for="pr_edit">Edit</label><input type="checkbox" name="profile_manager[]" class="access_level" id="pr_confirm" value="pr_manager_cnf"><label for="pr_confirm">Confirm</label><input type="checkbox" name="profile_manager[]" class="access_level" id="pr_delete" value="pr_manager_del"><label for="pr_delete">Delete</label><input type="checkbox" name="profile_manager[]" class="access_level" id="pr_transefer" value="pr_manager_trf"><label for="pr_transefer">Transfer</label></div></div>
<div class="roll-wrapp">
<span class="org-certificats">VIEW ONLY</span>
<div class="custom-checkbox margin-top-6"><input type="checkbox" name="view_only" class="view_only access_level" id="view_only" value="view_only"><label for="view_only">View Only</label></div>
</div>
             
              </div>
              <input type="hidden" name="invite_frm_action" value="invite_frm_value" />
              <input type="hidden" name="invite_user_id" id="invite_user_id" value="" />
              <input type="hidden" name="display_name" id="display_name" value="" />
			  <input type="hidden" name="org_id" id="org_id" value="" />
			  
              <input type="hidden" name="org_email_address" id="org_email_address" value="" />
              <input type="hidden" name="sess_user_id" id="sess_user_id" value="<?php echo $this->session->userdata('userid'); ?>" />             
              <input type="hidden" name="user_access_level" id="user_access_level" value="" />
              </form> </div>
      <div class="modal-footer no-border no-space dobt-text-center margin-bottom-10 margin-top-20">  
	  <button aria-hidden="true" name="cancel" id="cancel" class="btn black marr5  marb10 cancelbtn" type="button" data-dismiss="modal">Cancel</button>
      <a class="btn orange waves-effect waves-light marr5  marb10 send_invitation" href="javascript:void(0);">Submit</a>	  
      <span class="display_loader" style="display:none;"> <img id="loadimg" src="<?php echo base_url(); ?>assets/img/ajax-loading.gif" alt="loader" /> </span>     
      </div> 
	  
	  </div>
    </div>
    <!-- /.modal-content --> 
  </div>
<!-- END THANK YOU MODAL POPUP-->

<?php if($this->session->flashdata('message')):?>
            <!-- BEGIN THANK YOU MODAL POPUP-->
<div class="modal fade" id="message" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog message-modal">
        <div class="modal-content">
          <div class="modal-header"> 
            <!--<button aria-hidden="true" data-dismiss="modal" class="close" type="button"></button>-->
            <h4 class="modal-title">THANK YOU</h4>
          </div>
          <div class="modal-body"><p><?php echo $this->session->flashdata('message'); ?></p></div>
          <div class="modal-footer text-center no-margin"> 
          	<button class="btn orange" data-dismiss="modal" type="button">OK</button>
          </div>
         </div>
        <!-- /.modal-content --> 
      </div>
      <!-- /.modal-dialog --> 
</div>

<?php endif; ?>
<?php if($this->session->flashdata('invitation_error')):?>
            <!-- BEGIN THANK YOU MODAL POPUP-->
<div class="modal fade" id="invitation_error" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog message-modal">
        <div class="modal-content">
          <div class="modal-header"> 
            <!--<button aria-hidden="true" data-dismiss="modal" class="close" type="button"></button>-->
            <h4 class="modal-title">Alert!</h4>
          </div>
          <div class="modal-body"><p><?php echo $this->session->flashdata('invitation_error'); ?></p></div>
          <div class="modal-footer text-center no-margin"> 
          	<button class="btn orange" data-dismiss="modal" type="button">OK</button>
          </div>
         </div>
        <!-- /.modal-content --> 
      </div>
      <!-- /.modal-dialog --> 
</div>
<!-- END THANK YOU MODAL POPUP-->
<?php endif; ?>



	<div class="modal fade" id="deleted-leg" role="dialog">
	 <form class="horizontal-form" role="form" id="delete_leg_transport" name="delete_leg_transport" enctype="multipart/form-data" action="<?php echo base_url(); ?>org_transportation/delete_user_legs/" method="post">
      <input type="hidden" name="transport_id" id="transport_id" value="">
      <input type="hidden" name="do_action" id="do_action" value="delete_leg" />
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Please select the leg you want to remove yourself from.</h4>
        </div>
        <div class="modal-body text-center" style='height:247px;'> 
		<table id="deleted_leg_listing" class="table transport-table">
			<thead>
                <tr>
                    <th></th>
					<th>LEGS</th>
                    <th class="w190">DATE/TIME</th>
                    <th>PICK UP / DROP OFF</th>                             
                </tr>
            </thead> 
			<tbody>
                    
            </tbody>
        </table>			
        </div>
        <div class="modal-footer text-center no-margin">
			<a href="javascript:void(0);" class="btn orange-small waves-effect waves-light" id="delete_leg_btn">Continue</a>
		 </div>
       </div>
      
    </div>
	 </form>
  </div>




<!-- END THANK YOU MODAL POPUP-->


<?php if(!isset($_COOKIE['appuser'])):?>
            <!-- BEGIN THANK YOU MODAL POPUP-->
<div class="modal fade" id="message_app" style="display:none;" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog message-modal appbox">
        <div class="modal-content">
          <!--<div class="modal-header"></div>-->
          <div class="modal-body">
<div class="applogo"><img src="<?php echo $base_url; ?>/img/app-logo.jpg" alt="Doobert - animal rescue made simple" title="Doobert - animal rescue made simple"></div><div class="didyou">Did you know that Doobert has a mobile app?</div><div class="br"></div>
<div class="app-detail">
	<div class="dash-app-info"><a href="https://play.google.com/store/apps/details?id=app.doobert" target="_blank"><img src="<?php echo $base_url; ?>/img/google-play-small.jpg" class="marr24" alt="Google Play" title="Google Play"></a><a href="https://itunes.apple.com/us/app/doobert-user-app/id1047733391" target="_blank"><img src="<?php echo $base_url; ?>/img/app-store-small.jpg" alt="App Store" title="App Store"></a></div>
	<a href="javascript:void(0);" class="continue" data-dismiss="modal">Continue with mobile web</a>
	<div class="custom-checkbox"><input type="checkbox" name="dontshow" value="1" id="dontshow"/><label for="dontshow">Don’t show this again</label></div><div class="br"></div>
</div>
</div></div>
        <!-- /.modal-content --> <?php /*  ?><div class="modal-footer text-center no-margin"><button class="btn orange" data-dismiss="modal" type="button" onclick="javascript:window.location='<?php echo base_url();?>user/setdownloadcookie'">Skip and proceed</button></div><button class="btn orange" data-dismiss="modal" type="button">Skip and continue</button><?php */ ?>
      </div>
      <!-- /.modal-dialog --> 
</div>
<!-- END THANK YOU MODAL POPUP-->
<?php endif; ?>

		<form action="<?php echo base_url().'dashboard'; ?>" id="submit_board_view_type" method="post">
				<input type="hidden" id="dashboard_view_type" name="dashboard_view_type"  value="O">
		</form>
		
		<?php include 'includes/modern/footer.php';?>		
		
	</div>
	
<?php include 'includes/modern/footer-script.php';?>
<script>
var base_url= '<?php echo base_url()?>';
var transport_counter = '1';
</script>


<script src="<?php echo base_url(); ?>assets/custom_jquery/profile_photo_new.js" type="text/javascript" ></script>
<?php /* ?><script src="<?php echo base_url(); ?>js/css_browser_selector.js" type="text/javascript" ></script><?php */ ?>
<script src="<?php echo $base_url; ?>assets/plugins/fullcalendar/fullcalendar/fullcalendar.min.js" type="text/javascript"></script>
<script src="<?php echo $base_url; ?>assets/scripts/index.js" type="text/javascript"></script> 	
<script>

$('#pick_org').autocomplete ({ 
	source: function (request, response)
    {
    	 var term= request.term;
			term = $.trim(term);
			var str	= term;
			var letters = /^[a-zA-Z ]+$/;	
			if(str.match(letters))
			{
				request.term = str; 
			} else {
				str = str.toUpperCase();
				request.term = str.replace(/\s/g, ''); 
			}		
		$.ajax(
        {
            url: "<?php echo base_url(); ?>org_animal/get_org/",
            dataType: "json",
            data:
            {
				term: request.term				
            },
            success: function (data)
            {  
            	if(data=="1")
				{
					window.location.href="<?php echo base_url() ?>";
				}
				else
				{   console.log(data);
                	response(data);
				}
            }
        });
    },
	minLength:1,
	delay: 0,
	open: function() { $('.ui-menu').width($("#pick_org").width())},
	focus: function( event, ui ){
			var org_name = ui.item.value;	
			var org_id = ui.item.org_id;	
			var org_email_address = ui.item.org_email_address;	
			var invite_user_id = ui.item.in_user_id;
			$("#pick_org" ).val(org_name);	
			$("#org_id" ).val(org_id);	
			$("#org_email_address" ).val(org_email_address);	
			$("#invite_user_id" ).val(invite_user_id);			
			return false;
	},     
	select: function( event, ui ) {
		var org_name = ui.item.value;			
		$("#pick_org" ).val(org_name);		
		return false;
	}
	});

$(document).on('change','#pick_org',function(){
var selected_zipcode = $.trim($(this).val());
	if(selected_zipcode!='')
	{
	  $.ajax({
            url: "<?php echo base_url(); ?>org_animal/get_org/",
            dataType: "json",
            data:
            {
                term: selected_zipcode,
				city: $("#pickup_city" ).val(),
				state: $("#pickup_state" ).val()
            },
            success: function (data)
            {
				if(data)
				{
					var org_name = data[0].value;	
					var org_id = data[0].org_id;	
					var org_email_address = data[0].org_email_address;	
					var invite_user_id = data[0].in_user_id;
					$("#pick_org" ).val(org_name);	
					$("#org_id" ).val(org_id);	
					$("#org_email_address" ).val(org_email_address);	
					$("#invite_user_id" ).val(invite_user_id);					
				}
				else
				{
					if($("#pick_org").val().indexOf(',') == -1)
					{
						alert('Please enter valid doobert organization');
						$("#pick_org" ).val('');	
						$("#org_id" ).val('');	
						$("#org_email_address" ).val('');	
						$("#invite_user_id" ).val('');
					}
				}
				
            }
        });
	} else {
		alert('Please enter valid doobert organization');
						$("#pick_org" ).val('');	
						$("#org_id" ).val('');	
						$("#org_email_address" ).val('');	
						$("#invite_user_id" ).val('');
	}		

});	
</script>


<script>
$(document).ready(function(){

	$(document).ready(function(){
		$('#allow_pics').on('change',function()
		{
			$('#submit_board_view_type').submit();		
		});
	});	
	
	$('#classic_view').on('click',function(){
	$('#submit_board_view_type').submit();
	});
	/*$('.switch-container input[type="checkbox"]').on('click', function () {
				
		if ($(this).is(':checked')) {
			window.location='<?php echo base_url();?>dashboard_modern';		   
		}
		else{ 
			window.location='<?php echo base_url();?>dashboard';	 
		}
	});*/
	
		$('#list-view').click(function() {
		$('#list-view').addClass('active');
		$('#calendar-view').removeClass('active');
		$('.section').show();
        $('#dashboard-calendar').hide();
        $('#card-table').show();
		//if($( window ).width() <= 767)
//		{
//			$('#card-table').hide();
//			$('.small-only').show();
//		}
		if($( window ).width() <= 800)
		{
			$('#card-table').hide();
			$('.section').hide();
			$('.listsectionmobile').show();
		}
		});
		$('#calendar-view').click(function() {
			$('#calendar-view').addClass('active');
			$('#list-view').removeClass('active');
			$('.section').hide();
			$('#calendar').html('');
			$('#card-table').hide();
			$('#dashboard-calendar').show();
			$('.small-only').hide();
			$('.listsectionmobile').hide();
			if($( window ).width() <= 800)
			{
				$('#card-table').hide();
				$('.section').hide();
				$('.listsectionmobile').hide();
			}
			
			var date = new Date();
		var d = date.getDate();
		var m = date.getMonth();
		var y = date.getFullYear();
		
		var h = {};

            if ($('#calendar').width() <= 400) {
                $('#calendar').addClass("mobile");
                h = {
                    left: 'title, prev, next',
                    center: '',
                    right: 'today,month,agendaWeek,agendaDay'
                };
            } else {
                $('#calendar').removeClass("mobile");
                if (App.isRTL()) {
                    h = {
                        right: 'title',
                        center: '',
                        left: 'prev,next,today,month,agendaWeek,agendaDay'
                    };
                } else {
                    h = {
                        left: 'title',
                        center: '',
                        right: 'prev,next,today,month,agendaWeek,agendaDay'
                    };
                }               
            }
		
		$('#calendar').fullCalendar({
				height:350,
				disableDragging: false,
                header: h,
                editable: false,
                events: [
				<?php  $replace_array = array(",","'","\n");$replace_with = array("");
					if(isset($event_data) && !empty($event_data)) {
						foreach($event_data as $row) { 
							if($row['start_date']!='0000-00-00 00:00:00' && $row['end_date']!='0000-00-00 00:00:00') {
								$y = date('Y',strtotime($row['start_date']));
								$m = date('m',strtotime($row['start_date']));
								$j = date('j',strtotime($row['start_date']));
								$h = date('g',strtotime($row['start_date']));
								$i = date('i',strtotime($row['start_date']));
								
								$ye = date('Y',strtotime($row['end_date']));
								$me = date('m',strtotime($row['end_date']));
								$je = date('j',strtotime($row['end_date']));
								
								$he = date('g',strtotime($row['end_date']));
								$ie = date('i',strtotime($row['end_date']));
								
				?>							{
								<?php if(isset($row['tr_title'])) {									
									$transport_type = '';
									$img_tag= '';
									
									if($row['transport_type'] == "Pre-defined")
									{
										$img_tag = '<img src="'.base_url().'assets/img/prespecifylegs.png" />';
										$transport_type = 'Pre-defined';
									} 
									elseif($row['transport_type'] =="Routing"){
										$img_tag = '<img src="'.base_url().'assets/img/icon-assisted.png" />';
										$transport_type = 'Assisted';
									}	
									else if($row['transport_type'] == "Ride") {
											$transport_type = 'Ride';
											$img_tag = '<i class="fa fa-automobile" style="font-size:17px;color:#f25613" aria-hidden="true"></i>';
									}
									else if($row['transport_type'] == "Route") {
											$transport_type = 'Route';
											$img_tag = '<i class="material-icons" aria-hidden="true" style="color:#f25613;vertical-align: middle;padding-bottom: 3px;">swap_calls</i>';
									}else if($row['transport_type']=="Airline"){
										$img_tag = '<img src="'.base_url().'assets/img/icon-airline.png" />';
										$transport_type = 'Airline';
									}
									?>
								title: '<?php echo $row['tr_title']; ?>'+'<br><?php echo $img_tag;?><?php echo $transport_type;?>',
								
								<?php } else { ?>
								//title: "<php echo ($this->common_function->get_filtered_name_ucfirst(strip_tags( ($row['title'])))); ?>",
								title: "<?php echo (strip_tags(addslashes($row['title']))); ?>",
								<?php } ?>
								start: new Date(<?php echo $y; ?>,<?php echo $m-1; ?>, <?php echo $j; ?>, <?php echo $h; ?>, <?php echo $i; ?>),
								<?php if(!isset($row['tr_title'])) { ?>
								end: new Date(<?php echo $ye; ?>,<?php echo $me-1; ?>, <?php echo $je; ?>,<?php echo $he; ?>, <?php echo $ie; ?>),
								<?php } ?>
								<?php 
									if(isset($row['tr_title'])) {
										if($row['in_status'] == 1) {
										$tr_url = base_url().'org-transportation-scheduled/'.$row['transportation_id'];
										} else if($row['in_status'] == 2) {
										$tr_url = base_url().'org-confirm-transport/'.$row['transportation_id'];
										} else if($row['in_status'] == 3) {
										$tr_url = base_url().'org-cancel-transport/'.$row['transportation_id'];
										}
								?>
								url  : '<?php echo $tr_url; ?>',
								color:'09F'
								<?php } else { ?>
								url  : '<?php echo base_url().'organization-event-detail/'.$row['in_event_id'] ?>',
								color:'#378006'
								<?php } ?>
							},
				<?php
						}
					}
				}
				?>  
            ],
			eventAfterAllRender: function() {
				$( '.fc-event-inner span.fc-event-title' ).each(function( index ) {
					$(this).html($(this).text());
				});
			},
			eventRender: function(event, element) {
				 console.log(element);
  			}
		});
		
		

    });
	
	$(".filters01").click(function(event) {
		$(".filterlist01").slideToggle("slow");
		$(".filterlist02").slideUp(500);
		$(".filterlist03").slideUp(500);
		event.stopPropagation();
	});  
			
	$(".filters02").click(function(event) {
		$(".filterlist02").slideToggle("slow");
		$(".filterlist01").slideUp(500);
		$(".filterlist03").slideUp(500);
		event.stopPropagation();
	});
	
	$(".filters03").click(function(event) {
		$(".filterlist03").slideToggle("slow");
		$(".filterlist01").slideUp(500);
		$(".filterlist02").slideUp(500);
		event.stopPropagation();
	}); 

	$(document).click(function() {
		$(".filterlist01").slideUp(500);
		$(".filterlist02").slideUp(500);
	});		
	
});


$('.markallread').on('click',function() 
{  					
	
	$.ajax({
		type: "POST",
		url: '<?php echo base_url(); ?>user/markallread', 
		
		success:function(data) 
		{   
			
			$('#markallread').modal('show');			
		}
	});
	
});	
</script>

<script type="text/javascript">

$(document).ready(function(){ 
$('#load_more').on('click',function(){
		
		transport_counter  = parseInt(transport_counter) + parseInt(1);		
		$.ajax({
            url: base_url+"dashboard_modern/disp_transport_listing/",
			type:"POST",
            dataType: "json",
			beforeSend: function(){
                  $('#loader').show();
            },
            data:
            {
                trans_counter_record:transport_counter,
            },	
            success: function(data)
            {   $('#loader').hide();
				$('#ajax_data').html(data['transport_html_listing']);
				if(data['load_more']==0)
				{
					$('#load_more').hide();
				}		
				//$('.load_more')	
            },
		});
	});	
});



$('.send_invitation').click(function(){  
		var access_level = $('.access_level').is(':checked');
		var orgid= $('#pick_org').val();
		if(access_level == false) {
			alert('Please select at least one permission level.');
			return false;
		} 
		
		else if(orgid == '')
		{
			alert('Please select organization name.');
			return false;
		}
		else {
			$('#user_access_level').val('true');
		}
		
	   $('#invite_frm').attr('action','<?php echo base_url(); ?>dashboard_modern/invite_user_direct/');
	   $('#per_frm').modal('hide');
	   
	   if($.browser.msie) {
				$('.display_loader').html('<img id="loadimg" src="<?php echo base_url(); ?>assets/img/ajax-loading.gif" alt="loader" />');
			}
	   $('.display_loader').show();
	   
	   $('#loadimg').show();
	   $('.view_user_profile').hide();
	   $('.send_invitation').hide();	   
	   $('#invite_frm').submit();
   });	
   
   // mobile
	
	$('#load_more_mobile').on('click',function(){ 
		
		transport_counter  = parseInt(transport_counter) + parseInt(1);
		
		$.ajax({
            url: base_url+"dashboard_modern/disp_transport_listing_mobile/",
			type:"POST",
            dataType: "json",
			beforeSend: function(){
                  $('#loader').show();
            },
            data:
            {
                trans_counter_record:transport_counter,
            },	
            success: function(data)
            {   
				$('#loader').hide();
				$('#ajax_data_mobile').html(data['transport_html_listing_mobile']);
				if(data['load_more']==0)
				{
					$('#load_more_mobile').hide();
				}		
				//$('.load_more_mobile')	
            },
		});
	});
</script>
<script>
var isMobile = {
    Android: function() {
        return navigator.userAgent.match(/Android/i);
    },
    BlackBerry: function() {
        return navigator.userAgent.match(/BlackBerry/i);
    },
    iOS: function() {
        return navigator.userAgent.match(/iPhone|iPad|iPod/i);
    },
    Opera: function() {
        return navigator.userAgent.match(/Opera Mini/i);
    },
    Windows: function() {
        return navigator.userAgent.match(/IEMobile/i);
    },
    any: function() {
        return (isMobile.Android() || isMobile.BlackBerry() || isMobile.iOS() || isMobile.Opera() || isMobile.Windows());
    }
};
if( isMobile.any() ){
	jQuery('#message_app').modal('show');
}	


  	$('#dontshow').on('click',function() 
               	{  						
               		
               		$.ajax({
               			type: "POST",
               			url: '<?php echo base_url(); ?>user/setdownloadappcookie',               									
               			success:function(data) 
               			{   
               				jQuery('#message_app').modal('hide');							
               			}
               		});
               		
               	});
</script>
<script>
	<?php if($this->session->flashdata('message')){?>
	$('#message').modal('show');
	<?php } ?>
	<?php if($this->session->flashdata('invitation_error')){?>
	$('#invitation_error').modal('show');
	<?php } ?>
</script>
<script>
    $(document).ready(function () {
        $('.dropdown-toggle').dropdown();
    });
</script>
<script>
$(window).resize(function() {
if($( window ).width() <= 767) {  
			$('.st-key').hide();
			$('.small-only').show(); 			
		}
  //resize just happened, pixels changed
});
$(document).ready(function(){
$(document).on('click','#delete_leg_btn',function()
{
	if($('[name="delete_leg[]"]:checked').val()==undefined)
	{
		alert('Please select one of the leg to delete');
		return false;
	} else {	
		$('#delete_leg_transport').submit();
	}
});

$(document).ready(function()
  {
		$(document).on('click','#close_deleted_leg',function()
		{
			if(767 > $( window ).width()) //767
			{
							window.location = '<?php echo base_url() ?>';
			} 
			
		});
	});

});
</script>
<script>
function exit_from_leg(transport_id)
{
	$.ajax({
			type: "POST",
				  url: '<?php echo base_url(); ?>org_transportation/get_user_legs',
				  beforeSend: function() {
					//$('#delete_account').modal('show');
				  },
				  dataType:"json",
				  data: {
					  transport_id: transport_id
				  },
				  complete: function() {
					 $('#delete_account').modal('hide');
				  },
				  success:function(data) {
					 //var pa_legs = jQuery.parseJSON(data);
					 console.log(data.length);
					 console.log(data);
					 var html = '';
					if(data.status == 1)
					{
						/*for(var i=0;i<data.length;i++)
						{
							html +='<option value="'+data[i]['in_leg_id']+'">Leg'+data[i]['sort_order']+'</option>';
						}*/
						if(data.leg_details!='')
						{	
							$('#deleted-leg #deleted_leg_listing tbody').html(' ');
							$('#transport_id').val(transport_id);
							$('#deleted-leg #deleted_leg_listing tbody').append(data.leg_details);
							$('#deleted_leg_listing').cardtable();
							$('#deleted-leg').modal('show');
							if($( window ).width() < 767) //767
							{
								$('#deleted_leg_listing .large-only').html(" ");
							} else {
							$('#deleted-leg .small-only').html(" ");
							}	
						}	 
					}  else {
						if(data.status == 2)
						alert('You cannot exit from the leg  as transport is confirmed');	
					}     
				  }
		  });
}
</script>
</body>
</html>