var count_legs_recomd=0;
var cou_leg_reco = new Array();
var componentForm = {
			  street_number: 'short_name',
			  route: 'long_name',
			  locality: 'long_name',
			  administrative_area_level_1: 'short_name',
			  country: 'short_name',
			  postal_code: 'short_name'
			};
$(document).ready(function(){
	$('#verify_phone_no').mask('(999) 999-9999',{placeholder: "(___) ___-____"},{'translation': {9: {pattern: /[0-9*]/,optional:false}}});
$(document).on('click','#continue-org',function()
{
			if(count_legs_recomd <5)
			{	
				count_legs_recomd = parseInt(count_legs_recomd)+parseInt(1);			
					  
				var html_str  = '';
				/*html_str += '<div class="clearfix" id="dynid_'+count_legs_recomd+'">';
			
				html_str +='<div class="col-lg-4 col-md-4 col-sm-4 no-left-space route-locations"><div class="col-lg-12 col-md-12 col-sm-12 no-left-space smaller column"><div class="form-group"><input type="text" data-origin-num='+count_legs_recomd+' id="origin-address-'+count_legs_recomd+'" name="origin-address[]" class="form-control origin-address-1" placeholder="I can transport FROM" maxlength="500"><input type="hidden" id="origin-city-'+count_legs_recomd+'" name="origin-city[]" maxlength="50" ><input type="hidden" id="origin-state-'+count_legs_recomd+'" name="origin-state[]" maxlength="50" ><input type="hidden"   id="origin-zip-'+count_legs_recomd+'"   name="origin-zip[]" ><input type="hidden"  id="origin-country-'+count_legs_recomd+'"   name="origin-country[]" ></div></div></div>';
			
				html_str += '<div class="col-lg-4 col-md-4 col-sm-4 no-space route-locations"><div class="col-lg-12 col-md-12 col-sm-12 no-left-space smaller column"><div class="form-group"><input type="text" data-dest-num='+count_legs_recomd+' id="dest-address-'+count_legs_recomd+'" name="dest-address[]" class="form-control destination-address-1" placeholder="I can transport TO" maxlength="500"><input type="hidden" id="dest-city-'+count_legs_recomd+'" name="dest-city[]" maxlength="50" ><input type="hidden" id="dest-state-'+count_legs_recomd+'" name="dest-state[]" maxlength="50" ><input type="hidden"   id="dest-zip-'+count_legs_recomd+'"   name="dest-zip[]" ><input type="hidden"  id="dest-country-'+count_legs_recomd+'" name="dest-country[]" ></div></div></div>';
			
				html_str += '<div class="col-lg-4 col-md-4 col-sm-4 no-left-space another-option-add-top20"><a href="javascript:void(0);" onClick="removediv('+count_legs_recomd+');"><i class="material-icons">delete</i></a></div>';
			
				html_str += '</div>';*/
				
				/*html_str += '<div class="clearfix" id="dynid_'+count_legs_recomd+'">';
				html_str +=	'<div class="col-lg-4 col-md-4 col-sm-4 no-left-space route-locations"><div class="col-lg-12 col-md-12 col-sm-12 no-left-space smaller column"><div class="w227"><input placeholder="City, State OR Zip Code" data-origin-num='+count_legs_recomd+' id="origin-address-'+count_legs_recomd+'" name="origin-address[]" class="form-control origin-add"  /></div></div></div>';
				html_str +=	'<div class="col-lg-4 col-md-4 col-sm-4 no-space route-locations"><div class="col-lg-12 col-md-12 col-sm-12 no-left-space smaller column"><div class="w227"><input placeholder="City, State OR Zip Code" data-dest-num='+count_legs_recomd+' id="dest-address-'+count_legs_recomd+'" name="dest-address[]" class="form-control destination-add" /></li></div></div></div>';
				html_str +=	'<div class="col-lg-4 col-md-4 col-sm-4 no-left-space another-option-add-top20 "><a href="javascript:void(0);" onclick="removediv('+count_legs_recomd+');"><i class="material-icons">delete</i></a></div>';
				html_str +=	'</div>';*/
				
				var ids_num = count_legs_recomd+1;
				
				for(var i=2;i<=6;i++)
				{	
					if(jQuery.inArray(i,cou_leg_reco) == -1)
					{
						counter_id = i;
						cou_leg_reco.push(i);
						break;
					}
				}
				
				html_str += '<br><ul id="dynid_'+counter_id+'">';
				//html_str +=	'<li class="w227 datepick">';
				/*html_str +=	'<input type="text" value="" class="form-control transpickdrop from_date"  data-date-format="dd-mm-yyyy" data-date-start-date="+0d" data-date-viewmode="years" maxlength="50" id="pickupselect'+ids_num+'" name="pickupselect[]" placeholder="" readonly>';
				html_str +=	'<a href="javascript:void(0);" id="from_date_picker'+ids_num+'" class="date datepicker-icon" ><i data-textid="'+ids_num+'" class="material-icons from-date-icon">date_range</i></a></li>';*/
				html_str +=	'<li class="w227 datepick"><input type="text" value="" class="form-control transpickdrop from_date"  data-date-format="dd-mm-yyyy" data-date-start-date="+0d" data-date-viewmode="years" maxlength="50" data-pickselect="'+counter_id+'" id="pickupselect'+counter_id+'" name="pickupselect[]" placeholder="" readonly><a href="javascript:void(0);" id="from_date_picker'+counter_id+'" class="date datepicker-icon" ><i data-textid="'+counter_id+'" class="material-icons from-date-icon">date_range</i></a><input type="hidden" name="pickupselect_year[]" id="pickupselect'+counter_id+'_year" /></li>';
				html_str +=	'<li class="action"><a href="javascript:void(0);" onclick="removediv('+count_legs_recomd+');"><i class="material-icons">delete</i></a></li>';
				html_str +=	'</ul>';

			
				$('#portion-cover').append(html_str);
				
					$('.from_date').datepicker({ 
						minDate: today_date,   
						format: "D M d",
						showMeridian: true,
						autoclose: true
					});
				
				
		  }
	
		  
});

$(document).on('click','#non_doobert_cancel',function(){
			    $('#non_doobert_user_name').val('');
				$('#non_doobert_user_email').val('');
				$('#non_doobert_user_phone').val('');
				$('#non_doobert_user_vehicle_zipcode').val('');
				$('#non_doobert_user_vehicle_type').val('');
				$('#non_doobert_user_vehicle_color').val('');
				$('#non_doobert_user_vehicle_license_plate').val('');
				$('#non_doobert_user_vehicle_license_state').val('');
				//$('.form-group').removeClass('has-error');
				//$('.help-block').remove();
		});

$(document).on('click','#continue-org1',function()
{
			if(count_legs_recomd <5)
			{	
			count_legs_recomd = parseInt(count_legs_recomd)+parseInt(1);
			 
					  
			var html_str  = '';
			/*html_str += '<div class="clearfix" id="dynid_'+count_legs_recomd+'">';
			
			html_str += '<div  class="col-lg-4 col-md-4 col-sm-4 no-left-space route-locations"><div class="col-lg-12 col-md-12 col-sm-12 no-left-space smaller column"><div class="form-group"><input type="text" data-origin-num='+count_legs_recomd+' id="pickup-airport-'+count_legs_recomd+'" name="pickup-airport[]" class="form-control pickup-aviation" placeholder="Pick Up Airport" maxlength="500"><input type="hidden" id="pickup-airport-city-'+count_legs_recomd+'" name="pickup-airport-city[]" maxlength="50" ><input type="hidden" id="pickup-airport-state-'+count_legs_recomd+'" name="pickup-airport-state[]" maxlength="50" ></div></div></div>';
			
			
			html_str += '<div class="col-lg-4 col-md-4 col-sm-4 no-space route-locations"><div class="col-lg-12 col-md-12 col-sm-12 no-left-space smaller column"><div class="form-group"><input type="text" data-dest-num='+count_legs_recomd+' id="dropoff-airport-'+count_legs_recomd+'" name="dropoff-airport[]" class="form-control dropoff-aviation" placeholder="Drop Off Airport" maxlength="500"><input type="hidden" id="dropoff-airport-city-'+count_legs_recomd+'" name="dropoff-airport-city[]" maxlength="50" ><input type="hidden" id="dropoff-airport-state-'+count_legs_recomd+'" name="dropoff-airport-state[]" maxlength="50" ></div></div></div>';
			
			
			html_str += '<div class="col-lg-4 col-md-4 col-sm-4 no-left-space another-option-add-top20"><div class="col-lg-4 col-md-4 col-sm-4 no-left-space another-option-add-top20"><a href="javascript:void(0);" onClick="removediv('+count_legs_recomd+');"><i class="material-icons">delete</i></a></div></div>';
			
			html_str += '</div>';*/
			
			html_str += '<ul id="dynid_'+count_legs_recomd+'">';
			
			html_str += '<li class="w227"><input type="text" data-origin-num='+count_legs_recomd+' id="pickup-airport-'+count_legs_recomd+'" name="pickup-airport[]" class="form-control pickup-aviation" placeholder="Pick Up Airport" maxlength="500"><input type="hidden" id="pickup-airport-city-'+count_legs_recomd+'" name="pickup-airport-city[]" maxlength="50" ><input type="hidden" id="pickup-airport-state-'+count_legs_recomd+'" name="pickup-airport-state[]" maxlength="50" ></li>';
			
			
			html_str += '<li class="w227"><input type="text" data-dest-num='+count_legs_recomd+' id="dropoff-airport-'+count_legs_recomd+'" name="dropoff-airport[]" class="form-control dropoff-aviation" placeholder="Drop Off Airport" maxlength="500"><input type="hidden" id="dropoff-airport-city-'+count_legs_recomd+'" name="dropoff-airport-city[]" maxlength="50" ><input type="hidden" id="dropoff-airport-state-'+count_legs_recomd+'" name="dropoff-airport-state[]" maxlength="50" ></li>';
			
			
			html_str += '<li class="action"><a href="javascript:void(0);" onClick="removediv('+count_legs_recomd+');"><i class="material-icons">delete</i></a></li>';
			
			html_str += '</ul>';
			
			$('#portion-cover').append(html_str);
		  }	
});

});

$(document).ready(function(){
	$('.from_date').datepicker({ 
    minDate: today_date,   
	//format: "mm/dd/yyyy",
	format: "D M d",
	showMeridian: true,
	autoclose: true
});
$(document).ready(function(){
$(document).on('click','.datepicker-icon',function()  
{
	var element = $(this).find('.from-date-icon');
	var ids 	= element.attr('data-textid');
	$('#pickupselect'+ids).trigger('focus');
});
});
});

function confirm_transportation()
{
	var error_confirm = "";
	//$transport_details['cover_dis_per']>=90 &&  strtotime($transport_details['dt_target'])>=strtotime(date("Y-m-d"))
	
	if(animal<=0)
	{
		error_confirm +="Ooops.  You do not have any animal profiles on this transport so you cannot confirm it until you have at least one animal profile attached.  Please use the EDIT TRANSPORT feature under the SELECT ACTION drop down below to add an animal.\n";
	}
	/*if(target_date<currentdate)
	{
		error_confirm +="Current date must be less than or equal to Target date.\n";
	}*/
	if(total_legs<=0)
	{
		error_confirm +="Ooops.  You do not have any legs on this transport so you cannot confirm it until you have at least one leg created.\n";
	}	
	
	if(error_confirm!='')
	{
		alert(error_confirm);
		return false;
	}
	else
	{
		$('#transport-confirmation').modal('show');
		
		return false;	
		
	}
}
$(document).ready(function () {
$(document).on('click','#modal_confirm_transport',function(){
		//alert('modal_confirm_transport clicked');
		var additional_email = new Array();
		var error_message = '';
			if(confirm_transport_status == 1)
			{	
					if(confirm("Legs date should match with transport date. Please update the legs date before confirming."))
					{
						var cname = 'edit_legs';
						var cvalue = '1';
						var exdays = '1';
						var d = new Date();
						d.setTime(d.getTime() + (exdays*24*60*60*1000));
						var expires = "expires="+ d.toUTCString();
						document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
						window.location.replace(base_url+"transport-create-legs/");						
					}else{
						return false;
					}
					return false;
			}
			
			var counter = 3;
			var flag = 1;
			var emailReg = /^([\w-\.\+]+@([\w-]+\.)+[\w-]{2,4})?$/;
			for(var i=0; i<counter; i++)
			{
				if($('#addit_name'+i).val()!='' ||  $('#addit_email_address'+i).val()!='')
				{
					var num = i+1;
					if($('#addit_name'+i).val()=='')
					{
						flag = 0;	
						error_message += 'Please Enter User'+num+' Name \n';
					}
					
					if($('#addit_email_address'+i).val()=='')
					{
						flag = 0;	
						error_message += 'Please Enter User'+num+' Email Address \n';
					} else if(!emailReg.test( $('#addit_email_address'+i).val() ))
					{
						flag = 0;
						error_message += 'Please enter User'+num+' Valid Email Address \n';
					}	
						
				} 
				if($('#addit_name'+i).val()!='' &&  $('#addit_email_address'+i).val()!=''  && flag == 1 )
				{
					
					additional_email.push({'user_name':$('#addit_name'+i).val(),'user_email':$('#addit_email_address'+i).val()});
					$('#addit_name'+i).val(' ');
					$('#addit_email_address'+i).val(' ');	
				}	
			}
			
			if(flag ==0)
			{
				alert(error_message);
				return false;
			}	
			
			$('#add_email_address').val(JSON.stringify(additional_email));
			$('#transport-confirmation').modal('hide');
			/*$('#confirm_transport').submit();
			return true;*/
			document.confirm_transport.submit();		
});
});
jQuery(document).ready(function() {
$('#origin-address1').autocomplete({	
	source: function (request, response)
    {
		request.term = $.trim(request.term);
		var str	= request.term;
		var letters = /^[a-zA-Z ]+$/;	
		if(str.match(letters))
		{
			request.term = str; 
		} else {
			str = str.toUpperCase();
			request.term = str.replace(/\s/g, ''); 
		}
        $.ajax(
        {
            url: base_url+"org_transportation/get_zip_code2/" ,
            dataType: "json",
			//async:false,
            data:
            {
                term: request.term,
				city: $("#locality_s").val(),
				state: $("administrative_area_level_1_s").val()
            },
            success: function (data)
            {
				if(data=="1")
				{
					window.location.href=base_url;
				}
				else
				{
                	response(data);
				}
            }
        });
    },
	minLength:1,
	open: function() { $('.ui-menu').width($("#origin-address1" ).width()) },
	focus: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			$("#origin-address1").val(id);
			$("#postal_code_s").val(name);
			$("#country_s").val(ui.item.st_country);
			$("#locality_s").val(ui.item.city);
			$("#administrative_area_level_1_s").val(ui.item.state_prefix);
			//var start_array = {"city":$("#locality_s").val(),"full_address":'',"state_abbr":$("#administrative_area_level_1_s").val(),"zip_code":$("#postal_code_s").val(),"country":$("#country_s").val()};			
			//Doobert.transportation_route_variables.polylineLeg.originAddress = 	start_array;
			return false;			
	},     
	select: function( event, ui ) {
		var id = ui.item.label;
			var name = ui.item.value;
			$("#origin-address1").val(id);
			$("#postal_code_s").val(name);
			$("#country_s").val(ui.item.st_country);
			$("#locality_s").val(ui.item.city);
			$("#administrative_area_level_1_s").val(ui.item.state_prefix);
			//var start_array = {"city":$("#locality_s").val(),"full_address":'',"state_abbr":$("#administrative_area_level_1_s").val(),"zip_code":$("#postal_code_s").val(),"country":$("#country_s").val()};			
			//Doobert.transportation_route_variables.polylineLeg.originAddress = 	start_array;
		return false;
	}
	});
$(document).on('change','#origin-address1',function(){
	
	var selected_zipcode = $.trim($(this).val());
	var str	= selected_zipcode; 
	
	var letters = /^[a-zA-Z ]+$/;	
	if(str.match(letters))
	{
			 selected_zipcode = str; 
	} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
	}	

	var select_pickup_city = $("#locality_s").val();
	
	var select_pickup_state = $("#administrative_area_level_1_s").val();

	var select_pickup_country = $("#country_s").val();


	if ($("#origin-address1").val().indexOf(',') != -1 && $("#origin-address1").val().indexOf('USA') != -1 && $("#origin-address1").val().indexOf('Canada') != -1) {
		if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
		{
			$("#origin-address1").val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
		}
	}
	else
	{
			if(selected_zipcode!=''){
		$.ajax({
				url: base_url+"org_transportation/get_zip_code2/" ,
				dataType: "json",
				async:false,
				data:
				{
					term: selected_zipcode,
					city: $("#locality_s").val(),
					state: $("#administrative_area_level_1_s").val()
				},
				success: function (data)
				{
					if(data)
					{
					$("#origin-address1").val(data[0].label);
					$("#postal_code_s").val(data[0].value);
					$("#country_s").val(data[0].st_country);
					$("#locality_s").val(data[0].city);
					$("#administrative_area_level_1_s").val(data[0].state_prefix);
					//var start_array = {"city":$("#locality_s").val(),"full_address":'',"state_abbr":$("#administrative_area_level_1_s").val(),"zip_code":$("#postal_code_s").val(),"country":$("#country_s").val()};			
					//Doobert.transportation_route_variables.polylineLeg.originAddress = 	start_array;
					//console.log(Doobert.transportation_route_variables.polylineLeg);
					
					}
					else
					{
						if($("#origin-address1").val().indexOf(',') == -1)
						{
							alert('Please enter valid from location');	
							$("#origin-address1").val("");
						}
					}
				}
			});		
		}//!=''
	}
	});
});
jQuery(document).ready(function() {
	$('#destination-address1').autocomplete({	
	source: function (request, response)
    {
		request.term = $.trim(request.term);
		var str	= request.term;
		var letters = /^[a-zA-Z ]+$/;	
		if(str.match(letters))
		{
			request.term = str; 
		} else {
			str = str.toUpperCase();
			request.term = str.replace(/\s/g, ''); 
		}
        $.ajax(
        {
            url: base_url+"org_transportation/get_zip_code2/" ,
            dataType: "json",
			//async:false,
            data:
            {
                term: request.term,
				city: $("#locality_d").val(),
				state: $("administrative_area_level_1_d").val()
            },
            success: function (data)
            {
				if(data=="1")
				{
					window.location.href=base_url;
				}
				else
				{
                	response(data);
				}
            }
        });
    },
	minLength:1,
	open: function() { $('.ui-menu').width($("#destination-address1" ).width()) },
	focus: function( event, ui ) {
			//var i = $(this).attr('data-dest-num');
			var id = ui.item.label;
			var name = ui.item.value;
			$("#destination-address1").val(id);
			$("#postal_code_d").val(name);
			$("#country_d").val(ui.item.st_country);
			//country_state(ui.item.st_country,"pick");
			$("#locality_d").val(ui.item.city);
			$("#administrative_area_level_1_d").val(ui.item.state_prefix);	
			//var end_array = {"city":$("#locality_d").val(),"full_address":'',"state_abbr":$("#administrative_area_level_1_d").val(),"zip_code":$("#postal_code_d").val(),"country":$("#country_d").val()};			
			//Doobert.transportation_route_variables.polylineLeg.destinationAddress = end_array;
			return false;			
	},     
	select: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			$("#destination-address1").val(id);
			$("#postal_code_d").val(name);
			$("#country_d").val(ui.item.st_country);
			//country_state(ui.item.st_country,"pick");
			$("#locality_d").val(ui.item.city);
			$("#administrative_area_level_1_d").val(ui.item.state_prefix);
			//var end_array = {"city":$("#locality_d").val(),"full_address":'',"state_abbr":$("#administrative_area_level_1_d").val(),"zip_code":$("#postal_code_d").val(),"country":$("#country_d").val()};			
			//Doobert.transportation_route_variables.polylineLeg.destinationAddress = end_array;
		return false;
	}
	});
	$(document).on('change','#destination-address1',function(){
	
	//var id = $(this).attr('data-dest-num');	
		
	//var selected_zipcode = $(this).val();
	var selected_zipcode = $.trim($(this).val());
	var str	= selected_zipcode; 
	//selected_zipcode = str.replace(/\s/g, '');
	var letters = /^[a-zA-Z ]+$/;	
	if(str.match(letters))
	{
			 selected_zipcode = str; 
	} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
	}	
	//alert(selected_zipcode);
	//alert($("#pick_city" ).val());
	var select_pickup_city = $("#locality_d").val();
	//alert(select_pickup_city);
	var select_pickup_state = $("#administrative_area_level_1_d").val();
	//alert(select_pickup_state);
	var select_pickup_country = $("#country_d").val();
	//alert(select_pickup_country);
	//alert($("#pick_zip").val());
	//alert($("#pick_zip").val().indexOf(','));

	if ($("#destination-address1").val().indexOf(',') != -1 && $("#destination-address1").val().indexOf('USA') != -1 && $("#destination-address1").val().indexOf('Canada') != -1) {
		if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
		{
			$("#destination-address1").val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
		}
	}
	else
	{
			if(selected_zipcode!=''){
		$.ajax({
				url: base_url+"org_transportation/get_zip_code2/" ,
				dataType: "json",
				async:false,
				data:
				{
					term: selected_zipcode,
					city: $("#locality_d").val(),
					state: $("#administrative_area_level_1_d").val()
				},
				success: function (data)
				{
					//alert(data);
					//alert(data.length);
					//console.log(data);
					//console.log(data[0].label);
					if(data)
					{
						$("#destination-address1").val(data[0].label);
						$("#postal_code_d").val(data[0].value);
						$("#country_d").val(data[0].st_country);
						//country_state(data[0].st_country,"pick");
						$("#locality_d").val(data[0].city);
						$("#administrative_area_level_1_d").val(data[0].state_prefix);
						//var end_array = {"city":$("#locality_d").val(),"full_address":'',"state_abbr":$("#administrative_area_level_1_d").val(),"zip_code":$("#postal_code_d").val(),"country":$("#country_d").val()};			
						//Doobert.transportation_route_variables.polylineLeg.destinationAddress = end_array;
					}
					else
					{
						if($("#destination-address1").val().indexOf(',') == -1)
						{
							alert('Please enter valid from location');	
							$("#destination-address1").val("");
						}
					}
				}
			});		
		}//!=''
	}
	});
	});
	
jQuery(document).ready(function() {
$(document).on("keydown.autocomplete",".origin-address-1",function(e){
$(this).autocomplete({
	source: function (request, response)
    {
		var i = $(this)[0].element.attr('data-origin-num');
		//console.log($(this)[0].element);
		//console.log();
		//alert(id);
		request.term = $.trim(request.term);
		var str	= request.term;
		var letters = /^[a-zA-Z ]+$/;	
		if(str.match(letters))
		{
			request.term = str; 
		} else {
			str = str.toUpperCase();
			request.term = str.replace(/\s/g, ''); 
		}
        $.ajax(
        {
            url: base_url+"org_transportation/get_zip_code2/" ,
            dataType: "json",
			//async:false,
            data:
            {
                term: request.term,
				city: $("#origin-city-"+i).val(),
				state: $("#origin-state-"+i).val()
            },
            success: function (data)
            {
				if(data=="1")
				{
					window.location.href=base_url;
				}
				else
				{
                	response(data);
				}
            }
        });
    },
	minLength:1,
	open: function() { $('.ui-menu').width($(".origin-address-1" ).width()) },
	focus: function( event, ui ) {
		console.log(this);
			var k = $(this).attr('data-origin-num');
			console.log(k);
			var id = ui.item.label;
			var name = ui.item.value;
			$("#origin-address-"+k).val(name);
			$("#origin-zip-"+k).val(name);
			$("#origin-country-"+k).val(ui.item.st_country);
			
			$("#origin-city-"+k).val(ui.item.city);
			$("#origin-state-"+k).val(ui.item.state_prefix);	
			return false;			
	},     
	select: function( event, ui ) {
		var k = $(this).attr('data-origin-num');
		var id = ui.item.label;
		var name = ui.item.value;
		$("#origin-zip-"+k).val(name);
		$("#origin-address-"+k).val(id);
		$("#origin-country-"+k).val(ui.item.st_country);
		
		$("#origin-city-"+k).val(ui.item.city);
		$("#origin-state-"+k).val(ui.item.state_prefix);
		return false;
	}
	});
});	
$(document).on('change','.origin-address-1',function(){
	
	var id = $(this).attr('data-origin-num');	
		
	var selected_zipcode = $.trim($(this).val());
	var str	= selected_zipcode; 
	var letters = /^[a-zA-Z ]+$/;	
	if(str.match(letters))
	{
			 selected_zipcode = str; 
	} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
	}	
	
	var select_pickup_city = $("#origin-city-"+id).val();
	
	var select_pickup_state = $("#origin-state-"+id).val();
	
	var select_pickup_country = $("#origin-country-"+id).val();
	

	if ($("#origin-address-"+id).val().indexOf(',') != -1 && $("#origin-address-"+id).val().indexOf('USA') != -1 && $("#origin-address-"+id).val().indexOf('Canada') != -1) {
		if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
		{
			$("#origin-address-"+id).val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
		}
	}
	else
	{
			if(selected_zipcode!=''){
		$.ajax({
				url: base_url+"org_transportation/get_zip_code2/" ,
				dataType: "json",
				async:false,
				data:
				{
					term: selected_zipcode,
					city: $("#origin-city-"+id).val(),
					state: $("#origin-state-"+id).val()
				},
				success: function (data)
				{
					if(data)
					{
					$("#origin-address-"+id).val(data[0].label);
					$("#origin-zip-"+id).val(data[0].value);
					$("#origin-country-"+id).val(data[0].st_country);
					
					$("#origin-city-"+id).val(data[0].city);
					$("#origin-state-"+id).val(data[0].state_prefix);
					}
					else
					{
						if($("#origin-address-"+id).val().indexOf(',') == -1)
						{
							alert('Please enter valid to location');	
							$("#origin-address-"+id).val("");
						}
					}
				}
			});		
		}//!=''
	}
	});
});
jQuery(document).ready(function() {
$(document).on("keydown.autocomplete",".destination-address-1",function(e){
$(this).autocomplete({	
	source: function (request, response)
    {
		var i = $(this)[0].element.attr('data-dest-num');
		request.term = $.trim(request.term);
		var str	= request.term;
		var letters = /^[a-zA-Z ]+$/;	
		if(str.match(letters))
		{
			request.term = str; 
		} else {
			str = str.toUpperCase();
			request.term = str.replace(/\s/g, ''); 
		}
        $.ajax(
        {
            url: base_url+"org_transportation/get_zip_code2/" ,
            dataType: "json",
			//async:false,
            data:
            {
                term: request.term,
				city: $("#dest-city-"+i).val(),
				state: $("#dest-state-"+i).val()
            },
            success: function (data)
            {
				if(data=="1")
				{
					window.location.href=base_url;
				}
				else
				{
                	response(data);
				}
            }
        });
    },
	minLength:1,
	open: function() { $('.ui-menu').width($(".destination-address-1" ).width()) },
	focus: function( event, ui ) {
			var i = $(this).attr('data-dest-num');
			var id = ui.item.label;
			var name = ui.item.value;
			$("#dest-address-"+i).val(name);
			$("#dest-zip-"+i).val(name);
			$("#dest-country-"+i).val(ui.item.st_country);
			
			$("#dest-city-"+i).val(ui.item.city);
			$("#dest-state-"+i).val(ui.item.state_prefix);	
			return false;			
	},     
	select: function( event, ui ) {
		var i = $(this).attr('data-dest-num');
		var id = ui.item.label;
		var name = ui.item.value;
		$("#dest-zip-"+i).val(name);
		$("#dest-address-"+i).val(id);
		$("#dest-country-"+i).val(ui.item.st_country);
		
		$("#dest-city-"+i).val(ui.item.city);
		$("#dest-state-"+i).val(ui.item.state_prefix);
		return false;
	}
	});
	});
	$(document).on('change','.destination-address-1',function(){
	//$('.destination-address-1').on('change',function(){
	
	var id = $(this).attr('data-dest-num');	
		
	
	var selected_zipcode = $.trim($(this).val());
	var str	= selected_zipcode; 
	
	var letters = /^[a-zA-Z ]+$/;	
	if(str.match(letters))
	{
			 selected_zipcode = str; 
	} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
	}	
	
	var select_pickup_city = $("#dest-city-"+id).val();
	
	var select_pickup_state = $("#dest-state-"+id).val();
	
	var select_pickup_country = $("#dest-country-"+id).val();


	if ($("#dest-address-"+id).val().indexOf(',') != -1 && $("#dest-address-"+id).val().indexOf('USA') != -1 && $("#dest-address-"+id).val().indexOf('Canada') != -1) {
		if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
		{
			$("#dest-address-"+id).val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
		}
	}
	else
	{
			if(selected_zipcode!=''){
		$.ajax({
				url: base_url+"org_transportation/get_zip_code2/" ,
				dataType: "json",
				async:false,
				data:
				{
					term: selected_zipcode,
					city: $("#dest-city-"+id).val(),
					state: $("#dest-state-"+id).val()
				},
				success: function (data)
				{
					if(data)
					{
					$("#dest-address-"+id).val(data[0].label);
					$("#dest-zip-"+id).val(data[0].value);
					$("#dest-country-"+id).val(data[0].st_country);
					
					$("#dest-city-"+id).val(data[0].city);
					$("#dest-state-"+id).val(data[0].state_prefix);
					}
					else
					{
						if($("#dest-address-"+id).val().indexOf(',') == -1)
						{
							alert('Please enter valid to location');	
							$("#dest-address-"+id).val("");
						}
					}
				}
			});		
		}//!=''
	}
	});
});	
function removediv(id)
{	
	var index = cou_leg_reco.indexOf(id);
	if (index > -1) 
	{
		cou_leg_reco.splice(index, 1);
	}
	$("#dynid_"+id).remove();
	count_legs_recomd--;	
}
	
$(document).ready(function()
{
$('#origin-address1-airport').autocomplete ({
		source: function (request, response)
   		 {
			$.ajax(
			{
				url: base_url+"org_transportation/get_airports_by_data/" ,
				dataType: "json",
				data:
				{
					term: request.term
				},
				success: function (data)
				{
					if(data.length == 0)
					{
						alert('Please enter valid Pick Up Airport');
						$("#origin-address1-airport").val('');
					}
					else
					{	
						response(data);					
					}				
				}
			});
  	  	},
		minLength:1,
		open: function() { $('.ui-menu').width($("#origin-address1-airport" ).width()) },
		focus: function( event, ui ) {
				var id = ui.item.label;
				var name = ui.item.value;
				$( "#origin-address1-airport" ).val(name);
				return false;
		},     
		select: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			var st_name = ui.item.st_name;
			var st_latitude = ui.item.st_latitude;
			var st_longitude = ui.item.st_longitude;
			var st_city = ui.item.st_city;			
			var st_state = ui.item.st_state;			
			var st_iso_country = ui.item.st_iso_country;
					
			$("#origin-address1-airport" ).val(name);
			$("#pickup_airport_city").val(st_city);
			$("#pickup_airport_state").val(st_state);
			$("#my-leg #origin-address1-airport").val(name);
			var origin_loc = '';
			if(id)
			{
				origin_loc = origin_loc+id;
			}
			
			 
			origin_address_array.id = "Pickup";
			origin_address_array.latitude = st_latitude;
			origin_address_array.longitude = st_longitude;
			origin_address_array.name = origin_loc;
			origin_address_array.st_city = st_city;
			origin_address_array.st_state = st_state;
			origin_address_array.st_iso_country = st_iso_country;
			
			//Doobert.transportation_avia_variables.startPoint = origin_address_array;
			
			$("#pickup_airport_city").val(st_city);
			$("#pickup_airport_state").val(st_state);
            var join_user = $("#map").attr("data-current-user-can-join");        
			if(join_user == 'true')
			{
				var origin_address_div =  $('#map').attr('data-origin-address', $("#my-leg #origin-address1-airport").val());
			}
			
			return false;
		}
	});	

$('#origin-address1-airport').on('change',function(){
var selected_zipcode = $.trim($(this).val());
var str	= selected_zipcode; 

var letters = /^[a-zA-Z ]+$/;	
if(str.match(letters))
{
			 selected_zipcode = str; 
} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
}

var select_pickup_city = $("#pickup_airport_city" ).val();

var select_pickup_state = $("#pickup_airport_state" ).val();


if ($("#origin-address1-airport").val().indexOf(',') != -1 && $("#origin-address1-airport").val().indexOf('USA') != -1 && $("#origin-address1-airport").val().indexOf('Canada') != -1) {
	if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
	{
		//$("#pickup_location").val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
	}
}
else
{
	if(selected_zipcode!=''){
	  $.ajax({
            url: base_url+"org_transportation/get_airports_by_data/",
            dataType: "json",
            data:
            {
                term: selected_zipcode,
				city: $("#pickup_airport_city" ).val(),
				state: $("#pickup_airport_state" ).val()
            },
            success: function (data)
            {
				if(data)
				{
					//var name = data[0].label;
					var id = data[0].label;
					var name = data[0].value;
					var st_name = data[0].st_name;
					var st_latitude = data[0].st_latitude;
					var st_longitude = data[0].st_longitude;
					var st_city = data[0].st_city;			
					var st_state = data[0].st_state;			
					var st_iso_country = data[0].st_iso_country;
					
					var origin_loc = '';
					if(id)
					{
						origin_loc = origin_loc+id;
					}
					
					//var origin_address_array = {}; 
						origin_address_array.id = "Pickup";
						origin_address_array.latitude = st_latitude;
						origin_address_array.longitude = st_longitude;
						origin_address_array.name = origin_loc;
						origin_address_array.st_city = st_city;
						origin_address_array.st_state = st_state;
						origin_address_array.st_iso_country = st_iso_country;
			
						//Doobert.transportation_avia_variables.startPoint = origin_address_array;
							$( "#origin-address1-airport" ).val(data[0].label);
							$( "#pickup_airport_state" ).val(data[0].st_state);
							$( "#pickup_airport_city" ).val(data[0].st_city);
				}
				else
				{
					if(data == null || data === '')
					{
						alert('Please enter valid Pick Up Airport');
						$("#origin-address1-airport").val('');
					}
				}
				
            }
        });	
	}//!='' 		
}
});

$('#destination-address1-airport').autocomplete ({
		source: function (request, response)
   		 {
			$.ajax(
			{
				url: base_url+"org_transportation/get_airports_by_data/" ,
				dataType: "json",
				data:
				{
					term: request.term
				},
				success: function (data)
				{
					if(data.length == 0)
					{
						alert('Please enter valid Drop Off Airport');
						$("#destination-address1-airport").val('');
					}
					else
					{	
						response(data);					
					}					
				}
			});
  	  	},
		minLength:1,
		open: function() { $('.ui-menu').width($("#destination-address1-airport" ).width()) },
		focus: function( event, ui ) {
				var id = ui.item.label;
				var name = ui.item.value;
				$( "#destination-address1-airport" ).val(name);
				return false;
		},     
		select: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			var st_name = ui.item.st_name;
			var st_latitude = ui.item.st_latitude;
			var st_longitude = ui.item.st_longitude;
			var st_city = ui.item.st_city;			
			var st_state = ui.item.st_state;			
			var st_iso_country = ui.item.st_iso_country;
			
			
			var destination_loc = '';
			if(id)
			{
				destination_loc = destination_loc+id;
			}
			
			$("#destination-address1-airport" ).val(name);			
			
			$("#my-leg #destination-address1-airport").val(name);	
			
			
			destination_address_array.id = "DropOff";
			destination_address_array.latitude = st_latitude;
			destination_address_array.longitude = st_longitude;
			destination_address_array.name = destination_loc;
			destination_address_array.st_city = st_city;
			destination_address_array.st_state = st_state;
			destination_address_array.st_iso_country = st_iso_country;
			
			//Doobert.transportation_avia_variables.endPoint = destination_address_array;
			
            var join_user = $("#map").attr("data-current-user-can-join");        
		
			if(join_user == 'true')
			{
				var destination_address_div =  $('#map').attr('data-destination-address', $("#my-leg #destination-address1-airport").val());			
			}
			
			return false;
			}
		});	
		
		$('#destination-address1-airport').on('change',function()
		{
			var selected_zipcode = $.trim($(this).val());
			var str	= selected_zipcode; 
			var letters = /^[a-zA-Z ]+$/;	
			if(str.match(letters))
			{
				selected_zipcode = str; 
			} else {
				str = str.toUpperCase();  	
				selected_zipcode = str.replace(/\s/g, ''); 
			}
			var select_pickup_city = $("#dropoff_airport_city" ).val();
			var select_pickup_state = $("#dropoff_airport_state" ).val();


if ($("#destination-address1-airport").val().indexOf(',') != -1 && $("#destination-address1-airport").val().indexOf('USA') != -1 && $("#destination-address1-airport").val().indexOf('Canada') != -1) {
	if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
	{
		//$("#pickup_location").val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
	}
}
else
{
	if(selected_zipcode!=''){
	  $.ajax({
            url: base_url+"org_transportation/get_airports_by_data/",
            dataType: "json",
            data:
            {
                term: selected_zipcode,
				city: $("#pickup_airport_city" ).val(),
				state: $("#pickup_airport_state" ).val()
            },
            success: function (data)
            {
				if(data)
				{
					//var name = data[0].label;
					var id = data[0].label;
					var name = data[0].value;
					var st_name = data[0].st_name;
					var st_latitude = data[0].st_latitude;
					var st_longitude = data[0].st_longitude;
					var st_city = data[0].st_city;			
					var st_state = data[0].st_state;			
					var st_iso_country = data[0].st_iso_country;
					
					var origin_loc = '';
					if(id)
					{
						origin_loc = origin_loc+id;
					}
					
					//var destination_address_array = {}; 
						destination_address_array.id = "DropOff";
						destination_address_array.latitude = st_latitude;
						destination_address_array.longitude = st_longitude;
						destination_address_array.name = origin_loc;
						destination_address_array.st_city = st_city;
						destination_address_array.st_state = st_state;
						destination_address_array.st_iso_country = st_iso_country;
			
						//Doobert.transportation_avia_variables.endPoint = destination_address_array;
							$( "#destination-address1-airport" ).val(data[0].label);
							$( "#dropoff_airport_city" ).val(data[0].st_state);
							$( "#dropoff_airport_state" ).val(data[0].st_city);
				}
				else
				{
					if(data == null || data === '')
					{
						alert('Please enter valid from location');
						$("#destination-address1-airport").val('');
					}
				}
			}
		});	
	}//!='' 		
  }
});

	});


$(document).on("keydown.autocomplete",".pickup-aviation",function(e){
$(this).autocomplete ({
		source: function (request, response)
   		 {
			var i = $(this)[0].element.attr('data-origin-num'); 
			request.term = $.trim(request.term);
			var str	= request.term;
			var letters = /^[a-zA-Z ]+$/;	
			if(str.match(letters))
			{
				request.term = str; 
			} else {
				str = str.toUpperCase();
				request.term = str.replace(/\s/g, ''); 
			} 
			$.ajax(
			{
				//url: "<?php echo base_url(); ?>org_transportation/get_airports_by_zipcode/" ,
				url: base_url+"org_transportation/get_airports_by_zipcode_or_airport_id/" ,
				dataType: "json",
				data:
				{
					term: request.term
				},
				success: function (data)
				{
					//alert(data);
					//return false;
					//response(data);
					if(data == null || data === '')
					{
						alert('Please enter valid Pick Up Airport');
						$("#pickup_airport-"+i).val('');
					}
					//else
					if(1)
					{
						response(data);
					}
					
				}
			});
  	  	},
		minLength:1,
		open: function() { $('.ui-menu').width($(".pickup-aviation" ).width()) },
		focus: function( event, ui ) {
				var k = $(this).attr('data-origin-num');
				var id = ui.item.label;
				//alert(id);
				var name = ui.item.value;
				$( "#pickup-airport-"+k ).val(name);
				$( "#pickup-airport-state-"+k ).val(ui.item.st_state);
				$( "#pickup-airport-city-"+k ).val(ui.item.st_city);
				return false;
		},     

		select: function( event, ui ) {
			var k = $(this).attr('data-origin-num');
			var id = ui.item.label;
			var name = ui.item.value;
			$("#pickup-airport-"+k ).val(name);
			$("#pickup-airport-state-"+k ).val(ui.item.st_state);
			$("#pickup-airport-city-"+k ).val(ui.item.st_city);
			return false;
		}
	});
});		
	
$(document).on('change','.pickup-aviation',function(){

var id = $(this).attr('data-origin-num');
var selected_zipcode = $.trim($(this).val());
var str	= selected_zipcode; 

var letters = /^[a-zA-Z ]+$/;	
if(str.match(letters))
{
			 selected_zipcode = str; 
} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
}

var select_pickup_city = $("#pickup-airport-city"+id).val();

var select_pickup_state = $("#pickup-airport-state"+id).val();


if ($("#pickup-airport-"+id).val().indexOf(',') != -1 && $("#pickup-airport-"+id).val().indexOf('USA') != -1 && $("#pickup-airport-"+id).val().indexOf('Canada') != -1) {
	if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
	{
		//$("#pickup_location").val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
	}
}
else
{
	if(selected_zipcode!=''){
	  $.ajax({
            url: base_url+"org_transportation/get_airports_by_zipcode_or_airport_id/" ,
            dataType: "json",
            data:
            {
                term: selected_zipcode,
				city: $("#pickup-airport-city"+id).val(),
				state: $("#pickup-airport-state"+id).val()
            },
            success: function (data)
            {
				if(data)
				{
				var name = data[0].label;
				$( "#pickup-airport-"+id ).val(data[0].label);
				$( "#pickup-airport-state"+id ).val(data[0].st_state);
				$( "#pickup-airport-city"+id ).val(data[0].st_city);
				}
				else
				{
					if(data == null || data === '')
					{
						alert('Please enter valid Pick Up Airport');
						$("#pickup-airport-"+id).val('');
					}
				}
				
            }
        });	
	}//!='' 		
}
});
	$(document).on("keydown.autocomplete",".dropoff-aviation",function(e){
	$(this).autocomplete ({
		source: function (request, response)
   		 {
			var i = $(this)[0].element.attr('data-dest-num'); 
			request.term = $.trim(request.term);
			var str	= request.term;
			var letters = /^[a-zA-Z ]+$/;	
			if(str.match(letters))
			{
				request.term = str; 
			} else {
				str = str.toUpperCase();
				request.term = str.replace(/\s/g, ''); 
			} 
			$.ajax(
			{
				url: base_url+"org_transportation/get_airports_by_zipcode_or_airport_id/" ,
				dataType: "json",
				data:
				{
					term: request.term
				},
				success: function (data)
				{
					/*if(data=="1")
					{
						window.location.href="<?php echo base_url() ?>";
					}*/
					if(data == null || data === '')
					{
						alert('Please enter valid Drop Off Airport');
						$("#dropoff_airport-"+i).val('');
					}
					//else
					if(1)
					{
						response(data);
					}
				}
			});
  	  	}, 
		minLength:1,
		open: function() { $('.ui-menu').width($(".dropoff-aviation" ).width()) },
		focus: function( event, ui ) {
				var i = $(this).attr('data-dest-num');
				var id = ui.item.label;
				var name = ui.item.value;
				$("#dropoff-airport-"+i ).val(name);
				$("#dropoff-airport-state-"+i ).val(ui.item.st_state);
				$("#dropoff-airport-city-"+i ).val(ui.item.st_city);
				return false;
		},     
		select: function( event, ui ) {
			var i = $(this).attr('data-dest-num');
			var id = ui.item.label;
			var name = ui.item.value;
			$("#dropoff-airport-"+i ).val(name);
			$("#dropoff-airport-state-"+i ).val(ui.item.st_state);
			$("#dropoff-airport-city-"+i ).val(ui.item.st_city);
			return false;
		}
	});	
	});	
	
	$(document).on('change','.dropoff-aviation',function(){
	var i = $(this).attr('data-dest-num'); 
	var selected_zipcode = $.trim($(this).val());
	var str	= selected_zipcode;  
	var letters = /^[a-zA-Z ]+$/;	
	if(str.match(letters))
	{
			 selected_zipcode = str; 
	} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
	}

	var select_pickup_city = $("#dropoff-airport-city-"+i ).val();
	var select_pickup_state = $("#dropoff-airport-state-"+i ).val();

	if ($("#dropoff-airport-"+i).val().indexOf(',') != -1 && $("#dropoff-airport-"+i).val().indexOf('USA') != -1 && $("#dropoff-airport-"+i).val().indexOf('Canada') != -1) {
		if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
		{
			//$("#pickup_location").val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
		}
	}
	else
	{
		if(selected_zipcode!=''){
			$.ajax({
				url: base_url+"org_transportation/get_airports_by_zipcode_or_airport_id/" ,
				dataType: "json",
				data:
				{
					term: selected_zipcode,
					city: $("#dropoff-airport-city-"+i ).val(),
					state: $("#dropoff-airport-state-"+i ).val()
				},
				success: function (data)
				{
					if(data)
					{
						var name = data[0].label;
						$( "#dropoff-airport-"+i ).val(data[0].label);
						$( "#dropoff-airport-state-"+i ).val(data[0].st_state);
						$( "#dropoff-airport-city-"+i ).val(data[0].st_city);
					}
					else
					{
						if(data == null || data === '')
						{
							alert('Please enter valid Drop Off Airport');
							$("#dropoff-airport-"+i).val('');
						}
					}
				
				}	
        });	
	}// !=''		
}
});


$(document).on('change','#type-org' ,function() {
	var value = $(this).val();
	$(".transport-view-map").html('<i class="material-icons font-16">map</i> View Map');
	$( ".view-map-cont" ).hide();
	$('#leg-legend').hide();
	$('#google').hide();
	if(value == 0  || value == 5)
	{
		//$('#card-table').show();
		if($( window ).width() <= 767)
			{
			$(".small-only").attr('style','display:block !important');
			}else{
		 	$("#card-table").show();
			}
		$('#add_photo').hide();	
		$('.communication-feed').hide();
		$('.success-resuce-story').hide();
		 $('.recommend-changes-info').hide('fast');

		return false;
	}
	else if(value == 1)
	{
		//$('#card-table').hide();
		if($( window ).width() <= 767)
			{
			$(".small-only").attr('style','display:none !important');
			}else{
		 	$("#card-table").hide();
			}
		$('.communication-feed').hide();
		$('#tab-photos-box').show();
		$('.success-resuce-story').show();
		$('#add_photo').show();
		$('.recommend-changes-info').hide('fast');
		//$('#resst').show();
		$('#title').show();
	
	}
	else if(value == 2)
	{
		 $('#add_photo').hide();	
		 $('#recommend-legs').hide('fast');
		 $('.suggestion-text').hide('fast');
         $('.recommend-changes-info').show('fast');
		 //$('#card-table').hide();
		 $('.success-resuce-story').hide();
		 $('.communication-feed').hide();
		 if($( window ).width() <= 767)
			{
			$(".small-only").attr('style','display:none !important');
			}else{
		 	$("#card-table").hide();
			}
		 
	}
	else if(value == 3)
	{
		if($( window ).width() <= 767)
			{
			$(".small-only").attr('style','display:none !important');
			}else{
		 	$("#card-table").hide();
			}
		$('#add_photo').hide();
		$('.success-resuce-story').hide();
		$('.communication-feed').show();
		 $('.recommend-changes-info').hide('fast');
		
	}
	else if(value == 4)
	{ 
		$('#add_photo').hide();
		$('#type-org').attr('value','0');
		//window.open(base_url+'org_transportation/download_transportation_pdf/', '_blank');
		window.location = base_url+'org_transportation/download_transportation_pdf/';
	}
	
});

$('#loadimg_feed').hide();
$('#message_frm').validate({
		errorElement: 'span', //default input error message container
		errorClass: 'help-block', // default input error message class
		focusInvalid: true, // do not focus the last invalid input
		rules: {
			message: {
				required: true
			}
		},

		messages: {
			message: {
				required: 'Please enter message.'
			}
		},

		invalidHandler: function (event, validator) { //display error alert on form submit   
			$('#message_frm').show();
		},

		highlight: function (element) { // hightlight error inputs
			$(element)
				.closest('.form-group').addClass('has-error'); // set error class to the control group
		},

		success: function (label) { //alert(label);
			label.closest('.form-group').removeClass('has-error');
			label.remove();
		},

		errorPlacement: function (error, element) { 
			//error.addClass('help-small no-left-padding').insertAfter(element.closest('.form-group'));
			error.addClass('help-block').insertAfter(element.closest('.form-control'));
			/*if (element.attr("name") == "pickup_select")
			{
				error.addClass('help-block').insertAfter(element.closest('.form-control'));
			}
			else
			{
				error.addClass('help-block').insertAfter(element.closest('.form-control'));
			}*/
		}

	});
	
$(document).on('click','#post_message',function(){
	if($('#message_frm').valid() == false) {
		return false;
	} else {
		$('#post_message').hide();
		$('#loadimg_feed').show();
		return true;
	}
});

$(document).ready(function () {
					
	$('#cancel_recommend').click(function () 
	{
	
		$('#card-table').show();
		
		$('#type-org').attr('value','0');
		$('.recommend-changes-info').hide('fast');
	});

	$('#cancel_recommend_avia').click(function () 
	{
		$('#card-table').show();
		$('#type-org').attr('value','0');
		$('.recommend-changes-info').hide('fast');
	});
});

$('#select-action').on('change', function() {
		  var value = $(this).val();
		  //alert(value);
		  if(value == 0)
		  {
			return false;
		  }
		  else if(value == 1)
		  {
			//alert('add animal');
			//window.location = '<?php echo base_url(); ?>add-animal-transport/<?php echo $this->session->userdata('transport_id'); ?>';
		  }
		  else if(value == 2)
		  {
			//alert('edit date');
			$('#portlet-config').modal('show');
		  }
		  else if(value == 3)
		  {
			//alert('edit transport');
			window.location = base_url+'edit-airline-transport';
		  }
		  else if(value == 4)
		  {
			//alert('cancel transport');
			if(confirm('Are you sure you want to cancel transportation?'))
			{
				$('#cancel-transport-description').modal('show');
				//$('#cancel_transport').submit();
			}else{ 
			    $('#select-action').val('0');
				return false; 
			}
		  }
		  else if(value == 5)
		  {
			//alert('edit legs');
			var cname = 'edit_legs';
			var cvalue = '1';
			var exdays = '1';
			var d = new Date();
			d.setTime(d.getTime() + (exdays*24*60*60*1000));
			var expires = "expires="+ d.toUTCString();
			document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
			window.location = base_url+'transport-create-legs/';
		  }
});	

$(document).ready(function(){
		$('#'+file_divid_update).fileupload({
		  url: upload_link,
		  maxNumberOfFiles: 5,
		  maxFileSize : 5242880,
		  acceptFileTypes :/(\.|\/)(jpe?g|doc|docx|xls|xlsx|pdf)$/i,
		  sequentialUploads: true,
		  autoUpload :true
		});
});

$(document).on('click', '#update_transport_info', function(){ 	
	var file_name = '';
	$('#image_file_update').val('');
	$('.table-striped tr').each(function() {
	var image_files = $(this).find('td p a').text(); 
	if(image_files!='')
	{  
		if (file_name == '') {
				file_name += image_files;
		}else{
				file_name += ',' + image_files; 
		}
	}
	});
	$('#image_file_update').val(file_name);
	
	if($('#modified_by').val() == '0' && $('#additional-comments-update').val() == ""  && $('#image_file_update').val() == "" && $('#transport_info_files_cnt').val() == 0) {
		alert("Please enter comments/upload files.");
		return false;
	} else {
		$('#update_transport_info').hide();
		
		if($.browser.msie) {
				$('.display_loader').html('<img id="loadimg" src="'+base_url+'assets/img/ajax-loading.gif" alt="loader" />');
			}
		$('.display_loader').show();
		
		$('#loadimg_mail').show();
		$('#edit-additional-info').modal('hide');
		
		if($.browser.msie) {
			$('.display_loader').html('<div id="loader" style="display: none;"><img src="'+base_url+'assets/img/ajax-modal-loading.gif" width="32" height="32" align="absmiddle">&nbsp;<span id="loadertext">Loading...</span></div>');
		}
		
		$('.display_loader').show();
		$('#loader').show();		
		$('#transport_update_info').submit();
	}
	}); 




$('#pick_up_location').autocomplete({
			source: function (request, response)
			{
				request.term = $.trim(request.term);
					 var str = request.term;
				 var letters = /^[a-zA-Z ]+$/;	
				if(str.match(letters))
				{
						request.term = str; 
				} else {
						str = str.toUpperCase();
						request.term = str.replace(/\s/g, ''); 
				}
				$.ajax({
					url: base_url+"org_transportation/get_zip_code2/" ,
					dataType: "json",
					data:
					{
						term: request.term,
						city: $("#pick_city" ).val(),
						state: $("#pickup_state" ).val()
					},
					success: function (data)
					{
						if(data=="1")
						{
							window.location.href = base_url;
						}
						else
						{
							response(data);
						}
					}
				});
			},
			minLength:1,
			open: function() { $('.ui-menu').width($("#pick_up_location" ).width()) },
			focus: function( event, ui ) {
					var id = ui.item.label;
					var name = ui.item.value;
					$("#pick_up_location" ).val(name);
					$("#pick_zip" ).val(name);
					$("#pick_country" ).val(ui.item.st_country);
					$("#pick_city").val(ui.item.city);
					$("#pickup_state").val(ui.item.state_prefix);	
					return false;			
				},     
			select: function( event, ui ) {
					var id = ui.item.label;
					var name = ui.item.value;
					$("#pick_zip" ).val(name);
			$("#pick_up_location" ).val(id);
		$("#pick_country" ).val(ui.item.st_country);
		//country_state(ui.item.st_country,"pick");
		$("#pick_city" ).val(ui.item.city);
		$("#pickup_state" ).val(ui.item.state_prefix);
		return false;
	}
	});

	$(document).on('change','#pick_up_location',function(){
	//var selected_zipcode = $(this).val();
	var selected_zipcode = $.trim($(this).val());
	var str	= selected_zipcode; 
	//selected_zipcode = str.replace(/\s/g, '');
	var letters = /^[a-zA-Z ]+$/;	
	if(str.match(letters))
	{
			 selected_zipcode = str; 
	} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
	}	
	//alert(selected_zipcode);
	//alert($("#pick_city" ).val());
	var select_pickup_city = $("#pick_city" ).val();
	
	var select_pickup_state = $("#pickup_state" ).val();
	
	var select_pickup_country = $("#pick_country" ).val();


	if ($("#pick_up_location").val().indexOf(',') != -1 && $("#pick_up_location").val().indexOf('USA') != -1 && $("#pick_up_location").val().indexOf('Canada') != -1) {
		if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
		{
			$("#pick_up_location").val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
		}
	}
	else
	{
			if(selected_zipcode!=''){
		$.ajax({
				url: base_url+"org_transportation/get_zip_code2/" ,
				dataType: "json",
				async:false,
				data:
				{
					term: selected_zipcode,
					city: $("#pick_city" ).val(),
					state: $("#pickup_state" ).val()
				},
				success: function (data)
				{
					if(data)
					{
						$("#pick_up_location").val(data[0].label);
						$("#pick_zip").val(data[0].value);
						$("#pick_country").val(data[0].st_country);
						$("#pick_city").val(data[0].city);
						$("#pickup_state").val(data[0].state_prefix);
					}
					else
					{
						if($("#pick_up_location").val().indexOf(',') == -1)
						{
							alert('Please enter valid from location');	
							$("#pick_up_location").val("");
						}
					}
				}
			});		
		}//!=''
	}
	});
	
	
	
	$('#drop_off_location').autocomplete({
	source: function (request, response)
    {
		request.term = $.trim(request.term);
		var str	= request.term;
		var letters = /^[a-zA-Z ]+$/;	
		if(str.match(letters))
		{
			request.term = str; 
		} else {
			str = str.toUpperCase();
			request.term = str.replace(/\s/g, ''); 
		}
        $.ajax(
        {
            url: base_url+"org_transportation/get_zip_code2/" ,
            dataType: "json",
            data:
            {
                term: request.term,
				city: $("#drop_city" ).val(),
				state: $("#drop_state" ).val()
            },
            success: function (data)
            {
				if(data=="1")
				{
					window.location.href=base_url;
				}
				else
				{
                	response(data);
				}
            }
        });
    },
	minLength:1,
	open: function() { $('.ui-menu').width($("#drop_off_location" ).width()) },
	focus: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			$("#drop_off_location" ).val(name);
			$("#drop_zip" ).val(name);
			$("#drop_country" ).val(ui.item.st_country);
			//country_state(ui.item.st_country,"pick");
			$("#drop_city" ).val(ui.item.city);
			$("#drop_state" ).val(ui.item.state_prefix);
			
			return false;
	},     
	select: function( event, ui ) {
		var id = ui.item.label;
		var name = ui.item.value;
		//$("#pick_zip" ).val(name);
		$("#drop_off_location" ).val(id);
		$("#drop_zip" ).val(name);
		$("#drop_country" ).val(ui.item.st_country);
		//country_state(ui.item.st_country,"pick");
		$("#drop_city" ).val(ui.item.city);
		$("#drop_state" ).val(ui.item.state_prefix);
		
		return false;
	}
	});
	
	
	$(document).on('change','#drop_off_location',function(){
	
	var selected_zipcode = $.trim($(this).val());
	var str	= selected_zipcode; 
	
	var letters = /^[a-zA-Z ]+$/;	
	if(str.match(letters))
	{
			 selected_zipcode = str; 
	} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
	}

var select_dropoff_city = $("#drop_city" ).val();

var select_dropoff_state = $("#drop_state" ).val();

var select_dropoff_country = $("#drop_country" ).val();

if ($("#drop_off_location").val().indexOf(',') != -1 && $("#drop_off_location").val().indexOf('USA') != -1 && $("#drop_off_location").val().indexOf('Canada') != -1) {
	if(selected_zipcode != '' && select_dropoff_city != '' && select_dropoff_state != '' && select_dropoff_country != '')
	{
		$("#drop_off_location").val(selected_zipcode+', '+select_dropoff_city+', '+select_dropoff_state+', '+select_dropoff_country);
	}
}
else
{
	if(selected_zipcode!=''){
	$.ajax({
            url: base_url+"org_transportation/get_zip_code2/" ,
            dataType: "json",
            data:
            {
                term: selected_zipcode,
				city: $("#drop_city" ).val(),
				state: $("#drop_state" ).val()
            },
            success: function (data)
            {
				if(data)
				{
				$("#drop_off_location" ).val(data[0].label);
				$("#drop_zip" ).val(data[0].value);
				$("#drop_country").val(data[0].st_country);
				$("#drop_city" ).val(data[0].city);
				$("#drop_state" ).val(data[0].state_prefix);
				}
				else
				{
					if($("#drop_off_location").val().indexOf(',') == -1)
					{
						alert('Please enter valid to location');
						$("#drop_off_location").val("");
					}
				}
            }
        });		
	}//!=''	
}
});


$('#pickup_airport').autocomplete({
		source: function (request, response)
   		 {
			request.term = $.trim(request.term);
			var str	= request.term;
			var letters = /^[a-zA-Z ]+$/;	
			if(str.match(letters))
			{
				request.term = str; 
			} else {
				str = str.toUpperCase();
				request.term = str.replace(/\s/g, ''); 
			} 
			$.ajax({
				url: base_url+"org_transportation/get_airports_by_zipcode_or_airport_id/" ,
				dataType: "json",
				data:
				{
					term: request.term
				},
				success: function (data)
				{
					if(data=="1")
					{
						window.location.href=base_url;
					}
					if(1)
					{
						response(data);
					}	
				}
			});
  	  	},
		minLength:1,
		open: function() { $('.ui-menu').width($("#pickup_airport" ).width()) },
		focus: function( event, ui ) {
				var id = ui.item.label;
				var name = ui.item.value;
				$( "#pickup_airport" ).val(name);
				$( "#pickup_airport_state" ).val(ui.item.st_state);
				$( "#pickup_airport_city" ).val(ui.item.st_city);
				return false;
		},     
		select: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			$("#pickup_airport" ).val(name);
			$("#pickup_airport_state" ).val(ui.item.st_state);
			$("#pickup_airport_city" ).val(ui.item.st_city);
			return false;
		}
	});	
	
$(document).on('change','#pickup_airport',function(){

var selected_zipcode = $.trim($(this).val());
var str	= selected_zipcode; 

var letters = /^[a-zA-Z ]+$/;	
if(str.match(letters))
{
			 selected_zipcode = str; 
} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
}

var select_pickup_city = $("#pickup_airport_city" ).val();

var select_pickup_state = $("#pickup_airport_state" ).val();


if ($("#pickup_airport").val().indexOf(',') != -1 && $("#pickup_airport").val().indexOf('USA') != -1 && $("#pickup_airport").val().indexOf('Canada') != -1) {
	if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
	{
		//$("#pickup_location").val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
	}
}
else
{
	if(selected_zipcode!=''){
	  $.ajax({
            url: base_url+"org_transportation/get_airports_by_zipcode_or_airport_id/" ,
            dataType: "json",
            data:
            {
                term: selected_zipcode,
				city: $("#pickup_airport_city" ).val(),
				state: $("#pickup_airport_state" ).val()
            },
            success: function (data)
            {
				if(data)
				{
					var name = data[0].label;
					$( "#pickup_airport" ).val(data[0].label);
					$( "#pickup_airport_state" ).val(data[0].st_state);
					$( "#pickup_airport_city" ).val(data[0].st_city);
				}
				else
				{
					if(data == null || data === '')
					{
						alert('Please enter valid from location');
						$("#pickup_airport").val('');
					}
				}
				
            }
        });	
	}//!='' 		
}
});
	
	$('#dropoff_airport').autocomplete({
		source: function (request, response)
   		 {
			request.term = $.trim(request.term);
			var str	= request.term;
			var letters = /^[a-zA-Z ]+$/;	
			if(str.match(letters))
			{
				request.term = str; 
			} else {
				str = str.toUpperCase();
				request.term = str.replace(/\s/g, ''); 
			} 
			$.ajax(
			{
				url: base_url+"org_transportation/get_airports_by_zipcode_or_airport_id/" ,
				dataType: "json",
				data:
				{
					term: request.term
				},
				success: function (data)
				{
					if(data=="1")
					{
						window.location.href=base_url;
					}
					if(1)
					{
						response(data);
					}
				}
			});
  	  	}, 
		minLength:1,
		open: function() { $('.ui-menu').width($("#dropoff_airport" ).width()) },
		focus: function( event, ui ) {
				var id = ui.item.label;
				var name = ui.item.value;
				$("#dropoff_airport" ).val(name);
				$("#dropoff_airport_state" ).val(ui.item.st_state);
				$("#dropoff_airport_city" ).val(ui.item.st_city);
				return false;
		},     
		select: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			$("#dropoff_airport" ).val(name);
			$("#dropoff_airport_state" ).val(ui.item.st_state);
			$("#dropoff_airport_city" ).val(ui.item.st_city);
			return false;
		}
	});	
	
$(document).on('change','#dropoff_airport',function(){
//var selected_zipcode = $(this).val();
var selected_zipcode = $.trim($(this).val());
var str	= selected_zipcode; 
//selected_zipcode = str.replace(/\s/g, ''); 
var letters = /^[a-zA-Z ]+$/;	
if(str.match(letters))
{
			 selected_zipcode = str; 
} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
}

var select_pickup_city = $("#dropoff_airport_city" ).val();

var select_pickup_state = $("#dropoff_airport_state" ).val();


if ($("#dropoff_airport").val().indexOf(',') != -1 && $("#dropoff_airport").val().indexOf('USA') != -1 && $("#dropoff_airport").val().indexOf('Canada') != -1) {
	if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
	{
		//$("#pickup_location").val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
	}
}
else
{
	if(selected_zipcode!=''){
	  $.ajax({
            url: base_url+"org_transportation/get_airports_by_zipcode_or_airport_id/" ,
            dataType: "json",
            data:
            {
                term: selected_zipcode,
				city: $("#dropoff_airport_city" ).val(),
				state: $("#dropoff_airport_state" ).val()
            },
            success: function (data)
            {
				if(data)
				{
					var name = data[0].label;
					$( "#dropoff_airport" ).val(data[0].label);
					$( "#dropoff_airport_state" ).val(data[0].st_state);
					$( "#dropoff_airport_city" ).val(data[0].st_city);
				}
				else
				{
					if(data == null || data === '')
					{
						alert('Please enter valid to location');
						$("#dropoff_airport").val('');
					}
				}	
            }
        });	
	}// !=''		
}
});	

$(document).ready(function () {
    $(document).on('click','#ground',function () {
        $('#add-aviation').hide('fast');
        $('#add-ground').show('fast');
   });
    $(document).on('click','#aviation',function () {
        $('#add-ground').hide('fast');
        $('#add-aviation').show('fast');
   });
    $(document).on('click','#legground',function () {
         $('#aviation-leg').hide('fast');
         $('#ground-leg').show('fast');
    });
   $(document).on('click','#legaviation',function () {
         $('#ground-leg').hide('fast');
         $('#aviation-leg').show('fast');
   });
});	

$(document).ready(function(){

$(document).on('click','#submit_story',function(event) {
	event.preventDefault();
	if($('#rescue_transport_story_frm').valid() == false) {
		return false;
	} else {
		//alert('submit form true');
		var video_url = $('#story_video_link').val();
		var video_check = true;
		if(video_url != "")
		{
			video_check  = parseVideoURL(video_url);
			//return false;		
		}
		if(video_check)
		{
			var file_name = '';
			$('#rescue_transport_photo').val('');
			$('.table-striped tr').each(function() {
			var rescue_transport_photos = $(this).find('td p a').text(); 
			if(rescue_transport_photos!='')
			{  
				if (file_name == '') {
						file_name += rescue_transport_photos;
				}else{
						file_name += ',' + rescue_transport_photos; 
				}
			}
			});
			$('#rescue_transport_photo').val(file_name);
			$('#submit_story').hide();
			$('#cancel_rescue_story').hide();
			$('#loadimg').show();
			$('#rescue_transport_story_frm').submit();
			return true;
		}
	}
});

	
function parseVideoURL(url) {

    function getParm(url, base) {
            var re = new RegExp("(\\?|&)" + base + "\\=([^&]*)(&|$)");
            var matches = url.match(re);
            if (matches) {
                return(matches[2]);
            } else {
                return("");
            }
        }

        var retVal = {};
        var matches;
        var success = false;

        if ( url.match('http(s)?://(www.)?youtube|youtu\.be') ) {
          if (url.match('embed')) { retVal.id = url.split(/embed\//)[1].split('"')[0]; }
            else { retVal.id = url.split(/v\/|v=|youtu\.be\//)[1].split(/[?&]/)[0]; }
            retVal.provider = "youtube";
            var videoUrl = 'https://www.youtube.com/embed/' + retVal.id + '?rel=0';
            $('#story_video_img_link').val(videoUrl);
			$('#story_video_provider').val(retVal.provider);
			$('#story_video_id').val(retVal.id); 
			success = true;
        } else if (matches = url.match(/vimeo.com\/(\d+)/)) {
            retVal.provider = "vimeo";
            retVal.id = matches[1];
            var videoUrl = 'http://player.vimeo.com/video/' + retVal.id;
			$('#story_video_img_link').val(videoUrl); 
			$('#story_video_provider').val(retVal.provider);
			$('#story_video_id').val(retVal.id); 
			success = true;
        }

      if (success) {
        //alert(retVal.id);
		//var img_url = $.trim("http://i.ytimg.com/vi/"+$.trim(retVal.id)+"/1.jpg");
		//$('#story_video_link').val(img_url);
		//return retVal;
		return true;		
      }
      else { 
	  alert("Please enter valid video link."); 
	  $('#story_video_link').val(''); 
	  return false; 
	  }
}	
	
$('#rescue_transport_story_frm').validate({
		errorElement: 'label', //default input error message container
		errorClass: 'help-inline', // default input error message class
		focusInvalid: true, // do not focus the last invalid input
		ignore: [],
		rules: {
					story_title:{
						required:true
					},
					story_video_link:{												
						vimeo_url:true
					},
					rescue_story:{
					required: {
							depends: function(){  
							var txt = tinyMCE.activeEditor.getContent();												
								if($('#is_round').prop("checked")== false && txt.length == 0){			
								  return true
								}else{										
									return false
								}
							}
						},
					},
					
					txttranstogether:{
					required: {
							depends: function(){
								if($('#is_round').prop("checked")==true){
								  return true
								}else{
									return false
								}
							}
						},
					},
					
					txtmemorable:{
					required: {
							depends: function(){
								if($('#is_round').prop("checked")==true){
								  return true
								}else{
									return false
								}
							}
						},
					},
					
					txtbetter:{
					required: {
							depends: function(){
								if($('#is_round').prop("checked")==true){
								  return true
								}else{
									return false
								}
							}
						},
					},
					
					txtpassenger:{
					required: {
							depends: function(){
								if($('#is_round').prop("checked")==true){
								  return true
								}else{
									return false
								}
							}
						},
					},
					
					
					txttakehelp:{
					required: {
							depends: function(){
								if($('#is_round').prop("checked")==true){
								  return true
								}else{
									return false
								}
							}
						},
					}
				},
		messages: {
			story_title: {
				required: 'Please enter title.'
			},
			rescue_story:{
				required: 'Please enter story.'
			},
			
			txttranstogether: {
				required: 'Please enter value.'
			},
			
			txtmemorable: {
				required: 'Please enter value.'
			},
			txtbetter: {
				required: 'Please enter value.'
			},
			
			txtpassenger: {
				required: 'Please enter value.'
			},
			
			txttakehelp: {
				required: 'Please enter value.'
			},
			story_video_link:{						
						vimeo_url:"Please enter valid video link."						
			}
		},
		

		invalidHandler: function (event, validator) { //display error alert on form submit   
			$('#rescue_transport_story_frm').show();
			
			var errors = validator.numberOfInvalids();
			if (errors) {
			  var message = errors == 1
				? 'You missed 1 field. It has been highlighted'
				: 'You missed ' + errors + ' fields. They have been highlighted';
			  alert(message);
			}
		},

		highlight: function (element) { // hightlight error inputs
			$(element)
				.closest('.form-group').addClass('has-error'); // set error class to the control group
		},
		//onClose: function() {$(this).valid();},
		success: function (label) { 
			label.closest('.form-group').removeClass('has-error');
			label.closest('.help-block').removeClass('has-error');
			label.remove();		
			
		},errorPlacement: function (error, element) {
			error.addClass('help-block').insertAfter(element.closest('.form-control'));//For Other Normal Fileds
			error.addClass('help-inline').insertAfter(element.closest('.input-group'));//For HTTP Filed
			
			if(element.attr("id") == "rescue_story") {
				//error.insertAfter('#cke_rescue_story');
				error.insertAfter('#mceu_9');
			}
			if(element.attr("id") == "txttranstogether") {
				error.insertAfter('#txttranstogether');
			}
			if(element.attr("id") == "txtmemorable") {
				error.insertAfter('#txtmemorable');
			}
			if(element.attr("id") == "txtbetter") {
				error.insertAfter('#txtbetter');
			}
			if(element.attr("id") == "txtpassenger") {
				error.insertAfter('#txtpassenger');
			}
			
			if(element.attr("id") == "txtpassenger") {
				error.insertAfter('#txtpassenger');
			}
			if(element.attr("id") == "txttakehelp") {
				error.insertAfter('#txttakehelp');
			}
			
		}
	});
	jQuery.validator.addMethod("vimeo_url", function(value, element) {
			return this.optional(element) || (/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/)([^\s&]+)/i.test(value) || /vimeo.com\/(\d+)/i.test(value));
			}, "Please enter valid video link.");
	
});	

$(document).on('click','#cancel_rescue_story',function(){
	$('#tab-photos-box').show();
	$('#transport-story').hide();	
});

$(document).on('click','#cancel_transport_photo',function(){
	$('#tab-photos-box').show();
	$('#transport-story').hide();
	$('#photos-videos-box').hide();
});

$(document).on('click','#submit_photos',function(event){
	event.preventDefault();
	var file_name = '';
	$('#transport_photo').val('');
	var transport_video_link = $('#transport_video_link').val();
	
	$('.table-striped tr').each(function() {
    var transport_photos = $(this).find('td p a').text(); 
	if(transport_photos!='')
	{  
		if (file_name == '') {
				file_name += transport_photos;
		}else{
				file_name += ',' + transport_photos; 
		}
	}
	});
	$('#transport_photo').val(file_name);
	
	if(file_name == "" && transport_video_link == "") {
		alert("Please attach photo(s)/video link.")
		return false;
	} else {
		var video_check = true;
		if(transport_video_link != "")
		{
			video_check = parseTransportVideoURL(transport_video_link);
		}
		if(video_check)
		{
			$('#submit_photos').hide();
			$('#cancel_transport_photo').hide();
			//document.transport_photos.submit();
			$('#loadimg_upload').show();
			$('#loadimgphoto').show();
			$("#transport_photos").submit();
			return true;
		}
	}
});

function parseTransportVideoURL(url) {

    function getParm(url, base) {
            var re = new RegExp("(\\?|&)" + base + "\\=([^&]*)(&|$)");
            var matches = url.match(re);
            if (matches) {
                return(matches[2]);
            } else {
                return("");
            }
        }

        var retVal = {};
        var matches;
        var success = false;

        if ( url.match('http(s)?://(www.)?youtube|youtu\.be') ) {
          if (url.match('embed')) { retVal.id = url.split(/embed\//)[1].split('"')[0]; }
            else { retVal.id = url.split(/v\/|v=|youtu\.be\//)[1].split(/[?&]/)[0]; }
            retVal.provider = "youtube";
            var videoUrl = 'https://www.youtube.com/embed/'+ retVal.id + '?rel=0';
            $('#transport_video_img_link').val(videoUrl);
			$('#transport_video_provider').val(retVal.provider);
			$('#transport_video_id').val(retVal.id); 
			success = true;
        } else if (matches = url.match(/vimeo.com\/(\d+)/)) {
            retVal.provider = "vimeo";
            retVal.id = matches[1];
            var videoUrl = 'http://player.vimeo.com/video/' + retVal.id;
			$('#transport_video_img_link').val(videoUrl); 
			$('#transport_video_provider').val(retVal.provider);
			$('#transport_video_id').val(retVal.id); 
			success = true;
        }

      if (success) {
        //alert(retVal.id);
		//var img_url = $.trim("http://i.ytimg.com/vi/"+$.trim(retVal.id)+"/1.jpg");
		//$('#story_video_link').val(img_url);
		//return retVal;
		return true;		
      }
      else { 
	  alert("Please enter valid video link."); 
	  $('#transport_video_link').val(''); 
	  return false; 
	  }
}

$(document).ready(function(){
	//$("area[rel^='prettyPhoto']").prettyPhoto();
	//$(".gallery:first a[rel^='prettyPhoto']").prettyPhoto({animation_speed:'normal',theme:'light_square',slideshow:3000, autoplay_slideshow: false});
	//$(".gallery:gt(0) a[rel^='prettyPhoto']").prettyPhoto({animation_speed:'fast',slideshow:10000, hideflash: true});
	
	$('#'+photo_divid).fileupload({
		  url: photo_upload_link,
		  //maxNumberOfFiles: 5,
		  maxFileSize : 5242880,
		  acceptFileTypes :/(\.|\/)(jpe|jpg|jpeg|png|gif)$/i,
		  sequentialUploads: true,
		  autoUpload :true
		});
		
		
		$('#'+rescue_divid).fileupload({
		  url: photo_upload_link,
		  //maxNumberOfFiles: 5,
		  maxFileSize : 5242880,
		  acceptFileTypes :/(\.|\/)(jpe|jpg|jpeg|png|gif)$/i,
		  sequentialUploads: true,
		  autoUpload :true
		});
		
		
		$('#download_all').click(function (event) {
			event.preventDefault();
			$('.document').multiDownload();
		});
		
});

function edit_story(id)
{   
     $('#tab-photos').hide();        
    //$('#transport-story').show();
	$('.success-resuce-story').show();
    $('#story_id').val(id);	
	$('.graybg').show();
	$('.greyblock').show();
	$('.number').show();
	$('#title').show();
	$('.vlink').show();
	$('#story_video_link').show();
	$('.yourstory').show();
	$('.first').show();
	$('.last').show();
	$('.stepsinfo').show();
	$('.attach-photos').show();
	$('#add-transport-story').addClass('select');
    $('#rescue_story_action').val('rescue_story_edit_action');   	
        
    $.ajax({
			type: "POST",
			url: base_url+'org_transportation/get_rescue_story',
			beforeSend: function() {
			},
			  data: {
				  story_id:id
			  },
			  dataType:"json",			 
			  complete: function() {
			  },
			  success:function(data){                          
              //console.log(data); 			 
				$('#story_title').val(data[0].st_rescue_title);				
				if(data[0].in_flag == 1){
				$('#is_round').prop('checked', true);
				$('#txttranstogether').val(data[0].st_rescue_story[0].txttranstogether);
				$('#txtmemorable').val(data[0].st_rescue_story[0].txtmemorable);
				$('#txtbetter').val(data[0].st_rescue_story[0].txtbetter);
				$('#txtpassenger').val(data[0].st_rescue_story[0].txtpassenger);
				$('#txttakehelp').val(data[0].st_rescue_story[0].txttakehelp);
				$('#promptquestion').show();					
				$('.qst').show();
				$('.graybg').show();
				$('#resst').hide();
				tinyMCE.activeEditor.setContent('');
				$('.graybg').show();
				$('.yourstory').show();
				$('.first').show();
				$('.last').show();
				$('.stepsinfo').show();
				} 
				else{
					tinyMCE.activeEditor.setContent(data[0].st_rescue_story);
					$('#resst').show();
				}
			  }		
			});
        
}

$("#pick_up_location,#pick_street,#drop_off_location,#drop_street,#contact_name,#contact_email,#note-comments,#pickup_airport,#dropoff_airport,#contact_name_avia,#contact_email_avia,#note_comments_avia").val("");
   
	$('#recommend_leg_airline').validate({
								   errorElement: 'span', //default input error message container
									 errorClass: 'help-block', // default input error message class
					               focusInvalid: true, // do not focus the last invalid input
					                     rules: {
								pickupselect_recommend: {
										required: true
									},
								
									contact_name: {
									required: {
									depends: function(){
											if($('#recommend_user_id').val() == ''){ 
												return true;
											} else {
												return false;
											}
										}
									}
								},
								contact_email: {
								required: {
								depends: function(){
										if($('#recommend_user_id').val() == ''){ 
											return true;
										} else {
											return false;
										}
									}
								},
								email: {
								depends: function(){
										if($('#recommend_user_id').val() == ''){ 
											return true;
										} else {
											return false;
										}
									}
								}
							}
						},
					messages: {
						pickupselect_recommend: {
							required: 'Please Enter Trip Date.'
						},
						contact_name: {
							required: 'Please Enter Your Name.'
						},
						contact_email: {
							required: 'Please Enter Your Email.'
						}
					},
			
					invalidHandler: function (event, validator) { //display error alert on form submit   
						$('#suggest_leg').show();
						
						var errors = validator.numberOfInvalids();
						if (errors) {
						  var message = errors == 1
							? 'You missed 1 field. It has been highlighted'
							: 'You missed ' + errors + ' fields. They have been highlighted';
						  alert(message);
						}
					},
			
					highlight: function (element) { // hightlight error inputs
						$(element)
							.closest('.form-group').addClass('has-error'); // set error class to the control group
					},
			
					success: function (label) { //alert(label);
						label.closest('.form-group').removeClass('has-error');
						label.remove();
					},
			
					errorPlacement: function (error, element) { 
						error.addClass('help-block').insertAfter(element.closest('.form-control'));
					}
			
				});
        
		

		$(document).on('click','#suggest_leg',function(){
			if($('#suggest_leg_airline').valid() == false) {
				return false;
			} else {
				$('#suggest_leg').hide();	
				if($.browser.msie) {
					$('.display_loader').html('<img id="loadimg" src="'+base_url+'"assets/img/ajax-loading.gif" alt="loader" />');
				}
				$('.display_loader').show();
				$('#loadimg_mail').show();
				$('#email-config').modal('hide');
				
				if($.browser.msie) {
					$('.display_loader').html('<div id="loader" style="display: none;"><img src="'+base_url+'assets/img/ajax-modal-loading.gif" width="32" height="32" align="absmiddle">&nbsp;<span id="loadertext">Loading...</span></div>');
				}
		
				$('.display_loader').show();
				$('#loader').show();
			}
		});   
		
		$('#recommend_leg_avia').validate({
											errorElement: 'span', //default input error message container
											  errorClass: 'help-block', // default input error message class
											focusInvalid: true, // do not focus the last invalid input
											rules: {
												pickup_airport: {
												 required: true
												},
												dropoff_airport: {
												  required: true
												},
											contact_name_avia: {
											required: {
												depends: function(){
												if($('#recommend_user_id_avia').val() == ''){ 
													return true;
												} else {
													return false;
												}
											}
										}
									},
									contact_email_avia: {
										required: {
										depends: function(){
										if($('#recommend_user_id_avia').val() == '')
											{ 
												return true;
											} else {
											return false;
											}
										}
									}
								}
							},
			
					messages: {
						pickup_airport: {
							required: 'Please Enter From Location.'
						},
						dropoff_airport: {
							required: 'Please Enter To Location.'
						},
						contact_name_avia: {
							required: 'Please Enter Your Name.'
						},
						contact_email_avia: {
							required: 'Please Enter Your Email.'
						}
					},
			
					invalidHandler: function (event, validator) { //display error alert on form submit   
						$('#suggest_leg').show();
						
						var errors = validator.numberOfInvalids();
						if (errors) {
						  var message = errors == 1
							? 'You missed 1 field. It has been highlighted'
							: 'You missed ' + errors + ' fields. They have been highlighted';
						  alert(message);
						}
					},
			
					highlight: function (element) { // hightlight error inputs
						$(element)
							.closest('.form-group').addClass('has-error'); // set error class to the control group
					},
			
					success: function (label) { //alert(label);
						label.closest('.form-group').removeClass('has-error');
						label.remove();
					},
			
					errorPlacement: function (error, element) { 
						error.addClass('help-block').insertAfter(element.closest('.form-control'));
					}
			
				});
        
		

		$(document).on('click','#suggest_leg_aviation',function(){
			if($('#recommend_leg_avia').valid() == false) {
				return false;
			} else {
				$('#suggest_leg').hide();
				if($.browser.msie) {
					$('.display_loader').html('<img id="loadimg" src="'+base_url+'assets/img/ajax-loading.gif" alt="loader" />');
				}
				$('.display_loader').show();
				$('#loadimg_mail').show();
				$('#email-config').modal('hide');
				if($.browser.msie) {
					$('.display_loader').html('<div id="loader" style="display: none;"><img src="'+base_url+'assets/img/ajax-modal-loading.gif" width="32" height="32" align="absmiddle">&nbsp;<span id="loadertext">Loading...</span></div>');
				}
				$('.display_loader').show();
				$('#loader').show();
			}
		});  


$('#pick_up_location').autocomplete({
			source: function (request, response)
			{
				request.term = $.trim(request.term);
					 var str = request.term;
				 var letters = /^[a-zA-Z ]+$/;	
				if(str.match(letters))
				{
						request.term = str; 
				} else {
						str = str.toUpperCase();
						request.term = str.replace(/\s/g, ''); 
				}
				$.ajax({
					url: base_url+"org_transportation/get_zip_code2/" ,
					dataType: "json",
					data:
					{
						term: request.term,
						city: $("#pick_city" ).val(),
						state: $("#pickup_state" ).val()
					},
					success: function (data)
					{
						if(data=="1")
						{
							window.location.href = base_url;
						}
						else
						{
							response(data);
						}
					}
				});
			},
			minLength:1,
			open: function() { $('.ui-menu').width($("#pick_up_location" ).width()) },
			focus: function( event, ui ) {
					var id = ui.item.label;
					var name = ui.item.value;
					$("#pick_up_location" ).val(name);
					$("#pick_zip" ).val(name);
					$("#pick_country" ).val(ui.item.st_country);
					$("#pick_city").val(ui.item.city);
					$("#pickup_state").val(ui.item.state_prefix);	
					return false;			
				},     
			select: function( event, ui ) {
					var id = ui.item.label;
					var name = ui.item.value;
					$("#pick_zip" ).val(name);
			$("#pick_up_location" ).val(id);
		$("#pick_country" ).val(ui.item.st_country);
		//country_state(ui.item.st_country,"pick");
		$("#pick_city" ).val(ui.item.city);
		$("#pickup_state" ).val(ui.item.state_prefix);
		return false;
	}
	});

	$(document).on('change','#pick_up_location',function(){
	//var selected_zipcode = $(this).val();
	var selected_zipcode = $.trim($(this).val());
	var str	= selected_zipcode; 
	//selected_zipcode = str.replace(/\s/g, '');
	var letters = /^[a-zA-Z ]+$/;	
	if(str.match(letters))
	{
			 selected_zipcode = str; 
	} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
	}	
	//alert(selected_zipcode);
	//alert($("#pick_city" ).val());
	var select_pickup_city = $("#pick_city" ).val();
	
	var select_pickup_state = $("#pickup_state" ).val();
	
	var select_pickup_country = $("#pick_country" ).val();


	if ($("#pick_up_location").val().indexOf(',') != -1 && $("#pick_up_location").val().indexOf('USA') != -1 && $("#pick_up_location").val().indexOf('Canada') != -1) {
		if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
		{
			$("#pick_up_location").val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
		}
	}
	else
	{
			if(selected_zipcode!=''){
		$.ajax({
				url: base_url+"org_transportation/get_zip_code2/" ,
				dataType: "json",
				async:false,
				data:
				{
					term: selected_zipcode,
					city: $("#pick_city" ).val(),
					state: $("#pickup_state" ).val()
				},
				success: function (data)
				{
					if(data)
					{
						$("#pick_up_location").val(data[0].label);
						$("#pick_zip").val(data[0].value);
						$("#pick_country").val(data[0].st_country);
						$("#pick_city").val(data[0].city);
						$("#pickup_state").val(data[0].state_prefix);
					}
					else
					{
						if($("#pick_up_location").val().indexOf(',') == -1)
						{
							alert('Please enter valid from location');	
							$("#pick_up_location").val("");
						}
					}
				}
			});		
		}//!=''
	}
	});
	
	
	
	$('#drop_off_location').autocomplete({
	source: function (request, response)
    {
		request.term = $.trim(request.term);
		var str	= request.term;
		var letters = /^[a-zA-Z ]+$/;	
		if(str.match(letters))
		{
			request.term = str; 
		} else {
			str = str.toUpperCase();
			request.term = str.replace(/\s/g, ''); 
		}
        $.ajax(
        {
            url: base_url+"org_transportation/get_zip_code2/" ,
            dataType: "json",
            data:
            {
                term: request.term,
				city: $("#drop_city" ).val(),
				state: $("#drop_state" ).val()
            },
            success: function (data)
            {
				if(data=="1")
				{
					window.location.href=base_url;
				}
				else
				{
                	response(data);
				}
            }
        });
    },
	minLength:1,
	open: function() { $('.ui-menu').width($("#drop_off_location" ).width()) },
	focus: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			$("#drop_off_location" ).val(name);
			$("#drop_zip" ).val(name);
			$("#drop_country" ).val(ui.item.st_country);
			//country_state(ui.item.st_country,"pick");
			$("#drop_city" ).val(ui.item.city);
			$("#drop_state" ).val(ui.item.state_prefix);
			
			return false;
	},     
	select: function( event, ui ) {
		var id = ui.item.label;
		var name = ui.item.value;
		//$("#pick_zip" ).val(name);
		$("#drop_off_location" ).val(id);
		$("#drop_zip" ).val(name);
		$("#drop_country" ).val(ui.item.st_country);
		//country_state(ui.item.st_country,"pick");
		$("#drop_city" ).val(ui.item.city);
		$("#drop_state" ).val(ui.item.state_prefix);
		
		return false;
	}
	});
	
	
	$(document).on('change','#drop_off_location',function(){
	
	var selected_zipcode = $.trim($(this).val());
	var str	= selected_zipcode; 
	
	var letters = /^[a-zA-Z ]+$/;	
	if(str.match(letters))
	{
			 selected_zipcode = str; 
	} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
	}

var select_dropoff_city = $("#drop_city" ).val();

var select_dropoff_state = $("#drop_state" ).val();

var select_dropoff_country = $("#drop_country" ).val();

if ($("#drop_off_location").val().indexOf(',') != -1 && $("#drop_off_location").val().indexOf('USA') != -1 && $("#drop_off_location").val().indexOf('Canada') != -1) {
	if(selected_zipcode != '' && select_dropoff_city != '' && select_dropoff_state != '' && select_dropoff_country != '')
	{
		$("#drop_off_location").val(selected_zipcode+', '+select_dropoff_city+', '+select_dropoff_state+', '+select_dropoff_country);
	}
}
else
{
	if(selected_zipcode!=''){
	$.ajax({
            url: base_url+"org_transportation/get_zip_code2/" ,
            dataType: "json",
            data:
            {
                term: selected_zipcode,
				city: $("#drop_city" ).val(),
				state: $("#drop_state" ).val()
            },
            success: function (data)
            {
				if(data)
				{
				$("#drop_off_location" ).val(data[0].label);
				$("#drop_zip" ).val(data[0].value);
				$("#drop_country").val(data[0].st_country);
				$("#drop_city" ).val(data[0].city);
				$("#drop_state" ).val(data[0].state_prefix);
				}
				else
				{
					if($("#drop_off_location").val().indexOf(',') == -1)
					{
						alert('Please enter valid to location');
						$("#drop_off_location").val("");
					}
				}
            }
        });		
	}//!=''	
}
});


$('#pickup_airport').autocomplete({
		source: function (request, response)
   		 {
			request.term = $.trim(request.term);
			var str	= request.term;
			var letters = /^[a-zA-Z ]+$/;	
			if(str.match(letters))
			{
				request.term = str; 
			} else {
				str = str.toUpperCase();
				request.term = str.replace(/\s/g, ''); 
			} 
			$.ajax({
				url: base_url+"org_transportation/get_airports_by_zipcode_or_airport_id/" ,
				dataType: "json",
				data:
				{
					term: request.term
				},
				success: function (data)
				{
					if(data=="1")
					{
						window.location.href=base_url;
					}
					if(1)
					{
						response(data);
					}	
				}
			});
  	  	},
		minLength:1,
		open: function() { $('.ui-menu').width($("#pickup_airport" ).width()) },
		focus: function( event, ui ) {
				var id = ui.item.label;
				var name = ui.item.value;
				$( "#pickup_airport" ).val(name);
				$( "#pickup_airport_state" ).val(ui.item.st_state);
				$( "#pickup_airport_city" ).val(ui.item.st_city);
				return false;
		},     
		select: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			$("#pickup_airport" ).val(name);
			$("#pickup_airport_state" ).val(ui.item.st_state);
			$("#pickup_airport_city" ).val(ui.item.st_city);
			return false;
		}
	});	
	
$(document).on('change','#pickup_airport',function(){

var selected_zipcode = $.trim($(this).val());
var str	= selected_zipcode; 

var letters = /^[a-zA-Z ]+$/;	
if(str.match(letters))
{
			 selected_zipcode = str; 
} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
}

var select_pickup_city = $("#pickup_airport_city" ).val();

var select_pickup_state = $("#pickup_airport_state" ).val();


if ($("#pickup_airport").val().indexOf(',') != -1 && $("#pickup_airport").val().indexOf('USA') != -1 && $("#pickup_airport").val().indexOf('Canada') != -1) {
	if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
	{
		//$("#pickup_location").val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
	}
}
else
{
	if(selected_zipcode!=''){
	  $.ajax({
            url: base_url+"org_transportation/get_airports_by_zipcode_or_airport_id/" ,
            dataType: "json",
            data:
            {
                term: selected_zipcode,
				city: $("#pickup_airport_city" ).val(),
				state: $("#pickup_airport_state" ).val()
            },
            success: function (data)
            {
				if(data)
				{
					var name = data[0].label;
					$( "#pickup_airport" ).val(data[0].label);
					$( "#pickup_airport_state" ).val(data[0].st_state);
					$( "#pickup_airport_city" ).val(data[0].st_city);
				}
				else
				{
					if(data == null || data === '')
					{
						alert('Please enter valid from location');
						$("#pickup_airport").val('');
					}
				}
				
            }
        });	
	}//!='' 		
}
});
	
	$('#dropoff_airport').autocomplete({
		source: function (request, response)
   		 {
			request.term = $.trim(request.term);
			var str	= request.term;
			var letters = /^[a-zA-Z ]+$/;	
			if(str.match(letters))
			{
				request.term = str; 
			} else {
				str = str.toUpperCase();
				request.term = str.replace(/\s/g, ''); 
			} 
			$.ajax(
			{
				url: base_url+"org_transportation/get_airports_by_zipcode_or_airport_id/" ,
				dataType: "json",
				data:
				{
					term: request.term
				},
				success: function (data)
				{
					if(data=="1")
					{
						window.location.href=base_url;
					}
					if(1)
					{
						response(data);
					}
				}
			});
  	  	}, 
		minLength:1,
		open: function() { $('.ui-menu').width($("#dropoff_airport" ).width()) },
		focus: function( event, ui ) {
				var id = ui.item.label;
				var name = ui.item.value;
				$("#dropoff_airport" ).val(name);
				$("#dropoff_airport_state" ).val(ui.item.st_state);
				$("#dropoff_airport_city" ).val(ui.item.st_city);
				return false;
		},     
		select: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			$("#dropoff_airport" ).val(name);
			$("#dropoff_airport_state" ).val(ui.item.st_state);
			$("#dropoff_airport_city" ).val(ui.item.st_city);
			return false;
		}
	});	
	
$(document).on('change','#dropoff_airport',function(){

var selected_zipcode = $.trim($(this).val());
var str	= selected_zipcode; 

var letters = /^[a-zA-Z ]+$/;	
if(str.match(letters))
{
			 selected_zipcode = str; 
} else {
			 str = str.toUpperCase();  	
			 selected_zipcode = str.replace(/\s/g, ''); 
}

var select_pickup_city = $("#dropoff_airport_city" ).val();

var select_pickup_state = $("#dropoff_airport_state" ).val();


if ($("#dropoff_airport").val().indexOf(',') != -1 && $("#dropoff_airport").val().indexOf('USA') != -1 && $("#dropoff_airport").val().indexOf('Canada') != -1) {
	if(selected_zipcode != '' && select_pickup_city != '' && select_pickup_state != '' && select_pickup_country != '')
	{
		//$("#pickup_location").val(selected_zipcode+', '+select_pickup_city+', '+select_pickup_state+', '+select_pickup_country);
	}
}
else
{
	if(selected_zipcode!=''){
	  $.ajax({
            url: base_url+"org_transportation/get_airports_by_zipcode_or_airport_id/" ,
            dataType: "json",
            data:
            {
                term: selected_zipcode,
				city: $("#dropoff_airport_city" ).val(),
				state: $("#dropoff_airport_state" ).val()
            },
            success: function (data)
            {
				if(data)
				{
					var name = data[0].label;
					$( "#dropoff_airport" ).val(data[0].label);
					$( "#dropoff_airport_state" ).val(data[0].st_state);
					$( "#dropoff_airport_city" ).val(data[0].st_city);
				}
				else
				{
					if(data == null || data === '')
					{
						alert('Please enter valid to location');
						$("#dropoff_airport").val('');
					}
				}	
            }
        });	
	}// !=''		
}
});	
$(document).ready(function() {
$(".remove_doobert_user").on("click",function()
	{
		$('#remove_doobert_userpopup').modal('show');
		return false;
	});

});
	function cancel_leg_or_transport()
	{
			$('.cancel_leg,.btn-secondary,.driver-ono-user').hide();
			$('.'+$(this).attr("data-val")).show();
			$('.cancel_leg').hide();
			$('#action').val('cancel');
			$('#legs_select').submit();
			return true;
	}
	
	function remove_leg_and_transport()
	{
		//alert('remove leg');
		//$(".loder_cancel,#select_leg,#leave_transport").hide();
		$('.cancel_leg,.btn-secondary,.driver-ono-user').hide();
		$('#'+$(this).attr("data-val")).show();
		$('.cancel_leg').hide();
		$('#action').val('remove_vol');
		$('#legs_select').submit();
		return true;
	}

	$(document).ready(function() {
$(".cancel_leg").on("click",function(){
	if($(this).attr("legtype")=='join')
	{
		//$(".loder_cancel,#select_leg,#leave_transport").hide();
		$('.'+$(this).attr("data-val")).show();
		$('.cancel_leg,.btn-secondary,.driver-ono-user').hide();
		
		$('#legs_select').submit();
		return true;
	}
	else if($(this).attr("legtype")=='remove')
	{
		$('#remove_popup_'+$('#cancel_leg_id').val()).modal('show');
		return false;
	}
	else
	{
		//alert($('#cancel_leg_id').val());
		//$('#exit_popup_transport_leg ')
		//$('#cancel_popup_'+$('#cancel_leg_id').val()).modal('show');
		$('#exit_popup_transport_leg').modal('show');
		return false;
		
	}

	});
});	

	
$(document).ready(function(){
jQuery(document).on('click','#insert_phone_number_driver',function(e){
var cancel_msg = $('#phone_number_driver').val();	
var error_msg=0;
if(cancel_msg=='')
{
	error_msg =1;
	alert('Please enter phone number');
} else {
	var a = /^(1\s|1|)?((\(\d{3}\))|\d{3})(\-|\s)?(\d{3})(\-|\s)?(\d{4})$/.test(cancel_msg);
	if(a == false)
	{
		error_msg =1;
		alert('Please enter valid telephone number');
	}	
}
if(error_msg == 0)
{	
	$('#telephone_no').val(cancel_msg);
	set_phone_number = 0;
	verify_phone_number = 1;
	$('#phone-number-driver').modal('hide');
	$("#click_airline_trip").trigger( "click" );	
}
});

$(document).on('click','#submit-term-condition',function(){
	
		var accept_condition = 1;
		if($('#accept_term:checked').length>0)
		{
			$('#accepted_term_condition').val('1');
			$("#click_airline_trip").trigger( "click" );
			$('#accept-term-condition').modal('hide');	
		} else {
			alert("Pls accept term and condition");
		}		
});

});

$(document).on('click','#accept_term',function(){
	
	if($('#accept_term:checked').length>0)
	{
		//$('#submit-term-condition').removeClass('disabled');
		$('#submit-term-condition-unchecked').hide();
		$('#submit-term-condition').show();
	} else {
		$('#submit-term-condition-unchecked').show();
		$('#submit-term-condition').hide();
		//$('#submit-term-condition').addClass('disabled');
	}	
	
});

$(document).on('click','#reason-cancel-transport',function(e){
var cancel_msg = $('#cancelmessage').val();	
var error_msg=0;
if(cancel_msg=='')
{
	error_msg =1;
	alert('Please enter the message');
}
if(error_msg == 0)
{	
	$('#cancel-transport-description').modal('hide');
	$('#transport_loader').modal('show');
	$('#cancel_trans_text').val(cancel_msg);	
	$('#cancel_transport').submit();
}
});

function verify_user_profile()
{
		var route_type = '3';
		$.ajax({
			type: "POST",
            url: base_url+"org_transportation/retrive_user_profile_data/",
			beforeSend: function() 
			{
				$('#loader').show();
			},
			data:{
				route_type:route_type,
			},
			complete: function() 
			{
					 $('#loader').hide();
			},
            success:function(data)
			{
				var profile_data = jQuery.parseJSON(data);
				$('#verify_first_name').val(profile_data['user_detail']['st_display_name']);
				$('#verify_last_name').val(profile_data['user_detail']['st_last_name']);
				$('#verify_email_address').val(profile_data['user_detail']['st_email']);
				$('#verify_phone_no').val(profile_data['user_detail']['st_phone_number']);
				$('#verified_num_status').val(profile_data['user_detail']['number_verified']);
				var select_type_html = '';
				var airline_type_html = '';
				var veh_type = profile_data['airline'];
					
				select_type_html += "<option value=''>Select Airline</option>";
				for(var j=0;j<veh_type.length; j++)
				{	
					if(profile_data['airline_emp'][0]['st_airline_name'] == veh_type[j]['st_airline_name'])
						select_type_html += "<option value='"+veh_type[j]['st_airline_name']+"' selected>"+veh_type[j]['st_airline_name']+"</option>";
					else
						select_type_html += "<option value='"+veh_type[j]['st_airline_name']+"'>"+veh_type[j]['st_airline_name']+"</option>";
				}
				$('#airline_name').append(select_type_html);
					
				var airbase_type = profile_data['airbase'];
				airline_type_html += "<option value=''>Select Airbase</option>";
				for(var j=0;j<airbase_type.length; j++)
				{	
					if(profile_data['airline_emp'][0]['st_base_name'] == airbase_type[j]['st_base_name'])
						airline_type_html += "<option value='"+airbase_type[j]['st_base_name']+"' selected>"+airbase_type[j]['st_label']+"</option>";
					else
						airline_type_html += "<option value='"+airbase_type[j]['st_base_name']+"'>"+airbase_type[j]['st_label']+"</option>";
				}
				$('#airline_base').append(airline_type_html);
				
				$('#vehicle_id').val(profile_data['airline_emp'][0]['in_id']);	
				
				$('#verify-user-profile').modal('show');
				return false;	
            }
        });
}

$(document).ready(function() 
{
	
		$('#click_airline_trip').on('click', function(){
				
			var date_picker_value = $('#pickupselect1').val();
			if(date_picker_value =='')
			{
				alert('Please enter trip date');
				return false;
			} else {
				$('#click_airline_trip').hide();
				if(user_accept_condition == 1 && $('#accepted_term_condition').val()== 0)
				{
							//set_phone_number = 0;
						$('#accept-term-condition').modal('show');
						return false;
				}
				if($('#completed_verification').val()=='0')
				{	
				verify_user_profile();
				return false;
				} else {
					$('#leg_reorder_loader').modal('show');
					$('#submit_airline_trip_date').val('1');
					$('#airline_trip').submit();
				}
				/*$.ajax({
						url: base_url+"org_transportation/check_phone_no_status/" ,
						async:false,
						success: function (status)
						{
								set_phone_number = status;	
						}
					});*/
					
					//$('#leg_reorder_loader').modal('show');
					//$('#submit_airline_trip_date').val('1');
					//$('#airline_trip').submit();
				}		
			}); 
			
		//});
		
		$('#make_changes').on("click",function()
		{
			$("#verify_first_name").attr("readonly", false);
			$("#verify_last_name").attr("readonly", false);
			$("#verify_email_address").attr("readonly", false);
			$("#verify_phone_no").attr("readonly", false);
			$("#airline_name,#airline_base").attr("disabled", false);
			//$("#verify_user_vehicle_license_plate,#verify_user_vehicle_color").attr("readonly", false);
			$('#make_changes').hide();
			$('#correct_info').hide();
			$('#cancel_verify_form').show();
			$('#save_verify_form').show();
			//$('#remove_doobert_userpopup').modal('show');
			return false;
		});
		
		$('#click_airline_trip_nondoobert').on('click',function()
		{
			error_message = '';
			flag_error = 0;	
			var emailReg = /^([\w-\.\+]+@([\w-]+\.)+[\w-]{2,4})?$/;
			var date_picker_value = $('#pickupselect1').val();
			if(date_picker_value =='')
			{
				error_message +='Please enter trip date \n';
				flag_error =1;
			}
			if($('#contact_name').val()=='')
			{
				flag_error = 1;	
				error_message += 'Please Enter User Name \n';
			}
					
			if($('#contact_email').val()=='')
			{
				flag_error = 1;	
				error_message +='Please Enter User Email Address \n';
			} else if(!emailReg.test( $('#contact_email').val() ))
			{
				flag_error = 1;
				error_message +='Please enter User Valid Email Address \n';
			}
			
			if(flag_error == 1)
			{
				alert(error_message);
				return false;
			} else {
				$('#leg_reorder_loader').modal('show');
			}	
			
		});	
});

	$(document).ready(function(){
		$.validator.addMethod("telephone_number", function (value, element) {
					var a = /^(1\s|1|)?((\(\d{3}\))|\d{3})(\-|\s)?(\d{3})(\-|\s)?(\d{4})$/.test(value);
					return a;
				},'Please enter valid telephone number');
		
		 $('#verify_user_profile').validate({
					errorElement: 'span', //default input error message container
					errorClass: 'help-block', // default input error message class
					focusInvalid: true, // do not focus the last invalid input
					rules: {
						verify_first_name: {
							required: true
						},
						verify_last_name: {
							required: true
						},
						verify_phone_no: {
							required: true,
							telephone_number:true
						},
						verify_email_address: {
							required: true,
							email:true
						},
						airline_name: {
							required: true
						},
						airline_base: {
							required: true
						}	
					},
			
					messages: {
						verify_first_name: {
							required: 'Please Enter First Name.'
						},
						verify_last_name: {
							required: 'Please Enter Last Name.'
						},
						verify_phone_no: {
							required: 'Please Enter Mobile Number.'
						},
						verify_email_address: {
							required: 'Please Enter Email.',
							email: 'Please Enter Valid Email.'
						},
						airline_name: {
							required: 'Please Enter Airline Type.'
						},
						airline_base: {
							required: 'Please Enter Airline Base.'
						},
						
					},
			
					invalidHandler: function (event, validator) { //display error alert on form submit   
						$('#verify_user_profile').show();
						
						var errors = validator.numberOfInvalids();
						if (errors) {
						  var message = errors == 1
							? 'You missed 1 field. It has been highlighted'
							: 'You missed ' + errors + ' fields. They have been highlighted';
						  alert(message);
						}
					},
			
					highlight: function (element) { // hightlight error inputs
						$(element)
							.closest('.form-group').addClass('has-error'); // set error class to the control group
					},
			
					success: function (label) { //alert(label);
						label.closest('.form-group').removeClass('has-error');
						label.remove();
					},
			
					errorPlacement: function (error, element) {
						if($(element).attr('id')=='airline_name')
						{	
							error.addClass('help-block').insertAfter('#vehicle_select');
						} else if($(element).attr('id')=='airline_base'){
							error.addClass('help-block').insertAfter('#vehicle_select1');
						} else {
							error.addClass('help-block').insertAfter(element.closest('.form-control'));
						}	
					}
			
				});
	});	
	$(document).ready(function()
	{
		$(document).on('click','#correct_info,#save_verify_form',function(event) 
		{
			if($('#verify_user_profile').valid() == false) 
			{
				return false;
			} else {
				$('#correct_info,#save_verify_form,#correct_info,#cancel_verify_form,#make_changes').prop('disabled', true);
				var current_url = window.location.pathname;
				var route_type = '3';
				var first_name = $('#verify_first_name').val();
				var last_name  = $('#verify_last_name').val();
				var email_address = $('#verify_email_address').val();
				var phone_no = 	$('#verify_phone_no').val();
				var vehicle_id = $('#vehicle_id').val();
				var airline_name = $('#airline_name').val();
				var airline_base = $('#airline_base').val();
				//var user_vehicle_license_plate = $('#verify_user_vehicle_license_plate').val();
				
				//document.getElementById("send_code").disabled = true;		
					$.ajax({
							type: "POST",
							url: base_url+"user/update_general_profile/" ,
							//async:false,
							beforeSend:function(){
									$('#loader').show();
							},
							data:
							{
								first_name:first_name,
								last_name:last_name,
								email_address:email_address,
								phone_no:phone_no,
								vehicle_id:vehicle_id,
								airline_name:airline_name,
								airline_base:airline_base,
								route_type:route_type,
							},
							complete: function() {
								
							},
							success:function(data)
							{
									$('#loader').hide();
									if(data == 1)
									{    
										$('#verify-user-profile').modal('hide');
										jQuery('#number_verification_covering').modal('show');  
										$("#SendCode_covering").hide(); 
										$("#VerifyCode_covering").show();
											
								   }else if(data == "Invalid"){
									   $('#correct_info,#save_verify_form,#correct_info,#cancel_verify_form').prop('disabled',false);
										alert("Unable to send the code please check mobile number you entered.");
									} else if(data =="join_leg")
									{
										  $('#verify-user-profile').modal('hide');
										  $('#completed_verification').val('1');
										  /*$('#leg_reorder_loader').modal('show');
										  
										  $('#submit_airline_trip_date').val('1');
										  $('#airline_trip').submit();*/
										  $('#completed_verification').val('1');
										$("#click_airline_trip").trigger( "click" );
									}else if(data == '3'){
										alert('Email already exist, please specify other one.');
										$('#correct_info,#save_verify_form,#make_changes,#cancel_verify_form').prop('disabled', false);
										//window.location = current_url;
									}else if(data == 	false){
										$('#correct_info,#save_verify_form,#correct_info,#cancel_verify_form').prop('disabled',false);
										alert("Unable to send the code please check the DND is inactive.");
									}			
							}
					});
			}
		});	
		
	});
	
	$(document).on('click','#covering_verify',function()
	{
			verification_code = jQuery("#covering_verification_code").val();
			if(verification_code)
			{
				verify_phone_number = 1;
				document.getElementById("covering_verify").disabled = true;       
				$.ajax({
						type: "POST",
						url: base_url+'user/check_sms_code',
						beforeSend: function()
						{
							$('#loader').show();
						},
						data: {
							verification_code:verification_code        
						},
						dataType:"json",
						complete: function()
						{
         
						},
						success:function(data)
						{
							$('#loader').hide();
							if(data == true)
							{ 
								jQuery('#number_verification_covering').modal('hide');
								
								/*$('#leg_reorder_loader').modal('show');
								$('#submit_airline_trip_date').val('1');
								$('#airline_trip').submit();*/
								$('#completed_verification').val('1');
								$("#click_airline_trip").trigger( "click" );
							}else{
								alert("Please enter valid verification code.");
								document.getElementById("covering_verify").disabled = false;
								jQuery("#covering_verification_code").val(" ");				
							}
						} 
				});
			}else
			{
				alert("Verification code is required field.");
			}
	});
	
	function covering_close_verified_tc()
	{
		if(confirm('Are you sure you want to cancel this verification?'))
		{
  			jQuery('#number_verification_covering').modal('hide');
  			alert("Sorry, The leg(s) you indicated you can help will not be send to the transport coordinator.")
  			location.reload();
  		}else{
  			return false;
  		}
	}

$(document).ready(function(){
	$(document).on('click','#c_date',function()
	{
		error_message = '';
		flag_error = 0;
		if($('#pickup_select').val()=='')
		{
			flag_error = 1;	
			error_message += 'Please Enter Transport Start Date \n';
		}
		if($('#dateselect').val()=='')
		{
			flag_error = 1;	
			error_message += 'Please Enter Transport End Date \n';	
		}
		if(flag_error == 1)
		{
			alert(error_message);
			return false;
		}
		
	});
});

function resetdropdown()
{
	if(date_select!='' && pickup_select!='')
	{
		$('#pickup_select').val(pickup_select); 
		$('#dateselect').val(date_select);
	} else {
		$('#pickup_select').val(''); 
		$('#dateselect').val('');
	}
	$('#select-action').val('0');	
}	
$(document).on('click','#add-transport-story',function(){
		$('#tab-photos-box').hide();
		$('#add-transport-story').addClass('select');
		$('#add-photo-video').removeClass('select');
		$('#transport-story').show(); 
		$('#photos-videos-box').hide(); 
		$('#story_id').val('');
		$('#rescue_story_action').val('rescue_story_action');
		$('#story_title').val('');//CKEDITOR.instances.rescue_story.setData('');
		tinyMCE.activeEditor.setContent('');	
		$('.photos-info').hide();
	});

$(document).on('click','#add-photo-video',function(){
		$('#tab-photos-box').hide();
		$('#add-photo-video').addClass('select');
		$('#add-transport-story').removeClass('select');
		$('#transport-story').hide();
		$('#photos-videos-box').show();
	});
	
	
	function copy_transport_details(transport_status,target_date,pickup_date)
	{
		if(transport_status == 4)
		{
			var error_confirm = "";
			var today = new Date();
			today.setHours(0,0,0,0);	
		
			d_date = target_date.split(" ");
			var day = d_date[2];
			var month = get_month(d_date[1]);
			var year =  today.getFullYear();
			//var tar_date_time = year+'-'+month+'-'+day+' 00:00:00';
			var tar_date_time = year+'-'+month+'-'+day+'T00:00:00';
			var useDate = new Date(tar_date_time);
		
		
			p_date = pickup_date.split(" ");
			var pday = p_date[2];
			var pmonth = get_month(p_date[1]);
			var pyear =  today.getFullYear();
		
			//var start_date_time = pyear+'-'+pmonth+'-'+pday+' 00:00:00';
			var start_date_time = pyear+'-'+pmonth+'-'+pday+'T00:00:00';
			var pickDate = new Date(start_date_time);
		
		
			if ((today <= useDate) && (today <= pickDate)) 
			{
				return(confirm('Please verify the dates of the legs.')?true:false);
			} else 
			{
				error_confirm +="Transportation target date and pick up date must be greater than or equal to the current date.";
			}			
			if(error_confirm!='')
			{
				alert(error_confirm);
				return false;
			}

		}
		else if(transport_status == 1)
		{
			var error_confirm = "";
			var today = new Date();
			today.setHours(0,0,0,0);
		
			d_date = target_date.split(" ");
			var day = d_date[2];
			var month = get_month(d_date[1]);
			var year =  today.getFullYear();
			//var tar_date_time = year+'-'+month+'-'+day+' 00:00:00';
			var tar_date_time = year+'-'+month+'-'+day+'T00:00:00';
			var useDate = new Date(tar_date_time);
		
			if ((today <= useDate)) 
			{
				return(confirm('Please verify the dates of the legs.')?true:false);
			} else {
				error_confirm +="Transportation target date must be greater than or equal to the current date.";
			}	
			//alert(error_confirm);		
			if(error_confirm!='')
			{
				alert(error_confirm);
				return false;
			}
		}
		else{
			return(confirm('Please verify the dates of the legs.')?true:false);
		}
	}

	function get_month(months)
	{
		switch (months) 
		{
		case 'Jan':
		month = "01";
		break;
		case 'Feb':
		month = "02";
		break;
		case 'Mar':
		month = "03";
		break;
		case 'Apr':
		month = "04";
		break;
		case 'May':
		month = "05";
		break;
		case 'Jun':
		month = "06";
		break;
		case 'Jul':
		month = "07";
		break;
		case 'Aug':
		month = "08";
		break;
		case 'Sep':
		month = "09";
		break;
		case 'Oct':
		month = "10";
		break;
		case 'Nov':
		month = "11";
		break;
		case 'Dec':
		month = "12";
		}
		return month;
	}