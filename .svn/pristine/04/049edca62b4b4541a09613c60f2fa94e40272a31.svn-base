<?php $base_url = $this->config->item('base_url'); 
$user_id = $this->session->userdata['userid'];
$org_id = $this->session->userdata['org_id'];
$enable_toggle = '';
if(isset($location_data) && count($location_data)>0)
{	
 $enable_toggle = 'location';
}
?>

<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en" class="no-js">
<!--<![endif]--><head>
<meta charset="utf-8"/>
<title>Manage Locations &amp; Favorites</title>
<?php include 'inc/header-css-js.php';?>
<!--<link rel='stylesheet' id='doobert-style-css'  href='<?php echo $base_url?>css/style.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='responsive-style-css'  href='<?php echo $base_url?>css/style-responsive.css?ver=1.1' type='text/css' media='all' />-->
<!--<link rel='stylesheet' id='bootstrap-style-css'  href='<?php echo $base_url?>css/bootstrap.min.css?ver=1.0' type='text/css' media='all' />-->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.8.0/css/bootstrap-slider.min.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.css"/>

<!-- Multiple file upload start -->
<!-- Generic page styles -->
<link rel="stylesheet" href="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/css/style.css">
<!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
<link rel="stylesheet" href="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/css/jquery.fileupload.css">
<link rel="stylesheet" href="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/css/jquery.fileupload-ui.css">
<!-- CSS adjustments for browsers with JavaScript disabled -->
<noscript>
<link rel="stylesheet" href="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/css/jquery.fileupload-noscript.css">
</noscript>
<noscript>
<link rel="stylesheet" href="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/css/jquery.fileupload-ui-noscript.css">
</noscript>
<!-- Multiple file upload end -->
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/css/tablescroll.css" />
</head>
<!-- BEGIN BODY -->
<body class="page-header-fixed">
<!-- nu bhushan for uploading file loader -->
<div id="loader" style="display: none;"><img src="<?php echo base_url(); ?>assets/img/ajax-modal-loading.gif" width="32" height="32" align="absmiddle">&nbsp;<span id="loadertext">Loading...</span></div>

<!-- BEGIN HEADER -->
<?php include 'inc/header-myaccount.php';?>
<!-- END HEADER -->
<div class="clearfix"> </div>
<!-- breadcrumb start -->
<section class="breadcrumb inner-breadcrumb">
	<div class="container">
		<div class="text-left">			
			<a href="<?php echo $base_url;?>dashboard">My Dashboard</a><i class="material-icons">chevron_right</i><a href="<?php echo base_url(); ?>org-dashboard/<?php echo $org_id?>">Org Dashboard</a><i class="material-icons">chevron_right</i>Manage Locations &amp; Favorites</div>
	</div>
</section>

	<section class="main-content-wrapper inner-wrapper">
        <div class="container" id="location-favorites">
            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
	                
					<article>
						<div class="entry-content">
							<div class="sub-content main-container clearfix">
								<div class="col-md-12 col-sm-12 col-xs-12 no-space">
									<h1 class="pull-left none abs"><a class="btn orange-small waves-effect waves-light addnew air-video text-center footer-learn-more-video" data-toggle="modal" data-target="#learmore-video-info" href="javascript:void(0);"><i class="fa fa-youtube-play"></i>Learn More</a><span>Manage Locations &amp; Favorites</span></h1>									
								</div>

								<div class="col-md-12 col-sm-12 col-xs-12 no-space">
									
									<?php 
								  		if($this->session->flashdata('success')) {
										  ?>
											<div class="alert alert-success">
							                	<strong>
										  			<?php echo $this->session->flashdata('success'); ?>
										  		</strong>
										  </div>
									<?php } ?>
								
									<div class="panel-group trans_accordian mar0 transportprofile" id="accordion">
										<!-- Favourite rides -->	
										<div class="panel panel-default">
										  	<div class="panel-heading">

												<h4 class="panel-title"> <a data-toggle="collapse" data-parent="#accordion" href="#favoriterides"><i class="material-icons"><?php echo (isset($enable_toggle)&& $enable_toggle=='rides' )?'remove_circle_outline':'add_circle_outline'; ?></i> <span class="txt">Manage Your Favorite Rides </span></a> </h4>

										  	</div>

										  	<div id="favoriterides" class="panel-collapse collapse <?php echo (isset($enable_toggle) && $enable_toggle=='rides' )?'in':''; ?>">
												<div class="panel-body">
										  			<div class="col-lg-12 no-space">
										  				<button aria-hidden="true" class="btn orange-small waves-effect waves-light addnew" type="button" id="add_new_favorite" name="add_new_favorite" aria-hidden="true" onclick="display_new_favorite_popup()"><i class="fa fa-plus"></i> ADD NEW FAVORITE</button>									
												 	</div><div class="br"></div>
												 	<div class="section">
														<div class="containerbox <?php echo (count($rides_data)<=4)?'auto':''; ?>"><table id="card-table" class="table list-animal-profile">
														<thead>
														  <tr>
															<th>RIDE NICKNAME<div>RIDE NICKNAME</div></th>
															<th>FROM LOCATION<div>FROM LOCATION</div></th>
															<th>TO LOCATION<div>TO LOCATION</div></th>
															<th>SPECIFIC INSTRUCTIONS<div>SPECIFIC INSTRUCTIONS</div></th>
															<th></th>															
														  </tr>
														</thead>
														<tbody>
															<?php if(isset($rides_data) && count($rides_data)>0)
															{ 
																foreach ($rides_data as $rides_key => $rides_value) 
																{
																	if(isset($location_arr) && count($location_arr)>0){
																		$from_id =  $rides_value['in_from_id'];
																		$fromloc = $location_arr[$from_id]['st_loc_nickname'];
																		$to_id =  $rides_value['in_to_id'];
																		$toloc = $location_arr[$to_id]['st_loc_nickname'];
																	}else{
																		$fromloc = '';
																		$toloc = '';
																	}
																	
																	?>
															<tr>
																<td><?php echo $rides_value['st_ride_nickname'];?></td>
																<td><?php echo $fromloc;?></td>
																<td><?php echo $toloc;?></td>
																<td><?php echo $rides_value['st_instruction'];?></td>
																<td class="padr0"><a href ="javascript:void(0);" class="btn greyaction action marr8" title="Edit" onclick="display_new_favorite_popup(<?php echo $rides_value['in_ride_id']?>)"><i class="fa fa-pencil"></i></a><a href ="javascript:void(0);" title="Delete"  onclick="delete_ride(<?php echo $rides_value['in_ride_id']?>)"; class="btn greyaction action"><i class="fa fa-trash-o"></i></a></td>
															</tr>
																<?php
																}
															}else{
																?>
																<tr>
																	<td colspan="5">No record found.</td>
																</tr>
																<?php
															}

															?>
														</tbody>
															</table></div>
													</div>
											  	</div>
											</div>
										</div>
										<!-- from and to locations -->
										<div class="panel panel-default">
										  	<div class="panel-heading">
												
										  		<h4 class="panel-title"> <a data-toggle="collapse" data-parent="#accordion" href="#fromtolocation"><i class="material-icons"><?php echo (isset($enable_toggle)&& $enable_toggle=='location' )?'remove_circle_outline':'add_circle_outline'; ?></i> <span class="txt">Manage Your From & To Locations </span></a> </h4>
										  	</div>
										  	<div id="fromtolocation" class="panel-collapse collapse <?php echo (isset($enable_toggle) && $enable_toggle=='location' )?'in':''; ?>">
												<div class="panel-body">
										  			<div class="col-lg-12 no-space">
														<button aria-hidden="true" class="btn orange-small waves-effect waves-light addnew" type="button" id="add_new_location" name="add_new_location" aria-hidden="true" onclick="display_new_location_popup()"><i class="fa fa-plus"></i> ADD NEW LOCATION</button>
													</div><div class="br"></div>
													<div class="section">
														<div class="containerbox <?php echo (count($location_data)<=4)?'auto':''; ?>"><table id="card-table-fromto" class="table list-animal-profile">
														<thead>
														  <tr>
															<th class="first">LOCATION NICKNAME<div>LOCATION NICKNAME</div></th>
															<th class="w144">LOCATION NAME<div>LOCATION NAME</div></th>
															<th>ADDRESS<div>ADDRESS</div></th>
															<th>CONTACT NAME<div>CONTACT NAME</div></th>
															<th class="w144">CONTACT PHONE<div>CONTACT PHONE</div></th>
															<th></th>
														  </tr>
														</thead>
														<tbody>
														<?php if(isset($location_data) && count($location_data)>0)
															{ 
																foreach ($location_data as $location_key => $location_value) 
																{
																	//$address = $location_value['st_loc_street'].", ".$location_value['st_loc_city'].", ".$location_value['st_loc_state'].", ".$location_value['st_loc_zip'];
																	$address ='';
																	$address .= (isset($location_value['st_loc_street']) && $location_value['st_loc_street']!='' )?$location_value['st_loc_street'].", ":"";
																	$address .= (isset($location_value['st_loc_city']) && $location_value['st_loc_city']!='' )?$location_value['st_loc_city'].", ":"";
																	$address .= (isset($location_value['st_loc_state']) && $location_value['st_loc_state']!='' )?$location_value['st_loc_state'].", ":"";
																	$address .= (isset($location_value['st_loc_zip']) && $location_value['st_loc_zip']!='' )?$location_value['st_loc_zip']:"";
																	?>
																	<tr>
																		<td><?php echo $location_value['st_loc_nickname']; ?></td>
																		<td><?php echo $location_value['st_loc_name']; ?></td>
																		<td><?php echo $address; ?></td>
																		<td><?php echo $location_value['st_loc_contact']; ?><br><a href="mailto:<?php echo $location_value['st_loc_email']; ?>"><?php echo $location_value['st_loc_email']; ?></a></td>
																		<td><?php echo $location_value['st_loc_phone']; ?></td>
																		<td class="padr0"><a href ="javascript:void(0);" class="btn greyaction action marr8" title="Edit" onclick="display_new_location_popup(<?php echo $location_value['in_loc_id']?>)"><i class="fa fa-pencil"></i></a><a href ="javascript:void(0);" onclick="delete_location(<?php echo $location_value['in_loc_id']?>)";  class="btn greyaction action" title="Delete"><i class="fa fa-trash-o"></i></a></td>
																	</tr>
																	<?php
																}
															}else{
																?>
																<tr>
																	<td colspan="6">No record found.</td>
																</tr>
																<?php
															}

															?>
														</tbody>
															</table></div>
													</div>
											  	</div>
											</div>
										</div>
									</div>
								 </div>
							</div>
						</div>
				</article><!-- #post-## -->
               
			        <div class="modal fade bs-modal-lg in" id="new-location" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			            <form class="horizontal-form" role="form" name="new-location-form" id="new-location-form" action="<?php echo $base_url.'add-location'?>" method="post">
			                <div class="modal-dialog">
			                    <div class="modal-content">
			                      	<div class="modal-header">
			                            <button aria-hidden="true" data-dismiss="modal" class="close" type="button"></button>
			                            <h4 class="modal-title">Add New Location</h4>
			                        </div>
			                            
		                            <div class="modal-body">
		                            	<div>
		                            		<label class="control-label">Location Details:</label>
		                            	</div>
		                            	<div class="box">
	                            		<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
	                            			<div class="form-group"><label class="control-label" for="st_loc_nickname">Location Nickname:</label>
	                            				<input type="text" class="form-control" id="st_loc_nickname" name="st_loc_nickname" placeholder="Enter Nickname">
	                            			</div>		
	                            		</div>
	                            		<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
	                            			<div class="form-group"><label class="control-label" for="st_loc_name">Location Actual Name:</label>
	                            				<input type="text" class="form-control" id="st_loc_name" name="st_loc_name" placeholder="Enter Location Name">
	                            			</div>
	                            		</div>
	                            		<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
	                            			<div class="form-group"><label class="control-label" for="st_loc_street">Street:</label>
	                            				<input type="text" class="form-control" id="st_loc_street" name="st_loc_street" placeholder="Enter Street Address">
	                            			</div>		
	                            		</div>
	                            		<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
	                            			<div class="form-group"><label class="control-label" for="st_loc_add">City, State Or Postal Code:</label>
	                            				<input type="text" class="form-control" id="st_loc_add" name="st_loc_add" placeholder="Enter From City, State or Postal Code">
	                            			</div>		
	                            		</div><div class="br"></div>
		                            	</div>
		                            	<div>
		                            		<label class="control-label">Location Contact Details:</label>
		                            	</div>
		                            	<div class="box marb26">
	                            		<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
	                            			<div class="form-group"><label class="control-label" for="st_loc_contact">Contact Name:</label>
	                            				<input type="text" class="form-control" id="st_loc_contact" name="st_loc_contact" placeholder="Enter Contact Name">
	                            			</div>		
	                            		</div>
	                            		<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
	                            			<div class="form-group"><label class="control-label" for="st_loc_email">Contact Email:</label>
	                            				<input type="text" class="form-control" id="st_loc_email" name="st_loc_email" placeholder="Enter Contact Email">
	                            			</div>
	                            		</div>
	                            		<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
	                            			<div class="form-group"><label class="control-label" for="st_loc_phone">Contact Phone:</label>
	                            				<input type="text" class="form-control" id="st_loc_phone" name="st_loc_phone" placeholder="Enter Contact Phone">
	                            			</div>		
	                            		</div>
	                            	<div class="br"></div>
		                            	</div>
		                            				                            	
		                               	<input type="hidden" name="frm_location" id="frm_action" value="submit" />
		                               	<input type="hidden" name="in_user_id" value="<?php echo $user_id?>">
		                               	<input type="hidden" name="in_org_id" value="<?php echo $org_id?>">
		                               	<input type="hidden" name="in_loc_id" id="in_loc_id" value="<?php echo $in_loc_id?>">
										
			                            <div class="btn-center"><a href="javascript:void(0);" id='cancel_link' class="btn black waves-effect waves-light" data-dismiss="modal">Cancel</a><button aria-hidden="true" id="submit_location" value="submit_location" name="action" class="btn orange-small waves-effect waves-light" type="submit"><i class="fa fa-plus"></i> Add New Location</button></div>
			                    	</div>
			                    </div>
			                </div>
			           	</form>
			        </div>

			        <!-- New favorite modal -->
			        <div class="modal fade bs-modal-lg in" id="new-ride" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			            <form class="horizontal-form" role="form" name="new-ride-form" id="new-ride-form" action="<?php echo $base_url.'add-ride'?>"  method="post">
			                <div class="modal-dialog">
			                    <div class="modal-content">
			                      	<div class="modal-header">
			                            <button aria-hidden="true" data-dismiss="modal" class="close" type="button"></button>
			                            <h4 class="modal-title">Add New Favorite</h4>
			                        </div>
			                            
		                            <div class="modal-body">
										<div class="box marb26">
		                            	<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
	                            			<div class="form-group"><label class="control-label" for="st_ride_nickname">Ride Nickname:</label>
	                            				<input type="text" class="form-control" id="st_ride_nickname" name="st_ride_nickname" placeholder="Enter Nickname">
	                            			</div>		
	                            		</div><div class="br"></div>
	                            		<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
	                            			<div class="form-group">
	                            			<label class="control-label" for="in_from_id">From Location:</label>
	                            				<div class="select-style"><select name="in_from_id" id ="in_from_id" class="form-control">
	                            					<option value="">Select</option>
	                            					<?php
	                            					if(isset($location_data) && count($location_data)>0){
	                            						foreach ($location_data as $location_key => $location_value) {
	                            							?>
	                            							<option value="<?php echo $location_value['in_loc_id']?>"><?php echo $location_value['st_loc_nickname'];?></option>
	                            							<?php
	                            						}
	                            					}
	                            					?>
													</select></div>
	                            			</div>
	                            		</div>
	                            		<div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
	                            			<div class="form-group"><label class="control-label" for="in_to_id" >To Location:</label>                      				
	                            				<div class="select-style">
	                            				<select name="in_to_id" id ="in_to_id" class="form-control">
	                            					<option value="">Select</option>
	                            					<?php
	                            					if(isset($location_data) && count($location_data)>0){
	                            						foreach ($location_data as $location_key => $location_value) {
	                            							?>
	                            							<option value="<?php echo $location_value['in_loc_id']?>"><?php echo $location_value['st_loc_nickname'];?></option>
	                            							<?php
	                            						}
	                            					}
	                            					?>
													</select></div>
	                            			</div>
	                            		</div><div class="br"></div>
	                            		<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
	                            			<div class="form-group"><label class="control-label" for="st_instruction">Specific Instructions:</label>
	                            				<textarea class = "form-control" cols="1000" rows="2" name ="st_instruction" id ="st_instruction"  placeholder="Enter Specific Instructions"><?php echo $location_value['st_instruction'];?></textarea>
	                            			</div>		
											</div><div class="br"></div>
										</div>
										<input type="hidden" name="in_user_id" value="<?php echo $user_id?>">
		                               	<input type="hidden" name="in_org_id" value="<?php echo $org_id?>">
		                               	<input type="hidden" name="in_ride_id" id="in_ride_id" value="<?php echo $in_ride_id?>">
			                            <div class="btn-center"><a href="javascript:void(0);" id='cancel_link' data-dismiss="modal" class="btn black waves-effect waves-light">Cancel</a><button aria-hidden="true" id="submit_ride" value="submit_ride" name="action" class="btn orange-small waves-effect waves-light" type="submit"><i class="fa fa-plus"></i> Add New Favorite</button></div>
	                      			</div>
			                    	</div>
			                    </div>
			                </div>              <!-- /.modal-dialog --> 
			            </form>
			        </div>
			        <!-- modal ends -->
		    	</div>
		    </div>
		</div>
	</section>
	
	
	
	
	
	<!--modal for video-->
			<div class="modal fade" id="learmore-video-info" role="dialog">
              <div class="modal-dialog">    
                <!-- Modal content-->
                  <div class="modal-content">
                  <div class="modal-header">
                      <button type="button" class="close close-video" id="closemodel" data-dismiss="modal">&times;</button>
                    </div>
                  <div id="animal-rescue-video" data-lightbox="on" class="art_yt center" itemscope="" itemid="" itemtype="https://schema.org/VideoObject">
                      <link itemprop="url" href="https://youtu.be/<?php echo $signup_video[19]; ?>">
                      <meta itemprop="name" content="Doobert by Locations and favorites">
                      <meta itemprop="description" content="Doobert by Locations and favorites">
                      <meta itemprop="duration" content="PT5M00S">
                      <link itemprop="thumbnailUrl" href="https://www.doobert.com/wp-content/uploads/2017/01/video-thumbnail.jpg">
                      <span itemprop="thumbnail" itemscope="" itemtype="https://schema.org/ImageObject">
                      <link itemprop="contentUrl" href="https://www.doobert.com/wp-content/uploads/2017/01/video-thumbnail.jpg">
                      <meta itemprop="width" content="1280">
                      <meta itemprop="height" content="720">
                      </span>
                      <link itemprop="embedUrl" href="https://www.youtube.com/embed/<?php echo $signup_video[19]; ?>">
                      <meta itemprop="isFamilyFriendly" content="True">
                      <meta itemprop="datePublished" content="2017-01-24">
                      <meta itemprop="uploadDate" content="2017-01-24">
                      <iframe class="video-iframe" id="learnmore-video" src="https://www.youtube.com/embed/<?php echo $signup_video[19]; ?>?rel=0" data-play="0" allowfullscreen="" width="100%" height="521" frameborder="0"></iframe>
                  </div>
                </div>      
              </div>
            </div>

<script src="<?php echo $base_url; ?>assets/plugins/jquery-validation/dist/jquery.validate.min.js" type="text/javascript"></script>
<!--script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script-->
<?php include 'inc/footer-dashboard.php';?>

<script src="<?php echo base_url(); ?>assets/scripts/tipso.js" type="text/javascript" charset="utf-8"></script> 
<script type="text/javascript">
get_zip_code('<?php echo $sender_zip; ?>','#st_loc_add');
$('#st_loc_phone').inputmask("(999) 999-9999");

$(document).ready(function(e) {	

	//location form validation
	jQuery.validator.addMethod("locationvalidate", function(value, element) {
		var in_from = jQuery("#in_from_id").val();
        var in_to = jQuery("#in_to_id").val();
        
		if(in_from == in_to){
			document.getElementById("#in_from_id").selectedIndex = "";
			document.getElementById("#in_to_id").selectedIndex = "";
		}
	},
		   "Please select the different from and to location."
		
	);

	jQuery('#new-location-form').validate({
					
	            errorElement: 'span', //default input error message container
	            errorClass: 'help-block', // default input error message class
	            focusInvalid: false, // do not focus the last invalid input
	            rules: {
	               st_loc_nickname: {
					required: true
					},
					st_loc_name: {
						required: true
					},
					st_loc_street: {
						required: true
					},
					st_loc_add: {
						required: true
					},
					st_loc_contact: {
						required: true
					},
					st_loc_email: {
						required: true,
						email: true
					},
					st_loc_phone: {
						required: true
					}
	                
	            },

	            messages: {
	               st_loc_nickname: {
						required: 'Please enter location nickname.'
					},
					st_loc_name: {
						required: 'Please enter location actual name.'
					},
					st_loc_street: {
						required: 'Please enter street.'
					},
					st_loc_add: {
						required: 'Please enter city,state or zip.'
					},
					st_loc_contact: {
						required: 'Please enter contact name.'
					},
					st_loc_email: {
						required: 'Please enter contact email.'
					},
					st_loc_phone: {
						required: 'Please enter contact phone.' 
					}
			   },

		invalidHandler: function (event, validator) { //display error alert on form submit   
				
			var errors = validator.numberOfInvalids();
					if (errors) {
					  var message ='';
					 if(errors <= 3){
			              for (var i=0;i<validator.errorList.length;i++){
			                  message += validator.errorList[i]['message']+"\n";
			              }
			            }
			            else{
									message = 'You missed ' + errors + ' fields. They have been highlighted';
								  
			            }
					  alert(message);
					  return false;
					}		
		},

		highlight: function (element) { // hightlight error inputs
			$(element)
				.closest('.form-group').addClass('has-error'); // set error class to the control group
		},

		success: function (label) { //alert(label);
			label.closest('.form-group').removeClass('has-error');
			label.remove();
		},
		
		errorPlacement: function (error, element) { 
			
			 error.insertAfter(element.closest('.form-control'));
		}
		
	});

	//ride form validation
	jQuery('#new-ride-form').validate({
					
	            errorElement: 'span', //default input error message container
	            errorClass: 'help-block', // default input error message class
	            focusInvalid: false, // do not focus the last invalid input
	            rules: {
	               st_ride_nickname: {
					required: true
					},
					in_from_id: {
						required:{
								depends: function(){
										var in_from = jQuery("#in_from_id").val();
								        var in_to = jQuery("#in_to_id").val();
								        if(in_from != '' && in_to != ''){
								            if(in_from == in_to){
								            	alert("Please select another From Location");
											 	document.getElementById("in_from_id").selectedIndex = "";
											}
										}else{
											return true;
										}
								}
						},

					},
					in_to_id: {
						required: {
								depends: function(){
										var in_from = jQuery("#in_from_id").val();
								        var in_to = jQuery("#in_to_id").val();
								        if(in_from != '' && in_to != ''){
								        	if(in_from == in_to){
								        		alert("Please select another To Location");
												document.getElementById("in_to_id").selectedIndex = "";
											}
										}else{
											return true;
										}
								}
						},
					},
					st_instruction: {
						required: true
					}
	                
	            },

	            messages: {
	               st_ride_nickname: {
						required: 'Please enter ride nickname.'
					},
					in_from_id: {
						required: 'Please select from location.'
					},
					in_to_id: {
						required: 'Please select to location.'
					},
					st_instruction: {
						required: 'Please enter specific instructions.'
					}		

	           },

		invalidHandler: function (event, validator) { //display error alert on form submit   
				
			var errors = validator.numberOfInvalids();
			if (errors) {
			  var message ='';
			 if(errors <= 3){
	              for (var i=0;i<validator.errorList.length;i++){
	                  message += validator.errorList[i]['message']+"\n";
	              }
	            }
	            else{
					message = 'You missed ' + errors + ' fields. They have been highlighted';
						  
	            }
			  alert(message);
			  return false;
			}		
		},

		highlight: function (element) { // hightlight error inputs
			$(element)
				.closest('.form-group').addClass('has-error'); // set error class to the control group
		},

		success: function (label) { //alert(label);
			label.closest('.form-group').removeClass('has-error');
			label.remove();
		},
		
		errorPlacement: function (error, element) { 
			
			if(element.attr("id") != "drop_zip" && element.attr("id") != "upcoming-trip-tripdate") {
				error.addClass('help-block').insertAfter(element.closest('.form-control'));
			}
			
			if(element.attr("id") == "drop_zip") {
				error.insertAfter('.input-group-btn-location');
			}
			if(element.attr("id") == "upcoming-trip-tripdate") {
				error.insertAfter('.input-group-btn-date');
			}
		}
	});	
});

	function display_new_location_popup(in_loc_id)
	{
		in_loc_id = in_loc_id || '';
		if(in_loc_id != ''){
			
			$.ajax(
	        {
	            url: base_url+"location_favorite/edit_location/"+in_loc_id,
	            dataType: "json",
	            method:"post",
				beforeSend: function(){
				  $('#loader').show();
				},
	            data:{
	            	in_loc_id:in_loc_id
	            },
				complete: function(){
				 $('#loader').hide();
				},
	            success: function (data)
	            {
	            	console.log(data);

					if(data)
					{

						var address = data.st_loc_zip+", "+data.st_loc_city+", "+data.st_loc_state;
						$('#st_loc_nickname').val(data.st_loc_nickname);
						$('#st_loc_name').val(data.st_loc_name);
						$('#st_loc_street').val(data.st_loc_street);
						$('#st_loc_contact').val(data.st_loc_contact);
						$('#st_loc_email').val(data.st_loc_email);
						$('#st_loc_phone').val(data.st_loc_phone);
						$('#st_loc_add').val(address);
						$('#in_loc_id').val(data.in_loc_id);
						$('#new-location-form').find('.form-group').removeClass('has-error');
						$('#new-location-form').find('.form-group .help-block').hide();
						$('#new-location').modal('show');
						
					}
					else
					{
	                	window.location.href=base_url+"manage-location-favorite";
					}
	            }
	        });
		}else{
			$('#new-location-form').trigger('reset');
			$('#new-location-form').find('.form-group').removeClass('has-error');
			$('#new-location-form').find('.form-group .help-block').hide();
			$('#new-location').modal('show');
			
		}
		/*$('#new-location-form').find('.form-group').removeClass('has-error');
		$('#new-location-form').find('.form-group .help-block').hide();
		$('#new-location').modal('show');*/
		
	}

	function display_new_favorite_popup(in_ride_id)
	{
		  in_ride_id = in_ride_id || ''; 
		if(in_ride_id != ''){
			$.ajax(
	        {
	            url: base_url+"location_favorite/edit_ride/"+in_ride_id,
	            dataType: "json",
	            method:"post",
				beforeSend: function(){
				  $('#loader').show();
				},
	            data:{
	            	in_ride_id:in_ride_id
	            },
				complete: function(){
				 $('#loader').hide();
				},
	            success: function (data)
	            {
	            	//console.log(data);
	                        	
					if(data)
					{
						var in_from_id = data.ride_data.in_from_id;
	            		var in_to_id = data.ride_data.in_to_id;
	            		$('#in_from_id option[value="'+in_from_id+'"]').prop('selected', true);
	            		$('#in_to_id option[value="'+in_to_id+'"]').prop('selected', true);
						$('#st_ride_nickname').val(data.ride_data.st_ride_nickname);
						$('#st_instruction').val(data.ride_data.st_instruction);
						$('#in_ride_id').val(data.ride_data.in_ride_id);
						$('#new-ride-form').find('.form-group').removeClass('has-error');
						$('#new-ride-form').find('.form-group .help-block').hide();			 
						$('#new-ride').modal('show');
						
					}
					else
					{
	                	window.location.href=base_url+"manage-location-favorite";
					}
	            }
	        });
		}else{
			$('#new-ride-form').trigger('reset');
			$('#new-ride-form').find('.form-group').removeClass('has-error');
			$('#new-ride-form').find('.form-group .help-block').hide();			 
			$('#new-ride').modal('show');
		}
		/*$('#new-ride-form').find('.form-group').removeClass('has-error');
		$('#new-ride-form').find('.form-group .help-block').hide();			 
		$('#new-ride').modal('show');*/
	}

	$('#st_loc_add').autocomplete ({
    source: function (request, response)
    {
		request.term = $.trim(request.term);
		var str	= request.term;
		var letters = /^[a-zA-Z ]+$/;	
		if(str.match(letters))
		{
			request.term = str; 
		} else {
			str = str.toUpperCase();
			request.term = str.replace(/\s/g, ''); 
		}	
		
        $.ajax(
        {
            url: base_url+"location_favorite/get_zip_code2/" ,
            dataType: "json",
            data:
            {
                term: request.term,
				city: $("#st_loc_city" ).val(),
				state: $("#st_loc_state" ).val()
            },
            success: function (data)
            {
				if(data=="1")
				{
					window.location.href=base_url;
				}
				else
				{
                	response(data);
				}
            }
        });
    },
	minLength:1,
	open: function() { $('.ui-menu').width($("#st_loc_add" ).width()) },
	focus: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.value;
			$("#st_loc_add" ).val(name);
			//$("#st_loc_country" ).val(ui.item.st_country);
			$("#st_loc_city" ).val(ui.item.city);
			$("#st_loc_state" ).val(ui.item.state_prefix);
			return false;
	},     
	select: function( event, ui ) {
		var id = ui.item.label;
		var name = ui.item.value;
		$("#st_loc_add" ).val(id);
		//$("#st_loc_country" ).val(ui.item.st_country);
		$("#st_loc_city" ).val(ui.item.city);
		$("#st_loc_state" ).val(ui.item.state_prefix);
		return false;
		}
	});

	function get_zip_code(zipcode,textfield)
	{
		
	 $.ajax(
        {
            url: base_url+"location_favorite/get_zip_code2/" ,
            dataType: "json",
            data:
            {
                term:zipcode,
            },
            success: function (data)
            {
				console.log(data[0].label)
				if(data=="1")
				{
					//window.location.href=base_url;
				}
				else
				{
					$(textfield).val(data[0].label);
                	//response(data);
				}
            }
        });
	}

	function get_zipcode(city,state,zip,country)
	{
		//alert($("#"+city).val());
		//alert($("#"+state).val());
		if($("#"+city).val() == '')
		{
			alert('Please enter city name.');
			return false;
		}
		if($("#"+state).val() == '')
		{
			alert('Please select state name.');
			return false;
		}
		if($("#"+state).val()!='' && $("#"+city).val()!='')
		{
		
		$.ajax({
			  type: "POST",
			  url: base_url+'location_favorite/get_zip_code_data/',
			  beforeSend: function(){
				 $('#loader').show();
			  },
			  data: {
				  state:$("#"+state).val(),
				  city:$("#"+city).val(),
				  action:"zip"
			  },
			  dataType:"json",
			  
			  complete: function(){
				$('#loader').hide();
			  },
			  success:function(data){
					var arr_zipcodes = data.zipcodes;												
					//alert(arr_zipcodes.length);
					//return false;
					var str_zipcode = '';
					
					if(arr_zipcodes.length > 0) {
					str_zipcode += "<select name='zipcode_list' id='zipcode_list' class='form-control' style='width:77%;'>";	
						$.each( arr_zipcodes, function( key, value ) {	
							
							str_zipcode += "<option";
							str_zipcode += " value = "+value.zip_code+">";
							str_zipcode += value.zip_code;
							str_zipcode += "</option>";	
						});
						str_zipcode += "</select>";	
						//alert(str_zipcode);
						$('#popup_zip_div').html(str_zipcode);					
					} else {
						alert('Zip code not found for provided city/state.');
				return false;
					}
			  }	
		   });
		}
	}


	$(document).on('change','#st_loc_add',function(){
		//var selected_zipcode = $(this).val();
		var selected_zipcode = $.trim($(this).val());
		var str	= selected_zipcode; 

		var letters = /^[a-zA-Z ]+$/;	
		if(str.match(letters))
		{
					 selected_zipcode = str; 
		} else {
			var  comma_string = /,/;
			if(str.match(comma_string))
			{	
				var str2 = str.split(',');
		        selected_zipcode = str2[0];		
			} else {			 
					 str = str.toUpperCase();
					 selected_zipcode = str.replace(/\s/g, ''); 
			}
				 
		}

		
		var select_dropoff_city = $("#st_loc_city" ).val();
		var select_dropoff_state = $("#st_loc_state" ).val();
		//var select_dropoff_country = $("#st_loc_country" ).val();
	
		if ($("#st_loc_add").val().indexOf(',') != -1 && $("#st_loc_add").val().indexOf('USA') != -1 && $("#st_loc_add").val().indexOf('Canada') != -1) {
			if(selected_zipcode != '' && select_dropoff_city != '' && select_dropoff_state != '' && select_dropoff_country != '')
			{
				//$("#st_loc_add").val(selected_zipcode+', '+select_dropoff_city+', '+select_dropoff_state+', '+select_dropoff_country);
				$("#st_loc_add").val(selected_zipcode+', '+select_dropoff_city+', '+select_dropoff_state);
			}
		}
		else
		{
			if(selected_zipcode!=''){
			$.ajax({
		            url: base_url+"location_favorite/get_zip_code2/" ,
		            dataType: "json",
		            data:
		            {
		                term: selected_zipcode,
						city: $("#st_loc_city" ).val(),
						state: $("#st_loc_state" ).val()
		            },
					
		            success: function (data)
		            {
						
						if(data)
						{
						$("#st_loc_add" ).val(data[0].label);
						//$("#st_loc_country" ).val(data[0].st_country);
						//country_state(data[0].st_country,"drop");
						$("#st_loc_city" ).val(data[0].city);
						$("#st_loc_state" ).val(data[0].state_prefix);
						}
						else
						{
							alert('Please enter valid to location');
							$("#st_loc_add ").val('');						
						
						}
		            }
		        });	
			}//!=''		
		}
	});

</script>
	
<script>
$(document).ready(function(){	
$(document).on('click', '#closemodel', function(){ 
   $('.art_yt iframe').attr('src', '');
});

$(document).on('click', '#learmore-video-info', function(){ 	
$('.art_yt iframe').attr('src', 'https://www.youtube.com/embed/<?php echo $signup_video[19]; ?>?rel=0');
});
	
	
	
$('#card-table-fromto').cardtable();
	$(document).on('click','.panel-title a',function()
	{
		//console.log($(this).attr('aria-expanded'));
		var panel_click = $(this);
		var expanded = panel_click.attr('aria-expanded');
		if(expanded == 'true')
		{	
			$('.panel-title a').each(function(e){
				 $("[href='"+$(this).attr('href')+"'] .material-icons").html('add_circle_outline');	
			});
			
			$("[href='"+panel_click.attr('href')+"'] .material-icons").html('remove_circle_outline');
			
		} else {
			$("[href='"+panel_click.attr('href')+"'] .material-icons").html('add_circle_outline');
		}	
		//remove_circle_outline
		//add_circle_outline
		//var html = $($(this)+' .material-icons').html();
	});
	
	
	

});

function delete_ride(in_ride_id){

	if(confirm('Are you sure you want to delete this item?'))
	{
		var base_url = "<?php echo $base_url;?>delete-ride/";
		window.location = base_url+in_ride_id;
	}else{
		return false;
	}

}

function delete_location(in_location_id){

	if(confirm('Are you sure you want to delete this item?'))
	{
		var base_url = "<?php echo $base_url;?>delete-location/";
		window.location = base_url+in_location_id;
	}else{
		return false;
	}

}
</script>
		