<?php $base_url = $this->config->item('base_url');?>

<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en" class="no-js">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
<meta charset="utf-8"/>
<title>My Notifications - Transportation Module - Doobert</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="" name="description"/>
<meta content="" name="author"/>
<?php include 'inc/header-css-js.php';?>
<?PHP //include "includes/head-links-inside.php" ?>
<link href="<?php echo base_url(); ?>assets/css/pages/timeline.css" rel="stylesheet" type="text/css"/>
</head>
<!-- BEGIN BODY -->
<body class="page-header-fixed">
<div id="loader" style="display: none;"><img src="<?php echo base_url(); ?>assets/img/ajax-modal-loading.gif" width="32" height="32" align="absmiddle">&nbsp;<span id="loadertext">Loading...</span></div>
<!--Menu Active Link-->
<?php $tab = 5; $subtab = 0; $display_menu = 1; ?>
<!-- BEGIN HEADER -->
<?PHP //include "includes/head-content-inside.php"; ?>
<?PHP include APPPATH."views/inc/header-myaccount.php" ?>
<?PHP //include "includes/head-content-login.php"; ?>
<!-- END HEADER -->
<div class="clearfix"> </div>
<section class="breadcrumb inner-breadcrumb">
	<div class="container">
		<div class="text-left">
			<a href="<?php echo $base_url;?>dashboard">My Dashboard</a><i class="material-icons">chevron_right</i>My Notifications</div>
	</div>
</section>
<!-- BEGIN CONTAINER -->
<section class="main-content-wrapper inner-wrapper">
        <div class="container">
         <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
	                
					<article>
						<div class="entry-content">
							<div class="sub-content main-container clearfix">
								<div class="col-md-12 col-sm-12 col-xs-12 no-space"> 
  <!-- BEGIN CONTENT -->
  
  <div class="page-content-wrapper">
    <div class="page-content"> 
    
      <!-- Page Content Start Here--> 
      		<!-- BEGIN PAGE CONTENT-->
			<div class="row">
				<div class="col-md-12">
					
                    	<?php //echo "<pre>";print_r($feed);die;
						if(!empty($feed)) {
						
							?>
                            <ul class="timeline">
                            <?php
							foreach($feed as $row) {
								$check_user = $this->user_settings_model->check_org_user_status($row['user_id'],$row['organization_id']);
					//echo $row['in_notification_id'];
						$org_photo='';	$user_photo='';	
						if(isset($row['org_image']) && $row['org_image']!='' && file_exists($this->config->item('upload')."org_doc/36x36/".$row['org_image'])) {
							$org_photo = $row['org_image'];
						} else {
							$org_photo = 'no_photo_icon.png';
						}
						
						if(isset($row['user_image']) && $row['user_image']!='' && file_exists($this->config->item('upload')."profile/36x36/".$row['user_image'])) {
							$user_photo = $row['user_image'];
						} else {
							$user_photo = 'no_photo_icon.png';
						}
						
						if(isset($row['animal_image']) && $row['animal_image']!='' && file_exists($this->config->item('upload')."animal_images/36x36/".$row['animal_image'])) {
							$animal_img = $row['animal_image'];
						} else {
							$animal_img = 'no_photo_icon.png';
						}
                    ?>
						<li class="timeline-yellow">
                            
                            <?php 
								//Animal Details
								if($row['in_type'] == 2 || $row['in_type'] == 3 || $row['in_type'] == 4 || (isset($row['animal_id']) && $row['animal_id'] != 0 && $row['in_type'] != 17 && $row['in_type'] != 19 && $row['in_type'] != 20)) {
									//echo $row['user_id']."_".$row['organization_id']."_".$check_user;
								//if($check_user > 0) {
									
									$get_org_name = '';
									if($row['in_type'] == 4) {
										$get_org_name = $this->user_settings_model->get_organization_id($row['animal_id'],$row['organization_id']);
									}
									
									$animal_photo = '';
									if(isset($row['animal_image']) && $row['animal_image']!='' && file_exists($this->config->item('upload')."animal_images/36x36/".$row['animal_image'])) {
										$animal_photo = $row['animal_image'];
									} else {
										$animal_photo = 'no_photo_icon.png';
									}
									
									$org_photo = '';
									if(isset($row['org_image']) && $row['org_image']!='' && file_exists($this->config->item('upload')."org_doc/36x36/".$row['org_image'])) {
									$org_photo = $row['org_image'];
									} else {
									$org_photo = 'no_photo_icon.png';
									}
									
									if(trim($row['message']) != '') {
							?>
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['dt_created'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['dt_created'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
							<?php
									$patterns = array('%##animal_image##%','%##org_name##%','%##animal_name##%','%##breed_string##%','%##type_string##%','%##org_url##%','%##animal_url##%');
									$replacements = array(base_url().'upload/animal_images/36x36/'.$animal_photo,$row['org_name'],$row['animal_name'],$row['animal_breed_name'],$row['animal_type_name'],base_url().'organization-'.$row['organization_id'].'-'.$this->common_function->get_filtered_name($row['org_name']),base_url().'animal-'.$row['animal_id'].'-'.$this->common_function->get_filtered_name($row['animal_name']));
									$content = preg_replace($patterns,$replacements,$row['message']); 
									echo $content;
								} else {
							?>
                            <?php /*?><div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['dt_created'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['dt_created'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div><?php */?>
                            
							<?php
									$get_org_name2 = '';
									$get_org_name3 = '';
								if($row['in_type'] != 4) {
										$patterns = array('%##animal_image##%','%##org_name##%','%##animal_name##%','%##breed_string##%','%##type_string##%','%##org_url##%','%##animal_url##%');
										$replacements = array(base_url().'upload/animal_images/36x36/'.$animal_photo,$row['org_name'],$row['animal_name'],$row['animal_breed_name'],$row['animal_type_name'],base_url().'organization-'.$row['organization_id'].'-'.$this->common_function->get_filtered_name($row['org_name']),base_url().'animal-'.$row['animal_id'].'-'.$this->common_function->get_filtered_name($row['animal_name']));
									} else {
										$notification_id = '';
										
										$get_id_noti = array();
										
										if($get_org_name == '') {
											$notification_id = $row['in_notification_id']-1;
											
											$get_id_noti = $this->user_settings_model->get_notification_detail($row['in_notification_id']);
											$get_org_name2 = $this->user_settings_model->get_org_name_for_transefer($get_id_noti['in_organization_id']);
											$get_id_noti2 = $this->user_settings_model->get_notification_detail($notification_id);
											$get_org_name3 = $this->user_settings_model->get_org_name_for_transefer(isset($get_id_noti2['in_organization_id'])?$get_id_noti2['in_organization_id']:0);
										}
									}
									
									if($get_org_name3 == '') {
										$notification_id = $row['in_notification_id']+1;
											
										$get_id_noti = $this->user_settings_model->get_notification_detail($row['in_notification_id']);
										$get_org_name2 = $this->user_settings_model->get_org_name_for_transefer($get_id_noti['in_organization_id']);
										$get_id_noti2 = $this->user_settings_model->get_notification_detail($notification_id);
										$original = $this->user_settings_model->get_org_name_for_transefer(isset($get_id_noti2['in_organization_id'])?$get_id_noti2['in_organization_id']:0);
										
										$patterns = array('%##animal_image##%','%##org_name##%','%##animal_name##%','%##breed_string##%','%##type_string##%','%##org_url##%','%##animal_url##%','%##org_name_to##%');
										$replacements = array(base_url().'upload/animal_images/36x36/'.$animal_photo,$row['org_name'],$row['animal_name'],$row['animal_breed_name'],$row['animal_type_name'],base_url().'organization-'.$row['organization_id'].'-'.$this->common_function->get_filtered_name($row['org_name']),base_url().'animal-'.$row['animal_id'].'-'.$this->common_function->get_filtered_name($row['animal_name']),$get_org_name);
									} else {
									
										$patterns = array('%##animal_image##%','%##org_name##%','%##animal_name##%','%##breed_string##%','%##type_string##%','%##org_url##%','%##animal_url##%','%##org_name_to##%');
										$replacements = array(base_url().'upload/animal_images/36x36/'.$animal_photo,($get_org_name3=='')?$row['org_name']:$get_org_name3,$row['animal_name'],$row['animal_breed_name'],$row['animal_type_name'],base_url().'organization-'.$row['organization_id'].'-'.$this->common_function->get_filtered_name($row['org_name']),base_url().'animal-'.$row['animal_id'].'-'.$this->common_function->get_filtered_name($row['animal_name']),($get_org_name2=='')?$get_org_name:$get_org_name2);
									}
									
									$content = preg_replace($patterns,$replacements,$this->common_function->org_feeds[$row['in_type']]);
									
									//echo ($row['org_name'] != $get_org_name3 && $get_org_name=='')?'<div class="timeline-time"> <span class="date"> '.date('m/d/y',strtotime($row['dt_created'])).'</span> <span class="time"> '.date('H:i',strtotime($row['dt_created'])).' </span> </div><div class="timeline-icon"> <i class="fa fa-road"></i> </div>'.$content:'';
									echo '<div class="timeline-time"> <span class="date"> '.date('m/d/y',strtotime($row['dt_created'])).'</span> <span class="time"> '.date('H:i',strtotime($row['dt_created'])).' </span> </div><div class="timeline-icon"> <i class="fa fa-road"></i> </div>'.$content;
									}
								//Transportation details
								} else if(($row['in_type'] == 5 || $row['in_type'] == 0) && (isset($row['transportation_id']) && $row['transportation_id'] != '0')) {
									
									$user_photo = '';
									if(isset($row['user_image']) && $row['user_image']!='' && file_exists($this->config->item('upload')."profile/29x29/".$row['user_image'])) {
										$user_photo = $row['user_image'];
									} else {
										$user_photo = 'no_photo_icon.png';
									}
									
									$org_photo = '';
									if(isset($row['org_image']) && $row['org_image']!='' && file_exists($this->config->item('upload')."org_doc/36x36/".$row['org_image'])) {
										$org_photo = $row['org_image'];
									} else {
										$org_photo = 'no_photo_icon.png';
									}
									
									if(trim($row['message']) != '') {
							?>
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
							<?php
															
								$patterns = array('%##org_name##%','%##base_url##%','%##org_image##%','%##user_image##%');
								$replacements = array($row['org_name'],base_url(),$this->config->item('upload_url').'org_doc/36x36/'.$org_photo,$this->config->item('upload_url').'profile/29x29/'.$user_photo);
								$content = preg_replace($patterns,$replacements,$row['message']); 
								echo $content;
							} else {
							?>
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
                            
                            <div class="timeline-body border">
                                <h2 class="no-bdr">
                                    <span><img src="<?php echo $this->config->item('upload_url')."org_doc/36x36/".$org_photo; ?>" alt=""  width="32"></span>
                                    <a href="<?php echo base_url().'organization-'.$row['organization_id'].'-'.$this->common_function->get_filtered_name($row['org_name']); ?>" class="profile"><?php echo $row['org_name']; ?></a> created a new transportation <?php echo '#DBT'.$row['transportation_id']; ?>.	
                                </h2>
                                <div class="timeline-content">
                                    <p class="text17"><?php echo date('l, M, d',strtotime($row['target_date'])); ?></strong></p>
                                    <div class="w175">
                                    	<p><strong>From Location</strong>
                                    	<br><?php echo $row['from_city'].', '.$row['from_state'].', '.$row['from_zip'] ?></p>
                                    </div>
                                    <div class="arrow">
                                    	<img src="<?php echo base_url(); ?>assets/img/arrow.png" alt=""></div>
                                    <div class="w175">
                                    	<p><strong>To Location</strong>
                                    	<br><?php echo $row['to_city'].', '.$row['to_state'].', '.$row['to_zip'] ?></p>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                            
							<?php
									/*$patterns = array('%##org_name##%','%##dt_target##%','%##st_from_city##%','%##st_from_state##%','%##st_from_zip##%','%##st_to_city##%','%##st_to_state##%','%##st_to_zip##%','%##url_link##%','%##base_url##%','%##org_image##%','%##user_image##%');
									$replacements = array($row['org_name'],date('l,M,d',strtotime($row['target_date'])),$row['from_city'],$row['from_state'],$row['from_zip'],$row['to_city'],$row['to_state'],$row['to_zip'],base_url().'organization-'.$row['organization_id'].'-'.$this->common_function->get_filtered_name($row['org_name']),base_url(),$this->config->item('upload_url').'org_doc/36x36/'.$org_photo,$this->config->item('upload_url').'profile/29x29/'.$row['org_image']);
									
									$content = preg_replace($patterns,$replacements,$this->common_function->org_feeds[$row['in_type']]); 
									echo $content;*/
								}
							} else if(($row['in_type'] == 6) && (isset($row['transportation_id']) && $row['transportation_id'] != '0')) {
								//die('Test Fail');
								
								//Transport Animal List Update
								$user_photo = '';
								if(isset($row['user_image']) && $row['user_image']!='' && file_exists($this->config->item('upload')."profile/29x29/".$row['user_image'])) {
									$user_photo = $row['user_image'];
								} else {
									$user_photo = 'no_photo_icon.png';
								}
								
								$org_photo = '';
								if(isset($row['org_image']) && $row['org_image']!='' && file_exists($this->config->item('upload')."org_doc/36x36/".$row['org_image'])) {
									$org_photo = $row['org_image'];
								} else {
									$org_photo = 'no_photo_icon.png';
								}
							
							if(trim($row['message']) != '') {
							?>
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
							<?php
								$patterns = array('%##org_name##%','%##base_url##%','%##org_image##%','%##user_image##%');
								$replacements = array($row['org_name'],base_url(),$this->config->item('upload_url').'org_doc/36x36/'.$org_photo,$this->config->item('upload_url').'profile/29x29/'.$user_photo);
								$content = preg_replace($patterns,$replacements,$row['message']); 
								echo $content;
							} else {
							?>
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
                            
                            <div class="timeline-body border">
									<h2 class="no-bdr"><span><img src="<?php echo $this->config->item('upload_url')."org_doc/36x36/".$org_photo; ?>" width="32" alt=""></span><a href="<?php echo base_url().'organization-'.$row['organization_id'].'-'.$this->common_function->get_filtered_name($row['org_name']) ?>" class="profile"><?php echo $row['org_name']; ?></a> updated the list of animals for <?php echo '#DBT'.$row['transportation_id']; ?>.</h2>
									<h2 class="last">
                                    <?php
								$transport_animals = $this->user_settings_model->get_transport_animals($row['transportation_id']);
								$noti_msg = (count($transport_animals)>0)?count($transport_animals).' animal is now scheduled for transportation.': "No animal(s) are schedule.";
								echo $noti_msg;
									?>
                                    </h2>
									<div class="timeline-content">
										<p class="text17"><?php echo date('l, M, d',strtotime($row['target_date'])); ?></p>
										<div class="w175"><p><strong>From Location</strong><br><?php echo $row['from_city'].', '.$row['from_state'].', '.$row['from_zip'] ?></p></div>
										<div class="arrow"><img src="<?php echo base_url(); ?>assets/img/arrow.png" alt=""></div>
										<div class="w175"><p><strong>To Location</strong><br><?php echo $row['to_city'].', '.$row['to_state'].', '.$row['to_zip'] ?></p></div>
										<div class="clearfix"></div>
								  </div>
								</div>
                            <?php } ?>
						</li>
                        
                        <?php
							 } else if(($row['in_type'] == 7) && (isset($row['transportation_id']) && $row['transportation_id'] != '0')) {
								
								$user_photo = '';
								if(isset($row['user_image']) && $row['user_image']!='' && file_exists($this->config->item('upload')."profile/29x29/".$row['user_image'])) {
									$user_photo = $row['user_image'];
								} else {
									$user_photo = 'no_photo_icon.png';
								}
								
								$org_photo = '';
								if(isset($row['org_image']) && $row['org_image']!='' && file_exists($this->config->item('upload')."org_doc/36x36/".$row['org_image'])) {
									$org_photo = $row['org_image'];
								} else {
									$org_photo = 'no_photo_icon.png';
								}
								 
								 if($row['message'] != '') {
						?>
                        	<div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
						<?php
								$patterns = array('%##org_name##%','%##base_url##%','%##org_image##%','%##user_image##%');
								$replacements = array($row['org_name'],base_url(),$this->config->item('upload_url').'org_doc/36x36/'.$org_photo,$this->config->item('upload_url').'profile/29x29/'.$user_photo);
								$content = preg_replace($patterns,$replacements,$row['message']); 
								echo $content;
								} else {
						?>
                        <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
                            
                        <div class="timeline-body border">
						<h2 class="last no-bdr"><span><img alt="" src="<?php echo $this->config->item('upload_url').'profile/29x29/'.$user_photo; ?>"  width="32"></span>Transport #DBT<?php echo $row['transportation_id']; ?> has been modified by <?php echo $row['user_name']; ?>.</h2>
						<div class="timeline-content">
										<p class="text17"><strong><?php echo date('l, M, d',strtotime($row['target_date'])); ?></strong></p>
										<div class="w175"><p><strong>From Location</strong><br><?php echo $row['from_city'].', '.$row['from_state'].', '.$row['from_zip'] ?></p></div>
										<div class="arrow"><img src="<?php echo base_url(); ?>assets/img/arrow.png" alt=""></div>
										<div class="w175"><p><strong>To Location</strong><br><?php echo $row['to_city'].', '.$row['to_state'].', '.$row['to_zip'] ?></p></div>
										<div class="clearfix"></div>
								  </div>
						</div>
						<?php
								}
							 } else if(($row['in_type'] == 8) && (isset($row['transportation_id']) && $row['transportation_id'] != '0')) {
								 
								$user_photo = '';
								if(isset($row['user_image']) && $row['user_image']!='' && file_exists($this->config->item('upload')."profile/29x29/".$row['user_image'])) {
									$user_photo = $row['user_image'];
								} else {
									$user_photo = 'no_photo_icon.png';
								}
								
								$org_photo = '';
								if(isset($row['org_image']) && $row['org_image']!='' && file_exists($this->config->item('upload')."org_doc/36x36/".$row['org_image'])) {
									$org_photo = $row['org_image'];
								} else {
									$org_photo = 'no_photo_icon.png';
								}
								 
								 if($row['message'] != '') {
								$patterns = array('%##org_name##%','%##base_url##%','%##org_image##%','%##user_image##%');
								$replacements = array($row['org_name'],base_url(),$this->config->item('upload_url').'org_doc/36x36/'.$org_photo,$this->config->item('upload_url').'profile/29x29/'.$user_photo);
								$content = preg_replace($patterns,$replacements,$row['message']); 
								echo $content;	 
							?>
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
							<?php
								 } else {
							?>
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
                            <div class="timeline-body border">
					<h2 class="last no-bdr"><span><img alt="" src="<?php echo $this->config->item('upload_url').'profile/29x29/'.$user_photo; ?>"  width="32"></span>Transport #DBT<?php echo $row['transportation_id']; ?> has been cancelled by <?php echo $row['user_name']; ?>.</h2>
					<div class="timeline-content">
									<p class="text17"><?php echo date('l, M, d',strtotime($row['target_date'])); ?></p>
									<div class="w175"><p><strong>From Location</strong><br><?php echo $row['from_city'].', '.$row['from_state'].', '.$row['from_zip'] ?></p></div>
									<div class="arrow"><img src="<?php echo base_url(); ?>assets/img/arrow.png" alt=""></div>
									<div class="w175"><p><strong>To Location</strong><br><?php echo $row['to_city'].', '.$row['to_state'].', '.$row['to_zip'] ?></p></div>
									<div class="clearfix"></div>
							  </div>
					</div>
							<?php
								 }
							 } else if(($row['in_type'] == 9) && (isset($row['transportation_id']) && $row['transportation_id'] != '0')) {
								 $user_photo = '';
								if(isset($row['user_image']) && $row['user_image']!='' && file_exists($this->config->item('upload')."profile/29x29/".$row['user_image'])) {
									$user_photo = $row['user_image'];
								} else {
									$user_photo = 'no_photo_icon.png';
								}
								
								$org_photo = '';
								if(isset($row['org_image']) || $row['org_image']!='' && file_exists($this->config->item('upload')."org_doc/36x36/".$row['org_image'])) {
									$org_photo = $row['org_image'];
								} else {
									$org_photo = 'no_photo_icon.png';
								}
								 if($row['message'] != '') {
							?>
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
							<?php
								$patterns = array('%##org_name##%','%##base_url##%','%##org_image##%','%##user_image##%');
								$replacements = array($row['org_name'],base_url(),$this->config->item('upload_url').'org_doc/36x36/'.$org_photo,$this->config->item('upload_url').'profile/29x29/'.$user_photo);
								$content = preg_replace($patterns,$replacements,$row['message']); 
								echo $content;
								} else {
							?>
                            
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
                            
                            <div class="timeline-body border">
								<h2 class="last no-bdr"><span><img alt="" src="<?php echo $this->config->item('upload_url').'profile/29x29/'.$user_photo; ?>"  width="32"></span><a class="profile" href="<?php echo base_url().'user-'.$row['user_id'].'-'.$this->common_function->get_filtered_name($row['user_name']) ?>"><?php echo $row['user_name']; ?></a> joined the transportation.</h2>
								<div class="timeline-content">
									<p class="text17"><?php echo date('l, M, d',strtotime($row['target_date'])); ?></p>
									<div class="w175"><p><strong>From Location</strong><br><?php echo $row['from_city'].', '.$row['from_state'].', '.$row['from_zip'] ?></p></div>
									<div class="arrow"><img src="<?php echo base_url(); ?>assets/img/arrow.png" alt=""></div>
									<div class="w175"><p><strong>To Location</strong><br><?php echo $row['to_city'].', '.$row['to_state'].', '.$row['to_zip'] ?></p></div>
									<div class="clearfix"></div>
							  </div></div>
							<?php		 
								 }
							 } else if(($row['in_type'] == 10) && (isset($row['transportation_id']) && $row['transportation_id'] != '0')) {
								$user_photo = '';
								if(isset($row['user_image']) && $row['user_image']!='' && file_exists($this->config->item('upload')."profile/29x29/".$row['user_image'])) {
									$user_photo = $row['user_image'];
								} else {
									$user_photo = 'no_photo_icon.png';
								}
								
								$org_photo = '';
								if(isset($row['org_image']) && $row['org_image']!='' && file_exists($this->config->item('upload')."org_doc/36x36/".$row['org_image'])) {
									$org_photo = $row['org_image'];
								} else {
									$org_photo = 'no_photo_icon.png';
								}
								 if(trim($row['message']) != '') {
							?>
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
							<?php
								$patterns = array('%##org_name##%','%##base_url##%','%##org_image##%','%##user_image##%');
								$replacements = array($row['org_name'],base_url(),$this->config->item('upload_url').'org_doc/36x36/'.$org_photo,$this->config->item('upload_url').'profile/29x29/'.$user_photo);
								$content = preg_replace($patterns,$replacements,$row['message']); 
								echo $content;
								 } else {
							?>
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
                            <div class="timeline-body border">
									<h2 class="last no-bdr">Transport #DBT<?php echo $row['transportation_id']; ?> has been confirmed.</h2>
									<div class="timeline-content">
										<p class="text17"><?php echo date('l, M, d',strtotime($row['target_date'])); ?></p>
										<div class="w175"><p><strong>From Location</strong><br><?php echo $row['from_city'].', '.$row['from_state'].', '.$row['from_zip'] ?></p></div>
									<div class="arrow"><img src="<?php echo base_url(); ?>assets/img/arrow.png" alt=""></div>
									<div class="w175"><p><strong>To Location</strong><br><?php echo $row['to_city'].', '.$row['to_state'].', '.$row['to_zip'] ?></p></div>
										<div class="clearfix"></div>
								  </div>
									</div>
							<?php
								 }
							 } else if(($row['in_type'] == 11) && (isset($row['transportation_id']) && $row['transportation_id'] != '0')) {
								$user_photo = '';
								if(isset($row['user_image']) && $row['user_image']!='' && file_exists($this->config->item('upload')."profile/29x29/".$row['user_image'])) {
									$user_photo = $row['user_image'];
								} else {
									$user_photo = 'no_photo_icon.png';
								}
								
								$org_photo = '';
								if(isset($row['org_image']) && $row['org_image']!='' && file_exists($this->config->item('upload')."org_doc/36x36/".$row['org_image'])) {
									$org_photo = $row['org_image'];
								} else {
									$org_photo = 'no_photo_icon.png';
								}
								if(trim($row['message']) != '') {
							?>
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
							<?php
								$patterns = array('%##org_name##%','%##base_url##%','%##org_image##%','%##user_image##%');
								$replacements = array($row['org_name'],base_url(),$this->config->item('upload_url').'org_doc/36x36/'.$org_photo,$this->config->item('upload_url').'profile/29x29/'.$user_photo);
								$content = preg_replace($patterns,$replacements,$row['message']); 
								echo $content;
								 } else {
							?>
                            
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
                            
                            <div class="timeline-body border">
									<h2 class="last no-bdr"><span><img alt="" src="<?php echo $this->config->item('upload_url').'profile/29x29/'.$user_photo; ?>"  width="32"></span><a class="profile" href="<?php echo base_url().'user-'.$row['user_id'].'-'.$this->common_function->get_filtered_name($row['user_name']) ?>"><?php echo $row['user_name']; ?></a> left the transportation.</h2>
									<div class="timeline-content">
										<p class="text17"><?php echo date('l, M, d',strtotime($row['target_date'])); ?></p>
										<div class="w175"><p><strong>From Location</strong><br><?php echo $row['from_city'].', '.$row['from_state'].', '.$row['from_zip'] ?></p></div>
									<div class="arrow"><img src="<?php echo base_url(); ?>assets/img/arrow.png" alt=""></div>
									<div class="w175"><p><strong>To Location</strong><br><?php echo $row['to_city'].', '.$row['to_state'].', '.$row['to_zip'] ?></p></div>
										<div class="clearfix"></div>
								  </div></div>
							<?php		 
								 }
							 } else if(($row['in_type'] == 12) && (isset($row['transportation_id']) && $row['transportation_id'] != '0')) {
								$user_photo = '';
								if(isset($row['user_image']) && $row['user_image']!='' && file_exists($this->config->item('upload')."profile/29x29/".$row['user_image'])) {
									$user_photo = $row['user_image'];
								} else {
									$user_photo = 'no_photo_icon.png';
								}
								
								$org_photo = '';
								if(isset($row['org_image']) && $row['org_image']!='' && file_exists($this->config->item('upload')."org_doc/36x36/".$row['org_image'])) {
									$org_photo = $row['org_image'];
								} else {
									$org_photo = 'no_photo_icon.png';
								}
								 if(trim($row['message'])) {
							?>
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
							<?php
								$patterns = array('%##org_name##%','%##base_url##%','%##org_image##%','%##user_image##%');
								$replacements = array($row['org_name'],base_url(),$this->config->item('upload_url').'org_doc/36x36/'.$org_photo,$this->config->item('upload_url').'profile/29x29/'.$user_photo);
								$content = preg_replace($patterns,$replacements,$row['message']); 
								echo $content;
								 } else {
							?>
                            
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
                            
                            <div class="timeline-body border">
							<h2 class="last no-bdr"><span><img alt="" src="<?php echo $this->config->item('upload_url').'profile/29x29/'.$user_photo; ?>"  width="32"></span><a class="profile" href="<?php echo base_url().'user-'.$row['user_id'].'-'.$this->common_function->get_filtered_name($row['user_name']) ?>"><?php echo $row['user_name']; ?></a> joined a leg <?php if(!empty($row['in_sort_order'])){echo "#".$row['in_sort_order'];} ?>.</h2>
							<div class="timeline-content">
									<p class="text17"><?php echo date('l, M, d',strtotime($row['target_date'])); ?></p>
										<div class="w175"><p><strong>From Location</strong><br><?php echo $row['from_city'].', '.$row['from_state'].', '.$row['from_zip'] ?></p></div>
									<div class="arrow"><img src="<?php echo base_url(); ?>assets/img/arrow.png" alt=""></div>
									<div class="w175"><p><strong>To Location</strong><br><?php echo $row['to_city'].', '.$row['to_state'].', '.$row['to_zip'] ?></p></div>
									<div class="clearfix"></div>
							  </div></div>
							<?php		 
								 }
							 } else if(($row['in_type'] == 13) && (isset($row['transportation_id']) && $row['transportation_id'] != '0')) {
								$user_photo = '';
								if(isset($row['user_image']) && $row['user_image']!='' && file_exists($this->config->item('upload')."profile/29x29/".$row['user_image'])) {
									$user_photo = $row['user_image'];
								} else {
									$user_photo = 'no_photo_icon.png';
								}
								
								$org_photo = '';
								if(isset($row['org_image']) && $row['org_image']!='' && file_exists($this->config->item('upload')."org_doc/36x36/".$row['org_image'])) {
									$org_photo = $row['org_image'];
								} else {
									$org_photo = 'no_photo_icon.png';
								}
								 if(trim($row['message'])) {
							?>
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
							<?php
								$patterns = array('%##org_name##%','%##base_url##%','%##org_image##%','%##user_image##%');
								$replacements = array($row['org_name'],base_url(),$this->config->item('upload_url').'org_doc/36x36/'.$org_photo,$this->config->item('upload_url').'profile/29x29/'.$user_photo);
								$content = preg_replace($patterns,$replacements,$row['message']); 
								echo $content;
								 } else {
							?>
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
                            
                            <div class="timeline-body border">
							<h2 class="last no-bdr"><span><img alt="" src="<?php echo $this->config->item('upload_url').'profile/29x29/'.$user_photo; ?>"  width="32"></span><a class="profile" href="<?php echo base_url().'user-'.$row['user_id'].'-'.$this->common_function->get_filtered_name($row['user_name']) ?>"><?php echo $row['user_name']; ?></a> left leg <?php if(!empty($row['in_sort_order'])){echo "#".$row['in_sort_order'];} ?> from transportation.</h2>
							<div class="timeline-content">
									<p class="text17"><?php echo date('l, M, d',strtotime($row['target_date'])); ?></p>
										<div class="w175"><p><strong>From Location</strong><br><?php echo $row['from_city'].', '.$row['from_state'].', '.$row['from_zip'] ?></p></div>
									<div class="arrow"><img src="<?php echo base_url(); ?>assets/img/arrow.png" alt=""></div>
									<div class="w175"><p><strong>To Location</strong><br><?php echo $row['to_city'].', '.$row['to_state'].', '.$row['to_zip'] ?></p></div>
									<div class="clearfix"></div>
							  </div></div>
							<?php
									 
								 }
							 } else if(($row['in_type'] == 14 || $row['in_type'] == 1) && (isset($row['transportation_id']) && $row['transportation_id'] != '0')) {
								$user_photo = '';
								if(isset($row['user_image']) && $row['user_image']!='' && file_exists($this->config->item('upload')."profile/29x29/".$row['user_image'])) {
									$user_photo = $row['user_image'];
								} else {
									$user_photo = 'no_photo_icon.png';
								}
								
								$org_photo = '';
								if(isset($row['org_image']) && $row['org_image']!='' && file_exists($this->config->item('upload')."org_doc/36x36/".$row['org_image'])) {
									$org_photo = $row['org_image'];
								} else {
									$org_photo = 'no_photo_icon.png';
								}
							?>
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
                            
                            <div class="timeline-body border">
								<h2 class="last no-bdr"><span><img alt="" src="<?php echo $this->config->item('upload_url').'profile/29x29/'.$user_photo; ?>"  width="32"></span><a class="profile" href="<?php echo base_url().'user-'.$row['user_id'].'-'.$this->common_function->get_filtered_name($row['user_name']) ?>"><?php echo $row['user_name']; ?></a>: <?php echo $row['message']; ?></h2></div>
                            <?php 
								//Join Organization Request
							 } else if($row['in_type'] == 15) {
								$user_photo = '';
								if(isset($row['user_image']) && $row['user_image']!='' && file_exists($this->config->item('upload')."profile/29x29/".$row['user_image'])) {
									$user_photo = $row['user_image'];
								} else {
									$user_photo = 'no_photo_icon.png';
								}
								
								$org_photo = '';
								if(isset($row['org_image']) && $row['org_image']!='' && file_exists($this->config->item('upload')."org_doc/36x36/".$row['org_image'])) {
									$org_photo = $row['org_image'];
								} else {
									$org_photo = 'no_photo_icon.png';
								}
							?>
                            <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
                            
                            <div class="timeline-body border">
								<h2 class="last no-bdr">
                                <span><img alt="" src="<?php echo $this->config->item('upload_url').'profile/29x29/'.$user_photo; ?>"  width="32"></span>
                                <a class="profile" href="<?php echo base_url().'user-'.$row['user_id'].'-'.$this->common_function->get_filtered_name($row['user_name']) ?>">
								<strong><?php echo $row['user_name']; ?></strong></a>
                                Join Organization request awaiting approval.
                                </h2>
                            </div>
							<?php
							 } else if($row['in_type'] == 16) {
								 $user_photo = '';
								if(isset($row['user_image']) && $row['user_image']!='' && file_exists($this->config->item('upload')."profile/29x29/".$row['user_image'])) {
									$user_photo = $row['user_image'];
								} else {
									$user_photo = 'no_photo_icon.png';
								}
							?>
                             <div class="timeline-time">
								<span class="date">
									 <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
								</span>
								<span class="time">
									 <?php echo date('H:i',strtotime($row['notification_date'])); ?>
								</span>
							</div>
							<div class="timeline-icon">
							  <i class="fa fa-road"></i>
							</div>
                            
                            <div class="timeline-body border">
								<h2 class="last no-bdr">
                                <span><img alt="" src="<?php echo $this->config->item('upload_url').'profile/29x29/'.$user_photo; ?>"  width="32"></span>
                                <?php echo $row['message']; ?>
                                </h2>
                            </div>
                    		<?php
							} else if($row['in_type'] == 25) {
								
								 $user_photo = '';
								if(isset($row['user_image']) && $row['user_image']!='' && file_exists($this->config->item('upload')."profile/29x29/".$row['user_image'])) {
									$user_photo = $row['user_image'];
								} else {
									$user_photo = 'no_photo_icon.png';
								}
							?>
                            	<div class="timeline-time">
                                    <span class="date">
                                         <?php echo date('m/d/y',strtotime($row['notification_date'])); ?>
                                    </span>
                                    <span class="time">
                                         <?php echo date('H:i',strtotime($row['notification_date'])); ?>
                                    </span>
								</div>
                                <div class="timeline-icon">
                                  <i class="fa fa-road"></i>
                                </div>
                                
                                <div class="timeline-body border">
                                    <h2>
                                    <span><img src="<?php echo $this->config->item('upload_url').'profile/29x29/'.$user_photo; ?>" width="32" alt=""></span>
                                   <a class="profile" href="'.<?php echo base_url().'user-'.$row['user_id'].'-'.$this->common_function->get_filtered_name($row['user_name']); ?>.'">
												<?php echo $row['user_name'] ?> </a> requires MVR check..	
                                </h2>
                                </div>
							<?php 
							 }
						} //End Foreach
					?>
                    </ul>
                    <?php		
						} else {
					?>
                    	<div class="row">
				<div class="col-md-12">
                	<div class="doobert-notification">
                    	<h2>Welcome to Doobert, you have no notifications.</h2>
                    	<ul>
                        	<li><a target="_blank" href="http://www.doobert.com/raise-funds/">Raise Funds <i class="fa fa-angle-right"></i></a></li>
                            <li><a target="_blank" href="http://www.doobert.com/how-can-you-help/sponsor-animal-rescues/">Sponsor Animal Rescues <i class="fa fa-angle-right"></i></a></li>
                            <li><a target="_blank" href="http://www.doobert.com/how-can-you-help/volunteer-rescues-shelters/">Volunteer for Rescues <i class="fa fa-angle-right"></i></a></li>
                            <li><a target="_blank" href="http://www.doobert.com/how-can-you-help/help-transport-animals/">Help Transport Animals <i class="fa fa-angle-right"></i></a></li>
                            <li><a target="_blank" href="http://www.doobert.com/receive-animal-rescue-alerts/">Receive alerts <i class="fa fa-angle-right"></i></a></li>
                        </ul>
                        <a href="<?php echo base_url().'rescue-organization' ?>" class="btn green-btn" title="Help me get setup as an organization">Help me get setup as an organization</a>
                    </div>
                </div>
			</div>
					<?php
						//echo "<h2>Welcome to Doobert, you have no notifications.</h2>";
							
						}
                     ?>
					
                    <input type="hidden" name="org_image_url" id="org_image_url" value="" />
                   <div align="center" class="view_more" style="display:none"><a href="javascript:void(0);">View more >></a></div>
                   <div align="center" class="not_found" style="display:none;">No more notifications !</div>
				</div>
			</div>
			<!-- END PAGE CONTENT--> 
      <!-- Page Content End Here--> 
    </div>
  </div>
  <!-- END CONTENT --> 
</div>
	</div>
						</div><!-- .entry-content -->
					</article><!-- #post-## -->
                </div>
            </div>
        </div>
        </section>
<!-- END CONTAINER -->

<?PHP //include "includes/footer.php" ?>
<?PHP include APPPATH."views/inc/footer-dashboard.php" ?>
<script type="text/javascript">
$(document).ready(function(e) {
	
	$('.view_more').live('click',function(){
	// $(window).scroll(function(){
		var count_notification = $('.timeline-yellow').length;
		$.ajax({
			type: "POST",
				  url: '<?php echo base_url(); ?>user_settings_and_notification/feed_pagination_fr',
				  beforeSend: function() {
					$('#loader').show();
				  },
				  data: {
					  start : count_notification,
					  end : 25
				  },
				  dataType:"html",
				  complete: function() {
					 $('#loader').hide();
				  },
				  success:function(data) {
					  if($.trim(data) != '') {
						var window_height = $(window).height();
    					var document_height = $(document).height();
					  	$('.timeline').append(data);
   					
						$('html,body').animate({ 
								scrollTop: window_height + document_height 
						},2500);
					  } else {
						  $('.not_found').show();
						  $('.view_more').hide();
					  }
					  
					 var current_notification = $('.timeline-yellow').length;
					 var total_rows = '<?php echo $count_notification_ids; ?>';
					  
					 if(current_notification == total_rows) {
						$('.view_more').hide();
					 } else {
						if(current_notification < 0) { 
							$('.view_more').show();
						}
					 }
				  }
		});
	});
});
</script>
<script type="text/javascript">
$(window).load(function(){
	var current_notification = $('.timeline-yellow').length;
	var total_rows = '<?php echo $count_notification_ids; ?>';
	
	if(current_notification == total_rows) {
		$('.view_more').hide();
	} else {
		if(current_notification > 0) {
			$('.view_more').show();
		}
	}
	 
});
</script>
<!-- END JAVASCRIPTS -->
</body>
<!-- END BODY -->
</html>