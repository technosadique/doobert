$(document).ready(function() { 
var error_display_pickup_airport = 0;
var error_display_drop_airport = 0;	
if($( window ).width() <= 1069) //767
{
	$('.large-only').html(" ");
	var tables = $('.add_transport .small-only');
	$.each(tables, function(i, tbl){
		$(tbl).prop('id', 'tbl_'+i);     
	});
} else {
	$('.small-only').html(" ");
}

/*$('#contact_phone_no').inputmask("(999) 999-9999");
$('#receiving_contact_phone_no').inputmask("(999) 999-9999");*/

$('#contact_phone_no').mask('(999) 999-9999',{placeholder: "(___) ___-____"},{'translation': {9: {pattern: /[0-9*]/,optional:false}}});
$('#receiving_contact_phone_no').mask('(999) 999-9999',{placeholder: "(___) ___-____"},{'translation': {9: {pattern: /[0-9*]/,optional:false}}});

});
var alert_trans_loc = '1';
var validation_form = '0';
jQuery(document).ready(function() 
{       
           ComponentsPickers.init();	
		   $('#auto_split').val('');	
		   $('#timepicker1').timepicker({
				defaultTime:'08:00 AM',
		   });
		   $('#timepicker2').timepicker({
				defaultTime:'08:00 PM', 
		   }); 
		  
			$('.open-timepicker1').click(function(event){
				event.preventDefault();
				$('#timepicker1').click();
			});  
			
			$('.open-timepicker2').click(function(event){
				event.preventDefault();
				$('#timepicker2').click();
			});  
			
			$('.numbersOnly').keyup(function () { 
				this.value = this.value.replace(/[^0-9\.]/g,'');
			});
});   
	

var legs_file = '';
$(document).ready(function(){
$('#loadimg').hide();
$('#driver_loadimg').hide();
$('#system_loadimg').hide();
$(document).on('click','#btn_continue',function()
{	
	var distance_duration = $("#distance_duration").val();
	var handoff_time = $("#handoff_time").val();
	var break_by = 'd';
	
	if(break_by == 'd')
	{
		if(distance_duration == '')
		{
			alert('Please enter distance.');
			return false;
		}
		
		if(distance_duration < 30)
		{
			alert('Break by distance value should be Greater then or Equal to 30 Miles.');
			return false;
		}
		
		if(handoff_time == '')
		{
			alert('Please enter handoff time between legs.');
			return false;
		}
		
		var timepicker1 = $('#timepicker1').val();
		
		//alert('timepicker1'+timepicker1);
		
		if(timepicker1 == '')
		{
			alert('Please enter leg start time');
			return false;
		}
		
		var timepicker2 = $('#timepicker2').val();
		
		//alert('timepicker2'+timepicker2);
		
		if(timepicker2 == '')
		{
			alert('Please enter leg end time');
			return false;
		}
	}
	
	if(break_by == 't')
	{
		if(distance_duration == '')
		{
			alert('Please enter distance/duration.');
			return false;
		}
		
		if(handoff_time == '')
		{
			alert('Please enter handoff time between legs.');
			return false;
		}
		
		var timepicker1 = $('#timepicker1').val();
		
		//alert('timepicker1'+timepicker1);
		
		if(timepicker1 == '')
		{
			alert('Please enter leg start time');
			return false;
		}
		
		var timepicker2 = $('#timepicker2').val();
		
		//alert('timepicker2'+timepicker2);
		
		if(timepicker2 == '')
		{
			alert('Please enter leg end time');
			return false;
		}		
	}
	
	$('#break-route-legs').modal('hide');
	$('#submit').hide();
	$('#driver_submit').hide();
	$('#system_submit').hide();
	$('#system_submit1').hide();
	
	if($.browser.msie) {
			$('.display_loader').html('<img id="system_loadimg" src="'+base_url+'assets/img/ajax-loading.gif" alt="loader" />');
	}
	$('.display_loader').show();
	
	$('#system_loadimg').show();
	
	$('#system_loader').modal('show');
	
	$("#form_break_by").val(break_by);
	$("#form_distance_duration").val($("#distance_duration").val());
	$("#form_handoff_time").val($("#handoff_time").val());
	$("#form_timepicker1").val(timepicker1);
	$("#form_timepicker2").val(timepicker2);
	
	if($('#transport_locations').valid() == true) {
		return true;		
	}
	else { 
		return false; 
	}
	
});

$(document).on('click','#system_submit,#system_submit1',function(){
		
	var file_name = '';
	$('#image_file').val('');
	$('.table-striped tr').each(function() {
    var image_files = $(this).find('td p a').text(); 
	if(image_files!='')
	{  
		if (file_name == '') {
				file_name += image_files;
		}else{
				file_name += ',' + image_files; 
		}
	}
	});
	$('#image_file').val(file_name);
	alert_trans_loc = '1';
	if($('#transport_locations').valid() == false) {
		validation_form = '1';
		return false;
	} else {
		
		$('.weight-col').each(function(e) 
		{
			if($('#quick-weight-'+e).length>0)
			{
				var qu_wgth = $('#quick-weight-'+e).val();
				if(qu_wgth>16)
				{
					if(confirm("For airline transport animal weight is more than 16 lbs, do you want to continue?")==false)
					{
						e.preventDefault();
					}
				}	
			}	
		});
		
		var from_date = $('#pickupselect').val();
		var to_date = $('#dateselect').val();
		  
		var start_time_date = new Date(from_date);
		var end_time_date = new Date(to_date);
		
		var fm_year =  $('#pickupselect_year').val(); 
		var to_year =  $('#dateselect_year').val(); 
		
		//var end_date = new Date(end_time_date.getFullYear(), end_time_date.getMonth(), end_time_date.getDate()); 
		//var start_date = new Date(start_time_date.getFullYear(), start_time_date.getMonth(), start_time_date.getDate()); 
		 
		var end_date = new Date(to_year, end_time_date.getMonth(), end_time_date.getDate()); 
		var start_date = new Date(fm_year, start_time_date.getMonth(), start_time_date.getDate());
		 
		if (start_date > end_date) {
			alert("Drop Off Date must be greather than or equal to Pick Up Date.");
			return false;
		} 
		if (end_date < start_date) {
			alert("Pick Up Date must be less than or equal to Drop Off Date.");
			return false;
		}	  
		
		$('#submit').hide();
		$('#driver_submit').hide();
		$('#system_submit').hide();
		$('#system_submit1').hide();
		if($(this).prop('id')=='system_submit1')
		{	
			$('#update_status').val('1');
			$('#in_status').val(transport_status);
		} else {	
			$('#in_status').val('4');
		}	
		if($.browser.msie) {
				$('.display_loader').html('<img id="loadimg" src="'+base_url+'assets/img/ajax-loading.gif" alt="loader" />');
		}
		
		$('.display_loader').show();
		$('#transport_loader1').modal('show');
		$('#loadimg').show();
		$('#transport_locations').submit();
		return true;
	}
});	

/*$('#drop_base_airport').autocomplete({
		 source: function (request, response)
   		 {
			request.term = $.trim(request.term);
			var str	= request.term;
			var letters = /^[a-zA-Z ]+$/;	
			if(str.match(letters))
			{
				request.term = str; 
			} else {
				str = str.toUpperCase();
				request.term = str.replace(/\s/g, ''); 
			}	 
			$.ajax({
				url: base_url+"org_transportation/airport_base/" ,
				dataType: "json",
				data:
				{
					term: request.term
				},
				success: function (data)
				{	
					if(data=="1")
					{
						window.location.href=base_url;
					}
					if(1)
					{
						response(data);
					}
				}
			});
  	  	}, 
		minLength:1,
		open: function() { $('.ui-menu').width($("#drop_base_airport" ).width()) },
		focus: function( event, ui ) 
		{
			var id = ui.item.label;
			var name = ui.item.value;
			$("#drop_base_airport" ).val(id);
			$('#dropoff_airport_identifer').val(name);
			return false;
		},     
		select: function( event, ui ) 
		{
			var id = ui.item.label;
			var name = ui.item.value;
			$("#drop_base_airport" ).val(id);
			$('#dropoff_airport_identifer').val(name);
			return false;
		}			
	});


$('#pick_base_airport').autocomplete({
		source: function (request, response)
   		{
			request.term = $.trim(request.term);
			var str	= request.term;
			var letters = /^[a-zA-Z ]+$/;	
			if(str.match(letters))
			{
				request.term = str; 
			} else {
				str = str.toUpperCase();
				request.term = str.replace(/\s/g, ''); 
			}	 
			$.ajax(
			{
				url: base_url+"org_transportation/airport_base/" ,
				dataType: "json",
				data:
				{
					term: request.term
				},
				success: function (data)
				{
					if(data=="1")
					{
						window.location.href=base_url;
					}
					if(1)
					{
						response(data);
					}
				}
			});
  	  	}, 
		minLength:1,
		open: function() { $('.ui-menu').width($("#pick_base_airport" ).width()) },
		focus: function( event, ui ) 
		{
				var id = ui.item.label;
				var name = ui.item.value;
				$("#pick_base_airport" ).val(id);
				$("#pickup_airport_identifer").val(name);
				return false;
		},     
		select: function( event, ui ) 
		{
				var id = ui.item.label;
				var name = ui.item.value;
				$("#pick_base_airport" ).val(id);
				$("#pickup_airport_identifer").val(name);
				return false;
		}
	});*/

$(document).ready(function(){
	
		$.validator.addMethod("telephone_number", function (value, element) {
				 var a = /^(1\s|1|)?((\(\d{3}\))|\d{3})(\-|\s)?(\d{3})(\-|\s)?(\d{4})$/.test(value);
				return a;
		},'Please enter valid telephone number');
	
	$('#transport_locations').validate({
		//excluded: [':disabled',':not(:visible)'],
		errorElement: 'span', //default input error message container
		errorClass: 'help-block', // default input error message class
		focusInvalid: true, // do not focus the last invalid input
		rules: {
			pick_street: {
				//required: true
			},
			pick_city: {
				//required: true
			},
			pick_state: {
				//required: true
			},
			pick_base_airport: {
				required: true
			},
			drop_street: {
				//required: true
			},
			drop_city: {
				//required: true
			},
			drop_state: {
				//required: true
			},
			drop_base_airport: {
				required: true
			},
			dateselect: {
				//required: true
			},
			pickupselect: {
				//required: true
			},
			organization_name: {
				required: true
			},
			contact_email: {
				required: true,
				email:true,
			},
			contact_phone_no: {
				required: true,
				telephone_number:true
			},
			contact_name: {
				required: true
			},
			receiving_organization_name:{
				required: true
			},
			receiving_contact_name: {
				required: true
			},
			receiving_contact_email: {
				required: true,
				email:true,
			},
			receiving_contact_phone_no: {
				required: true,
				telephone_number:true
			},
			leg_upload:{
				//extension: "xls|xlsx|csv",
				//filesize: 1048576	
			}
		},

		messages: {
			pick_base_airport: {
				required: 'Please enter origin location.'
			},
			drop_street: {
				required: 'Please enter drop off street.'
			},
			drop_city: {
				required: 'Please enter drop off city.'
			},
			drop_state: {
				required: 'Please enter drop off state.'
			},
			drop_base_airport: {
				required: 'Please enter destination location.'
			},
			/*dateselect: {
				required: 'Please select drop off date.'
			},
			pickupselect: {
				required: 'Please select pick up date.' 
			}*/
			
		},

		invalidHandler: function (event, validator) { //display error alert on form submit   
			$('#transport_locations').show();
			
			var errors = validator.numberOfInvalids();
			if (errors && alert_trans_loc=='1') {
			  var message = errors == 1
				? 'You missed 1 field. It has been highlighted'
				: 'You missed ' + errors + ' fields. They have been highlighted';
			  alert(message);
			}
		},

		highlight: function (element) { // hightlight error inputs
			$(element)
				.closest('.form-group').addClass('has-error'); // set error class to the control group
		},

		success: function (label) { //alert(label);
		
			label.closest('.form-group').removeClass('has-error');
			label.remove();
			
		},

		errorPlacement: function (error, element) 
		{ 	
			if (element.attr("name") == "pickupselect")
			{
				error.addClass('help-block').insertAfter('#from_date_picker');
			}
			else if(element.attr("name") == "dateselect")
			{
				error.addClass('help-block').insertAfter('#to_date_picker');
			}
			else if (element.attr("name") == "leg_upload")
			{
				error.addClass('help-block').insertAfter(element.closest('.fileinput'));
			} else if (element.attr("type") == "radio"){
				 error.insertAfter(element.parent().find('#error-message-for-gender-'+element.data('id')).selector);
				 error.insertAfter(element.parent().find('#error-message-for-gender-'+element.data('id')));
			} else if(element.attr('name')=='pick_base_airport')
			{
				error_display_pickup_airport =1;
				error.addClass('help-block').insertAfter('#pickup_error_display');
			} else if(element.attr('name')=='drop_base_airport')
			{
				error_display_drop_airport = 1;	
				error.addClass('help-block').insertAfter('#drop_error_display');
			}
			else
			{
				error.addClass('help-block').insertAfter(element.closest('.form-control'));
				error.addClass('help-inline').insertAfter(element.closest('.input-group'))
			}
		}

	});
	
		$('.quick-type').each(function(e) {
		$('#quick-type-'+e).rules('add',{
			required : {
						depends: function(element){
								if($('#quick-animal-name-'+e).val()!='')
								{									
									return true;
								} else {
									return false;
								}
							}
					} ,
				messages:{
				 required: 'This field is required.'	
				}
			
		});
		});
		
		$('.quick-breed').each(function(e) {
		$('#quick-breed-'+e).rules('add',{
			required : {
						depends: function(element){
								
								if($('#quick-animal-name-'+e).val()!= '')
								{	
									return true;
								} else {
									return false;
								}
							}
					},
			messages:{
				required:'This field is required.'	
			}
			
		});
		});

	
		$('.quick-gender').each(function(e) {
		$('#quick-gender-f-'+e).rules('add',{
			required : {
						depends: function(element){
								
								if($('#quick-animal-name-'+e).val()!= '')
								{	
									return true;
								} else {
									return false;
								}
							}
					},
			messages:{
				required:'This field is required.'	
			}
			
		});
		});
		
		$('.weight-col').each(function(e) {
		$('#quick-weight-'+e).rules('add',{
			required : {
						depends: function(element){
								
								if($('#quick-animal-name-'+e).val()!= '')
								{	
									return true;
								} else {
									return false;
								}
							}
					},
				//max:15,	
			messages:{
				required:'This field is required.'
				//max:'For this type of transport animal weight must be less then than 16 lbs.'	
			}
			
		});
		});
	
$.validator.addMethod('filesize', function(value, element, param) 
{
    return this.optional(element) || (element.files[0].size <= param) 
}, $.validator.format("Maximum allowed 1MB file."));
$.validator.addMethod("extension", function(value, element, param) {
	param = typeof param === "string" ? param.replace(/,/g, "|") : "png|jpe?g|gif";
	return this.optional(element) || value.match(new RegExp(".(" + param + ")$", "i"));
}, $.validator.format("Please select valid file."));
});

$(document).on('change','#pick_base_airport',function()
{
	var pickup_airport = $('#pick_base_airport').val();
	if(pickup_airport!='')
	{
		$('#pickup_error_display').next().attr("style","display:none");
		$('#pick_base_airport').closest('.form-group').removeClass('has-error');
	} else {
		if(error_display_pickup_airport ==1)
		{
			$('#pickup_error_display').next().attr("style","display:block");
			$('#pick_base_airport').closest('.form-group').addClass('has-error');
		}	
	}	
});

$(document).on('change','#drop_base_airport',function()
{
	var dropoff_airport = $('#drop_base_airport').val();
	if(dropoff_airport!='')
	{
		$('#drop_error_display').next().attr("style","display:none");
		$('#drop_base_airport').closest('.form-group').removeClass('has-error');
	} else {
		if(error_display_drop_airport ==1)
		{
			$('#drop_error_display').next().attr("style","display:block");
			$('#drop_base_airport').closest('.form-group').addClass('has-error');
		}	
	}	
});

$(document).ready(function() {
	$('#pick_base_airport').select2();
	$('#drop_base_airport').select2();
});

/*$(document).on('change','#pick_base_airport',function(){
var selected_zipcode = $.trim($(this).val());


	if(selected_zipcode!='')
	{
	  $.ajax({
            url: base_url+"org_transportation/airport_base/" ,
            dataType: "json",
            data:
            {
                term: selected_zipcode,
            },
            success: function (data)
            {
				if(data)
				{
					var name = data[0].value;
					$( "#pick_base_airport" ).val(data[0].label);
					$("#pickup_airport_identifer").val(name);
				}
				else
				{
					if(data == null || data === '')
					{
						alert('Please enter valid from location');
						$("#pick_base_airport").val('');
						$("#pickup_airport_identifer").val('');
					}
				}
				
            }
        });		
	} else 
	{
			alert('Please enter valid fromlocation');
			$("#pick_base_airport").val('');
	}	 

});

$(document).on('change','#drop_base_airport',function(){
var selected_zipcode = $.trim($(this).val());

	if(selected_zipcode!=''){
	  $.ajax({
            url: base_url+"org_transportation/airport_base/" ,
            dataType: "json",
            data:
            {
                term: selected_zipcode,
            },
            success: function (data)
            {
				if(data)
				{
					$( "#drop_base_airport" ).val(data[0].label);
					$('#dropoff_airport_identifer').val(data[0].value);
				}
				else
				{
					if(data == null || data === '')
					{
						alert('Please enter valid to location');
						$("#drop_base_airport").val('');
						$('#dropoff_airport_identifer').val('');
					}
				}	
            }
        });		
	} else {
			alert('Please enter valid to location');
			$("#drop_base_airport").val('');
	}	 	 

});*/


		
var startDate = new Date('01/01/2012');
var FromEndDate = new Date();
var ToEndDate = new Date();
ToEndDate.setDate(ToEndDate.getDate()+365);

$('.from_date').datepicker({ 
    minDate: today_date,   
	//format: "mm/dd/yyyy",
	format: "D M d",
	showMeridian: true,
	autoclose: true
})
    .on('changeDate', function(selected){
		if(selected.date!='')
		{
			startDate = new Date(selected.date.valueOf());
			startDate.setDate(startDate.getDate(new Date(selected.date.valueOf())));
			if(new Date(selected.date.valueOf())>new Date($("#dateselect").val()))
			{
				$("#dateselect").val('');
			}
			//$('.to_date').datepicker('setStartDate', startDate);
		}
    });

$('.to_date').datepicker({
        minDate: today_date, 
		//format: "mm/dd/yyyy",
		format: "D M d",
		showMeridian: true,
		autoclose: true,
		todayBtn: false
		
    })
    .on('changeDate', function(selected){
		if(selected.date!='')
		{
			FromEndDate = new Date(today_date);
			FromEndDate.setDate(FromEndDate.getDate(new Date(today_date)));
			//FromEndDate = new Date(selected.date.valueOf());
			//FromEndDate.setDate(FromEndDate.getDate(new Date(selected.date.valueOf())));
			//$('.from_date').datepicker('setStartDate', FromEndDate);
		}
    });
		
});
$(document).ready(function(event){	
$('.datepicker-icon').find('.from-date-icon').on('click', function(){
	   		$('#pickupselect').trigger('focus');
		});
		
		$('.datepicker-icon').find('.to-date-icon').on('click', function(){
	   		$('#dateselect').trigger('focus');
		});
});	

$('#pick_city').autocomplete ({
	source:function (request, response){
        $.ajax({
            url: base_url+"org_transportation/get_city/",
            dataType: "json",
            data:{
                term: request.term,
				city: $("#pick_city" ).val(),
				state: $("#pick_state" ).val()
            },
            success: function (data) {
                response(data);
            }
        });
	},
	minLength:2,
	open: function() { $('.ui-menu').width($("#pick_city" ).width()) },
	autoFocus:true,
	focus: function( event, ui ) {
		var city = ui.item.label;
		$( "#pick_city" ).val(city);
		
		return false;
	},     
	select: function( event, ui ) {
		var city = ui.item.label;
		$( "#pick_city" ).val(city);
		
		return false;
	}
});

$(document).on('click','#submit',function(){
	var file_name = '';	
	$('#image_file').val('');
	$('.table-striped tr').each(function() {
    var image_files = $(this).find('td p a').text(); 
	if(image_files!='')
	{  
		if (file_name == '') {
				file_name += image_files;
		}else{
				file_name += ',' + image_files; 
		}
	}
	});
	$('#image_file').val(file_name);
	alert_trans_loc = '1';
	if($('#transport_locations').valid() == false) {
		validation_form = '1';
		return false;
	} else {
		
		$('.weight-col').each(function(e) 
		{
			if($('#quick-weight-'+e).length>0)
			{
				var qu_wgth = $('#quick-weight-'+e).val();
				if(qu_wgth>16)
				{
					if(confirm("For airline transport animal weight is more than 16 lbs, do you want to continue?")==false)
					{
						e.preventDefault();
					}
				}	
			}	
		});
		
		var from_date = $('#pickupselect').val();
		var to_date = $('#dateselect').val();
		  
		var start_time_date = new Date(from_date);
		var end_time_date = new Date(to_date);
		
		var end_date = new Date(end_time_date.getFullYear(), end_time_date.getMonth(), end_time_date.getDate()); 
		var start_date = new Date(start_time_date.getFullYear(), start_time_date.getMonth(), start_time_date.getDate()); 
		  
		if (start_date > end_date) {
			alert("Drop Off Date must be greather than or equal to Pick Up Date.");
			return false;
		} 
		if (end_date < start_date) {
			alert("Pick Up Date must be less than or equal to Drop Off Date.");
			return false;
		}	  
		
		//$("#action").val("prespecify")
		$('#submit').hide();
		$('#driver_submit').hide();
		$('#system_submit').hide();
		$('#system_submit1').hide();
		if(transport_type=='D' && enable_routing_status ==0 && owner_routing_status==0)
		{
			$('#in_status').val('4');
			$('#airline_transport_enable').val('1');
		} else {
			$('#in_status').val('1');
		}
		/*if($.browser.msie) {
				$('.display_loader').html('<img id="loadimg" src="'+base_url+'assets/img/ajax-loading.gif" alt="loader" />');
		}
		$('.display_loader').show();*/
		
		/*if(transport_type=='D' && enable_routing_status ==1 && owner_routing_status==1)
		{
			$('#transport_loader').modal('show');
		}*/	
		
		$('#loadimg').show();
		$('#transport_loader').modal('show');
		$('#transport_locations').submit();
		return true;
	}
});	
$( "#leg_upload" ).change(function() {
	legs_file = $(this).val()
});
$(document).on('click','#driver_submit',function(){
	if(legs_file!='')
	{
		alert("Upload legs only for Pre-Specify Legs.");
		return false;
	}
	var file_name = '';
	$('#image_file').val('');
	$('.table-striped tr').each(function() {
    var image_files = $(this).find('td p a').text(); 
	if(image_files!='')
	{  
		if (file_name == '') {
				file_name += image_files;
		}else{
				file_name += ',' + image_files; 
		}
	}
	});
	$('#image_file').val(file_name);
	if($('#transport_locations').valid() == false) {
		return false;
	} else {
		
		var from_date = $('#pickupselect').val();
		var to_date = $('#dateselect').val();
		  
		var start_time_date = new Date(from_date);
		var end_time_date = new Date(to_date);
		
		var end_date = new Date(end_time_date.getFullYear(), end_time_date.getMonth(), end_time_date.getDate()); 
		var start_date = new Date(start_time_date.getFullYear(), start_time_date.getMonth(), start_time_date.getDate()); 
		  
		if (start_date > end_date) {
			alert("Drop Off Date must be greather than Pick Up Date.");
			return false;
		} 
		if (end_date < start_date) {
			alert("Pick Up Date must be less than Drop Off Date.");
			return false;
		}
		
		$("#action").val("driverspecify")
		$('#submit').hide();
		$('#driver_submit').hide();
		$('#system_submit').hide();
		$('#system_submit1').hide();
		$('#transport_loader').modal('show');
		$('#transport_locations').submit();
		/*if($.browser.msie) {
				$('.display_loader').html('<img id="driver_loadimg" src='+base_url+'"assets/img/ajax-loading.gif" alt="loader" />');
		}*/
		//$('.display_loader').show();
		
		//$('#driver_loadimg').show();
		//return true;
	}
});	

var q=2;
$(document).on('click','.add_more',function() {
		if(q<=5)
		{					
		var row = '<div class="fileinput fileinput-new " data-provides="fileinput">';
			row+= '<div class="input-group">';
			row+= '<div class="form-control uneditable-input span3" data-trigger="fileinput"> <i class="fa fa-file fileinput-exists"></i>&nbsp; <span class="fileinput-filename"> </span> </div>';
			row+= '<span class="input-group-addon btn default btn-file light-green"> <span class="fileinput-new"> Browse... </span> <span class="fileinput-exists"> Change </span>';
			row+= '<input type="file" id="attachfiles_'+q+'" name="attachfiles_'+q+'">';
			row+= '</span> <a href="#" class="input-group-addon btn default fileinput-exists hidden-480" data-dismiss="fileinput"> Remove </a> </div>';
			row+= '<a title="Add More" class="cost-footer-btn btn light-green margin-top-10 add_more" href="javascript:void(0);"><i class="fa fa-plus"></i> Add More</a> ';                           
			row+= '</div>';
		$('.more_upload').append(row); 
		q++;	
		$(this).hide();
		}
		else
		{
			alert("Only 5 files are allow.");
		}
	
});

$(document).on('change','#zipcode_list',function(){
var selected_zipcode = $(this).val();
//alert(selected_zipcode);
$("#"+zip).val(selected_zipcode);
});

$(document).on('click','#transport_close',function(){
	var url = base_url;   
	var new_url = url+'org-dashboard'; 
	$(location).attr('href',new_url);
});	

function get_zip(city,state,zip)
{
	//alert($("#"+city).val());
	//alert($("#"+state).val());
	if($("#"+state).val()!='' && $("#"+city).val()!='')
	{
	 	jQuery.post(base_url+"org_transportation/get_zip_code/",{state:$("#"+state).val(),city:$("#"+city).val(),action:"zip"}, function( data ) {
			//$("#"+zip).val(data);
			if(data)
			{
				if(data=="1")
				{
					window.location.href="<?php echo base_url() ?>";
				}
				else
				{
					var newdaata = data.split("#*#"); 
					$("#"+zip).val(newdaata[0]);
					$("#"+city).val(newdaata[1]);
				}
			}
			
		});
	}
}

function get_zipcode(city,state,zip,country)
{
	//alert($("#"+city).val());
	//alert($("#"+state).val());
	if($("#"+city).val() == '')
	{
		alert('Please enter city name.');
		return false;
	}
	if($("#"+state).val() == '')
	{
		alert('Please select state name.');
		return false;
	}
	if($("#"+state).val()!='' && $("#"+city).val()!='')
	{
		
		$.ajax({
			  type: "POST",
			  url: base_url+'org_transportation/get_zip_code_data/',
			  beforeSend: function(){
				 $('#loader').show();
			  },
			  data: {
				  state:$("#"+state).val(),
				  city:$("#"+city).val(),
				  action:"zip"
			  },
			  dataType:"json",
			  
			  complete: function(){
				$('#loader').hide();
			  },
			  success:function(data){
					var arr_zipcodes = data.zipcodes;												
					//alert(arr_zipcodes.length);
					//return false;
					var str_zipcode = '';
					
					if(arr_zipcodes.length > 0) {
					str_zipcode += "<select name='zipcode_list' id='zipcode_list' class='form-control' style='width:77%;'>";	
						$.each( arr_zipcodes, function( key, value ) {	
							
							str_zipcode += "<option";
							str_zipcode += " value = "+value.zip_code+">";
							str_zipcode += value.zip_code;
							str_zipcode += "</option>";	
						});
						str_zipcode += "</select>";	
						//alert(str_zipcode);
						$('#popup_zip_div').html(str_zipcode);					
					} else {
						alert('Zip code not found for provided city/state.');
				return false;
					}
			  }	
		   });
	}
}

function change_origin_details()
{
	if($("#pick_city").val() == '')
	{
		alert('Please enter city name.');
		return false;
	}
	if($("#pick_state").val() == '')
	{
		alert('Please select state name.');
		return false;
	}
	if($("#popup_zipcode").val() == '')
	{
		alert('Origin zip code is required.');
		return false;
	}
	//alert($('#pick_country').val());
	//$('#pick_zip').val($('#popup_zipcode').val()+", "+$('#pick_city').val()+", "+$('#pick_state').val()+", "+$('#pick_country').val());
	$('#pick_zip').val($('#zipcode_list').val()+", "+$('#pick_city').val()+", "+$('#pick_state').val()+", "+$('#pick_country').val());	
	$('#zip-search').modal('hide');
	//$('#pick_city').val('');
	//$('#pick_state').val('');
	//$('#pick_country').val('');
	$('#popup_zipcode').val('');
	$('#popup_zip_div').show();
	var str_zipcode1 = '<input type="text" readonly="" name="popup_zipcode" id="popup_zipcode" class="form-control display-zipcode" placeholder="Zip code will appear here">';
	$('#popup_zip_div').html(str_zipcode1);	
	
}

function change_destination_details()
{
	if($("#pick_city").val() == '')
	{
		alert('Please enter city name.');
		return false;
	}
	if($("#pick_state").val() == '')
	{
		alert('Please select state name.');
		return false;
	}
	if($("#popup_zipcode").val() == '')
	{
		alert('Destination zip code is required.');
		return false;
	}
	//$('#drop_zip').val($('#popup_zipcode').val()+", "+$('#pick_city').val()+", "+$('#pick_state').val()+", "+$('#pick_country').val());
	$('#drop_zip').val($('#zipcode_list').val()+", "+$('#pick_city').val()+", "+$('#pick_state').val()+", "+$('#pick_country').val());
	$('#zip-search').modal('hide');
	//$('#pick_city').val('');
	//$('#pick_state').val('');
	//$('#pick_country').val('');
	$('#popup_zipcode').val('');
	$('#popup_zip_div').show();
	var str_zipcode1 = '<input type="text" readonly="" name="popup_zipcode" id="popup_zipcode" class="form-control display-zipcode" placeholder="Zip code will appear here">';
	$('#popup_zip_div').html(str_zipcode1);	
	
}

function transport_agree(transport_btn)
{

	if(transport_btn.id == 'transport_cancel')
	{
		var url = base_url;   
		var new_url = url+'org-dashboard'; 
		$(location).attr('href',new_url);
	}
	if(transport_btn.id == 'transport_iagree')
	{
		
		$.ajax({
			  type: "POST",
			  url: base_url+'org_transportation/update_user_transport_agreement/',
			  beforeSend: function(){
				 $('#loader').show();
			  },
			  data: {},
			  dataType:"json",			  
			  complete: function(){
				$('#loader').hide();
			  },
			  success:function(data)
			  	{
					if(data)
					{
						alert('Agreement accepted.');
					}
				}
		   });
	}
	
}


$(window).resize(function() {
	$('.ui-autocomplete').hide();
});

            (function() {
                /* matchHeight example */
                $(function() {
                    // apply your matchHeight on DOM ready (they will be automatically re-applied on load or resize)
                    // get test settings
                    var byRow = $('body').hasClass('test-rows');
                    // apply matchHeight to each item container's items
                    $('.dobt-form').each(function() {
                        $(this).children('.gr-wrap').matchHeight(byRow);
                    });
                    // Reset Height on Submit form
                    $('#driver_submit').click(function() {
                      setTimeout(function(){
                        $('.dobt-form').each(function() {
                            $(this).children('.gr-wrap').matchHeight(byRow);
                        });
                      }, 10);
                    });
                });
            })();		
     
$(document).ready(function(){
	jQuery('.title-tipso').tipso();
});



//Start media Gallery 
$(document).ready(function(){
$("area[rel^='prettyPhoto']").prettyPhoto();
$(".gallery:first a[rel^='prettyPhoto']").prettyPhoto({animation_speed:'normal',theme:'light_square',slideshow:3000, autoplay_slideshow: false});
$(".gallery:gt(0) a[rel^='prettyPhoto']").prettyPhoto({animation_speed:'fast',slideshow:10000, hideflash: true});
});
$('#receiving_organization_name').autocomplete ({
		source: function (request, response)
   		 {
			request = $.trim(request.term);
			$.ajax(
			{ 
				//url: "<?php echo base_url(); ?>org_transportation/get_airports_by_zipcode/" ,
				url: base_url+"org_transportation/get_all_organization/" ,
				dataType: "json",
				data:
				{
					term: request
				},
				success: function (data)
				{
					//alert(data);
					//return false;
					//response(data);
					if(data=="1")
					{
						window.location.href=base_url;
					}
					/*if(data == null || data === '')
					{
						alert('Please enter valid from Zipcode/Airport ID');
						$("#pickup_airport").val('');
					}*/
					//else
					if(1)
					{
						response(data);
					}
					
				}
			});
  	  	},
		minLength:1,
		open: function() { $('.ui-menu').width($("#receiving_organization_name" ).width()) },
		focus: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.label;
			var person =  ui.item.director;
			var email =  ui.item.email;
			var tel_num =  ui.item.telephone;
			var cert = ui.item.st_has_501c3;
			var zip = ui.item.st_zip;
			if(cert=='Y')
			{
				$('#receiving-501c3-certified').prop("checked",true);
				$('#receiving-501c3-certified').next('.slider').html('<span class="yes">Yes</span>');
			}
			if(cert=='N')
			{
				$('#receiving-501c3-certified').prop("checked",false);
				$('#receiving-501c3-certified').next('.slider').html('<span class="no">No</span>');
			}	
			$("#receiving_organization_name" ).val(name);
			$("#receiving_contact_name" ).val(person);
			$("#receiving_contact_email" ).val(email);
			$("#receiving_contact_phone_no" ).val(tel_num);
			if(validation_form == '1')
			{
				alert_trans_loc = '0';
				$('#transport_locations').valid();
			}
			//get_zip_code(zip,'#drop_zip');
				return false;
		},     
		select: function( event, ui ) {
			var id = ui.item.label;
			var name = ui.item.label;
			var person =  ui.item.director;
			var email =  ui.item.email;
			var tel_num =  ui.item.telephone;
			var cert = ui.item.st_has_501c3;
			var zip = ui.item.st_zip;
			if(cert=='Y')
			{
				$('#receiving-501c3-certified').prop("checked",true);
				//$('#receiving-501c3-certified').parent('span').addClass("checked");
			}
			
			if(cert=='N')
			{
				$('#receiving-501c3-certified').prop("checked",false);
				//$('#receiving-501c3-certified').parent('span').removeClass("checked");
			}
			
			$("#receiving_organization_name" ).val(name);
			$("#receiving_contact_name" ).val(person);
			$("#receiving_contact_email" ).val(email);
			$("#receiving_contact_phone_no" ).val(tel_num);
			if(validation_form == '1')
			{
				alert_trans_loc = '0';
				$('#transport_locations').valid();
			}
			//get_zip_code(zip,'#drop_zip');
			return false;
		}
	});	

equalheight = function(container){

var currentTallest = 0,
     currentRowStart = 0,
     rowDivs = new Array(),
     $el,
     topPosition = 0;
 $(container).each(function() {

   $el = $(this);
   $($el).height('auto')
   topPostion = $el.position().top;

   if (currentRowStart != topPostion) {
     for (currentDiv = 0 ; currentDiv < rowDivs.length ; currentDiv++) {
       rowDivs[currentDiv].height(currentTallest);
     }
     rowDivs.length = 0; // empty the array
     currentRowStart = topPostion;
     currentTallest = $el.height();
     rowDivs.push($el);
   } else {
     rowDivs.push($el);
     currentTallest = (currentTallest < $el.height()) ? ($el.height()) : (currentTallest);
  }
   for (currentDiv = 0 ; currentDiv < rowDivs.length ; currentDiv++) {
     rowDivs[currentDiv].height(currentTallest);
   }
 });
}

$(window).on('load',function() {
  equalheight('.org-trans-detail .transport-steps');
  //setTimeout(function(){ $(window).trigger('resize'); }, 200);
});


$(window).resize(function(){
  equalheight('.org-trans-detail .transport-steps');
  //setTimeout(function(){ $(window).trigger('resize'); }, 200);
});

var animals_info_details = [];
var inserted_animal_detail = [];

$('#records').val(count);

function verify_save_button()
{
	var total_animal_count = $('#records').val();
	var animal_name = $('.quick-animal-name').val();
			if(total_animal_count > 1 || animal_name!='')
			{
				$('#save-req').attr("style", "display:block;");
			} else {
				$('#save-req').attr("style", "display:none;");
			}
}
$('.quick-animal-name').blur(function()
{
	verify_save_button();
});
	verify_save_button();

function get_breed(id,type_breed)
{ 
	if(type_breed != '' || type_breed != undefined)
	{
		type_breed = type_breed;
	} else {
		type_breed = '';
	}
	
	var animalid 	='#quick-type-'+id;	
	var animalbreed ='#quick-breed-'+id
	var animal_type = parseInt($(animalid).val());
	$.ajax({
			  type: "POST",
			  url: base_url+'org_animal/get_animal_breed',
			  beforeSend: function() {
				$('#loader').show();
				$("#quick-breed-"+id).prop("disabled", true);
			  },
			  data: {
				  animal_type:animal_type
			  },
			  dataType:"json",
			  async:"false",
			  complete: function() {
				 $('#loader').hide();
				 $("#quick-breed-"+id).prop("disabled", false);
			  },
			  success:function(data){
					var arr_animal_breed = data.get_animal_breed;												
					var str = '';
					
					if(arr_animal_breed.length > 0) {
						str += "<option value=''>Select</option>";
						
						$.each( arr_animal_breed, function( key, value ) {		
							var new_key = Number(key)+Number(1);
								
							str += "<option";
							
							if(type_breed!='' && type_breed == value.in_animal_breed_id )
							{
								str += " value = "+value.in_animal_breed_id+" selected>";
							} else 
							{
								str += " value = "+value.in_animal_breed_id+">";
							}		
							str += value.st_animal_breed_name;
							str += "</option>";	
						});
						
						$(animalbreed).html(str);
											
					} else {
						$(animalbreed).html('<option value="">Select</option>');
					}
			  }	
			});
		
}

$(document).ready(function(){
		
		$(document).on("click","#on_transport",function () {
		  //alert('on_transport called');
		  if ($("#on_transport").prop("checked")) {
			   // do something
				//alert('show all animals');
				 $('#checked-on_transport span').addClass('checked');
				$(".already_in_transports").show();			   
			}else{
				$('#checked-on_transport span').removeClass('checked');		
				$(".already_in_transports").hide();				
			}
		});
		
});

$(document).on('click','#submit-req',function(){
$('#records').val(count);
});

$(document).on('click','#add-more',function(){ 
	
	var ids = last_inserted_animal_id
	if($('input:radio[name="quick-gender-'+ids+'"]').length >0)
	{	
		var genders = $('input:radio[name="quick-gender-'+ids+'"]:checked').val();
	} else {
		var genders = '';
	}
	if($('#quick-animal-name-'+ids).length >0)
	{	
		var animals_name = $('#quick-animal-name-'+ids).val();
	} else {
		var animals_name = '';
	}
	if($('#quick-type-'+ids).length >0)
	{		
		var animals_type = $('#quick-type-'+ids).val();
	} else {
		var animals_type = '';
	}

	if($('#quick-breed-'+ids).length >0)
	{		
		var animal_breeds = $('#quick-breed-'+ids).val();
	} else {
		var animal_breeds = '';
	}
	if($('#animal-id-'+ids).length >0)
	{	
		var animals_id = $('#animal-id-'+ids).val();
	} else {
		var animals_id = '';
	}
	if($('#quick-weight-'+ids).length >0)
	{		
		var animals_weight = $('#quick-weight-'+ids).val();
	} else {
		var animals_weight = '';
	}	
	var travelling_with = new Array();
	if($('input[name="quick-travel-'+ids+'[]"]').length >0)
	{	
		$('input[name="quick-travel-'+ids+'[]"]:checked').each(function(e) {
			travelling_with.push(this.value);
			
			});
	}
	if($('#chk_'+ids).length >0)
	{		
		if($('#chk_'+ids).prop('checked'))
		{
			var cvis = 'Y';
		} else {
			var  cvis = 'N';
		}
	} else {
		var  cvis = '';
	}	
	var myData={"animal_name":animals_name,"animal_type":animals_type,"animal_breed":animal_breeds,
				"gender":genders,"travelling_with":travelling_with,"cvi":cvis,'animal_id':animals_id,
				"animal_weight":animals_weight
			   };	
	if(animals_name != '' && animals_type!='' && animal_breeds!='' &&  genders!=undefined && genders!='')
	{
			$.ajax({
					type: "POST",
					url: base_url+'org_transportation/add_new_animal',
					data: myData, 						
					dataType:"html",
					success:function(animal_id) 
					{
						//console.log(transport_id);
						if(jQuery.inArray(animal_id, inserted_animal_detail) == -1)
						{
							inserted_animal_detail.push(animal_id);
						}
						$('#animal-id-'+ids).val(animal_id)
					}
			});
	}
	if(count<20){
	if($( window ).width() <= 1069)
	{  
		var row = '<table class=" table gray-table list-animal-profile stacktable small-only" id="tbl_'+count+'"><tbody><tr  class="row-'+count+'">';
			row+= '<td class="st-key">Animal Name</td>';
			row+= '<td class="st-val">';                          
			row+= '<input type="text" class="form-control quick-animal-name quick-animal-name-'+count+'" id="quick-animal-name-'+count+'" name="quick-animal-name-'+count+'" value="" maxlength="250">';
			row+= '<input type="hidden" name="animal-id-'+count+'" id="animal-id-'+count+'" value="0" class="animal_id" ><input type="hidden" name="animal-trasnport-id-'+count+'" id="animal-trasnport-id-'+count+'" value="0" />';
			row+= '</td></tr>';
			row+= '<tr class="row-'+count+'">';
			row+= '<td class="st-key">Type</td>';
			row+= '<td class="st-val type">';
			row+= '<div class="select-style form-group">';
			row+= '<select id="quick-type-'+count+'" name="quick-type-'+count+'" class="quick-type quick-type-'+count+' form-control" onchange="get_breed('+count+')">';
			row+= '<option value="">Select</option>';
			for(var i=0;i<animal_type.length;i++) 
			{
			row+= '<option value="'+animal_type[i]['in_animal_type_id']+'">'+animal_type[i]['st_animal_type_name']+'</option>';
			}
			row+= '</select></div></td></tr>';
			row+= '<tr class="row-'+count+'"><td class="st-key">Breed</td>';
			row+= '<td class="st-val status">';
			row+= '<div class="select-style form-group">';
			row+= '<select id="quick-breed-'+count+'" name="quick-breed-'+count+'" class="quick-breed quick-breed-'+count+' form-control">';
			row+= '<option value="">Select</option>';
			row+= '</select></div></td></tr>';
			row+= '<tr class=""><td class="st-key">Gender</td><td class="st-val padb0 padbm"><div class="radio-btn form-group radiogroup_with_lbl clearfix"><input type="radio" class="form-control" data-id="'+count+'" name="quick-gender-'+count+'" id="quick-gender-m-'+count+'" value="Male"><label class="radio-inline" for="quick-gender-m-'+count+'">Male</label>';
			row+= '<input type="radio" class="form-control quick-gender" name="quick-gender-'+count+'" id="quick-gender-f-'+count+'" value="Female"><label id="error-message-for-gender-'+count+'" class="radio-inline" for="quick-gender-f-'+count+'">Female</label></div>';
			row+= '</td></tr>';
			row+= '<tr class=""><td class="st-key">Weight(in lbs)</td><td class="st-val ">';                          
            row+= '<div class="form-group"><input type="text" class="form-control quick-weight-'+count+'" id="quick-weight-'+count+'" name="quick-weight-'+count+'" value="" maxlength="3">';                   
            row+= '</div></td></tr>';
			row+= '<tr class="row-'+count+'"><td class="st-key">Traveling with</td>';
			row+= '<td class="st-val traveling">';
			row+= '<div class="custom-checkbox">';
			row+= '<input type="checkbox" name="quick-travel-'+count+'[]" id="Collar-'+count+'" value="1">';
			row+= '<label for="Collar-'+count+'" class="checkbox-inline">Collar</label></div>';
			row+= '<div class="custom-checkbox ">';
			row+= '<input type="checkbox" name="quick-travel-'+count+'[]" id="Leash-'+count+'" value="2">';
			row+= '<label for="Leash-'+count+'" class="checkbox-inline">Leash</label>';
			row+= '</div>';
			row+= '<div class="custom-checkbox marb0">';
			row+= '<input type="checkbox" name="quick-travel-'+count+'[]" id="Crate-'+count+'" value="3">';
			row+= '<label for="Crate-'+count+'" class="checkbox-inline">Crate</label>';
			row+= '</div>';
			row+= '<div class="custom-checkbox marb0">';
			row+= '<input type="checkbox" name="quick-travel-'+count+'[]" id="Medicine-'+count+'" value="4">';
			row+= '<label for="Medicine-'+count+'" class="checkbox-inline">Medicine</label>';
			row+= '</div></td></tr>';
			row+= '<tr class=""><td class="st-key">CVI?</td><td class="st-val padr0"><div class="custom-checkbox w78"><input type="checkbox" name="quick-cvi-'+count+'" id="chk_'+count+'" value="Y"><label class="checkbox-inline" for="chk_'+count+'">Yes</label><a href="javascript:void(0);" class="title-tipso question" title="A CVI is a Certificate of Veterinary Inspection or Health Certificate. It is required for inter-state transports (crossing state lines) in all 50 states and in some states for intra-state transports (within state)."></a></div></td></tr>';
			row+= '<tr class="row-'+count+'"><td class="st-key">Photos</td><td class="st-val">';
			row+= '<div class="photos">';
			row+= '<ul id="animal-photo-attach-'+count+'" class="img"></ul>';
			row+= '<div id="add_animal_img-'+count+'">';
			row+= '<a href="javascript:void(0);" class="btn primary btn-action image-button" id="'+count+'"><i class="material-icons">insert_photo</i></a>';
			row+= '<input type="file" style="display:none;" name="my_file" id="my-file"> </div></div>';
			row+= '<input type="hidden" id="rotate_angle1-'+count+'" name="rotate_angle1-'+count+'" value="0">';
			row+= '<input type="hidden" id="crop_x1-'+count+'" name="x1-'+count+'">';
			row+= '<input type="hidden" id="crop_y1-'+count+'" name="y1-'+count+'">';
			row+= '<input type="hidden" id="crop_w1-'+count+'" name="w1-'+count+'">';
			row+= '<input type="hidden" id="crop_h1-'+count+'" name="h1-'+count+'">';
			row+= '<input type="hidden" id="profile_pic1-'+count+'" name="h1-'+count+'">';
			row+= '<input type="hidden" id="rotate_angle2-'+count+'" name="rotate_angle2-'+count+'" value="0">';
			row+= '<input type="hidden" id="crop_x2-'+count+'" name="x2-'+count+'">';
			row+= '<input type="hidden" id="crop_y2-'+count+'" name="y2-'+count+'">';
			row+= '<input type="hidden" id="crop_w2-'+count+'" name="w2-'+count+'">';
			row+= '<input type="hidden" id="crop_h2-'+count+'" name="h2-'+count+'">';
			row+= '<input type="hidden" id="profile_pic2-'+count+'" name="h1-'+count+'">';
			row+= '<input type="hidden" id="rotate_angle3-'+count+'" name="rotate_angle3-'+count+'" value="0">';
			row+= '<input type="hidden" id="crop_x3-'+count+'" name="x3-'+count+'">';
			row+= '<input type="hidden" id="crop_y3-'+count+'" name="y3-'+count+'">';
			row+= '<input type="hidden" id="crop_w3-'+count+'" name="w3-'+count+'">';
			row+= '<input type="hidden" id="crop_h3-'+count+'" name="h3-'+count+'">';
			//row+= '<input type="hidden" id="profile_pic3-'+count+'" name="h1-'+count+'">';
			row+= '<input type="hidden" id="rotate_angle4-'+count+'" name="rotate_angle4-'+count+'" value="0">';
			row+= '<input type="hidden" id="crop_x4-'+count+'" name="x4-'+count+'">';
			row+= '<input type="hidden" id="crop_y4-'+count+'" name="y4-'+count+'">';
			row+= '<input type="hidden" id="crop_w4-'+count+'" name="w4-'+count+'">';
			row+= '<input type="hidden" id="crop_h4-'+count+'" name="h4-'+count+'">';
			//row+= '<input type="hidden" id="profile_pic3-'+count+'" name="h1-'+count+'">';	
			row+= '<input type="hidden" name="uploaded_photo1-'+count+'" id="uploaded_photo1-'+count+'" value="">';
			row+= '<input type="hidden" name="uploaded_photo2-'+count+'" id="uploaded_photo2-'+count+'" value="">';
			row+= '<input type="hidden" name="uploaded_photo3-'+count+'" id="uploaded_photo3-'+count+'" value="">';
			row+= '<input type="hidden" name="uploaded_photo4-'+count+'" id="uploaded_photo4-'+count+'" value="">';
			row+= '<input type="hidden" name="existing_photo1-'+count+'" id="existing_photo1-'+count+'" value="0">';
			row+= '<input type="hidden" name="existing_photo2-'+count+'" id="existing_photo2-'+count+'" value="0">';
			row+= '<input type="hidden" name="existing_photo3-'+count+'" id="existing_photo3-'+count+'" value="0">';
			row+= '<input type="hidden" name="existing_photo4-'+count+'" id="existing_photo4-'+count+'" value="0">';
			row+= '<input type="hidden" id="count_image-'+count+'" value="0" name="count_image-'+count+'">';	
			row+= '</td></tr>';
			row+= '<tr class="row-'+count+'"><td class="st-key"></td>';
			row+= '<td class="st-val text-center action">';
			var content_function = "remove_animal_content('"+count+"')";
			row+= '<a href="javascript:void(0);" onClick="'+content_function+'" class="btn primary black-btn btn-action"><i class="material-icons">delete</i></a>';
			row+= '</td></tr></tbody></table>';	
			$('.add_transport div:eq(1)').append(row);
			jQuery('.title-tipso').tipso();
	} else {		
	var row = '<tr id="row-'+count+'">';
		row+= '<input type="hidden" name="animal-id-'+count+'" id="animal-id-'+count+'" value="0" class="animal_id" ><input type="hidden" name="animal-trasnport-id-'+count+'" id="animal-trasnport-id-'+count+'" value="0" />';
		
		row+= '<td><input type="text" class="form-control w246 quick-animal-name" id="quick-animal-name-'+count+'" name="quick-animal-name-'+count+'" value="" maxlength="250"></td>'; 
	
		row+= '<td class="type"><div class="select-style form-group"><select class="form-control w172" id="quick-type-'+count+'" name="quick-type-'+count+'" onChange="get_breed('+count+')"><option value="">Select</option>';
		
		for(var i=0;i<animal_type.length;i++) 
		{
			row+= '<option value="'+animal_type[i]['in_animal_type_id']+'">'+animal_type[i]['st_animal_type_name']+'</option>';
		}
		row+= '</div></select></td>';
		
		row+= '<td class="status"><div class="select-style form-group"><select class="form-control w172" id="quick-breed-'+count+'" name="quick-breed-'+count+'"><option value="">Select</option></select></div></td>';	
		
		row+= '<td class="padb0 padbm"><div class="radio-btn form-group radiogroup_with_lbl clearfix"><input type="radio" class="form-control" data-id="'+count+'" name="quick-gender-'+count+'" id="quick-gender-m-'+count+'" value="Male"><label class="radio-inline" for="quick-gender-m-'+count+'">Male</label>';
		row+= '<input type="radio" class="form-control quick-gender" name="quick-gender-'+count+'" id="quick-gender-f-'+count+'" value="Female"><label id="error-message-for-gender-'+count+'" class="radio-inline" for="quick-gender-f-'+count+'">Female</label></div></td>';
		
		row+= '<td><div class="form-group"><input type="text" class="form-control weight-col quick-weight-'+count+'" id="quick-weight-'+count+'"  name="quick-weight-'+count+'" value="" maxlength="3"></div></td>';
		
		row+= '<td class="traveling"><div class="custom-checkbox "><input type="checkbox" class="quick-travel-'+count+'" id="Collar-'+count+'"  name="quick-travel-'+count+'[]"  value="1"><label for="Collar-'+count+'" class="checkbox-inline">Collar</label></div><div class="custom-checkbox"><input type="checkbox" class="quick-travel-'+count+'" id="Leash-'+count+'" name="quick-travel-'+count+'[]" value="2"><label for="Leash-'+count+'" class="checkbox-inline">Leash</label></div><div class="custom-checkbox marb0"><input type="checkbox"class="quick-travel-'+count+'" name="quick-travel-'+count+'[]" value="3" id="Crate-'+count+'"><label for="Crate-'+count+'" class="checkbox-inline">Crate</label></div><div class="custom-checkbox marb0"><input type="checkbox" class="quick-travel-'+count+'" name="quick-travel-'+count+'[]" value="4" id="Medicine-'+count+'"><label for="Medicine-'+count+'" class="checkbox-inline">Medicine</label></div></td>';
		
		row+= '<td class="padr0"><div class="custom-checkbox w78"><input type="checkbox" name="quick-cvi-'+count+'" id="chk_'+count+'" value="Y"><label class="checkbox-inline" for="chk_'+count+'">Yes</label><a href="javascript:void(0);" class="title-tipso question" title="A CVI is a Certificate of Veterinary Inspection or Health Certificate. It is required for inter-state transports (crossing state lines) in all 50 states and in some states for intra-state transports (within state)."></a></div></td>';
		
		row+= '<td>';
		
		row+= '<div class="photos"><ul id="animal-photo-attach-'+count+'" class="img"></ul><div id="add_animal_img-'+count+'"><a href="javascript:void(0);" class="btn primary btn-action image-button"  id="'+count+'"><i class="material-icons">insert_photo</i></a><input type="file" style="display:none;" name="my_file" id="my-file"></div></div>';
            
            
		row+= '<input type="hidden" id="rotate_angle1-'+count+'"  name="rotate_angle1-'+count+'" value="0"/>';
			
		row+= '<input type="hidden" id="crop_x1-'+count+'" name="x1-'+count+'"/>';
			
		row+= '<input type="hidden" id="crop_y1-'+count+'" name="y1-'+count+'"/>';
			
		row+= '<input type="hidden" id="crop_w1-'+count+'" name="w1-'+count+'"/>';
			
		row+= '<input type="hidden" id="crop_h1-'+count+'" name="h1-'+count+'"/>';
			
		//row+= '<input type="hidden" id="profile_pic1-'+count+'" name="h1-'+count+'"/>';  
			
		row+= '<input type="hidden" id="rotate_angle2-'+count+'" name="rotate_angle2-'+count+'" value="0"/>';
			
		row+= '<input type="hidden" id="crop_x2-'+count+'" name="x2-'+count+'"/>';
			
		row+= '<input type="hidden" id="crop_y2-'+count+'" name="y2-'+count+'"/>';
			
		row+= '<input type="hidden" id="crop_w2-'+count+'" name="w2-'+count+'"/>';
			
		row+= '<input type="hidden" id="crop_h2-'+count+'" name="h2-'+count+'"/>';
			
		//row+= '<input type="hidden" id="profile_pic2-'+count+'" name="h1-'+count+'"/>';
			
		row+= '<input type="hidden" id="rotate_angle3-'+count+'" name="rotate_angle3-'+count+'" value="0"/>';
			
		row+= '<input type="hidden" id="crop_x3-'+count+'" name="x3-'+count+'"/>';
			
		row+= '<input type="hidden" id="crop_y3-'+count+'" name="y3-'+count+'"/>';
			
		row+= '<input type="hidden" id="crop_w3-'+count+'" name="w3-'+count+'"/>';
			
		row+= '<input type="hidden" id="crop_h3-'+count+'" name="h3-'+count+'"/>';
			
		//row+= '<input type="hidden" id="profile_pic3-'+count+'" name="h1-'+count+'"/>';
		
		row+= '<input type="hidden" id="rotate_angle4-'+count+'" name="rotate_angle4-'+count+'" value="0"/>';
			
		row+= '<input type="hidden" id="crop_x4-'+count+'" name="x4-'+count+'"/>';
			
		row+= '<input type="hidden" id="crop_y4-'+count+'" name="y4-'+count+'"/>';
			
		row+= '<input type="hidden" id="crop_w4-'+count+'" name="w4-'+count+'"/>';
			
		row+= '<input type="hidden" id="crop_h4-'+count+'" name="h4-'+count+'"/>';
			
		//row+= '<input type="hidden" id="profile_pic4-'+count+'" name="h1-'+count+'"/>';
			
		row+= '<input type="hidden" name="uploaded_photo1-'+count+'" id="uploaded_photo1-'+count+'" value="" />';
			
		row+= '<input type="hidden" name="uploaded_photo2-'+count+'" id="uploaded_photo2-'+count+'" value="" />';
			
		row+= '<input type="hidden" name="uploaded_photo3-'+count+'" id="uploaded_photo3-'+count+'" value="" />';
		
		row+= '<input type="hidden" name="uploaded_photo4-'+count+'" id="uploaded_photo4-'+count+'" value="" />';
			
		row+= '<input type="hidden" name="existing_photo1-'+count+'" id="existing_photo1-'+count+'" value="0" />';
			
		row+= '<input type="hidden" name="existing_photo2-'+count+'" id="existing_photo2-'+count+'" value="0" />';
			
		row+= '<input type="hidden" name="existing_photo3-'+count+'" id="existing_photo3-'+count+'" value="0" />';
		
		row+= '<input type="hidden" name="existing_photo4-'+count+'" id="existing_photo4-'+count+'" value="0" />';
			
		row+= '<input type="hidden" id="count_image-'+count+'" value="0" name="count_image-'+count+'"/>';
				
		row+= '</td>';
		
		var content_function = "remove_animal_content('"+count+"')";
		var delete_icon = base_url+"assets/img/delete.png";
		
		row+= '<td><a href="javascript:void(0);" onClick="'+content_function+'" class="btn primary black-btn btn-action"><i class="material-icons">delete</i></a></td>';
		
		row+= '</tr>';
		$('.add_transport #card-table').append(row);
		jQuery('.title-tipso').tipso();
	 }
		var qtype = '#quick-type-'+parseInt(count);
		var qbreed = '#quick-breed-'+parseInt(count);
		var qgender ='#quick-gender-f-'+parseInt(count);
		var qtravel ='.quick-travel-'+parseInt(count);
		var qname = '#quick-animal-name-'+parseInt(count);
		//var animal_weight = '#animal-weight-'+parseInt(count);
		var animal_weight = '#quick-weight-'+parseInt(count);
		$(qtype).rules('add',{
			required : {
						depends: function(element){
								var name = $(qname).val();
								if(name)
								{	
									return true;
								} else {
									return false;
								}
							}
					} ,
				messages:{
				 required: 'This field is required.'	
				}
			
		});
		
		$(qbreed).rules('add',{
			required : {
						depends: function(element){
								var name = $(qname).val();
								if(name)
								{	
									return true;
								} else {
									return false;
								}
							}
					},
			messages:{
				required:'This field is required.'	
			}
			
		});
		
	
		$(qgender).rules('add', {
			required : {
						depends: function(element){
								var name = $(qname).val();
								if(name)
								{	
									return true;
								} else {
									return false;
								}
							}
					},
					messages:{
				 required: 'This field is required.'	
				}
			 
		});
		
		
		$(animal_weight).rules('add',{
			required : {
							depends: function(element){
								var name = $(qname).val();
								if(name)
								{	
									return true;
								} else {
									return false;
								}
							}
					},
				//max:15,	
			messages:{
				required:'This field is required.'
				//max:'For this type of transport animal weight must be less then than 16 lbs.'	
			}
			
		});
	
						
		//$('.gender-'+count).uniform();
		//$('.test').uniform();
		//$('.quick-travel-'+count).uniform(); 
		//$('.medicine').uniform();
		//$.uniform.update();
		last_inserted_animal_id = count;
		count++;
		$('#records').val(count);
		}else {
		alert('Maximum 20 rows can be added');	
		}
				
});

function all_animals()
{
		$.ajax({
		type:'POST',
		url:base_url+'org_transportation/get_all_animals/',
		data:{
			//id:id,
		},
		beforeSend:function(){
						
						$('#animal_listing_loader').modal('toggle');
		},
		success:function(data){
			
			var html_str  = '';
			
			
			html_str += '<tr>';
			html_str += '<td colspan="5" class="show-animals padb0"><ul><li><label class="control-label va-top" for="on_transport">Show Animals:</label><ul><li><div class="custom-checkbox "><input type="checkbox" name="not_on_transport" id="not_on_transport" value="" checked disabled><label for="not_on_transport" class="checkbox-inline org-select-rdo">Not on a Transportation</label></div></li><li><div class="custom-checkbox"><input type="checkbox" name="on_transport" id="on_transport" value=""><label for="on_transport" class="checkbox-inline org-select-rdo">Already on a Transport</label></div></li></ul></td>';		  
			html_str += '</tr>';
		
			
			var animal_listing = JSON.parse(data);
			
			
			var animal_listing_len = animal_listing.length;
			if(animal_listing_len > 0)
			{
				
				var highest_bid_value = '';
				var highest_bid_user = '';
				var final_bid = 0;
				
					for(var i=0; i <animal_listing_len;i++)
					{
						if(jQuery.inArray(animal_listing[i]['data']['in_animal_id'], inserted_animal_detail ) == -1)
						{	
							animals_info_details[animal_listing[i]['data']['in_animal_id']] = animal_listing[i]['data'];
							html_str +=  animal_listing[i]['html'];
						}	
					}		
					
						
					$('.all_animals_listing .table-bordered tbody').html(html_str);
					$('.all_animals_listing').modal('toggle');
			} else {
						//alert('data information is not available');
						//var html_str  = '';
						html_str += '<tr><td>No animals available.</td></tr>';
						$('.all_animals_listing .table-bordered tbody').html(html_str);
						
						$('.all_animals_listing').modal('toggle');
						
					}
					
					$('.preview').popover({'trigger':'hover','html':true,'animation':false});
					$(document).on("hover",".info-icons a",function(){
						$('.popover').addClass($(this).data("class"));
					});
					
					$('.preview').popover();
					//if()
						if($( window ).width() <= 767)
						{	
							$('#animal_listing').stacktable({class:'stacktable small-only'});
							$('#Listing_animals .large-only').html(" ");
							//$('.large-only').html(" ");

						} else {
							$('#animal_listing').stacktable({class:'stacktable large-only'});
							$('#Listing_animals .small-only').html(" ");
							//$('.small-only').html(" ");
						}
						
					//$('#animal_listing').stacktable({class});
					$(".already_in_transports").hide();	
				},
				complete:function(){
					//$('#animal_listing_loader').modal('hide');
					},
			});
}	

$(document).on('click','.empty_dates',function()
{
	$('#animal_listing_loader').modal('hide');
}); 

var count_record = $('#records').val();
for (var i=0;i< count_record;i++)
{	
	var count_image = $('.animal-photo-attach-'+i+' .img-class-photo > li').length;
	$('#count_image-'+i).val(count_image);	
}	

function disSelAni()
{
	var ids=[]; 
	var gender;
	$('#animal_listing_loader').modal('hide');
	$('input[class=animal_listing_data]:checked').each(function(){
	if(jQuery.inArray($(this).attr('id'), inserted_animal_detail ) == -1)
	{	
	for(var i=0;i<count;i++)
	{
		if($('#quick-animal-name-'+i).length > 0)
		{
			 if($('#quick-animal-name-'+i).val()!='')
			 {
				new_row=1;
			 } else {
				id = i;
				new_row=0;
				break;
			} 	
		}	
	}	
	
	if($('.quick-animal-name').length <=0)
	{
		new_row = 1;
	}		
	if(new_row == 1)
	{
			id = count;	
			$("#add-more").trigger("click");
	}	
		
	//var id = count;
	inserted_animal_detail.push($(this).attr('id'));
	if(animals_info_details[$(this).attr('id')]['st_gender'] == 'F')
		gender = 'Female';
	else 
		gender = 'Male';
  
   $('[name="animal-id-'+id+'"]').val(animals_info_details[$(this).attr('id')]['in_animal_id']);
   $('#quick-animal-name-'+id).val(animals_info_details[$(this).attr('id')]['st_animal_name']);
   $('select[name="quick-type-'+id+'"]').find('option[value="'+animals_info_details[$(this).attr('id')]['in_animal_type_id']+'"]').attr("selected",true);
 
   get_breed(id,animals_info_details[$(this).attr('id')]['in_primary_breed_id']);
   
  	
	$('#quick-weight-'+id).val(animals_info_details[$(this).attr('id')]['in_weight']);
	$('input:radio[value="'+gender+'"][name="quick-gender-'+id+'"]').prop("checked",true);	

	if(typeof(animals_info_details[$(this).attr('id')]['st_travel_with']) != "undefined" && animals_info_details[$(this).attr('id')]['st_travel_with'] !== null)		
    {	  
		var travelwith = animals_info_details[$(this).attr('id')]['st_travel_with'];
		
		var myKey = /,/;
		//var myStringVar = "I Love kuppiya";
		var myMatch = travelwith.search(myKey);
		if(myMatch != -1)
		{	
		
			var trvlwith = travelwith.split(",");
			if(trvlwith.length >0)
			{
				for(var j=0;j<trvlwith.length;j++)
				{
					$('input:checkbox[value="'+trvlwith[j]+'"][name="quick-travel-'+id+'[]"]').prop("checked",true);
				}	
			}
		} else {
			$('input:checkbox[value="'+travelwith+'"][name="quick-travel-'+id+'[]"]').prop("checked",true);	
		}	
   }

	if(animals_info_details[$(this).attr('id')]['st_cvi'] )
		{
			$('input:checkbox[name="quick-cvi-'+id+'"]').prop("checked",true);
			$('input:checkbox[name="quick-cvi-'+id+'"]').parent('span').addClass("checked");	
		}
	
   if($(this).attr('id')!='')
   {	   
   $.ajax({
		type:'POST',
		async:false,
		url:base_url+'org_transportation/get_all_image/',
		data:{
			id:$(this).attr('id'),
		},
		success:function(data){
				console.log(data);
				var animal_image_listing = JSON.parse(data);
				var animal_img_listing_len = animal_image_listing.length;
				if(animal_img_listing_len > 0)
				{
					
					$('#animal-photo-attach-'+id).append('<li id="images" title="View Photos" onClick="show_images('+id+')">'+animal_img_listing_len +' Pic(s)</li>');
					$('#count_image-'+id).val(animal_img_listing_len);
					for(var i=0; i <animal_img_listing_len;i++)
					{
						var ind1 = parseInt(i)+parseInt(1);
						uploaded_animal_image['animal_photo'+id+'-'+ind1] = ({'image_name':animal_image_listing[i]['st_file_name'],'in_file_id':animal_image_listing[i]['in_file_id'],'in_deleted':'0'});
						$('#uploaded_photo'+ind1+'-'+id).val(animal_image_listing[i]['st_file_name']);
						$('#existing_photo'+ind1+'-'+id).val(animal_image_listing[i]['in_file_id']);
					}
					if(animal_img_listing_len == 4 )
					{
						$('#add_animal_img-'+id).hide();
					}
				}
			},
		});
	}

	}	
	});
}

$(document).on("click",".animal_listing_data",function () {
			var id = $(this).attr('id');
		  if ($("#"+id).prop("checked")) {
			   // do something
			   $('#uniform-select'+id+' span').addClass('checked');
			   $("#"+id).attr('checked',true);
				//alert('show all animals');
						   
			}else{
				$('#uniform-select'+id+' span').removeClass('checked');
				 $("#"+id).attr('checked',false);	
			}
		});

var id;
var ind_img;
var img_uploaded_name;	
$(document).on('click','.image-button',function(){
    $('#my-file').click();
	id = $(this).attr('id');
});

$(document).ready(function() {
$(document).on('change','#my-file',function(e) {
			//alert(id);
			var error_msg = '';
			if($('#my-file').val()!='') {
				/*var ind = $('#count_image-'+id).val();
				ind = parseInt(ind)+parseInt(1);*/
				var fsize1 = $('#my-file')[0].files[0].size;
				var fname1 = $('#my-file')[0].files[0].name;
				var ftype1 = $('#my-file')[0].files[0].type;
				
				if(fsize1 > 5242880) {
					//alert('hi');
					$('#my-file').val('');
					error_msg+='Animal photo must be less than 5MB\n';
				}
				
				if(ftype1 != 'image/jpeg' && ftype1 != 'image/gif' && ftype1 != 'image/png' && ftype1 != 'image/jpg') {
					error_msg+='Animal photo format is invalid\n';
				}
				
				//$("#uploaded_photo"+ind+"-"+id).val(fname1);
						
				//$('.crop-img-here4').html('<img class="cropper4" id="crop-image-rotate4" src="http://crystal99/doobert-v3/upload/test_animal_images/'+fname1+'" width="500px"><div class="rotation"><span class="clockwise"><a id="rotateLeft4" title="anti-clockwise" href="javascript:void(0);"> <i class="fa fa-rotate-left"></i> anti-clockwise</a></span> <span class="anti-clockwise"><a id="rotateRight4"  title="clockwise" href="javascript:void(0);"> <i class="fa fa-repeat"></i>clockwise</a></span></div>');
						
			$.ajaxFileUpload({
						url: base_url+'org_transportation/ajax_file_upload', 
						secureuri:false,
						//data: myData,
						fileElementId:'my-file',
						dataType: 'json',	
						async:false,
						success:function(data,e) {
						if(data.upload_error != undefined || $.trim(data.upload_error) != '') {
								$('#crop_img_popup1').modal('hide');
								if(data.upload_error == "You did not select a file to upload."){
									alert("Animal photo must be less than 5MB.");
								}else{
									alert(data.upload_error);
								}
								$('.image_preview1').html('');
								$('#profile_pic1').hide();
								return false;
						}
						
						ind_img = $('#count_image-'+id).val();
						if(ind_img=='0')
						{
								ind_img = parseInt(ind_img)+parseInt(1);
						} else 
						{
							for(var l=1;l<=4;l++)
							{
								if((uploaded_animal_image['animal_photo'+id+'-'+l]==undefined) || (uploaded_animal_image['animal_photo'+id+'-'+l]['image_name']==''))
								{
									ind_img = l;
									break;
								}
								
							}	
						}	
							
						$("#uploaded_photo"+ind_img+"-"+id).val(data.file_name);
						img_uploaded_name = data.file_name;
						$('.crop-img-here4').html('<img id="crop-image-rotate1" class="cropper1 img_url" src="'+base_url+'upload/animal_images/'+data.file_name+'"><div class="rotation"><span class="clockwise"><a id="rotateLeft1" title="Rotate Left" href="javascript:void(0);"> <i class="fa fa-rotate-left"></i> anti-clockwise</a></span> <span class="anti-clockwise"><a id="rotateRight1" title="Rotate Right" href="javascript:void(0);"> <i class="fa fa-repeat"></i>clockwise</a></span></div>');
						
				
						$('#crop_img_popup4').modal('show');
						
						var $cropper = $('.cropper1'),
							$dataX = $("#crop_x"+ind_img+"-"+id),
							$dataY = $("#crop_y"+ind_img+"-"+id),
							$dataH = $("#crop_h"+ind_img+"-"+id),
							$dataW = $("#crop_w"+ind_img+"-"+id),
							cropper;
						$cropper.cropper({
							//aspectRatio: 16 / 12,
							data: {
								x: $dataX,
								y: $dataY,
								width: $dataW,
								height: $dataH
							},
							//rotatable : true,
							zoomable : false,
							minWidth: 50,
							minHeight: 50,
							built: function (e) {
								console.log(e.type);

									var n_x1	=	$("#crop_x"+ind_img+"-"+id).val();
									var n_y1	=	$("#crop_y"+ind_img+"-"+id).val();
									var n_h1	=	$("#crop_h"+ind_img+"-"+id).val();
									var n_w1	=	$("#crop_w"+ind_img+"-"+id).val();
									
									$("#crop_x"+ind_img+"-"+id).val(n_x1);
									$("#crop_y"+ind_img+"-"+id).val(n_y1);
									$("#crop_h"+ind_img+"-"+id).val(n_h1);
									$("#crop_w"+ind_img+"-"+id).val(n_w1);
									var imgdata1 = $('#crop-image-rotate1').cropper("getImageData");
									$('#rotate_angle'+ind_img+'-'+id).val(imgdata1.rotate);
									$('#ajax-loader-bar-rotate1').hide();
								},
							
							
							done: function(data) {
								$dataX.val(data.x);
								$dataY.val(data.y);
								$dataH.val(data.height);
								$dataW.val(data.width);
								//$dataRotate.val(data.rotate);
							}
							
					
						});
						
						
						cropper = $cropper.data("cropper");
						
						//$(".save_popup1_animal_photo").show();
						
						$(document).on('click',"#rotateLeft1",function() {														 
							$('#ajax-loader-bar-rotate1').show();
							$cropper.cropper("rotate", -90);
							
						});
					
						$(document).on('click',"#rotateRight1",function() {
							$('#ajax-loader-bar-rotate1').show();
							$cropper.cropper("rotate", 90);
							
						});
						},
						error:function(a,b,c){
							//alert("HII12345");
						},
					});		
			}
		});
		
		$(document).on('click','.save_popup4_animal_photo',function(){
			
			$('#animal-photo-attach-'+id).html('');
			var image_name = $('.img_url').attr('src');
			var img_name = image_name.substring(image_name.lastIndexOf('/')+1)+"__"+id;	
			uploaded_animal_image['animal_photo'+id+'-'+ind_img] = ({'image_name':img_uploaded_name,'in_file_id':'','in_deleted':'1'});
			//$('#animal-photo-attach-'+id).append('<li><img src="'+image_name+'"  alt="" title=""></li>');
			//$('#animal-photo-attach-'+id).append('<li><img src="'+image_name+'"  alt="" title="">'+ '&nbsp;<a href="javascript:void(0)" onClick="$(this).parent().remove();">X</a></li>');
			//$('#animal-photo-attach-'+id).append('<li><img src="'+image_name+'"  alt="" title="">'+ '&nbsp;<a href="javascript:void(0)"  class="remove_img" onClick="remove_img(this)" data-val="'+img_name+'">X</a></li>');		
			
			var count_image = $('#count_image-'+id).val();
				count_image = parseInt(count_image) + parseInt(1);	
			
			//$('#animal-photo-attach-'+id).append('<li id="images" title="View Photos" class="open_img" data-val="'+img_name+'" onClick="show_images(this)">'+count_image +' Pic(s)</li>');	
			$('#animal-photo-attach-'+id).append('<li id="images" title="View Photos" onClick="show_images('+id+')">'+count_image +' Pic(s)</li>');
			$('#count_image-'+id).val(count_image);
			$('#crop_img_popup4').modal('hide');
			if(count_image== 4)
			{
				$('#add_animal_img-'+id).hide();
			}
		});	
	
});	

var k;
$(document).ready(function() 
{ 
	var animal_ids_count = $('.animal_id').length;
	//console.log(animal_ids_count);
	for(k=0; k < animal_ids_count; k++)
	{
		if($('#animal-id-'+k).val() !='0')
		{
			
		$.ajax({
			type:'POST',
			url:base_url+'org_transportation/get_all_image/',
			 beforeSend: function() {
					var l = k; 
			},
			 async:false,
			data:{
				id:$('#animal-id-'+k).val(),
			},
			success:function(data){
				//alert("HII123");
				console.log('result '+data);
				var animal_image_listing = JSON.parse(data);
				var animal_img_listing_len = animal_image_listing.length;
				console.log('length is'+animal_img_listing_len);
				if(animal_img_listing_len > 0)
				{
					$('#animal-photo-attach-'+k).append('<li id="images" title="View Photos" onClick="show_images('+k+')">'+animal_img_listing_len +' Pic(s)</li>');
					$('#count_image-'+k).val(animal_img_listing_len);
					for(var i=0; i <animal_img_listing_len;i++)
					{
						var ind1 = parseInt(i)+parseInt(1);
						$('#uploaded_photo'+ind1+'-'+k).val(animal_image_listing[i]['st_file_name']);
						$('#existing_photo'+ind1+'-'+k).val(animal_image_listing[i]['in_file_id']);
						uploaded_animal_image['animal_photo'+k+'-'+ind1] = ({'image_name':animal_image_listing[i]['st_file_name'],'in_file_id':animal_image_listing[i]['in_file_id'],'in_deleted':'1'});
					}
					if(animal_img_listing_len >= 4 )
					{
						$('#add_animal_img-'+k).hide();
					}
						
				}
			},
		});
		}
	}
});	
	function remove_img(ele){
		$(ele).parent().remove();
		var name_id = $(ele).attr('data-val');
		var temp = name_id.split("__");
		var name = temp[0];
		var id = temp[1];
		for(var i=1;i<=4;i++){
			hiddenId = "uploaded_photo"+i+"-"+id;
			singleValues = $( "#"+hiddenId).val();
			//alert(hiddenId);	alert(name +"   "+singleValues);
			if(name == singleValues){
				//value matched
				$( "#"+hiddenId).val('');
			}else{
				
			}
		}
		var count_image = $('#count_image-'+id).val();
		count_image = parseInt(count_image) - parseInt(1);
		$('#count_image-'+id).val(count_image);
		if(count_image != 4)
		{
			$('#add_animal_img-'+id).show();
		}
	}

	function show_images(ids)
	{		
		$('#animal_image .photos').html('');
		
		var li_img ='';
		var singleValues ='';
		all_img ='0';
		dis_image ='0'
		for(var i=1;i<=4;i++)
		{
			if(uploaded_animal_image['animal_photo'+ids+'-'+i]!=undefined)
			{		
				//var img_name = uploaded_animal_image['animal_photo'+ids+'-'+i]['image_name'];
				hiddenId = "uploaded_photo"+i+"-"+ids;			
				singleValues = uploaded_animal_image['animal_photo'+ids+'-'+i]['image_name'];			
				console.log(hiddenId +'||'+ singleValues);
				
				if(singleValues)
				{
					dis_image++;
					if(uploaded_animal_image['animal_photo'+ids+'-'+i]['in_file_id']=='')
					var image_name = base_url+'upload/animal_images/'+singleValues;
					else 
					var image_name = base_url+'upload/animal_images/140x140/'+singleValues;		
					if(uploaded_animal_image['animal_photo'+ids+'-'+i]['in_deleted']==1)
					{	
						li_img += '<li><img src="'+image_name+'" height="120px" alt="" title="">'+ '&nbsp;<div class="custom-checkbox"><input type="checkbox" name="delUImg" value="1" class="quick-travel userRemove delImgChk" id="u'+hiddenId+'" data-val="'+singleValues+'" data-ind="'+ids+'" ><label for="u'+hiddenId+'" class="checkbox-inline"></label></div></li>';
					}else {
						all_img++;
						li_img += '<li><img src="'+image_name+'" height="120px"  alt="" title=""></li>';
					}
					singleValues = '';
				}
			}		
		}
		$('#animal_image .photos').append(li_img);
		if(dis_image==all_img)
		{	
			$('#delete_img').hide();
		} else {
			$('#delete_img').show();
		}	
		$("#animal_image").modal('show');
	}
	

//function open_images(id, transport=''){
function open_images(id, transport){	
	var id = id || '';
	var transport = transport || '';
	var animal_ids_count = $('.animal_id').length;
	if(id == ''){
		id = 0;
	}else{
		id = id;
	}
				
		$.ajax({
			type:'POST',
			url:base_url+'org_transportation/get_all_image/',
			 beforeSend: function() {				
			},
			 async:false,
			data:{
				id:$('#animal-id-'+id).val(),
			},
			success:function(data){
				//alert("HII123");
				
				$('#animal_image .photos').html('');				
				var animal_image_listing = JSON.parse(data);
				var animal_img_listing_len = animal_image_listing.length;				
				if(animal_img_listing_len > 0)
				{
					

					for(var i=0; i <animal_img_listing_len;i++)
					{
						var ind1 = parseInt(i)+parseInt(1);
						$('#uploaded_photo'+ind1+'-'+id).val(animal_image_listing[i]['st_file_name']);
						$('#existing_photo'+ind1+'-'+id).val(animal_image_listing[i]['in_file_id']);
						var image_name = base_url+'upload/animal_images/140x140/'+animal_image_listing[i]['st_file_name'];						
						var animalimg = animal_image_listing[i]['st_file_name'];
						var animalid = ind1+'-'+id;
						
						if(transport == 1){
							$('#animal_image .photos').append('<li><img src="'+image_name+'" height="120px"  alt="" title="">'+ '&nbsp;</li>');
						}else{
							$('#animal_image .photos').append('<li><img src="'+image_name+'" height="120px"  alt="" title="">'+ '&nbsp;<div class="custom-checkbox"><input type="checkbox" name="delIm" value="1" class="quick-travel delImgChk" id="'+animalid+'" data-val="'+animalimg+'"><label for="'+animalid+'" class="checkbox-inline" ></label></div></li>');
						}
					}	
						
						$('#count_image-'+id).val(animal_img_listing_len);
						if(animal_img_listing_len >= 4)
						{
							$('#add_animal_img').hide();
						}
						
				}
			},
		});
		/*}
	}*/
	$("#animal_image").modal('show');

}


function close_animal(){
	$("#animal_image").modal('hide');	
}

function delete_animal_img()
{
	var delete_animal_image =[];
	var animal_id =[];
	var img_index = '';
	$('.userRemove').each(function(){
		if($(this).prop('checked') === true)
		{
			delete_animal_image.push({'animal_name':$(this).data('val'),'ind':$(this).data('ind')});	          				        
	    }			
	});
	
	if((delete_animal_image.length > 0) || (delete_animal_image.length >0)) 
	{
		if(confirm('Are you sure you want to delete this animal image(s) from the transport?'))
		{
			for(var d=0;d<delete_animal_image.length;d++)
			{
				var ani_name = delete_animal_image[d]['animal_name'];
				var ind = delete_animal_image[d]['ind'];
				var in_file_id = ''
				var ln = '';
				var ani_image='';
				for(var l=1;l<=4;l++)
				{
					if(uploaded_animal_image['animal_photo'+ind+'-'+l]!=undefined)
					{	
						var image_detail = uploaded_animal_image['animal_photo'+ind+'-'+l]['image_name'];
						if(image_detail == ani_name)
						{
							//uploaded_animal_image['animal_photo'+ind+'-'+l] = ({'image_name':img_uploaded_name,'in_file_id':'','in_deleted':'1'});
							in_file_id = uploaded_animal_image['animal_photo'+ind+'-'+l]['in_file_id'];
							ani_image =  uploaded_animal_image['animal_photo'+ind+'-'+l]['image_name'];
							uploaded_animal_image['animal_photo'+ind+'-'+l] = ({'image_name':'','in_file_id':'','in_deleted':'1'});
							
							ln = l;
							break;
						}
					}
				}	
				if(in_file_id!='' && ani_image!='')
				{
					$.ajax({
							type:'POST',
							url:base_url+'org_transportation/delete_animal/',
							beforeSend: function() 
							{
							},
							async:false,
							data:{
									animal_image:ani_image,
								},
							dataType:"json",
							success:function(data)
							{
							}
						});
						$('#uploaded_photo'+ln+'-'+ind).val('');
						$('#existing_photo'+ln+'-'+ind).val('');
						//$('#uploaded_photo'+ln+'-'+ind).val('');
				} else {
					
					$('#uploaded_photo'+ln+'-'+ind).val('');
				}
			
				$('#animal-photo-attach-'+ind).html('');
				var count_image = $('#count_image-'+ind).val();
				var total_count = parseInt(animal_image.length) + parseInt(animal_id.length);
				console.log(total_count);
				count_image = parseInt(count_image) - parseInt(1);

				$('#count_image-'+ind).val(count_image);
				if(count_image != 0)
				{
					$('#animal-photo-attach-'+ind).append('<li id="images" title="View Photos" onClick="show_images('+ind+')">'+count_image +' Pic(s)</li>');
				}
				if(count_image != 4)
				{
					$('#add_animal_img-'+ind).show();
				}
				$("#animal_image").modal('hide');	

			}
			alert('Animal image(s) deleted successfully.');
		}
	
	} else
		{
				alert("Please select animal image to delete.");
				return false;
		}
}	
	
			
var error_animal_story=0;
var error_animal_field = 0;
$(document).on('click','#submit-req,#edit_animal_transport',function(){
	var error_msg = '';
	var error_status = 0;
	if($('input[id=passengers-conditions]:checked').length >0)
	{
		//$('#submit-req').attr('disabled',false);
	} else {
		//$('#submit-req').attr('disabled',true);
		error_msg += 'Please accept terms & conditions';
		error_status = 1;
		
	}
	
	if($('#animal_story').val()!= '')
	{
		error_animal_field = 0;
	} else {
		error_animal_field = 1;
		//error_msg += 'Please Enter Animal Story.';
		if($('.publish-story-trans .help-block').length > 0)
		{
			error_status = 1;
			error_animal_story = 1;					
		} else {
			$('.publish-story-trans').parent().addClass('has-error');
			$('.publish-story-trans').append('<label for="animal_story" class="help-block">This Field is Required.</label>');
			error_status = 1;
			error_animal_story = 1;
		}	
	}
	//error_msg
	if(error_status == 1)
	{	
		if(error_msg!='')
		{
			if(error_animal_field == 0)
			{	
				alert(error_msg);
			}	
		}	
		return false;
	}	
});

	$('#animal_story').blur(function(){
			if(error_animal_story == 1)
			{
				if($('#animal_story').val()!= '')
				{
					error_animal_field = 0;
					$('.publish-story-trans').parent().removeClass('has-error');
					$('.publish-story-trans .help-block').remove();
				} else {
					error_animal_field = 1;
				//error_msg += 'Please Enter Animal Story.';
					if($('.publish-story-trans .help-block').length > 0)
					{
						
					} else {	
					$('.publish-story-trans').parent().addClass('has-error');
					$('.publish-story-trans').append('<label for="animal_story" class="help-block">This Field is Required.</label>');
					}
				}
		  }
	});


function delete_animal(animal_id,row_id)
{
	
	var animal_ids_count = $('.animal_id').length;
	//alert(animal_ids_count);
	if(animal_ids_count > 1)
	{	
			if(confirm('Are you sure you want to remove this animal from the transport?'))
			{
			$.ajax({
					type:'POST',
					url:base_url+'org_transportation/update_animal_transport_status',
					async:false,
					data:{
						animal_id	:	animal_id,
						transport_id : transport_id
					},
					success:function(data){
						//console.log('result'+data);
						var animal_ids_count = $('.animal_id').length;	
						
							if(row_id!=0 || animal_ids_count > 1)
							{	
								if($(window ).width() <= 1069)
								{	
									$('#tbl_'+row_id).remove();
								} else 
								{	
									$('.list-animal-profile tbody #row-'+row_id).remove();
								}
								//$('.list-animal-profile tbody #row-'+row_id).remove();
							} else {
								$('animal-id-'+row_id).val('0');
								$('#quick-animal-name-'+row_id).val('');
								$('#quick-type-'+row_id).val('');
								$('#quick-type-'+row_id).val('');
								$('#quick-breed-'+row_id).val('');
								//$('input:checkbox[name="quick-cvi-'+id+'"]').prop("checked",false);
								//$('input:checkbox[name="quick-cvi-'+id+'"]').parent('span').removeClass("checked");
								$('input:checkbox[name="quick-travel-'+row_id+'[]"]').prop("checked",false);
								$('input:checkbox[name="quick-travel-'+row_id+'[]"]').parent('span').removeClass("checked");
								$('#animal-photo-attach-'+row_id).html(' ');
								$('#rotate_angle1-'+row_id).val('');
								$('#crop_x1-'+row_id).val('');
								$('#crop_y1-'+row_id).val('');
								$('#crop_w1-'+row_id).val('');
								$('#crop_h1-'+row_id).val('');
								$('#profile_pic1-'+row_id).val('');
								$('#uploaded_photo1-'+row_id).val('');
								$('#existing_photo1-'+row_id).val('0');
								$('#rotate_angle2-'+row_id).val('');
								$('#crop_x2-'+row_id).val('');
								$('#crop_y2-'+row_id).val('');
								$('#crop_w2-'+row_id).val('');
								$('#crop_h2-'+row_id).val('');
								$('#profile_pic2-'+row_id).val('');
								$('#uploaded_photo2-'+row_id).val('');
								$('#existing_photo2-'+row_id).val('0');
								$('#rotate_angle3-'+row_id).val('');
								$('#crop_x3-'+row_id).val('');
								$('#crop_y3-'+row_id).val('');
								$('#crop_w3-'+row_id).val('');
								$('#crop_h3-'+row_id).val('');
								$('#profile_pic3-'+row_id).val('');
								$('#uploaded_photo3-'+row_id).val('');
								$('#existing_photo3-'+row_id).val('0');
								$('#rotate_angle4-'+row_id).val('');
								$('#crop_x4-'+row_id).val('');
								$('#crop_y4-'+row_id).val('');
								$('#crop_w4-'+row_id).val('');
								$('#crop_h4-'+row_id).val('');
								$('#profile_pic4-'+row_id).val('');
								$('#uploaded_photo4-'+row_id).val('');
								$('#existing_photo4-'+row_id).val('0');
								$('#count_image-'+row_id).val('0');
								$('#add_animal_img-'+row_id).show();
							}				
						
						alert('Animal successfully removed from this transport.');
						if($( window ).width() <= 1069){							
							location.reload();
						}
					},
				});


			}
			
			else
			{
				return false;
			}	
	}
	else
	{   alert('Transport should have atleast one animal added for transporting.');
		return false;
	}
}


$(document).on('click','#publish-transport-org',function()
{
	$('#transport_loader').modal('show');
});

function funPreview(){
  
$('.preview').popover({'trigger':'hover','html':true,'animation':false});

  $(document).on("hover",".info-icons a",function(){
      $('.popover').addClass($(this).data("class"));
    
    });
}
funPreview();

function onlyNumbers(evt) {
        var e = event || evt; // for trans-browser compatibility
        var charCode = e.which || e.keyCode;	
        var flag = true;
        //
        if (charCode > 47 && charCode < 58)
        {   
			if (len(e.target.id))
				flag = true;
            else
			{	
				alert("Value should be not more the 3 Digit Number");	
				flag = false;
			}	
		} else {
			alert("Value should be not more the 3 Digit Number");
			flag = false;
		}
        return flag;
    }
    function len(id) {
        var flag = false;
        var val = document.getElementById(id).value.length;
        val = val + 1;
        if (val <= 3)
            flag = true;
        return flag;
    }

function remove_animal_content(id)
{  
	if(confirm('Are you sure you want to remove this animal from the transport?'))
	{	
		var animal_id = $('#animal-id-'+id).val();
		
		var animal_ids_count = $('.animal_id').length;

		if(animal_id != '0')
		{
		//inserted_animal_detail[]
			inserted_animal_detail.splice( $.inArray(animal_id, inserted_animal_detail), 1 );
		}	 	
		$('#animal-id-'+id).val('0');
		$('#quick-animal-name-'+id).val('');
		$('#quick-type-'+id).val('');
		$('#quick-type-'+id).val('');
		$('#quick-breed-'+id).val('');
		$('#quick-weight-'+id).val('');
		/*var quick_gender =  $('input[name="quick-gender-'+id+'"]:checked').val();
		alert(quick_gender);*/
		$('input:radio[name="quick-gender-'+id+'"]').prop("checked",false);
		$('input:radio[name="quick-gender-'+id+'"]').parent('span').removeClass('checked');
	
		$('input:checkbox[name="quick-cvi-'+id+'"]').prop("checked",false);
		$('input:checkbox[name="quick-cvi-'+id+'"]').parent('span').removeClass("checked");
	
		$('input:checkbox[name="quick-travel-'+id+'[]"]').prop("checked",false);
		$('input:checkbox[name="quick-travel-'+id+'[]"]').parent('span').removeClass("checked");
		$('#animal-photo-attach-'+id).html(' ');
		$('#rotate_angle1-'+id).val('');
		$('#crop_x1-'+id).val('');
		$('#crop_y1-'+id).val('');
		$('#crop_w1-'+id).val('');
		$('#crop_h1-'+id).val('');
		$('#profile_pic1-'+id).val('');
		$('#uploaded_photo1-'+id).val('');
		$('#existing_photo1-'+id).val('0');
		$('#rotate_angle2-'+id).val('');
		$('#crop_x2-'+id).val('');
		$('#crop_y2-'+id).val('');
		$('#crop_w2-'+id).val('');
		$('#crop_h2-'+id).val('');
		$('#profile_pic2-'+id).val('');
		$('#uploaded_photo2-'+id).val('');
		$('#existing_photo2-'+id).val('0');
		$('#rotate_angle3-'+id).val('');
		$('#crop_x3-'+id).val('');
		$('#crop_y3-'+id).val('');
		$('#crop_w3-'+id).val('');
		$('#crop_h3-'+id).val('');
		$('#profile_pic3-'+id).val('');
		$('#uploaded_photo3-'+id).val('');
		$('#existing_photo3-'+id).val('0');
		$('#rotate_angle4-'+id).val('');
		$('#crop_x4-'+id).val('');
		$('#crop_y4-'+id).val('');
		$('#crop_w4-'+id).val('');
		$('#crop_h4-'+id).val('');
		$('#profile_pic4-'+id).val('');
		$('#uploaded_photo4-'+id).val('');
		$('#existing_photo4-'+id).val('0');
		$('#count_image-'+id).val('0');
		$('#add_animal_img-'+id).show();
		if(id!=0 && animal_ids_count > 1)
		{
			if($(window ).width() <= 1069)
			{    
				//$('.small-only tbody .row-'+id).remove();
				$('#tbl_'+id).remove();
				
			}else {		
			$('#card-table tbody #row-'+id).remove();
			}
		} else {
			$('#quick-breed-'+id).empty('');
			$('#quick-breed-'+id).html('<option value="">Select</option>');
		}
	}else {
		return false;
	}		
}



function remove_animal_content_mobile(id)
{  
	if(confirm('Are you sure you want to remove this animal from the transport?'))
	{	
		var animal_id = $('#animal-id-'+id).val();
		
		var animal_ids_count = $('.small-only').length;	
		

		if(animal_id != '0')
		{
		//inserted_animal_detail[]
			inserted_animal_detail.splice( $.inArray(animal_id, inserted_animal_detail), 1 );
		}	 	
		$('#animal-id-'+id).val('0');
		$('#quick-animal-name-'+id).val('');
		$('#quick-type-'+id).val('');
		$('#quick-type-'+id).val('');
		$('#quick-breed-'+id).val('');
		$('#quick-weight-'+id).val('');
		/*var quick_gender =  $('input[name="quick-gender-'+id+'"]:checked').val();
		alert(quick_gender);*/
		$('input:radio[name="quick-gender-'+id+'"]').prop("checked",false);
		$('input:radio[name="quick-gender-'+id+'"]').parent('span').removeClass('checked');
	
		$('input:checkbox[name="quick-cvi-'+id+'"]').prop("checked",false);
		$('input:checkbox[name="quick-cvi-'+id+'"]').parent('span').removeClass("checked");
	
		$('input:checkbox[name="quick-travel-'+id+'[]"]').prop("checked",false);
		$('input:checkbox[name="quick-travel-'+id+'[]"]').parent('span').removeClass("checked");
		$('#animal-photo-attach-'+id).html(' ');
		$('#rotate_angle1-'+id).val('');
		$('#crop_x1-'+id).val('');
		$('#crop_y1-'+id).val('');
		$('#crop_w1-'+id).val('');
		$('#crop_h1-'+id).val('');
		$('#profile_pic1-'+id).val('');
		$('#uploaded_photo1-'+id).val('');
		$('#existing_photo1-'+id).val('0');
		$('#rotate_angle2-'+id).val('');
		$('#crop_x2-'+id).val('');
		$('#crop_y2-'+id).val('');
		$('#crop_w2-'+id).val('');
		$('#crop_h2-'+id).val('');
		$('#profile_pic2-'+id).val('');
		$('#uploaded_photo2-'+id).val('');
		$('#existing_photo2-'+id).val('0');
		$('#rotate_angle3-'+id).val('');
		$('#crop_x3-'+id).val('');
		$('#crop_y3-'+id).val('');
		$('#crop_w3-'+id).val('');
		$('#crop_h3-'+id).val('');
		$('#profile_pic3-'+id).val('');
		$('#uploaded_photo3-'+id).val('');
		$('#existing_photo3-'+id).val('0');
		$('#rotate_angle4-'+id).val('');
		$('#crop_x4-'+id).val('');
		$('#crop_y4-'+id).val('');
		$('#crop_w4-'+id).val('');
		$('#crop_h4-'+id).val('');
		$('#profile_pic4-'+id).val('');
		$('#uploaded_photo4-'+id).val('');
		$('#existing_photo4-'+id).val('0');
		$('#count_image-'+id).val('0');			
		
		if(id!=0 && animal_ids_count > 1)
		{
			if($(window ).width() <= 767)
			{    
				//$('.small-only tbody .row-'+id).remove();
				$('#tbl_'+id).remove();
				
			}else {		
			$('#card-table tbody #row-'+id).remove();
			}
		} else {
			$('#quick-breed-'+id).empty('');
			$('#quick-breed-'+id).html('<option value="">Select</option>');
		}
	}else {
		return false;
	}		
}

function get_zip_code(zipcode,textfield)
{
	 $.ajax(
        {
            url: base_url+"org_transportation/get_zip_code2/" ,
            dataType: "json",
            data:
            {
                term:zipcode,
            },
            success: function (data)
            {
				console.log(data[0].label)
				if(data=="1")
				{
					//window.location.href=base_url;
				}
				else
				{
					$(textfield).val(data[0].label);
                	//response(data);
				}
            }
        });
}