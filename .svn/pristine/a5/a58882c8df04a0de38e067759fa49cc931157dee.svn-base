<?php $base_url = $this->config->item('base_url'); ?>
<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en" class="no-js">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
<meta charset="utf-8"/>
<title>Find space on volunteer drives & flights (My Trips) - Doobert.com</title>
<?PHP //include "includes/head-links-inside.php"?>
<?php include 'inc/header-css-js.php';?>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="<?php echo base_url(); ?>assets/plugins/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
<!--<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD7Dabm2M9XvDVk27xCZomEZ1uJFcJHG4k&sensor=false&v=3&libraries=geometry"></script>-->
  <!--<script src="https://maps.googleapis.com/maps/api/js"></script>-->
  <script type="text/javascript" src="https://maps.google.com/maps/api/js?key=<?php echo $this->config->item('googleapi_key'); ?>&sensor=false&libraries=geometry&language=en"></script>
  
<script type="text/javascript">
  
</script>
<script type="text/javascript">
  
    //<![CDATA[
		
	var map;
	var flightPaths = [];
	var roadPaths   = [];
	var allMarkers  = [];
	var allMarkers2  = [];
	var infomarkers = [];
	var allinfowindow = [];
	var nextPostAge = '';
	var renderArray = [];
	//var tr_status = '';
	var directionsDisplay;
	var directionsService = new google.maps.DirectionsService();
	var map;
	var pathInfoWindow = new google.maps.InfoWindow();
	
	function initialize() {
		var mapOptions = {
			zoom: 5,
			center: new google.maps.LatLng(39.5, -98.35),
			zoomControlOptions: {
                      //style: google.maps.ZoomControlStyle.SMALL,
				//position: google.maps.ControlPosition.RIGHT_BOTTOM
				position: google.maps.ControlPosition.LEFT_TOP
			},
			panControlOptions: {
				//position: google.maps.ControlPosition.RIGHT_BOTTOM
				position: google.maps.ControlPosition.LEFT_TOP
			},
			mapTypeControlOptions: {
				position: google.maps.ControlPosition.BOTTOM_CENTER
			},
			scrollwheel: false,
			//mapTypeId: google.maps.MapTypeId.ROADMAP
		  };
		map = new google.maps.Map(document.getElementById('gMap'),mapOptions);
		 
		 updateTrips();
		 
		 	
	}

	function updateTrips(){ 

	removeFlightPaths();

	nextPostAge = $("#nextPostAge").val();
	
	var tr_type = document.querySelector('input[name = "tr_type"]:checked').value;
	
	 var radius  = $('#radius').val();
	 var zipcode = $('#zipcode').val(); 
	 
	 if(zipcode!='' || zipcode!=undefined)
	 {	
			var str	= zipcode; 
			str = str.toUpperCase();  	
			zipcode = str.replace(/\s/g, '');
	 }
	 
	var xml ='';
	var trips='';
	//var searchURL = "<?php echo base_url(); ?>trip/create_xml?days="+nextPostAge+"&tr_type1="+tr_type1+"&tr_type2="+tr_type2;	
	var searchURL = "<?php echo base_url(); ?>trip/create_xml?days="+nextPostAge+"&tr_type="+tr_type+"&radius="+radius+"&zipcode="+zipcode;	
	
	
	//alert('searchURL'+searchURL);
	downloadUrl(searchURL, function(data) { //alert(data.responseXML);  return false;
	 xml = data.responseXML;
		
	
	if(xml.documentElement.getElementsByTagName("trip"))
	{
	trips = xml.documentElement.getElementsByTagName("trip");	
				
	var markers = [];//some array
	var request = [];
	var j = 0;
	var bounds = new google.maps.LatLngBounds();
	var popUps = [];
    var infoWindows = [];
    var positions = [];
	var addListeners =[];
	var flightplanes =[];
	$('#content-1').empty();
		
	var temparray = []; 		
		for (var i = 0; i < trips.length; i++){
			temparray.push(trips[i]);
			var tripID = trips[i].getAttribute("tripId");			
			//alert(tripID);
			var sendLat = trips[i].getAttribute("sendLat");
			var sendLon = trips[i].getAttribute("sendLon");
			var recLat = trips[i].getAttribute("recLat");
			var recLon = trips[i].getAttribute("recLon");
			var sendZip = trips[i].getAttribute("sendZip");
			var recZip = trips[i].getAttribute("recZip");
			var sendCity = trips[i].getAttribute("sendCity");
			var recCity = trips[i].getAttribute("recCity");
			var driver = trips[i].getAttribute("driver");
			var tripDate = trips[i].getAttribute("dttrip");
			var crates = trips[i].getAttribute("crates");
			var tethered = trips[i].getAttribute("tethered");
			var paid = trips[i].getAttribute("paid");
			var trip_type = trips[i].getAttribute("in_type");
			var userUrl = trips[i].getAttribute("userUrl");
			var verifiedImg = trips[i].getAttribute("verifiedImg");
			var filled   =trips[i].getAttribute("filled");
			var transport_type = trips[i].getAttribute("transportType");
			var f  = trips[i].getAttribute("f");
			var ph = trips[i].getAttribute("ph");
			var p  = trips[i].getAttribute("p");
			var d  = trips[i].getAttribute("d");
			var u  = trips[i].getAttribute("u");
			var v  = trips[i].getAttribute("v");
			var tid = trips[i].getAttribute("tid");
			var email = trips[i].getAttribute("email");			
			
			//console.log(temparray);
			
			var strHTML = "<div id='map-view'><div class='subscribe-pop' style='width:235px !important;'><div class='search-user-trips-box'><div class='bottom-part'><p class='driver-trip-id'><span class='trip-id'>Trip ID - "+tripID+"</span><br>Driver: <span class='trip-driver-name'><a href='"+userUrl+"' target='_blank'>"+driver+"</a></span><img src='"+verifiedImg+"' alt='' title='' /></p><p><span>From: </span> "+sendCity+"</p><p><span>To: </span>"+recCity+"</p><p><span>Trip Date: </span>"+tripDate+"</p><p><span># of Crates: </span> "+crates+"</p><p><span># of Tethered Animals: </span>"+tethered+"</p><p><span>Paid Transport?: </span> "+paid+"</p> <p><span>Transport Type: </span> "+transport_type+"</p> <p><span> Filled ?: </span> "+filled+"</p> </div></div></div></div>";
			
			
			var userInfo = "<li><span class='verified-user'><img src='"+verifiedImg+"'alt='' title=''/></span><a href='javascript:void(0)' onclick='get_user_trip("+tid+")'><span class='user-name'>"+driver+" </span></a><span>Trip ID: "+tripID+"</span><span class='user-from'>From: "+sendCity+"</span><span class='user-to'>To: "+recCity+"</span><span class='user-bottom-part'>";
			if(f && f!='')
			{
				userInfo +="<img src="+f+"  alt='Foster Home' title='Foster Home'/>";
			}
			if(ph && ph!='')
			{
				userInfo +="<img src="+ph+"  alt='Photographer' title='Photographer'/>";
			}
			if(p && p!='')
			{
				userInfo +="<img src="+p+"  alt='Pilot Profile' title='Pilot Profile'/>";
			}
			if(d && d!='')
			{
				userInfo +="<img src="+d+"  alt='Driver' title='Driver'/>";
			}
			if(u && u!='')
			{
				userInfo +="<img src="+u+"  alt='User' title='User'/>";
			}
			if(v && v!='')
			{
				userInfo +="<img src="+v+"  alt='Volunteer' title='Volunteer' class='marr8'/>";
			}
			
			userInfo +='<a href="#search-user-contact" data-toggle="modal" class="btn btn-primary" onClick="contactUser(\''+ email+'/'+driver+'\')" >CONTACT ME</a></span></li>';
			
			$('#content-1').append(userInfo); 
			// for marker shift
			
			//var temp1 = JSON.parse(data.latlong[j]);
																	
			var currentMarkerLat = (sendLat);
			var currentMarkerLon = (sendLon);
			var reccurrentMarkerLat = (recLat);
   			var reccurrentmarkerLon = (recLon);
		
			var flag=0;
			//alert(data.name[j]);
			for(var j=0; j<temparray.length;j++)
			{
				//console.log(temparray[j].getAttribute("driver"));
				if(sendLat == temparray[j].getAttribute("sendLat") || sendLon == temparray[j].getAttribute("sendLon") || sendLat ==temparray[j].getAttribute("recLat") || sendLon == temparray[j].getAttribute("recLon"))
				{
				//alert("in the matching send Lat");
				if(i>0)
				{
				var existingMarkerLat = parseFloat(temparray[j].getAttribute("sendLat"));
				var existingMarkerLon = parseFloat(temparray[j].getAttribute("sendLon"));
						
				var cur_new_distance = distance(existingMarkerLat, existingMarkerLon, currentMarkerLat, currentMarkerLon,'K');
				//if a marker already exists in the same position as this marker
				if (cur_new_distance == 0 ) {
					var math1 = (Math.random() -.5)/100;
				
				//var currentMarkerLat = parseFloat(currentMarkerLat) + (Math.random() -.5) / 10;// * (Math.random() * (max - min) + min);
				//var currentMarkerLon = parseFloat(currentMarkerLon) + ((Math.random() -.5) / 10);// * (Math.random() * (max - min) + min);
				var currentMarkerLat = parseFloat(currentMarkerLat) - 0.0010;// * (Math.random() * (max - min) + min);
				var currentMarkerLon = parseFloat(currentMarkerLon) - 0.0010;// * (Math.random() * (max - min) + min);
				
					flag = flag+1;
				}
				} // if i>0
				} // if main condition 
				
				
				if(recLat == temparray[j].getAttribute("recLat") || recLon == temparray[j].getAttribute("recLon") || recLat== temparray[j].getAttribute("sendLat") || recLon == temparray[j].getAttribute("sendLon"))
				{
			
				if(i>0)
				{
				var recexistingMarkerLat = parseFloat(temparray[j].getAttribute("recLat"));
				var recexistingMarkerLon = parseFloat(temparray[j].getAttribute("recLon"));
				
				//if a marker already exists in the same position as this marker
				var cur_new_distance2 = distance(recexistingMarkerLat, recexistingMarkerLon, reccurrentMarkerLat, reccurrentmarkerLon,'K');
				//alert(cur_new_distance2);
				if(cur_new_distance2 == 0 )
				{
				
					var math2 = (Math.random() -.5)/100;
					
					//var reccurrentMarkerLat = parseFloat(reccurrentMarkerLat) + (Math.random() -.5) / 10;// * (Math.random() * (max - min) + min);
					//var reccurrentmarkerLon = parseFloat(reccurrentmarkerLon) + (Math.random() -.5) / 10;// * (Math.random() * (max - min) + min);
					
					var reccurrentMarkerLat = parseFloat(reccurrentMarkerLat) + 0.001; //*(Math.random()*(max - min) + min);
					var reccurrentmarkerLon = parseFloat(reccurrentmarkerLon) + 0.001;				
					
				}
				flag = flag+1;
				} // if i 
				} // if condition
				
				/*if(flag>0)
				{
					alert(flag);
					break;
				}*/
				
			} // for j
			//console.log(temparray);
			var flightPlanCoordinates = [
				new google.maps.LatLng(currentMarkerLat, currentMarkerLon),
				new google.maps.LatLng(reccurrentMarkerLat, reccurrentmarkerLon),
				];
			//console.log(flightPlanCoordinates);
		//	alert(flightPlanCoordinates);
			//alert(userInfo);			
			//if(trip_type == '2') //for airline 
			if(1)
			{
				directionColor = '#ee6d35';
				
				var flightPath = new google.maps.Polyline({
				path: flightPlanCoordinates,
				strokeColor: directionColor,
				strokeOpacity: 1.0,
				strokeWeight: 6,
				html: strHTML,
				});
				
				flightPaths.push(flightPath);
				
				google.maps.event.addListener(flightPath, 'click', function(event){
					for (var i = 0; i < infomarkers.length; i++){
					infomarkers[i].setMap(null);
					}
			// get the click's latlng and use that as anchor for infoWindow
			// found here: http://stackoverflow.com/questions/9998003/calling-infowindow-w-google-map-v3-api	
				var marker = new google.maps.Marker({
				position: event.latLng,
				map: map,
				icon: ''
				}); 
				console.log('marker position 1:'+marker.position);

			// set the info popup content as the html from polyline above
				pathInfoWindow.setContent(this.html);
				pathInfoWindow.open(map, marker);
				currentMark = marker;
				infomarkers.push(currentMark);
				allinfowindow.push(pathInfoWindow);
			
				
				google.maps.event.addListener(map, 'click', function(event){
					currentMark.setMap(null); 
					pathInfoWindow.close(map, marker);
					 for (var i = 0; i < infomarkers.length; i++){
					infomarkers[i].setMap(null);
					}
				});
				
				google.maps.event.addListener(pathInfoWindow,'closeclick',function(){
				   currentMark.setMap(null); //removes the marker
				   pathInfoWindow.close(map, marker);
				   // then, remove the infowindows name from the array
				});

				});
				
				flightPath.setMap(map);
				
				var marker1 = new google.maps.Marker({
								position: new google.maps.LatLng(currentMarkerLat, currentMarkerLon),
								icon: "http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=A|ed1f24|FFFFFF",
								map: map
							});
				allMarkers.push(marker1);
				bounds.extend(marker1.getPosition());
											
				var marker2 = new google.maps.Marker({
								position: new google.maps.LatLng(reccurrentMarkerLat, reccurrentmarkerLon),
								icon: "http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=B|275baa|FFFFFF",
								map: map
							});			
				allMarkers.push(marker2);
				bounds.extend(marker2.getPosition());
				
				
				bounds.extend(marker2.getPosition());
			} 
			else
			{
				var org =  new google.maps.LatLng(currentMarkerLat, currentMarkerLon);
				var des =  new google.maps.LatLng(reccurrentMarkerLat, reccurrentmarkerLon);
				//console.log(org);
				//console.log(des);
				var req = {
					origin: org,
					destination : des,
					optimizeWaypoints: true,
					travelMode: google.maps.DirectionsTravelMode.DRIVING,
				};
							
				directionsService.route(req, directionResults); 
				
								
			var marker3 = new google.maps.Marker({
								position: new google.maps.LatLng(recLat, recLon),
								icon: "http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=A|ed1f24|FFFFFF",
								//map: map
							});
							
			var marker4 = new google.maps.Marker({
								position: new google.maps.LatLng(sendLat, sendLon),
								icon: "http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=A|ed1f24|FFFFFF",
								//map: map
							});
			allMarkers.push(marker3);
			allMarkers.push(marker4);
			bounds.extend(marker3.getPosition());
			bounds.extend(marker4.getPosition());		
			
		  }
			//bounds.extend(marker.getPosition());	
		
			
		} // for loop
						
		  }//if(trip)		
		}); //downloadUrl
		// bounds.extend(marker.getPosition());
		
		google.maps.event.addListener(map, 'zoom_changed', function(){
			
			zoomLevel = map.getZoom();
			
		});
	
	}	//updateTrips
	
	
				
	
    	function directionResults(result, status){
		var cur = 0;
		var markerA = new google.maps.MarkerImage('http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=A|ed1f24|FFFFFF',
										new google.maps.Size(24, 27),
										new google.maps.Point(0, 0),
										new google.maps.Point(12, 27));
				var markerB = new google.maps.MarkerImage('http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=B|275baa|FFFFFF',
								new google.maps.Size(24, 28),
								new google.maps.Point(0, 0),
								new google.maps.Point(12, 28))
		
       // console.log("flight plan coordinate  :"+flightPlanCoordinates[i]);
        if (status == google.maps.DirectionsStatus.OK){
           // renderArray[cur] = new google.maps.DirectionsRenderer({
				render = new google.maps.DirectionsRenderer({
				polylineOptions:{
     			 strokeColor: "#840ab2"
				},
				suppressMarkers: true
				//preserveViewport:true				
			  //directionsDisplay.setDirections(response);
			});
			
			var _route = result.routes[0].legs[0]; 
			pinA = new google.maps.Marker({
				position: _route.start_location,
				map: map,
				icon: markerA
			}),
			allMarkers.push(pinA);	
			pinB = new google.maps.Marker({
				position: _route.end_location,
				map: map,
				icon: markerB
			});
			allMarkers.push(pinB);	
			
			//renderArray[cur].setMap(map);
			render.setMap(map);
			render.setDirections(result);
			renderArray.push(render);
			
           	 var step = 1;
     		 var infowindow2 = new google.maps.InfoWindow();
			
			cur++
		}
    }
			
	function distance(lat1, lon1, lat2, lon2, unit) {
	var radlat1 = Math.PI * lat1/180
	var radlat2 = Math.PI * lat2/180
	var radlon1 = Math.PI * lon1/180
	var radlon2 = Math.PI * lon2/180
	var theta = lon1-lon2
	var radtheta = Math.PI * theta/180
	var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
	dist = Math.acos(dist)
	dist = dist * 180/Math.PI
	dist = dist * 60 * 1.1515
	if (unit=="K") { dist = dist * 1.609344 }
	if (unit=="N") { dist = dist * 0.8684 }
	//return dist
	return Math.round(dist)
} 
	
	function downloadUrl(url, callback) {
		var request = window.ActiveXObject ?
		new ActiveXObject('Microsoft.XMLHTTP') :
		new XMLHttpRequest;

		request.onreadystatechange = function() {
		if (request.readyState == 4) {
			request.onreadystatechange = doNothing;
			callback(request, request.status);
			}
		}

		request.open('GET', url, true);
		request.send(null);
	}

// got this from http://stackoverflow.com/questions/9058911/cant-remove-mvcarray-polylines-using-google-maps-api-v3
function removeFlightPaths() {
           for (var i=0; i < flightPaths.length; i++){
                flightPaths[i].setMap(null);
            }
			// setMapOnAll(null);
			for (var i = 0; i < allMarkers.length; i++){
			allMarkers[i].setMap(null);
			}
			//pathInfoWindow.close(map, marker);
			for (var i = 0; i < infomarkers.length; i++){
				infomarkers[i].setMap(null);
			}
			for(var i=0 ; i< allinfowindow.length;i++)
			{
			//pathInfoWindow.close(map, allinfowindow[i]);
			 allinfowindow[i].close();
			}
			
			for(var i=0; i<renderArray.length;i++)
			{
					renderArray[i].setMap(null);
			}
			// you probably then want to empty out your array as well
            flightPaths = [];
			allMarkers=[];
			//infomarkers=[]
			allinfowindow=[];
       }

	function doNothing() {}
	
	google.maps.event.addDomListener(window, 'load', initialize);
	
	
	function calculateAndDisplayRoute(directionsService, directionsDisplay, pointA, pointB){
  	directionsService.route({
    origin: pointA,
    destination: pointB,
    travelMode: google.maps.TravelMode.DRIVING
  }, function(response, status) {
    if (status == google.maps.DirectionsStatus.OK){
      directionsDisplay.setDirections(response);
    } else {
      window.alert('Directions request failed due to ' + status);
    }
  });
}
    //]]>
  </script>
  <?php /*?><script src="<?php echo base_url(); ?>map/application.js?version=15122015"></script><?php */?>   
</head>
<!-- BEGIN BODY -->
<body class="page-header-fixed">
<div id="loader" style="display: none;"><img src="<?php echo base_url(); ?>assets/img/ajax-modal-loading.gif" width="32" height="32" align="absmiddle">&nbsp;<span id="loadertext">Loading...</span></div>
<!--Menu Active Link-->
<?php $tab = 3; $subtab=3.5; $display_menu=2; ?>
<?php 
	$breeds = array(); 
	
?>
<!-- BEGIN HEADER -->
<?php include 'inc/header-myaccount.php';?>
<?PHP //include "includes/head-content-inside.php"; ?>
<!-- END HEADER -->
<section class="breadcrumb inner-breadcrumb">
	<div class="container">
		<div class="text-left">
			<a href="<?php echo base_url(); ?>dashboard/">My Dashboard</a> <i class="fa fa-angle-right"></i>
			Find space on volunteer drives & flights (My Trips)
		</div>
	</div>
</section>
<?php /*
<div class="clearfix"> </div>
<!-- BEGIN CONTAINER -->
<div class="page-container">
  <div class="row no-margin">
    <div class="top-searchbar"> 
    </div>
  </div>
  <div class="clearfix"></div>
  <div class="row page-title-bg no-margin">
    <div class="pull-left inner-bg"> 
      <!-- BEGIN PAGE TITLE & BREADCRUMB-->
      <div class="col-lg-7 col-md-7 myaccount no-space">
        <h3 class="page-title">Find space on volunteer drives & flights (My Trips) &nbsp;&nbsp;&nbsp;	Org # <?php echo $this->session->userdata('org_id'); ?> - <?php echo $this->session->userdata('org_name'); ?></h3>
      </div>
      <div class="app-breadcrumb col-lg-5 col-md-5 no-space">
        <ul class="breadcrumb">
          <li> <a href="<?php echo base_url(); ?>dashboard/">My Account</a> <i class="fa fa-angle-right"></i> </li>
          <li>Find space on volunteer drives & flights (My Trips)</li>
        </ul>
      </div>
      <!-- END PAGE TITLE & BREADCRUMB --> 
    </div>
  </div>
  <div class="clearfix"> </div>
  <!-- BEGIN HORIZONTAL MENU PAGE SIDEBAR -->
  <div class="page-sidebar-wrapper">
 </div>
 */ ?>
  <!-- END BEGIN HORIZONTAL MENU PAGE SIDEBAR --> 
  <!-- BEGIN CONTENT -->
  <!-- BEGIN CONTAINER -->
<section class="main-content-wrapper inner-wrapper">
        <div class="container">
         	<div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
	                <article>
						<div class="entry-content">
							<div class="sub-content main-container clearfix">
								<div class="col-md-12 col-sm-12 col-xs-12 no-space">
									<!-- Main content start -->
									<!------------------------ Add content here ---------------------->
									<div class="page-content usertrips"><h1 class="pull-left">Find space on volunteer drives &amp; flights (My Trips)</h1><div class="clearfix"></div>
			  <!-- BEING PAGE CONTENT-->
			  <?php if(isset($success_msg)){ ?>
			  <div class="col-lg-12 no-space">
					<div class="margin-bottom-15 info-streep"><?php echo $success_msg;?></div>
			  </div>
			  <?php } ?>
			   <div class="row dobt-form no-margin search-user-trip">
					<div class="gr-wrap col-lg-12 col-md-12 col-sm-12 partner-org-section">
					<form id="rescue_map_frm" method="post">
						<div class="title-patch">
						<div class="gr-wrap col-lg-6 col-md-6 col-sm-6 no-space "> <!--trips-upcoming-->
						
						<div class="form-group">
							<label class="control-label fl past-trips-l" for="past-upcoming-trips">Upcoming Trips: </label>
							<div class="select-style"><select id="nextPostAge" name="nextPostAge" class="form-control past-trips-dd">
								<option value="3"<?php if($this->input->post('nextPostAge') == 3)echo 'selected'; ?>>In the next 3 days</option>
								<option value="5" <?php if($this->input->post('nextPostAge') == 5)echo 'selected'; ?>>In the next 5 days</option>
								<option value="7" <?php if($this->input->post('nextPostAge') == 7)echo 'selected'; ?>>In the next 7 days</option>
								<option value="14" <?php if($this->input->post('nextPostAge') == 14)echo 'selected'; ?>>In the next 14 days</option>
								<option value="30" <?php if($this->input->post('nextPostAge') == 30)echo 'selected'; ?>>In the next 30 days</option>
								<option value="365" <?php if($this->input->post('nextPostAge') == 365)echo 'selected'; ?>>next 12 months</option>
								</select></div>
							
							<input type="text" name="zipcode" id="zipcode" class="form-control past-trips-dd" placeholder="Zip" value="<?php if($this->input->post('zipcode')){ echo $this->input->post('zipcode'); }else if($this->session->userdata('zip')){echo $this->session->userdata('zip');} ?>">
							<input type="text" name="radius" id="radius" class="form-control past-trips-dd" placeholder="Miles" value="<?php if($this->input->post('radius')){ echo $this->input->post('radius');} else {echo 100;} ?>" >
							
							</div> 
							<!--
							<div class="form-group">
							<input type="text" name="zipcode" id="zipcode" class="form-control past-trips-dd">
							</div>	
							
							<div class="form-group">
							<input type="text" name="radius" id="radius" class="form-control past-trips-dd" >
							</div> -->	
							<div class="clear"></div>
							</div>
							
						   <!-- <div class="gr-wrap col-lg-6 col-md-6 col-sm-6 no-space"> <?php //echo 'type1: '.$this->input->post('tr_type1'); echo 'type2: '.$this->input->post('tr_type2'); ?>
							 <label class="transport-chk"><input type="checkbox" name="tr_type1" id="tr_type1" value="1" <?php if(($this->input->post('tr_type1')) && $this->input->post('tr_type1') == '1') { echo 'checked'; } else if(!$_POST) { echo 'checked'; }?> >Road Transports</label>
							 <label class="transport-chk"><input type="checkbox" name="tr_type2" id="tr_type2" value="2" <?php if(($this->input->post('tr_type2')) && $this->input->post('tr_type2') == '2') { echo 'checked'; } else if(!$_POST) { echo 'checked'; }?>>Air Transports</label>
						  <input type="submit" name="go" id="go" value="Go" title="Go" class="btn parro-tgreen marr5"/>
						  <input type="hidden" name="frm_action" value="frm_value">
						  </div>
								<div class="clear"></div>
						 </div>-->
						 
							<div class="gr-wrap col-lg-5 col-md-6 col-sm-6 no-space trips-transport"> <?php //echo 'type1: '.$this->input->post('tr_type1'); echo 'type2: '.$this->input->post('tr_type2'); ?><div class="radio-btn radiogroup_with_lbl org-search-result">
							<input type="radio" name="tr_type" id="tr_type1" value="1" <?php if(($this->input->post('tr_type')) && $this->input->post('tr_type') == '1') { echo 'checked'; } else if(!$_POST) { echo 'checked'; }?> > <label class="transport-chk" for="tr_type1">Road Transports</label>
							 <input type="radio" name="tr_type" id="tr_type2" value="2" <?php if(($this->input->post('tr_type')) && $this->input->post('tr_type') == '2') { echo 'checked'; } ?> ><label class="transport-chk marr0" for="tr_type2">Air Transports</label>
						  <input type="submit" name="go" id="go" value="Go" title="Go" class="btn orange waves-effect waves-light martm1"/>
						  <input type="hidden" name="frm_action" value="frm_value">
						  </div></div>
						  <div class="gr-wrap col-lg-1 no-space search-users">
						  <a href="javascript:void(0)" class="whitebtn" onClick="openNav()" title="Users"><i class="material-icons">chevron_left</i>Users</a>
						  </div>
								<div class="clear"></div>
						 </div>
							
						 </form>
						 <div id="gMap" style="width: 100%; height: 850px;"></div>
						 <!--<div id="gMap" style="width: 100%; height: 850px;"></div> -->
						</div>
						</div>
			  </div>
									<!-- Main content end --> 
					  			</div>
					  		</div>
						</div><!-- .entry-content -->
					</article><!-- #post-## -->
                </div>
            </div>
        </div>
</section>
<!-- END CONTAINER --> 
<?PHP //include "includes/footer.php" ?>
<?php include 'inc/footer-dashboard.php';?>
<div id="mySidenav" class="sidenav">
  <a href="javascript:void(0)" class="closebtn" onClick="closeNav()">Close <i class="fa fa-angle-double-right"></i></a>
  <div class="search-user">
  <input placeholder="Search User" type="text" name="search_name" id="search_name">
  <a href="javascript:void(0)" onClick="searchusers()"><span class="fa fa-search"></span></a>
</div>
  <ul class="content-1 mCustomScrollbar" id="content-1">
  </ul>			
</div>

<div id="responsive">
                <div class="modal fade" id="search-user-contact" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
                    <div class="modal-dialog">
                        <form class="horizontal-form" role="form" id="send-request" name="send_request" action="" method="post">
                            <input type="hidden" id="contact_name" name="contact_name" value="">
                            <input type="hidden" id="contact_email" name="contact_email" value="">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button aria-hidden="true" data-dismiss="modal" class="close empty_dates" type="button" title="Close"></button>
                                    <h4 class="modal-title">Contact Request</h4>
                                </div>							
                                <div class="modal-body">
                                    <div class="form-group">
                                        <div class="col-md-12 no-space">
                                            <textarea id="contactmessage" name="contactmessage" rows="3" class="form-control" maxlenght="500" Placeholder="Enter Your Message" ></textarea>
                                        </div>
										<div class="clearfix"></div>
                                        <div class="col-md-12 btm-button no-space text-center">
                                            <a href="javascript:void(0);" class="btn orange mart20" id="send_request_btn" title="Send">Send</a>
                                           <!-- <input type="submit" class="btn orange mart20 fr wht"  id="send_request_btn" value="Send">-->
                                        </div>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>

                            </div>
                        </form>
                        <!-- /.modal-content --> 
                    </div>
                    <!-- /.modal-dialog --> 
                </div>			
            </div>
			<!-- BEGIN THANK YOU MODAL POPUP-->
            <div class="modal fade" id="thankyou-config" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header"> 
                            <button aria-hidden="true" data-dismiss="modal" class="close" type="button"></button>
                            <h4 class="modal-title">THANK YOU</h4>
                        </div>
                        <div class="modal-body"><h5>Your contact request was sent successfully.</h5></div>
                        <div class="modal-footer text-center no-margin"><a class="btn blue" data-dismiss="modal" title="Close">Close</a> </div>
                    </div>
                    <!-- /.modal-content --> 
                </div>
                <!-- /.modal-dialog --> 
            </div>
            <!-- END THANK YOU MODAL POPUP-->
			
<script src="<?php echo base_url(); ?>assets/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script> 
<script src="<?php echo base_url(); ?>assets/plugins/bootstrap/js/bootstrap2-typeahead.min.js" type="text/javascript"></script> 
<script src="<?php echo base_url(); ?>assets/plugins/bootstrap-hover-dropdown/bootstrap-hover-dropdown.min.js" type="text/javascript"></script> 
<script src="<?php echo base_url(); ?>assets/plugins/jquery-slimscroll/jquery.slimscroll.min.js" type="text/javascript"></script> 
<script src="<?php echo base_url(); ?>assets/plugins/jquery.blockui.min.js" type="text/javascript"></script> 
<script src="<?php echo base_url(); ?>assets/plugins/jquery.cokie.min.js" type="text/javascript"></script> 
<script src="<?php echo base_url(); ?>assets/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
<script src="<?php echo base_url(); ?>assets/jquery.mCustomScrollbar.concat.min.js" type="text/javascript"></script>  

<script>
        jQuery(document).ready(function() {       
           // initiate layout and plugins
           
		   $('#go').click(function(){
		    var val = $('#zipcode').val();
			updateTrips();
			/*if(isNaN(val))
			{
				alert('Plesae enter valid zipcode'); 
				$('#zipcode').val('');
				return false;
			}else {
				updateTrips();
			}*/
					
		  });
		 
        });
			 	
	function contactUser(id){
					//alert(id);
					var arr_val = id.split('/');
                    emailid = arr_val[0];
                    name = arr_val[1];
					$('#contact_name').val(name);
                    $('#contact_email').val(emailid);
                    $('.modal-title').html('<h4>Contact Request to ' + name + '</h4>');
				}
				
	  $('#send_request_btn').click(function(){
					var mess='';
					mess = $('#contactmessage').val(); 
					//alert(mess);		
                    if (mess == '')
                    {
                        alert('Please enter your message.');
						//$.modal.close();
                        return false;
                    }
                    else
                    {
					var name  = $('#contact_name').val();
                    var email = $('#contact_email').val();
					
						 $.ajax({
								type: "POST",
								url: '<?php echo base_url(); ?>trip/trip_send_mail',
								beforeSend: function(){
								$('#search-user-contact').modal('toggle');	
								//$.modal.close();
								//$('#user-contact').hide();
								//$.modal.close();
								$('#loader').show();
								},
								data: {contact_name:name , contact_email:email ,contactmessage:mess},
			 // data : { },
								dataType:'json',
			  					complete: function(){
								$('#loader').hide();
				    			  },
								  success:function(data){ 
								  //console.log(data);
									if(data.success == 1)									
										$('.modal-title').html('<h4>Thank You</h4>')	
										$('#contactmessage').val('');
										$('#thankyou-config').modal('show');
								}, 
                        //return true;
						 });
                    }
		}); //send_request_btn2			
	
	$("#search_name").keyup(function(event){
	 if(event.keyCode == 13){
		searchusers();
    }
	});
	
	function searchusers()
	{
		
		//alert('in function');
		var name = $('#search_name').val();
		//alert(name);
		var nextPostAge = $("#nextPostAge").val();
		var zipcode = $("#zipcode").val();
		var radius = $("#radius").val();
		var tr_type = document.querySelector('input[name = "tr_type"]:checked').value;
		if(zipcode!='' || zipcode!=undefined)
		{		
			var str	= zipcode; 
			str = str.toUpperCase();  	
			zipcode = str.replace(/\s/g, '');
		}
		/*if(name=='')
		{
			alert('Please enter the user name');
			return false; 
		}
		else{*/
			 $.ajax({
						type: "POST",
						url: '<?php echo base_url(); ?>trip/search_user',
						beforeSend: function(){
							$('#loader').show();
						},
						data: {username:name , nextPostAge:nextPostAge ,zipcode:zipcode, radius:radius , tr_type:tr_type},
			 // data : { },
						dataType:'json',
			  			complete: function(){
						$('#loader').hide();
				    	},
						success:function(data){
						if(data.count >0){
						$('#content-1').empty();
						$('#search_name').empty();
						for(var i=0 ; i<data.count ; i++)
						{
							//alert(data.users[i].st_email);
							var userInfo = "<li><span class='verified-user'><img src='"+data.users[i].verified_img+"'alt='' title=''/></span><a href='javascript:void(0)' onclick='get_user_trip("+data.users[i].trip_id+")'><span class='user-name'>"+data.users[i].driver+" </span></a><span>Trip ID: TP"+data.users[i].trip_id+"</span><span class='user-from'>From: "+data.users[i].sendCity+"</span><span class='user-to'>To: "+data.users[i].recCity+"</span><span class='user-bottom-part'>";
							if(data.users[i].f && data.users[i].f!='')
							{
							userInfo +="<img src="+data.users[i].f+"  alt='Foster Home' title='Foster Home'/>";
							}
							if(data.users[i].ph && data.users[i].ph!='')
							{
							userInfo +="<img src="+data.users[i].ph+"  alt='Photographer' title='Photographer'/>";
							}
							if(data.users[i].p && data.users[i].p!='')
							{
							userInfo +="<img src="+data.users[i].p+"  alt='Pilot Profile' title='Pilot Profile'/>";
							}
							if(data.users[i].d && data.users[i].d!='')
							{
							userInfo +="<img src="+data.users[i].d+"  alt='Driver' title='Driver'/>";
							}
							if(data.users[i].u && data.users[i].u!='')
							{
							userInfo +="<img src="+data.users[i].u+"  alt='User' title='User'/>";
							}
							if(data.users[i].v && data.users[i].v!='')
							{
							userInfo +="<img src="+data.users[i].v+"  alt='Volunteer' title='Volunteer'/>";
							}
			
			userInfo +='<a href="#search-user-contact" data-toggle="modal" title="Contact Me" class="btn sky-blue-btn" onClick="contactUser(\''+ data.users[i].email+'/'+data.users[i].driver+'\')">CONTACT ME</a></span></li>';
					
			$('#content-1').append(userInfo); 
						
					  }// for close
					} // if(count);
					else{
						var msg ="No records found for your search '"+name+"'" ;
						alert(msg);
						$("#search_name").val('');
					}					
					}, 
                        //return true;
				}); // ajax
			//} //else
		
	}
	
	function get_user_trip( trip_id )
	{
		//alert(trip_id);
		/*alert(allinfowindow.length);
		for(var i=0; i<allinfowindow.length;i++)
		{
			pathInfoWindow 
		}	*/
		var nextPostAge = $("#nextPostAge").val();
		var zipcode = $("#zipcode").val();
		var radius = $("#radius").val();
		//updateTrips(trip_id);	
		if(zipcode!='' || zipcode!=undefined)
		{	
			var str	= zipcode; 
			str = str.toUpperCase();  	
			zipcode = str.replace(/\s/g, '');
		}
		var tr_type = document.querySelector('input[name = "tr_type"]:checked').value;
		
		removeFlightPaths();
		//setAllMap(null);
		var xml ='';
		var trips='';
		var searchURL = "<?php echo base_url(); ?>trip/create_xml?days="+nextPostAge+"&tr_type="+tr_type+"&radius="+radius+"&zipcode="+zipcode+"&trip_id="+trip_id;	
	
	
	downloadUrl(searchURL, function(data) { //alert(data.responseXML);  return false;
	 xml = data.responseXML;
	
	var pathInfoWindow = new google.maps.InfoWindow();

	if(xml.documentElement.getElementsByTagName("trip"))
	{
	trips = xml.documentElement.getElementsByTagName("trip");	
	
				
	var markers = [];//some array
	//var infomarkers = [];
	var request = [];
	var j = 0;
	var bounds = new google.maps.LatLngBounds();
	var popUps = [];
    var infoWindows = [];
    var positions = [];
	var addListeners =[];
	var flightplanes =[];
		for (var i = 0; i < trips.length; i++){
			
			var tripID = trips[i].getAttribute("tripId");			
			var sendLat = trips[i].getAttribute("sendLat");
			var sendLon = trips[i].getAttribute("sendLon");
			var recLat = trips[i].getAttribute("recLat");
			var recLon = trips[i].getAttribute("recLon");
			var sendZip = trips[i].getAttribute("sendZip");
			var recZip = trips[i].getAttribute("recZip");
			var sendCity = trips[i].getAttribute("sendCity");
			var recCity = trips[i].getAttribute("recCity");
			var driver = trips[i].getAttribute("driver");
			var tripDate = trips[i].getAttribute("dttrip");
			var crates = trips[i].getAttribute("crates");
			var tethered = trips[i].getAttribute("tethered");
			var paid = trips[i].getAttribute("paid");
			var trip_type = trips[i].getAttribute("in_type");
			var userUrl = trips[i].getAttribute("userUrl");
			var verifiedImg = trips[i].getAttribute("verifiedImg");
			var filled   =trips[i].getAttribute("filled");
			var transport_type = trips[i].getAttribute("transportType");
			var f  = trips[i].getAttribute("f");
			var ph = trips[i].getAttribute("ph");
			var p  = trips[i].getAttribute("p");
			var d  = trips[i].getAttribute("d");
			var u  = trips[i].getAttribute("u");
			var v  = trips[i].getAttribute("v");
			var tid = trips[i].getAttribute("tid");
			var email = trips[i].getAttribute("email");			
			var flightPlanCoordinates = [
				new google.maps.LatLng(sendLat, sendLon),
				new google.maps.LatLng(recLat, recLon),
				];
			
			var strHTML = "<div id='map-view'><div class='subscribe-pop' style='width:235px !important;'><div class='search-user-trips-box'><div class='bottom-part'><p class='driver-trip-id'><span class='trip-id'>Trip ID - "+tripID+"</span><br>Driver: <span class='trip-driver-name'><a href='"+userUrl+"' target='_blank'>"+driver+"</a></span><img src='"+verifiedImg+"' alt='' title='' /></p><p><span>From: </span> "+sendCity+"</p><p><span>To: </span>"+recCity+"</p><p><span>Trip Date: </span>"+tripDate+"</p><p><span># of Crates: </span> "+crates+"</p><p><span># of Tethered Animals: </span>"+tethered+"</p><p><span>Paid Transport? </span> "+paid+"</p> <p><span>Transport Type: </span> "+transport_type+"</p> <p><span> Filled ?: </span> "+filled+"</p> </div></div></div></div>";
			
					
			//if(trip_type == '2') //for airline 
			if(1)
			{
				directionColor = '#ee6d35';
				
				var flightPath = new google.maps.Polyline({
				path: flightPlanCoordinates,
				strokeColor: directionColor,
				strokeOpacity: 1.0,
				strokeWeight: 6,
				html: strHTML,
				});
				
				flightPaths.push(flightPath);
				
				google.maps.event.addListener(flightPath, 'click', function(event){
					for (var i = 0; i < infomarkers.length; i++){
					infomarkers[i].setMap(null);
					}				
			// get the click's latlng and use that as anchor for infoWindow
			// found here: http://stackoverflow.com/questions/9998003/calling-infowindow-w-google-map-v3-api	
				var marker = new google.maps.Marker({
				position: event.latLng,
				map: map,
				icon: ''
				}); 
				console.log('marker position 1:'+marker.position);

			// set the info popup content as the html from polyline above
				pathInfoWindow.setContent(this.html);
				pathInfoWindow.open(map, marker);
				currentMark = marker;
				infomarkers.push(currentMark);
				allinfowindow.push(pathInfoWindow);
				
				google.maps.event.addListener(map, 'click', function(event){
					currentMark.setMap(null); 
					pathInfoWindow.close(map, marker);
					for (var i = 0; i < infomarkers.length; i++){
					infomarkers[i].setMap(null);
					}
				});
				
				google.maps.event.addListener(pathInfoWindow,'closeclick',function(){
				   currentMark.setMap(null); //removes the marker
				   pathInfoWindow.close(map, marker);
				   // then, remove the infowindows name from the array
				});

				});
				
				flightPath.setMap(map);
				
				var marker1 = new google.maps.Marker({
								position: new google.maps.LatLng(sendLat, sendLon),
								icon: "http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=A|ed1f24|FFFFFF",
								map: map
							});
				allMarkers.push(marker1);
				bounds.extend(marker1.getPosition());
											
				var marker2 = new google.maps.Marker({
								position: new google.maps.LatLng(recLat, recLon),
								icon: "http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=B|275baa|FFFFFF",
								map: map
							});			
				allMarkers.push(marker2);
				bounds.extend(marker2.getPosition());
				map.fitBounds(bounds);
			} 
			else
			{
				var directionsDisplay = new google.maps.DirectionsRenderer({
				//preserveViewport:true,
				zoom:3,
				polylineOptions:{
     			 strokeColor: "#840ab2"
				}
				});
			
				//directionColor = '#840ab2';
				var org = new google.maps.LatLng(sendLat, sendLon);
				var des =  new google.maps.LatLng(recLat, recLon);
				//console.log(org);
				//console.log(des);
				var req = {
					origin: org,
					destination : des,
					optimizeWaypoints: true,
					travelMode: google.maps.DirectionsTravelMode.DRIVING,
				};
				//request.push(req);
			    //flightplanes.push(flightPlanCoordinates);
				
				directionsService.route(req, directionResults); 
				
				 directionsService.route(req, function(result, status) {
					if (status == google.maps.DirectionsStatus.OK) {
					  directionsDisplay.setDirections(result);
					}
				  });
						
			var marker3 = new google.maps.Marker({
								position: new google.maps.LatLng(recLat, recLon),
								//icon: "http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=A|ed1f24|FFFFFF",
								//map: map
							});
							
			var marker4 = new google.maps.Marker({
								position: new google.maps.LatLng(sendLat, sendLon),
								//icon: "http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=A|ed1f24|FFFFFF",
								//map: map
							});
			allMarkers.push(marker3);
			allMarkers.push(marker4);
			bounds.extend(marker3.getPosition());
			bounds.extend(marker4.getPosition());		
			
		  }
			//bounds.extend(marker.getPosition());	
		
			
		} // for loop
					
	  }//if(trip)		
	});//downloadUrl
	  closeNav();	
	} // main function 
    </script>
    <script>
function openNav() {
    document.getElementById("mySidenav").style.width = "282px";
}

function closeNav() {
    document.getElementById("mySidenav").style.width = "0";
}
</script>
<script>
		(function($){
			$(window).load(function(){
				
				$("#content-1").mCustomScrollbar({
					theme:"minimal"
				});
				
			});
		})(jQuery);
	</script>
</body>
<!-- END BODY -->
</html>