<?php $base_url = $this->config->item('base_url');

if($this->session->userdata('searchadmin')!="")
  $keyword = stripslashes($this->session->userdata('searchadmin'));
else
  $keyword = "";
?>
<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en" class="no-js">
<!--<![endif]--><head>
<meta charset="utf-8"/>
<title>Manage Reservations</title>
<?php include 'inc/header-css-js.php';?>
<!--<link rel='stylesheet' id='doobert-style-css'  href='<?php echo $base_url?>css/style.css?ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='responsive-style-css'  href='<?php echo $base_url?>css/style-responsive.css?ver=1.1' type='text/css' media='all' />-->
<!--<link rel='stylesheet' id='bootstrap-style-css'  href='<?php echo $base_url?>css/bootstrap.min.css?ver=1.0' type='text/css' media='all' />-->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.8.0/css/bootstrap-slider.min.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/plugins/jquery-ui/jquery-ui-1.10.3.custom.min.css"/>

<!-- Multiple file upload start -->
<!-- Generic page styles -->
<link rel="stylesheet" href="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/css/style.css">
<!-- CSS to style the file input field as button and adjust the Bootstrap progress bars -->
<link rel="stylesheet" href="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/css/jquery.fileupload.css">
<link rel="stylesheet" href="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/css/jquery.fileupload-ui.css">
<!-- CSS adjustments for browsers with JavaScript disabled -->
<noscript>
<link rel="stylesheet" href="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/css/jquery.fileupload-noscript.css">
</noscript>
<noscript>
<link rel="stylesheet" href="<?php echo base_url(); ?>assets/plugins/jquery-file-upload/css/jquery.fileupload-ui-noscript.css">
</noscript>
<!-- Multiple file upload end -->
<link rel="stylesheet" type="text/css" href="<?php echo base_url(); ?>assets/css/tablescroll.css" />
<style type="text/css">
#loader1{position: fixed; z-index: 10000000000000; text-align:center;width: 300px; padding: 20px 10px; vertical-align:middle; top: 50%; left:0; right: 0; background:none repeat scroll 0 0 #000000; color: #fff; font-family: 'Roboto',sans-serif; font-size: 12.5pt; -moz-border-radius: 5px; -khtml-border-radius: 5px; -webkit-border-radius: 5px; border-radius: 5px; margin: 0 auto;}
#loader1 img {margin-bottom:5px;}
@media (max-width:568px){#loader{width:200px; padding:10px 10px 8px; font-size:11.5pt;}}
</style>
</head>
<!-- BEGIN BODY -->
<body class="page-header-fixed">

<div id="loader1" style="display: none;"><img src="<?php echo base_url(); ?>assets/img/ajax-modal-loading.gif" width="32" height="32" align="absmiddle"><br><span id="loadertext">Processing your request... please wait...</span></div>

<!-- nu bhushan for uploading file loader -->
<div id="loader" style="display: none;"><img src="<?php echo base_url(); ?>assets/img/ajax-modal-loading.gif" width="32" height="32" align="absmiddle">&nbsp;<span id="loadertext">Loading...</span></div>

<!-- BEGIN HEADER -->
<?php include 'inc/header-myaccount.php';?>
<!-- END HEADER -->
<div class="clearfix"> </div>
<!-- breadcrumb start -->
<section class="breadcrumb inner-breadcrumb">
	<div class="container">
		<div class="text-left">			
			<a href="<?php echo $base_url;?>dashboard">My Dashboard</a><i class="material-icons">chevron_right</i><a href="<?php echo base_url(); ?>org-dashboard">Org Dashboard</a><i class="material-icons">chevron_right</i>Manage Reservations</div>
	</div>
</section>
	
	<section class="main-content-wrapper inner-wrapper" >
	
		<div class="container" id="edit_organization">
					<div class="topnav" id="myTopnav">
						<a href="<?php echo base_url() ?>space-reservation" class="active">Public </a>
					    <a href="<?php echo base_url() ?>transport_summary/route_reservation">Private</a>
						<a href="javascript:void(0);" class="icon" onclick="myFunction()"><i class="fa fa-bars"></i></a>
				    </div>
		</div>
        <div class="container" id="location-favorites">
            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
	                <article>
						<div class="entry-content">
							<div class="main-container clearfix" id="managereservations">
								<div class="col-md-9 col-sm-12 col-xs-12 no-space">
									<h1 class="pull-left marb19">Manage Reservations</h1>
									<form name="reservation_search" id="reservation_search" method="post" action="" style="width:auto";>
										<div class="w235">
	                            				<input type="text" class="form-control" id="search_text" name="search_text" placeholder="Search Transport Id" value="<?php echo htmlentities($keyword);?>">
	                            		</div>
	                            			<button  type="submit" id="search_submit" name="search_submit" class="btn primary-orange">Search</button>
										<div class="br"></div>
	                            	</form><div class="br"></div>

	                            	<table id="card-table" class="table nolink">
										<thead>                                         
											<tr>												
												<th><a href="<?php echo $base_url;?>order_transport/page/in_order_id/<?php if($order=='asc'){echo 'desc';}else{echo 'asc';}?>/<?php echo $limit;?>" <?php if($this->uri->segment('3') == 'in_order_id' && $order=='asc') { ?> class="asc" <?php }elseif($this->uri->segment('3') == 'in_order_id' && $order=='desc'){ ?>class="des" <?php }else{ ?>class="sorting"<?php } ?>>Reservation Id</a></th>
												<th><a href="<?php echo $base_url;?>order_transport/page/in_trans_id/<?php if($order=='asc'){echo 'desc';}else{echo 'asc';}?>/<?php echo $limit;?>" <?php if($this->uri->segment('3') == 'in_trans_id' && $order=='asc') { ?> class="asc" <?php }elseif($this->uri->segment('3') == 'in_trans_id' && $order=='desc'){ ?>class="des" <?php }else{ ?>class="sorting"<?php } ?>>Transport Id</a></th>	
												<th><a href="<?php echo $base_url;?>order_transport/page/name/<?php if($order=='asc'){echo 'desc';}else{echo 'asc';}?>/<?php echo $limit;?>" <?php if($this->uri->segment('3') == 'name' && $order=='asc') { ?> class="asc" <?php }elseif($this->uri->segment('3') == 'name' && $order=='desc'){ ?>class="des" <?php }else{ ?>class="sorting"<?php } ?>>Reserved by</a></th>
												<th><a href="<?php echo $base_url;?>order_transport/page/order_date/<?php if($order=='asc'){echo 'desc';}else{echo 'asc';}?>/<?php echo $limit;?>" <?php if($this->uri->segment('3') == 'order_date' && $order=='asc') { ?> class="asc" <?php }elseif($this->uri->segment('3') == 'order_date' && $order=='desc'){ ?>class="des" <?php }else{ ?>class="sorting"<?php } ?>>Reservation Date</a></th>
												<th><a href="<?php echo $base_url;?>order_transport/page/total_cost/<?php if($order=='asc'){echo 'desc';}else{echo 'asc';}?>/<?php echo $limit;?>" <?php if($this->uri->segment('3') == 'total_cost' && $order=='asc') { ?> class="asc" <?php }elseif($this->uri->segment('3') == 'total_cost' && $order=='desc'){ ?>class="des" <?php }else{ ?>class="sorting"<?php } ?>>Total Cost</a></th>
											<!-- <?php/*	<th><a href="<?php echo $base_url;?>order_transport/page/status/<?php if($order=='asc'){echo 'desc';}else{echo 'asc';}?>/<?php echo $limit;?>" <?php if($this->uri->segment('3') == 'status' && $order=='asc') { ?> class="asc" <?php }elseif($this->uri->segment('3') == 'status' && $order=='desc'){ ?>class="des" <?php }else{ ?>class="sorting"<?php } ?>>Approval Status</a></th> */?>-->
											<th>Approval Status</th>
												<th></th>                                               
											</tr>                                              
										</thead>
										<tbody>
											<?php 
												if(isset($reservation) && count($reservation)>0){
													foreach($reservation as $key=>$value){
														$orderdate =date("M d, Y", strtotime($value['order_date']));
														$order_trans_id = $value['order_id']."_".$value['transport_id'];
														$url = $base_url."order_transport/view_reservation/".$value['order_id']."_".$value['transport_id'];
														?>
													
													<tr>
														<td><a href="JavaScript:void(0);" data-value ="<?php echo $value['order_id']."_".$value['transport_id'];?>"  onclick="space_reservation_popup(this)" ><?php echo "RS".$value['order_id'];?></a></td>
														<td><a href="<?php echo $base_url."org-transportation-scheduled/".$value['transport_id']?>"><?php echo $org_code.$value['transport_id'];?></a></td>
														<td><?php echo $value['st_first_name']." ".$value['st_last_name'];?></td>
														<td><?php echo $orderdate;?></td>
														<td class="center"><?php echo "$".$value['total'];?></td>
														<td>
															<?php if($value['order_status'] == "Partially Approved") { ?>
															<span class="approved"><?php echo $value['order_status'];?></span>
															<?php } if($value['order_status'] == "Pending Approval") { ?>
															<span class="pending"><?php echo $value['order_status'];?></span>
															<?php } if($value['order_status'] == "Fully Approved") { ?>
															<span class="approved"><?php echo $value['order_status'];?></span>
															<?php } 	if($value['order_status'] == "Fully Rejected") { ?>
															<span class="rejected"><?php echo $value['order_status'];?></span>
															<?php } if($value['order_status'] == "Partially Rejected") { ?>
															<span class="rejected"><?php echo $value['order_status'];?></span>
															<?php } if($value['order_status'] == "Awaiting Payment") { ?>
															<span class="pending"><?php echo $value['order_status'];?></span>
															<?php } if($value['order_status'] == "Waiting List") { ?>
															<span class="pending"><?php echo $value['order_status'];?></span>
															<?php }?>
														</td>
														<td><button aria-hidden="true" class="btn orange-small waves-effect waves-light addnew" type="button" id="space_reservation" name="space_reservation" aria-hidden="true" data-value ="<?php echo $value['order_id']."_".$value['transport_id'];?>" 
														onclick="space_reservation_popup(this)" > View </button></td>

													</tr>
													<?php }
												}
											else {
						                      ?><tr >
						                          <td  colspan="7" align="center" class="alert alert-danger"><strong><?php  echo $Err_Msg; ?></strong></td>
						                      </tr>
						                     <?php 
						                    }
						                    ?>
										</tbody>
									</table>
									<?php if(isset($reservation) && count($reservation)>0) { ?>             
										<div class="row">
											<div class="col-md-12 col-sm-12">
												<div class="dataTables_paginate paging_bootstrap">
												<ul class="pagination" style="visibility: visible; margin:0 !important; float:right;">
													<?php echo $pagination;?>
												</ul><div class="br"></div>
												</div><div class="br"></div>
											</div>
										</div>
								<?php } ?>							
								</div>
								<div class="col-md-3 col-sm-12 col-xs-12 no-space">
								</div>
							</div>
						</div>
					</article>

					<!-- Modal -->
					<div class="modal fade bs-modal-lg in" id="space-reservation" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				        
				            <div class="modal-dialog information w700">
				                <div class="modal-content">
				                  	<div class="modal-header">
				                        <button aria-hidden="true" data-dismiss="modal" class="close" type="button"></button>
				                        <h4 class="modal-title" id="title" name="title"><span id="space_title"></span></h4>
				                        <span id="trans_add"></span>
				                    </div>
				                        
				                    <div class="modal-body">
										<div class="greytab">
											<div class="id">Reservation ID: <span id="reservation_id"></span></div>
											<div class="by">Reserved by <span id="name"></span> on <span id="order_date"></span></div>
											<div class="br"></div>
										</div>
				                    	<div class="greytab top popup_row">
											<div class="w64">Pick  Up:</div><div class="address"><span id="pick_date"></span><br><span id="pick_add"></span></div><div class="br"></div>
											<div class="w64">Drop Off:</div><div class="address"><span id="drop_date"></span><br><span id="drop_add"></span></div><div class="br"></div>
										</div>	
										<div class="greytab top">
											<div class="w64 contact">Contact:</div><div class="address contact_details"><a href="javascript:void(0);" class="delete-info btn orange-small waves-effect waves-light addnew" onClick="editContact()"><i class="fa fa-edit"></i> Edit</a><span id="name1"></span><br><div class="address"><span id="add"></span><br><span id="city_state"></span><br><span id="mail"></span> <br><span id="phone"></span> </div><div class="br"></div></div>							
											
											<div id="contact_form" style="">
							                    <form role="form" name="contact-form" id="contact-form" action="<?php echo $base_url."order_transport/update_order_address";?>" method="post">
							                    	<div class="form-group w47p"><label class="control-label" for="st_first_name">First Name:</label>
													<input class="form-control" type="text" name = "st_first_name" id = "st_first_name" placeholder="First name"></div>
													<div class="form-group w47p right"><label class="control-label" for="st_last_name">Last Name:</label>
													<input class="form-control" type="text" name = "st_last_name" id="st_last_name" placeholder="Last name">
													</div><div class="br"></div>
													<div class="form-group w100p"><label class="control-label" for="st_addr1">Address:</label>
													<input class="form-control w47p" type="text" name = "st_addr1" id="st_addr1" placeholder="Adddress Line 1">
													<input class="form-control w47p right" type="text" name = "st_addr2" id="st_addr2" placeholder="Adddress Line 2">
													</div><div class="br"></div>
													<div class="form-group w47p"><label class="control-label" for="st_city">Town/City:</label>
													<input class="form-control" type="text" name = "st_city" id="st_city" placeholder="City Name"></div>
													<div class="form-group w47p right"><label class="control-label" for="st_state">State:</label>
													<div class="select-style">
									        			<select name="st_state" id ="st_state" class="form-control">
									        					
														</select>
													</div></div><div class="br"></div>
													<div class="form-group w47p"><label class="control-label" for="st_country">Country:</label>
								        			<div class="select-style">
								        				<select name="st_country" id ="st_country" class="form-control">
								        					<option value="">Select</option>
								        					<option value="US" <?php if($st_country == "US") { echo 'selected'; }?>>United States</option>
								            				<option value="CA" <?php if($st_country == "CA") { echo 'selected'; }?>>Canada</option>
															<option value="IN" <?php if($st_country == "IN") { echo 'selected'; }?>>India</option>
														</select>
													</div></div>
													<div class="form-group w47p right"><label class="control-label" for="st_zip">Zip:</label>
								    				<input class="form-control" type="text" name = "st_zip" id="st_zip" placeholder="Zip Code"></div><div class="br"></div>
								    				<div class="form-group w47p"><label class="control-label" for="st_email">Email Address:</label>
								    				<input class="form-control" type="text" name = "st_email" id="st_email" placeholder="Email"></div>
								    				<div class="form-group w47p right"><label class="control-label" for="st_phone">Phone:</label>
								    				<input class="form-control" type="text" name = "st_phone" id="st_phone" placeholder="Phone number"></div><div class="br"></div>
								    				<input type = hidden name= "orderid" id="orderid">
								    				<button aria-hidden="true" id="cancel_contact" value="cancel_contact" name="cancel_contact" class="btn black waves-effect waves-light" type="button" onClick="CloseContact()">Cancel</button>
								    				<button aria-hidden="true" id="save_contact" value="save_contact" name="save_contact" class="btn orange-small waves-effect waves-light" type="submit">Save</button>
												</form>
											</div>

											<div class="w64">Note: </div> <div class="address"> <span id="note"></span></div><div class="br"></div>
										
											
										</div>									
									</div>
				                		<div class="section">
											<div class="containerbox">
												<table id="create-table" class="table list-animal-profile">
													<thead>
													  <tr>
														<th class="first">Crates</th>
														<th>Quantity</th>
														<th>Status</th>
														<th>Paid</th>
														<th>Cost per Crate</th>														
														<th class="right">Total</th>
														<th class="animal">Animal</th>
													  </tr>
													</thead>
													<tbody id="crate_table">
														
													</tbody>
												</table>
											</div>
										</div>	
										<form class="horizontal-form" role="form" name="space-reservation-form" id="space-reservation-form" action="" method="post">									
				                        <div id="approve_action" class="btn-center">
				                        	<button aria-hidden="true" id="reject_space" value="reject_space" name="reject_space" class="btn black waves-effect waves-light" type="button" onclick="reject()">Reject</button>
				                        	<button aria-hidden="true" id="approve_space" value="approve_space" name="approve_space" class="btn orange-small waves-effect waves-light" type="button" onclick="approve()"><i class="material-icons">done_all</i> Approve</button>	  
				                        	<button aria-hidden="true" id="paid_space" value="paid_space" name="paid_space" class="btn orange-small waves-effect waves-light paid" type="button" onclick="paid_alert()">Mark Paid</button>                      	
										</div>
										<div id="paid" class="btn-center">
				                        	
				                        	<button aria-hidden="true" id="paid_space" value="paid_space" name="paid_space" class="btn orange-small waves-effect waves-light paid" type="button" onclick="paid()">Mark Paid</button>
										</div>
				                       	</form>
				                        <div id="approve_action_done" class="btn-center">
				                        	<span></span>
				                        </div>
				                </div>
				            </div>
				       
					</div>
					<!--paid alert modal-->
				
					<div class="modal fade bs-modal-lg in" id="paid-alert" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			            <div class="modal-dialog information">
			                <div class="modal-content">
			                  	<div class="modal-header">
			                        <button aria-hidden="true" data-dismiss="modal" class="close" type="button"></button>
			                        <h4 class="modal-title" id="title1" name="title1"></h4>			                      
			                    </div>
			                        
			                    <div class="modal-body">
											Are you sure you want to override the approval cycle and mark this reservation fully paid?						
								</div>
			                		
									<form class="horizontal-form" role="form" name="paid_alert_form" id="paid_alert_form" action="" method="post">
																			
			                       		<div id="approve_action_modal" class="btn-center">
			                        	<button aria-hidden="true" id="reject_space" value="reject_space" name="reject_space" class="btn black waves-effect waves-light" type="button" onclick="close_paid_alert()">Cancel</button>
			                        	<button aria-hidden="true" id="approve_space" value="approve_space" name="approve_space" class="btn orange-small waves-effect waves-light" type="button" onclick="paid()"><i class="material-icons">done_all</i> YES, OVERRIDE</button>	  
			                        	                     	
									</div>										
			                       	</form>
			                        
			                </div>
			            </div>
					</div>

					<!--Add new Animals-->
					<div class="modal fade" id="new_animals" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
					    <div class="modal-dialog">
					        <form class="horizontal-form" role="form" id="new_animals_frm" name="new_animals_frm" enctype="multipart/form-data" action="">
					            <div class="modal-content">
					                <div class="modal-header">
					                    <button aria-hidden="true" id="close_non_doobert_user_form" onClick="reservation()" class="close" type="button" title="Close"></button>
					                    <h4 class="modal-title medium marb0">Add New Animal </h4>
					                </div>
					                <div class="modal-body">
					                        <div class="form-group col-md-4 padl0 user100p">
					                            <label for="quick-animal-name" class="control-label">Animal Name:</label>
					                            <input type="text" class="form-control w144 quick-animal-name" id="quick-animal-name"  name="quick-animal-name" value="" maxlength="250"><!-- <input type='hidden' id='animal-id' name='animal-id-<?php echo $i;?>' value='0' class="animal_id" /><input type='hidden' name='animal-trasnport-id-<?php echo $i;?>' value='0' /> -->
					                        </div>
					                        <div class="form-group col-md-4 user100p">
					                            <label for="non_doobert_user_email" class="control-label">Type:</label>
					                            <div class="select-style">
					                                <select id="quick-type" name="quick-type" class="quick-type quick-type form-control" onChange="breed_data()">
					                                    <option value="">Select</option>
					                                <?php foreach ($animal_type as $v){ ?>
					                                    <option value="<?php echo $v['in_animal_type_id'];?>"><?php echo $v['st_animal_type_name'];  ?></option>
					                                <?php } ?>
					                                </select>
					                            </div>
					                        </div>
					                        <div class="form-group col-md-4 user100p breed">
					                            <label for="non_doobert_user_phone" class="control-label">Breed:</label>
					                            <div class="select-style">
					                                <select id="quick-breed" name="quick-breed" class="quick-breed quick-breed form-control" onChange="breed_select()">
					                                <option value="">Select</option>
					                                </select>
					                            </div>
					                        </div>
					                        <div class="form-group col-md-4 w36p padl0 gender user100p clearfix">
					                            <label for="non_doobert_user_vehicle_zipcode" class="control-label">Gender:</label>
					                            <div class="radio-btn radiogroup_with_lbl clearfix">
					                            	<input type="radio" class="form-control" name="quick-gender" id="quick-gender-m" value="Male"><label class="radio-inline" for="quick-gender-m">Male</label>
					                                <input type="radio" class="form-control quick-gender" name="quick-gender" id="quick-gender-f" value="Female"><label id="error-message-for-gender" class="radio-inline" for="quick-gender-f">Female</label>
					                                <input type="radio" class="form-control quick-gender" name="quick-gender" id="quick-gender-u" value="Unknown"><label id="error-message-for-gender" class="radio-inline" for="quick-gender-u">Unknown</label>
					                            </div>
					                        </div>

					                    <div class="form-group col-md-4 w30p padl0 user100p weight">
					                        <label for="non_doobert_user_vehicle_type" class="control-label">Weight (in lbs):</label>
					                        <input type="text" class="form-control weight-col quick-weight" id="quick-weight"  name="quick-weight" value="" maxlength="3">  
					                        <!-- <span id="errmsg" style="color: red"></span> -->
					                    </div>
					                    <div class="form-group col-md-4 user100p cvi">
					                        <label for="non_doobert_user_vehicle_license_plate" class="control-label">CVI?:</label>
					                        <div class="custom-checkbox w78">
					                            <input type="checkbox" name="quick-cvi" id="chk" value="Y"><label class="checkbox-inline" for="chk">Yes <a href="javascript:void(0);" class="title-tipso question" title="A CVI is a Certificate of Veterinary Inspection or Health Certificate. It is required for inter-state transports (crossing state lines) in all 50 states and in some states for intra-state transports (within state)."></a></label>
					                        </div>
					                    </div>
					                    <div class="form-group col-md-4 user100p br padl0 w36p travelling">
					                    	<label for="non_doobert_user_vehicle_color" class="control-label">Traveling with:</label>
					                        <div class="custom-checkbox ">
					                            <input type="checkbox" name="quick-travel[]" id="Collar" value="1" />
					                            <label for="Collar" class="checkbox-inline">Collar</label>
					                        </div>
					                        <div class="custom-checkbox ">
					                            <input type="checkbox" name="quick-travel[]" id="Leash" value="2" />
					                            <label for="Leash" class="checkbox-inline">Leash</label>
					                        </div>
					                        <div class="custom-checkbox">
					                            <input type="checkbox" name="quick-travel[]" id="Crate" value="3" />
					                            <label for="Crate" class="checkbox-inline">Crate</label>
					                        </div>
					                        <div class="custom-checkbox marb0">
					                            <input type="checkbox" name="quick-travel[]" id="Medicine" value="4" />
					                            <label for="Medicine" class="checkbox-inline">Medicine</label>
					                        </div>
					                                                
					                    </div>
					                    <div class="form-group col-md-4 padl0 user100p photos">
					                        <label for="non_doobert_user_vehicle_license_state" class="control-label">Photos:</label>
					                        <div class="photos">
					                            <ul id="animal-photo-attach" class="img"></ul>
					                            <div id='add_animal_img'>
					                                <a href="javascript:void(0);" class="btn primary btn-action image-button" id='1'><i class="material-icons">insert_photo</i></a><input type="file" style="display:none;" name="my_file" id="my-file">
					                            </div>
					                        </div>
					                        <input type="hidden" id="in_ord_trans_id" name="in_ord_trans_id"/>
					                        <input type="hidden" id="rotate_angle1-<?php echo $i;?>"  name="rotate_angle1-<?php echo $i;?>" value="0"/>
					                        <input type="hidden" id="crop_x1-<?php echo $i;?>" name="x1-<?php echo $i;?>"/>
					                        <input type="hidden" id="crop_y1-<?php echo $i;?>" name="y1-<?php echo $i;?>"/>
					                        <input type="hidden" id="crop_w1-<?php echo $i;?>" name="w1-<?php echo $i;?>"/>
					                        <input type="hidden" id="crop_h1-<?php echo $i;?>" name="h1-<?php echo $i;?>"/>
					                        <?php /*<input type="hidden" id="profile_pic1-<?php echo $i;?>" name="h1-<?php echo $i;?>"/>*/ ?>


					                        <input type="hidden" name="uploaded_photo1" id="uploaded_photo1" value="" />


					                        <input type="hidden" id="count_image-<?php echo $i;?>" value='0' name="count_image-<?php echo $i;?>"/>
					                    </div>
					                    <div class="clearfix"></div>
					                    <div class="modal-footer text-center no-margin">
											<button class="btn orange" title="Submit" onClick='submit_new_ani()' type="button">Submit</button>
										</div>
					                    <div class="clearfix"></div>
					                </div>        
					            </div>           
					        </form>
					        <!-- /.modal-content --> 
					    </div>
					    <!-- /.modal-dialog --> 
					</div>

					<!--crop image popup-->
					<div class="modal fade" id="crop_img_popup4" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
				      	<div class="modal-dialog message-modal">
				        	<div class="modal-content">
				          	<div class="modal-header"> 
				            <button aria-hidden="true" data-dismiss="modal" class="close cancel_close4" title="Close" type="button"></button>
				            <h4 class="modal-title">Animal Photo</h4>
				          </div>
				          <div class="modal-body">
				          <div class="scroller crop-scroller" data-always-visible="1" data-rail-visible1="1" style="height:100%; overflow:auto;">
				          	<p>Select an area of an image and then click on Save Photo button to save photo.<img id="ajax-loader-bar-rotate1" src="<?php echo base_url(); ?>assets/img/ajax-loader-bar.gif" alt="image" style="display:none;"/></p>
				            <div class="crop-img-here4"><img id="ajax-loader-bar4" src="<?php echo base_url(); ?>assets/img/ajax-loader-bar.gif" alt="image" style="display:none;"/></div>
				          </div>  
				          </div>
				          <div class="modal-footer text-center no-margin"> 
				          <button class="btn orange save_popup4_animal_photo" style="" data-dismiss="modal" onClick="javascript:void(0);" type="button" title="Save Photo">Save Photo</button>
				          <button class="btn black cancel_popup4" onclick="animal_photo()" onClick="javascript:void(0);" type="button" title="Cancel">Cancel</button>
				          </div>
				         </div>
				        <!-- /.modal-content --> 
				      </div>
				      <!-- /.modal-dialog --> 
					</div>

		    	</div>
		    </div>
		</div>
	</section>

<script src="<?php echo $base_url; ?>assets/plugins/jquery-validation/dist/jquery.validate.min.js" type="text/javascript"></script>
<!--script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script-->
<?php include 'inc/footer-dashboard.php';?>
<script src="<?php echo base_url(); ?>assets/custom_jquery/contact_form.js?v=1" type="text/javascript" charset="utf-8"></script>
<script src="<?php echo base_url(); ?>assets/scripts/tipso.js" type="text/javascript" charset="utf-8"></script> 
<script type="text/javascript">

	var app_rej_arr=[];	
	var qtyarr=[];
	var qtyid=[];
	var paid_arr=[];
	function space_reservation_popup(order_trans_ele, otid){		
		order_trans_ele = order_trans_ele || '';
		otid = otid || '';

		$('.contact').show();
	    $('.contact_details').show();
		$('#contact_form').hide();

		$('space-reservation-form').trigger('reset');

		if(otid != ''){
			var order_trans_id = otid;
		}else{
			var order_trans_id = $(order_trans_ele).data('value');
		}

		if(order_trans_id != ''){
			
			$.ajax(
		        {
		            url: base_url+"order_transport/view_reservation/"+order_trans_id,
		            dataType: "json",
		            method:"post",
		            data:{
		            	order_trans_id:order_trans_id
		            },
		           
		            success: function (data)
		            {
		            	
		            	console.log(data);
		            	console.log(data.animal);
		            	if(data)
						{
							var trans_id = data.transport_id;
							var title ="#ROPS"+data.transport_id;
							var link = base_url+"org-transportation-scheduled/"+trans_id;
							var title_link =  "<a href="+link+">"+title+"</a>";
							//"#ROPS"+data.transport_id;
							var add2 = data.add2;
							var order = data.order;
							var order_trans = data.reserve_id+'_'+data.transport_id;
							$('#space_title').html("TRANSPORT"+title_link);
							$('#reservation_id').text("RS"+data.reserve_id);
							var reserve_by = data.first_name+" "+data.last_name;
							$('#name , #name1 ').text(reserve_by);
							$('#st_first_name').val(data.first_name);
							$('#st_last_name').val(data.last_name);
							$('#contact').text(data.contact);
							$('#note').text(data.note);
							$('#phone').text(data.phone);
							$('#st_phone').val(data.phone);
							$('#st_addr1').val(data.add1);
							$('#st_addr2').val(data.add2);
							
							if(add2 != ''){
								var add = data.add1 +'\n' +data.add2;
							}else{
								var add = data.add1;
							}
							$('#add').text(add);
							var city_state =data.city +", "+data.state+" - "+data.zip;
							$('#st_city').val(data.city);
							var code ='';
							for( var j=0; j <= data.statelist; j++){
					    			var cls = '';
					    			if(data.state == j){
					    				var cls = 'selected = "selected"';
					    			}
					    			
					    		code += '<option value = "'+j+'" '+ cls +'> '+ j +'</option>';
					    		}
					    		
					    		//console.log(data.state);

							//$('#st_state').val(statelist);
							//$(this).attr('selected', 'selected');
							$('#st_country').val(data.country);
							$('#st_country').trigger("change");
							$('#st_state').val(data.state);
							$('#city_state').text(city_state);
							$('#st_zip').val(data.zip);
							$('#mail').text(data.mail);	
							$('#st_email').val(data.mail);
							$('#order_date').text(data.order_date);
							$('#pick_add').text(data.pick_up);
							$('#pick_date').text(data.pick_up_date);
							$('#drop_add').text(data.drop_off);
							$('#drop_date').text(data.drop_off_date);
							$('#trans_add').text(data.trans_add);
							$('#orderid').val(data.reserve_id);				



						if(order.length > 0)
					    {
					       	var code = '';
					       	var total_cost_code ='';
					       	var total_cost = data.total_cost;
					       	var in_approval_arr =[];
					       	var waitarr=[];
					       	for(var i=0; i<order.length;i++)
					    	{
					    		var crate_type = order[i].st_crate_type;
					    		var qty = order[i].in_qty;
					    		var cost = order[i].cost;
					    		var total = order[i].total;
					    		var waitlistval = order[i].is_waitinglist;
					    		var in_approve = order[i].in_approval_o;
					    		var in_id = order[i].in_id;
					    		var in_crate_id = order[i].in_crate_id;
					    		var waitlist = "";
								var crate_qty = 0;
					    		if(waitlistval == 1){
					    			waitlist = "Waitlist";
					    		}else if(waitlistval == 2 && in_approve == 1){
					    			waitlist = "payment pending";
					    		}

					    		var status = order[i].crate_status;
					    		var orderqty = order[i].orderqty;
					    		var total_crate = order[i].in_crate_qty;
					    		//console.log(total_crate);
					    		if(orderqty){
					    			var crate_qty = total_crate - orderqty ;
					    		}else{
					    			var crate_qty = total_crate;
					    		}
					    		//console.log(total_crate+'||'+orderqty+'||'+crate_qty+'||'+qty);
					    		waitarr.push(waitlist);
					    		
					    		temp_cost = cost.substring(0,cost.length-3)

					    		var changeqty = in_crate_id+'_'+temp_cost+'_'+crate_qty;

					    		
					    		if(status == 'Approved' || status == 'Rejected'){
					    			code+= '<tr><td><div class="check"><input type="checkbox" class="approve_reject"  data-qty ="quantity_'+changeqty +'" value="" id="chk_'+in_crate_id+'" disabled><label>'+crate_type+' Crates</label></div></td>';
					    			code += '<td><div class="select-style1"><select name="quantity[]" value="" id ="quantity_'+changeqty +'" class="form-control quantity" onchange="cost_per_crate(this.value,this.id)">';
					    			code += '<option value = "'+j+'" selected = "selected" disabled> '+ qty +'</option>';
					    		}else{			    			
					    			
					    			code+= '<tr><td><div class="check"><input type="checkbox" class="approve_reject" data-value='+in_id+' data-qty ="quantity_'+changeqty +'"  id="chk_'+in_crate_id+'"  checked><label>'+crate_type+' Crates</label></div></td>';

					    		
						    		code += '<td><div class="select-style1"><select name="quantity[]" value="" id ="quantity_'+changeqty +'" class="form-control quantity" onchange="cost_per_crate(this.value,this.id)">';

						    	
							    		for( var j=0; j <= total_crate; j++){
							    			var cls = '';
							    			if(qty == j){
							    				var cls = 'selected = "selected"';
							    			}
							    			
							    			code += '<option value = "'+j+'" '+ cls +'> '+ j +'</option>';
							    		}
							    	code += '</select></div></td>';
						    	}
					    		code+='<td>'+status+'</td>';
					    		if(waitlistval != 0){
					    			mark ='';
					    		}else{
					    			mark = 'disabled';
					    		}

					    		code+='<td><div class="check"><input type="checkbox" class="paid_space" data-value='+in_id+' data-qty ="quantity_'+changeqty +'"  id="paid_'+in_crate_id+'" '+mark+'></div></td>';
					    		code+='<td>$'+cost+' per crate <br><span style ="color:red;">'+waitlist+'</span> </td><td class="right crate_total crate_total_'+in_crate_id+'">$'+total+'</td>';
					    		in_approval_arr.push(in_approve);
					    		code += '<td><div class="routeAnimalDtl dtl_'+in_crate_id+'" id="routeAnimalDtl_'+in_crate_id+'">';
					    		
					    		
					    		
								if(data.animal!= ''){ 														
									
									var obj = data.animal;
									$.each( obj, function( key, value ) {
										
										if(key == in_crate_id){
									  	$.each(value, function (vKey, val){
									  		//var img = val.animal_pic;											
											var img_url= base_url+'upload/animal_images/36x36/';
											var pic = val.animal_pic;;
											var img;
											if(pic == '' || pic == undefined){

												img = 'doobert-animal-no-image-70.gif';
											}else{
												img = pic;
											}
											var image = img_url+img;
											console.log(image);
											code +='<div class="selectanim dtl_'+in_crate_id+'">';	
									  		code += 	'<a href="javascript:void(0)" class="remove_img" onClick="remove_animal(this)" data-val="'+val.animal_id+'" >X</a><div class="Aimg"><img src="'+ image+'"></div><div class="animtext"><span class="Aname">'+val.animal_name +'</span><span class="Abreed"><i> '+ val.animal_breed + '</i></span></div><div class="br"></div>';
									  		code +='</div>';
									  	});
									  }
									  	
									  	if(($('.dtl_'+in_crate_id).length) == 5){
											$('.AniBtn'+in_crate_id).hide();
										}else{
											$('.AniBtn'+in_crate_id).show();
										}
									  	
									});
									
								}
								code += '</div> <div class="btn-center AniBtn'+in_crate_id+'" id="route_animal_btn"><button aria-hidden="true" id="add_animal" value="add_animal" name="add_animal" class="btn orange-small waves-effect waves-light" type="button" data-value ="'+in_crate_id+'" onclick="new_animal_open(this)"> <i class="material-icons">add_circle</i> Add New Animal</button></div></td>';
								

							}
							
							code+= '<tr class="bggrey"><td colspan="5" class="right">Total Cost:</td><td class="right total_cost">$'+total_cost+'</td><td></td></tr>';
							
							$('#crate_table').empty();
							$('#crate_table').append(code);
							$('#approve_space').data('order_trans',order_trans);
							$('#reject_space').data('order_trans',order_trans);
							jQuery('#create-table').cardtable();
						
								// var result;
								// if($.inArray(waitlist, waitarr)){
								// 	result = "In_wait";
								// }else{
								// 	result = "Available";
								// }
							

								if($.inArray("0", in_approval_arr) != -1){
									//alert("1");
									$('#approve_action').show();								
									$('#paid').hide();
									$('#approve_action_done span').hide();
									
								}else {
									if($.inArray("payment pending", waitarr) != -1){
										//alert("2");
										$('#paid').show();
										$('#approve_action').hide();
										$('#approve_action_done span').hide();
									}else{
										//alert("3");
										$('#paid').hide();
										$('#approve_action').hide();
										$('#approve_action_done span').hide();
									}								
									
								}
								/*}else{
									$('#approve_action').show();
									$('#approve_action_done span').show();
									$('#approve_action_done span').text('This reservation is pending approval');
									$('#approve_action_done span').css({ 'color':'red', 'font-size': '150%' });
								}
							}
							if(in_approval_o == 1){
								$('#approve_action').hide();
								$('#approve_action_done span').show();
								$('#approve_action_done span').text('Approved');
								$('#approve_action_done span').css({ 'color':'#63c801', 'font-size': '150%' });
							}
							if(in_approval_o == 2){
								$('#approve_action').hide();
								$('#approve_action_done span').text('Rejected');
								$('#approve_action_done span').show();
								$('#approve_action_done span').css({ 'color':'#b3b3b3', 'font-size': '150%' });
							}*/

							
							jQuery('#space-reservation').modal('show');
						}
						else
						{
						  	window.location.href=base_url+"space-reservation";
						}
					}
		        }
		    });
	    }else{
			window.location.href=base_url+"space-reservation";
			
		}
	}


	
	

	function approve(){	

		if($(window).width()<=767)
		 {
		 	var class_name = '.small-only';
		 } else {
		 	var class_name = '#create-table';
		 }	


		var success ='0';
		var unchecked = '0'; 
		
		$(class_name+' .quantity').each(function() 
		{
			var quantity ='';
			var qtyid = $(this).attr('id');
			var temp = qtyid.split('_');					
			var id = temp[1];
			var cost = temp[2];
			var avlqty = temp[3];
			var val = $(this).val();

			//$(class_name+' .approve_reject').each(function () {

				if($(class_name+' #chk_'+id).prop('checked'))
				{	
					var result  = cost_per_crate(val,qtyid);
					if(result == false){
						$(class_name+' #chk_'+id).prop('checked', false); 
				 		return false;
					}else{
						
						 var qtyid = $(class_name+' #chk_'+id).data('qty');
						 var app_rej_id = $(class_name+' #chk_'+id).data('value');
						
						 var idx = $.inArray(app_rej_id, app_rej_arr);
						 if (idx == -1) {
						   app_rej_arr.push(app_rej_id);
						   $('#card-table-fromto  #'+app_rej_id).val('1');
						 } /*else {
						   app_rej_arr.splice(idx, 1);
						 }*/
						 unchecked++;
						
						success = 1;
					}
				} else{
					//approve1();
					success = 1;
				}
			
		});	
		if(success == 1){
			approve1();
		} 	
		
	}


	function approve1(){

		var order_trans_id = $('#approve_space').data('order_trans');
		var url = base_url+"order_transport/approve_reservation/"+order_trans_id;
		
		qtyarr = $.grep(qtyarr,function(n){ return n == 0 || n });
		
		$.ajax(
	        {
	            url: url,
	            dataType: "json",
	            method:"post",
	            data:{
	            	order_trans_id:order_trans_id,
	            	app_rej_arr:app_rej_arr,
	            	in_qty:qtyarr,
	            },
			
			
	            beforeSend: function(){
		        	$('#space-reservation').hide();
		       		$('#loader1').show();
		        },
	          	success: function (data)	            
	            {
	            	$('#loader1').hide();    	
	            	if(data.res == true){
	            		window.location.href=base_url+"space-reservation";
	            	}	            	
	            	else{
	            		alert('Please select crates to approve.');
	            		window.location.href=base_url+"space-reservation";            		
	            	}
	          	}
	       
	    });
	}
	



	function reject(){
		if($(window).width()<=767)
		 {
		 	var class_name = '.small-only';
		 } else {
		 	var class_name = '#create-table';
		 }	

		var success ='0';
		var unchecked = '0'; 
		
		$(class_name+' .quantity').each(function() 
		{
			var quantity ='';
			var qtyid = $(this).attr('id');
			var temp = qtyid.split('_');					
			var id = temp[1];
			var cost = temp[2];
			var avlqty = temp[3];
			//$(class_name+' .approve_reject').each(function () {

				if($(class_name+' #chk_'+id).prop('checked'))
				{	
					
						 var qtyid = $(class_name+' #chk_'+id).data('qty');
						 var app_rej_id = $(class_name+' #chk_'+id).data('value');
						
						 var idx = $.inArray(app_rej_id, app_rej_arr);
						 if (idx == -1) {
						   app_rej_arr.push(app_rej_id);
						   $('#card-table-fromto  #'+app_rej_id).val('1');
						 } /*else {
						   app_rej_arr.splice(idx, 1);
						 }*/
						 unchecked++;
						console.log(app_rej_arr);
						success = 1;
				
				} else{
					
					success = 1;
				}
			
		});	
		if(success == 1){
			reject1();
		}	
	}

	function reject1(){		
		var order_trans_id = $('#reject_space').data('order_trans');
		var url = base_url+"order_transport/reject_reservation/"+order_trans_id;
		qtyarr = $.grep(qtyarr,function(n){ return n == 0 || n });
		$.ajax(
	        {
	            url: url,
	            dataType: "json",
	            method:"post",
	            data:{
	            	order_trans_id:order_trans_id,
	            	app_rej_arr:app_rej_arr,
	            	in_qty:qtyarr,

	            },
	            beforeSend: function(){
		        	$('#space-reservation').hide();
		       		$('#loader1').show();
		        },

	          	success: function (data)	            
	            {	
	            	$('#loader1').hide();
	            	if(data.res == true){
	            		window.location.href=base_url+"space-reservation";
	            	}else{
	            		alert('Please select crates to reject.');
	            		window.location.href=base_url+"space-reservation";
	            	}
	          	}
	       
	    });
	}


	$('#st_country').on('change',function(){
		var country_name = $(this).val();
		var state_list = '';
		
		if(country_name == 'US') {
				'<?php $statelist = $this->common_function->state_list;?>';			
				state_list += '<option value="">Select</option>';
				state_list += '<?php foreach($statelist as $key=>$val) { ?>';
				state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
				state_list += '<?php } ?>';
			
		}else if(country_name == 'CA'){
				'<?php $Cstatelist = $this->common_function->canadian_state_list;?>';
				state_list += '<option value="">Select</option>';
				state_list += '<?php foreach($Cstatelist as $key=>$val) { ?>';
				state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
				state_list += '<?php } ?>';
		}
		else if(country_name == 'IN'){
				'<?php $statelist = $this->common_function->indian_state_list;?>';
				state_list += '<option value="">Select</option>';
				state_list +='<option value="" disabled>--------------------- INDIA ---------------------</option>';
				state_list += '<?php foreach($statelist as $key=>$val) { ?>';
				state_list += ' <option value="<?php echo $key; ?>"><?php echo $val;  ?></option>';
				state_list += '<?php } ?>';
		}
		
		$('#st_state').html(state_list); 
	});



	function editContact(){

		$('.contact').hide();
		$('.contact_details').hide();
		$('#contact_form').show();
	}

	/*function change_status(ele){
		var qtyid = $(ele).data('qty');
		var app_rej_id = $(ele).data('value');
		var quantity = '';
	    var idx = $.inArray(app_rej_id, app_rej_arr);
		if (idx == -1) {
		  app_rej_arr.push(app_rej_id);
		  $('#card-table-fromto  #'+app_rej_id).val('1');
		} else {
		  app_rej_arr.splice(idx, 1);
		}

		// var result  = cost_per_crate(quantity,qtyid);
		// if(result == false){
		// 	$(ele).prop('checked', false); 
		// }

	}*/

	function cost_per_crate(quantity, qtyid)
	{	
		
		quantity = quantity || '';
		qtyid = qtyid || '';
		var prev_val = $('#'+qtyid).val();
		
		if(quantity ==''){
			var quantity = prev_val;
		}else{
			var quantity = quantity;
		}
		if($(window).width()<=767)
		{
		 	var class_name = '.small-only';
		} else {
		 	var class_name = '#create-table';
		}	

		var temp = qtyid.split('_');					
		var id = temp[1];
		var cost = temp[2];
		var avlqty = temp[3];
		var result ='';
		var crate_qty = quantity+"_"+id;
		if(parseInt(quantity) <= parseInt(avlqty)){
			if(jQuery.inArray(id, qtyid) != -1) {
			    qtyarr[id]	=	crate_qty;
			    
			} else {
			    qtyid = id;
			    qtyarr[id]	=	crate_qty;
			}
				
			
			
			var total = "$"+(quantity*cost).toFixed(2);
			jQuery(class_name+' .crate_total_'+id).html(total);
			total_cost();
			var result = true;
		}else{
			if(avlqty>0){
				alert("You have only "+ avlqty + " quantity left.");
			}else{
				alert("You have only zero quantity left.");
			}
			preval = parseInt(prev_val)+1;	
			$('#'+qtyid+' option:selected').removeAttr('selected');
			$('#'+qtyid+' option:nth-child('+preval+')').attr('selected','selected');		
			var result = false;
		}
		return result;
	}

	function total_cost()
	{
		
		if($(window).width()<=767)
		 {
		 	var class_name = '.small-only';
		 } else {
		 	var class_name = '#create-table';
		 }	

		var total = 0;
		$(class_name+' .crate_total').each(function() 
		{
			var temp_cost_per_crate = jQuery(this).text();
			var cost_per_crate = temp_cost_per_crate.substring(1, temp_cost_per_crate.length);		
			total = parseFloat(total) + parseFloat(cost_per_crate);		

		});	
		jQuery(class_name+' .total_cost').html("$"+total+".00");	
		total_amount = 	total;
	}

	function paid_alert(){
		jQuery('#paid-alert').modal('show');
		jQuery('#space-reservation').modal('hide');
	}


	function close_paid_alert(){
		jQuery('#paid-alert').modal('toggle');
	}

	function paid(){
		jQuery('#paid-alert').modal('toggle');
		if($(window).width()<=767)
		 {
		 	var class_name = '.small-only';
		 } else {
		 	var class_name = '#create-table';
		 }	

		var success ='0';
		var unchecked = '0'; 
		
		$(class_name+' .quantity').each(function() 
		{
			var quantity ='';
			var qtyid = $(this).attr('id');
			var temp = qtyid.split('_');					
			var id = temp[1];
			var cost = temp[2];
			var avlqty = temp[3];
			//$(class_name+' .approve_reject').each(function () {

				if($(class_name+' #paid_'+id).prop('checked'))
				{	
					
						 var qtyid = $(class_name+' #paid_'+id).data('qty');
						 var paid_id = $(class_name+' #paid_'+id).data('value');
						
						 var idx = $.inArray(paid_id, paid_arr);
						 if (idx == -1) {
						   paid_arr.push(paid_id);
						   $('#card-table-fromto  #'+paid_id).val('1');
						 } /*else {
						   app_rej_arr.splice(idx, 1);
						 }*/
						 unchecked++;
						console.log(paid_arr);
						success = 1;
				
				} else{
					
					success = 1;
				}
			
		});	
		if(success == 1){
			paid1();
		}	
	
	}


	function paid1(){	
	
		var order_trans_id = $('#reject_space').data('order_trans');
		var url = base_url+"order_transport/paid_reservation/"+order_trans_id;
		qtyarr = $.grep(qtyarr,function(n){ return n == 0 || n });
		$.ajax(
	        {
	            url: url,
	            dataType: "json",
	            method:"post",
	            data:{
	            	order_trans_id:order_trans_id,
	            	paid_arr:paid_arr,
	            	in_qty:qtyarr,

	            },
	            beforeSend: function(){
		        	$('#space-reservation').hide();
		       		$('#loader1').show();
		        },

	          	success: function (data)	            
	            {	
	            	$('#loader1').hide();
	            	if(data.res == true){
	            		window.location.href=base_url+"space-reservation";
	            	}else{
	            		alert('Please select crates to mark paid.');
	            		window.location.href=base_url+"space-reservation";
	            	}
	          	}
	       
	    });
	}


	function remove_animal(ele){
		ele = ele || '';		
		if(confirm("Are you sure, you want to delete selected animal profile(s)?.")){		
			$(ele).parent().remove();
			var route_animal_id = $(ele).attr('data-val');			
			$.ajax({
				type:'POST',
				async:false,
				url:base_url+'org_transportation/delete_route_animals/',
				data:{
					route_animal_id:route_animal_id,
				},
				success:function(data){		

					console.log(data);				
					if(data.length > 0){
						console.log(data.length);
						var detail = '';
						$.each(data, function (key, value) {
							
							var ord_trans_crate_id = value.in_ord_trans_id;
							var temp = ord_trans_crate_id.split("/");
							var crateId =  temp[1];		
							$('#routeAnimalDtl_'+crateId).empty();					
							//var img = value.st_animal_photo;
							var pic = value.st_animal_photo;
							var img;
							if(pic == '' || pic == undefined){

								img = 'doobert-animal-no-image-70.gif';
							}else{
								img = pic;
							}

							var aname = value.st_animal_name;
							var bname = value.st_animal_breed_name;
							var img_url= base_url+'upload/animal_images/36x36/';
							var image = img_url+img;
							detail += 	aname +' '+ bname + '<img src="'+ image+'"> <a href="javascript:void(0)" class="remove_img" onClick="remove_animal(this)" data-val="'+value.in_route_animal_id+'" >X</a><br>';
							
							$('#routeAnimalDtl_'+crateId).append(detail);
						})

					}
				},
			});
		}else{
			return false;
		}
		
	}

	function breed_select(){
		jQuery("#quick-breed").parent('div').removeClass('has-error');	
	}

	function breed_data(){
			jQuery("#quick-type").parent('div').removeClass('has-error');	
			var animalid = $("#quick-type").val();
			var base_url = "<?php echo $base_url;?>";		
			$("#quick-breed").html('');
			if(animalid){
				$.ajax({
					url: base_url+"org_animal_notify/animal_breed",
				    dataType: "json",
				    method:"post",
				    beforeSend: function() {
						$('#loader').show();				
					  },
				    data:{
				       	animalid:animalid
				    },		
					success:function(data) 
					{
						$('#loader').hide();
						var row = '';
						//console.log(data);
						row += "<option value=''>Select</option>";
						$.each(data, function(key,value){
							
							row += '<option value="'+value['in_animal_breed_id']+'">'+value['st_animal_breed_name']+'</option>';
							
							console.log(row);
						});
						$("#quick-breed").append(row);
					}		
				});
			}else{
				$("#quick-breed").append("<option value=''>Select</option>");
			}
		}

		$(document).on('click','.image-button',function(){		
	   //	$('#new_animals').modal('toggle');
	    $('#my-file').click();
		id = $(this).attr('id');
	});

	$(document).ready(function() {

		$("#quick-weight").keypress(function (e) {			
		     //if the letter is not digit then display error and don't type anything
		     if (e.which != 8 && e.which != 0 && (e.which < 48 || e.which > 57)) {
		        //display error message
		        //$("#errmsg").html("Digits Only").show().fadeOut("slow");
		               return false;
		    }
		});


		$(document).on('change','#my-file',function(e) {
			$('#loader').show();
			var error_msg = '';
			if($('#my-file').val()!='') {
				var ind = $('#count_image-'+id).val();
				ind = parseInt(ind)+parseInt(1);
				var fsize1 = $('#my-file')[0].files[0].size;
				console.log(fsize1);
				var fname1 = $('#my-file')[0].files[0].name;
				var ftype1 = $('#my-file')[0].files[0].type;
				
				if(fsize1 > 10485760) {	
				
					$('#my-file').val('');
					error_msg+='Animal photo must be less than 10MB.\n';
				}
				
				if(ftype1 != 'image/jpeg' && ftype1 != 'image/gif' && ftype1 != 'image/png' && ftype1 != 'image/jpg') {
					error_msg+='Animal photo format is invalid.\n';
				}
				

				$("#uploaded_photo1").val('');
				$("#uploaded_photo1").val(fname1);
						
				//$('.crop-img-here4').html('<img class="cropper4" id="crop-image-rotate4" src="http://crystal99/doobert-v3/upload/test_animal_images/'+fname1+'" width="500px"><div class="rotation"><span class="clockwise"><a id="rotateLeft4" title="anti-clockwise" href="javascript:void(0);"> <i class="fa fa-rotate-left"></i> anti-clockwise</a></span> <span class="anti-clockwise"><a id="rotateRight4"  title="clockwise" href="javascript:void(0);"> <i class="fa fa-repeat"></i>clockwise</a></span></div>');
						
				$.ajaxFileUpload({
					type:'POST',
					url: base_url+'org_transportation/ajax_file_upload', 
					secureuri:false,
					data:'1',
					fileElementId:'my-file',
					dataType: 'json',	
					async:false,
					success:function(data,e) {
						$('#loader').hide();
						console.log(data);
					if(data.upload_error != undefined || $.trim(data.upload_error) != '') {
							$('#crop_img_popup1').modal('hide');
							console.log(data.upload_error);
							if(data.upload_error == "You did not select a file to upload."){
								alert("Animal photo must be less than 5MB.");
							}else{
								alert(data.upload_error);
							}
							
							$('.image_preview1').html('');
							$('#profile_pic1').hide();
							return false;
					}
					
					$("#uploaded_photo1").val(data.file_name);
					
					$('.crop-img-here4').html('<img id="crop-image-rotate1" class="cropper1 img_url" src="'+base_url+'upload/animal_images/'+data.file_name+'"><div class="rotation"><span class="clockwise"><a id="rotateLeft1" title="Rotate Left" href="javascript:void(0);"> <i class="fa fa-rotate-left"></i> anti-clockwise</a></span> <span class="anti-clockwise"><a id="rotateRight1" title="Rotate Right" href="javascript:void(0);"> <i class="fa fa-repeat"></i>clockwise</a></span></div>');
					
			
					$('#crop_img_popup4').modal('show');
					
					var $cropper = $('.cropper1'),
						$dataX = $("#crop_x"+ind+"-"+id),
						$dataY = $("#crop_y"+ind+"-"+id),
						$dataH = $("#crop_h"+ind+"-"+id),
						$dataW = $("#crop_w"+ind+"-"+id),
						cropper;
					$cropper.cropper({
						//aspectRatio: 16 / 12,
						data: {
							x: $dataX,
							y: $dataY,
							width: $dataW,
							height: $dataH
						},
						//rotatable : true,
						zoomable : false,
						minWidth: 50,
						minHeight: 50,
						built: function (e) {
							console.log(e.type);

								var n_x1	=	$("#crop_x"+ind+"-"+id).val();
								var n_y1	=	$("#crop_y"+ind+"-"+id).val();
								var n_h1	=	$("#crop_h"+ind+"-"+id).val();
								var n_w1	=	$("#crop_w"+ind+"-"+id).val();
								
								$("#crop_x"+ind+"-"+id).val(n_x1);
								$("#crop_y"+ind+"-"+id).val(n_y1);
								$("#crop_h"+ind+"-"+id).val(n_h1);
								$("#crop_w"+ind+"-"+id).val(n_w1);
								var imgdata1 = $('#crop-image-rotate1').cropper("getImageData");
								$('#rotate_angle'+ind+'-'+id).val(imgdata1.rotate);
								$('#ajax-loader-bar-rotate1').hide();
							},
						
						
						done: function(data) {
							$dataX.val(data.x);
							$dataY.val(data.y);
							$dataH.val(data.height);
							$dataW.val(data.width);
							//$dataRotate.val(data.rotate);
						}
						
				
					});
					
					
					cropper = $cropper.data("cropper");
					
					//$(".save_popup1_animal_photo").show();
					
					$(document).on('click',"#rotateLeft1",function() {														 
						$('#ajax-loader-bar-rotate1').show();
						$cropper.cropper("rotate", -90);
						
					});
				
					$(document).on('click',"#rotateRight1",function() {
						$('#ajax-loader-bar-rotate1').show();
						$cropper.cropper("rotate", 90);
						
					});
					},
					error:function(a,b,c){
						//alert("HII12345");
					},
				});		
			}
		});
		$(document).on('click','.save_popup4_animal_photo',function(){
		
			$('#animal-photo-attach').html('');
			var image_name = $('.img_url').attr('src');
			var img_name = image_name.substring(image_name.lastIndexOf('/')+1)+"__"+id;	
			
			$('#animal-photo-attach').append('<li><img src="'+image_name+'"  alt="" title="">'+ '&nbsp;</li>');		
			
			var count_image = $('#count_image-'+id).val();
				count_image = parseInt(count_image) + parseInt(1);	
			
			$('#count_image-'+id).val(count_image);
			$('#crop_img_popup4').modal('hide');
			$('#new_animals').modal('show');
			// if(count_image== 1)
			// {
				$('#add_animal_img').hide();
			//}
		});	
	});
	
	function new_animal_open(ele){	
	ele = ele || ''	;

		$('#new_animals_frm').trigger('reset');
		$("#uploaded_photo1").val('');
		// $('#animal-photo-attach').hide();
		// $('#add_animal_img').show();

		var crate_id = $(ele).data("value") ;		
		$('#space-reservation').modal('hide'); 		
		$("#in_ord_trans_id").val(crate_id);
		
		$('#new_animals').modal('show'); 
	}

	function animal_photo() {
		$('#new_animals').modal('show');
		$('#crop_img_popup4').modal('hide');
	}

	function submit_new_ani(){
		var err = 0;
		var message='';
		jQuery( "#new_animals_frm" ).validate();

		if($('#quick-animal-name').val()!= ''){
			var type = $("#quick-type").val();
		    if(type == ''){
		    	message += "Type is required.\n";	
		    	err =1;
		    }

			var breed = $("#quick-breed").val();
		    if(breed == ''){
		    	message += "Breed is required.\n";
		    	err =1;
		    }

		    

		   	if($('input:radio[name="quick-gender"]').length >0)
			{	
			var genders = $('input:radio[name="quick-gender"]:checked').val();
			}else{
				genders ='';
			}
			
		    if(genders == undefined || genders == '') {
		    	message += "Gender is required.";
		    	err =1;
		    }



		    if(breed == ''){
	        jQuery("#quick-breed").parent('div').addClass('has-error');
		        err = 1;
		    }else{
		    	jQuery("#quick-breed").parent('div').removeClass('has-error');		    	
		    }

		    if(type == ''){
	        jQuery("#quick-type").parent('div').addClass('has-error');
		        err = 1;
		    }else{
		    	jQuery("#quick-type").parent('div').removeClass('has-error');
		    }


		   if(genders == undefined || genders == ''){
	        jQuery("#quick-gender-m").parent('div').addClass('has-error');
		        err = 1;
		    }else{
		    	jQuery("#quick-gender-m").parent('div').removeClass('has-error');
		    }


		    if(err == 1){
		    	alert(message);
		    }



		}else{
			alert("Please enter animal name.");
		}
		

		var ids = last_inserted_animal_id = 0;
		var ord_id = $('#reservation_id').text().slice(2);
		var trans = $('#space_title').text();
		var trans_id = trans.substr(trans.length - 4);
		
		var in_ord_trans_id = $('#in_ord_trans_id').val();
		var in_animal_id ='';
		if($('input:radio[name="quick-gender"]').length >0)
		{	
			var genders = $('input:radio[name="quick-gender"]:checked').val();
		} else {
			var genders = '';
		}
		if($('#quick-animal-name').length >0)
		{	
			var animals_name = $('#quick-animal-name').val();
		} else {
			var animals_name = '';
		}
		if($('#quick-type').length >0)
		{		
			var animals_type = $('#quick-type').val();
		} else {
			var animals_type = '';
		}

		if($('#quick-breed').length >0)
		{		
			var animal_breeds = $('#quick-breed').val();
		} else {
			var animal_breeds = '';
		}
		if($('#animal-id').length >0)
		{	
			var animals_id = $('#animal-id').val();
		} else {
			var animals_id = '';
		}
		if($('#quick-weight').length >0)
		{		
			var animals_weight = $('#quick-weight').val();
		} else {
			var animals_weight = '';
		}	
		var travelling_with = new Array();
		if($('input[name="quick-travel[]"]').length >0)
		{	
			$('input[name="quick-travel[]"]:checked').each(function(e) {
				travelling_with.push(this.value);
				
				});
		}
		if($('#chk').length >0)
		{		
			if($('#chk').prop('checked'))
			{
				var cvis = 'Y';
			} else {
				var  cvis = 'N';
			}
		} else {
			var  cvis = '';
		}	
		if($('#uploaded_photo1').length >0)
		{
			var animal_pic = $('#uploaded_photo1').val();
		}else{
			
			var animal_pic = '';
		}
		/*if($('#quick-animal-name').val()!= ''){
			if(animal_pic == ''){
				alert("Animal image is not added.");
			
			}
		}*/
	
		var myData={"animal_name":animals_name,"animal_type":animals_type,"animal_breed":animal_breeds,
					"gender":genders,"travelling_with":travelling_with,"cvi":cvis,'animals_id':animals_id,
					"animal_weight":animals_weight,"in_ord_trans_id":in_ord_trans_id, "in_animal_id":in_animal_id, "animal_pic":animal_pic,"ord_id":ord_id
			};	
		
		if(animals_name != '' && animals_type!='' && animal_breeds!='' &&  genders!=undefined && genders!='')
		{
			$.ajax({
				type: "POST",
				url: base_url+'org_transportation/add_new_route_animal',
				data: myData, 						
				dataType:"json",
				 beforeSend: function(){
        			// $("#reserve_space").attr("disabled", true);
       				// $('#space-reservation-form').hide();
       				$('#loader1').show();
        		},

				success:function(data) 
				{
					$('#loader1').hide();
					console.log(data);				
					if(data.length > 0){
						var detail = '';
						$.each(data, function (key, value) {							
							var ord_trans_crate_id = value.in_ord_trans_id;
							var temp = ord_trans_crate_id.split("_");
							var crateId =  temp[1];		
							console.log(crateId);
							$('#routeAnimalDtl_'+crateId).empty();					
							var pic = value.st_animal_photo;
							var img;
							if(pic == '' || pic == undefined){
								img = 'doobert-animal-no-image-70.gif';
							}else{
								img = pic;
							}

							var aname = value.st_animal_name;
							var bname = value.st_animal_breed_name;
							var img_url= base_url+'upload/animal_images/36x36/';
							var image = img_url+img;
							console.log(image);

							//detail += 	'<div class="dtl_'+crateId+'"> <div class="Aimg"> <img src="'+ image+'"> </div> <div> <span class="Aname">'+aname +'</span> <span class="Abreed"> '+ bname + '</span><a href="javascript:void(0)" class="remove_img" onClick="remove_animal(this)" data-val="'+value.in_route_animal_id+'" >X</a></div></div><br>';
							detail += 	'<div class="selectanim dtl_'+crateId+'"><a href="javascript:void(0)" class="remove_img" onClick="remove_animal(this)" data-val="'+value.in_route_animal_id+'" >X</a><div class="Aimg"><img src="'+ image+'"></div><div class="animtext"><span class="Aname">'+aname +'</span><span class="Abreed"><i> '+ bname + '</i></span></div><div class="br"></div></div>';
							
							$('#routeAnimalDtl_'+crateId).append(detail);

							if(($('.dtl_'+crateId).length) == 5){
								$('.AniBtn'+crateId).hide();
							}else{
								$('.AniBtn'+crateId).show();
							}
						})

					}
				}
			});
			$('#animal-photo-attach').html('');
			$('#add_animal_img').show();	
			$('#new_animals').modal('hide');		
			space_reservation_popup("", ord_id+'_'+trans_id);
		}

		 
	}

	function reservation(){	
		$('#animal-photo-attach').html('');
		$('#add_animal_img').show();	
		$('#Listing_animals').modal('hide');
		$('#new_animals').modal('hide');		
		$('#space-reservation').modal('show');

	}

	function myFunction() 
	{
		var x = document.getElementById("myTopnav");
		if (x.className === "topnav") 
		{
			x.className += " responsive";
		} else {
			x.className = "topnav";
		}
	}

</script>